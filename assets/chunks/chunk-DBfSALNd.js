import{b1 as ud,u as C0,aW as Yf,d as eh,aA as H_,p as M0,bb as np,X as Yu,I as K_,c as op,D as Hf,f as ep,o as Kf,g as J_,b as Nu,F as Q_,$ as rh,be as A0,O as P0,i as ty,a0 as fp,a as L0,w as Lu,m as Fc,W as Wh,Y as D0,Z as R0}from"./chunk-BAtEUBju.js";import{n as O0}from"./chunk-Dd5vnLK-.js";import{T as o_}from"./chunk-Ch0SDxT-.js";const N0={type:"FeatureCollection",features:[]},cd=()=>{const b=ud("vmMap");if(!b)throw new Error("useMap() 必须在作为 VmMap 组件的叶子节点上使用");return C0(b)},z0=()=>{const b=ud("vmLayer");if(!b)throw new Error("useLayer() 必须在作为 Layer 组件的叶子节点上使用");return b},ey=()=>ud("vmSource",null),k0=(b,T)=>{Yf(()=>{b.value.maxzoom=T.maxzoom}),Yf(()=>{b.value.minzoom=T.minzoom})};var Vu=eh({name:"VmAddSource",setup(){const b=ey();if(!b)throw new Error("can't find source");const T=cd(),E=async A=>{await K_(),T.getLayer(A)&&T.removeLayer(A),T.removeSource(A)};return H_(()=>b.value,(A,D)=>{if(D&&A.id===D.id){const z=T.getSource(A.id);if(z.type==="geojson"){A.type==="geojson"&&z.setData(A.data);return}}A&&(T.getSource(A.id)||T.addSource(A.id,M0(A,{excludes:["id"]}))),D&&E(D.id)},{immediate:!0}),np(()=>{E(b.value.id)}),{source:b}}});function B0(b,T,E,A,D,z){return Yu(b.$slots,"default",{source:b.source})}Vu.render=B0;Vu.__file="add-source/src/index.vue";Vu.install=b=>{b.component(Vu.name,Vu)};const hd={data:{type:[Object,String],default:()=>N0},id:{type:String,default:"geojson"}},F0=rh(hd),ry={};var iy=Object.freeze({__proto__:null,props:hd,createBindProps:F0,emits:ry}),Gu=eh({name:"VmGeojsonSource",components:{VmAddSource:Vu},emits:ry,props:hd,setup(b){const T=op(()=>({id:b.id,type:"geojson",data:b.data}));return Hf("vmSource",T),{source:T}}});function U0(b,T,E,A,D,z){const U=ep("VmAddSource");return Kf(),J_(Q_,null,[Nu(U),Yu(b.$slots,"default",{source:b.source})],64)}Gu.render=U0;Gu.__file="geojson-source/src/index.vue";Gu.install=b=>{b.component(Gu.name,Gu)};var ny={exports:{}},s_={};(function(b,T){(function(E,A){b.exports=A()})(A0,function(){var E,A,D;function z(a,G){if(!E)E=G;else if(!A)A=G;else{var ot="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+E+")(sharedChunk); ("+A+")(sharedChunk); self.onerror = null;",Rt={};E(Rt),D=G(Rt),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(D.workerUrl=window.URL.createObjectURL(new Blob([ot],{type:"text/javascript"})))}}z(["exports"],function(a){var G=typeof self<"u"?self:{},ot="2.15.0";let Rt;const xt={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(Rt==null){const e=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{Rt=s_.API_URL_REGEX!=null?new RegExp(s_.API_URL_REGEX):e}catch{Rt=e}}return Rt},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!xt.API_URL)return null;try{const e=new URL(xt.API_URL);return e.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":e.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},At={supported:!1,testSupport:function(e){!ee&&re&&(Oe?Ge(e):qt=e)}};let qt,re,ee=!1,Oe=!1;function Ge(e){const t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t);try{if(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,re),e.isContextLost())return;At.supported=!0}catch{}e.deleteTexture(t),ee=!0}G.document&&(re=G.document.createElement("img"),re.onload=function(){qt&&Ge(qt),qt=null,Oe=!0},re.onerror=function(){ee=!0,qt=null},re.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Mt="01";function gt(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Et=Ft;function Ft(e,t,i,s){this.cx=3*e,this.bx=3*(i-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(s-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=t,this.p2x=i,this.p2y=s}Ft.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,t){if(t===void 0&&(t=1e-6),e<0)return 0;if(e>1)return 1;for(var i=e,s=0;s<8;s++){var u=this.sampleCurveX(i)-e;if(Math.abs(u)<t)return i;var f=this.sampleCurveDerivativeX(i);if(Math.abs(f)<1e-6)break;i-=u/f}var m=0,y=1;for(i=e,s=0;s<20&&(u=this.sampleCurveX(i),!(Math.abs(u-e)<t));s++)e>u?m=i:y=i,i=.5*(y-m)+m;return i},solve:function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))}};var Ie=gt(Et),de=xe;function xe(e,t){this.x=e,this.y=t}xe.prototype={clone:function(){return new xe(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,i=e.y-this.y;return t*t+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=t,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),i=Math.sin(e),s=i*this.x+t*this.y;return this.x=t*this.x-i*this.y,this.y=s,this},_rotateAround:function(e,t){var i=Math.cos(e),s=Math.sin(e),u=t.y+s*(this.x-t.x)+i*(this.y-t.y);return this.x=t.x+i*(this.x-t.x)-s*(this.y-t.y),this.y=u,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},xe.convert=function(e){return e instanceof xe?e:Array.isArray(e)?new xe(e[0],e[1]):e};var $t=gt(de);const yt=Math.PI/180,ue=180/Math.PI;function Kt(e){return e*yt}function ae(e){return e*ue}const wt=[[0,0],[1,0],[1,1],[0,1]];function _i(e){if(e<=0)return 0;if(e>=1)return 1;const t=e*e,i=t*e;return 4*(e<.5?i:3*(e-t)+i-.75)}function Ne(e,t,i,s){const u=new Ie(e,t,i,s);return function(f){return u.solve(f)}}const Tr=Ne(.25,.1,.25,1);function Ye(e,t,i){return Math.min(i,Math.max(t,e))}function ti(e,t,i){return(i=Ye((i-e)/(t-e),0,1))*i*(3-2*i)}function Pe(e,t,i){const s=i-t,u=((e-t)%s+s)%s+t;return u===t?i:u}function tr(e,t,i){if(!e.length)return i(null,[]);let s=e.length;const u=new Array(e.length);let f=null;e.forEach((m,y)=>{t(m,(x,w)=>{x&&(f=x),u[y]=w,--s==0&&i(f,u)})})}function Ot(e){const t=[];for(const i in e)t.push(e[i]);return t}function ur(e,...t){for(const i of t)for(const s in i)e[s]=i[s];return e}let pr=1;function Li(){return pr++}function je(){return function e(t){return t?(t^Math.random()*(16>>t/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,e)}()}function Zr(e){return e<=1?1:Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function Tn(e){return!!e&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}function oi(e,t){e.forEach(i=>{t[i]&&(t[i]=t[i].bind(t))})}function Br(e,t){return e.indexOf(t,e.length-t.length)!==-1}function He(e,t,i){const s={};for(const u in e)s[u]=t.call(this,e[u],u,e);return s}function qe(e,t,i){const s={};for(const u in e)t.call(i||this,e[u],u,e)&&(s[u]=e[u]);return s}function jr(e){return Array.isArray(e)?e.map(jr):typeof e=="object"&&e?He(e,jr):e}const pi={};function Dr(e){pi[e]||(typeof console<"u"&&console.warn(e),pi[e]=!0)}function Hr(e,t,i){return(i.y-e.y)*(t.x-e.x)>(t.y-e.y)*(i.x-e.x)}function rn(e){let t=0;for(let i,s,u=0,f=e.length,m=f-1;u<f;m=u++)i=e[u],s=e[m],t+=(s.x-i.x)*(i.y+s.y);return t}function ii(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function zt(e){const t={};if(e.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,s,u,f)=>{const m=u||f;return t[s]=!m||m.toLowerCase(),""}),t["max-age"]){const i=parseInt(t["max-age"],10);isNaN(i)?delete t["max-age"]:t["max-age"]=i}return t}let J=null;function Z(e){if(J==null){const t=e.navigator?e.navigator.userAgent:null;J=!!e.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return J}function H(e){try{const t=G[e];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch{return!1}}function ft(e,t){return[e[4*t],e[4*t+1],e[4*t+2],e[4*t+3]]}const Dt="mapbox-tiles";let Jt=500,pe=50,kt,Ze;function rr(){try{return G.caches}catch{}}function Me(){rr()&&!kt&&(kt=G.caches.open(Dt))}function fr(e){const t=e.indexOf("?");if(t<0)return e;const i=function(u){const f=u.indexOf("?");return f>0?u.slice(f+1).split("&"):[]}(e),s=i.filter(u=>{const f=u.split("=");return f[0]==="language"||f[0]==="worldview"});return s.length?`${e.slice(0,t)}?${s.join("&")}`:e.slice(0,t)}let Sr=1/0;const Fr={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Fr);class gr extends Error{constructor(t,i,s){i===401&&Ut(s)&&(t+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(t),this.status=i,this.url=s}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const $r=ii()?()=>self.worker&&self.worker.referrer:()=>(G.location.protocol==="blob:"?G.parent:G).location.href,yi=function(e,t){if(!(/^file:/.test(i=e.url)||/^file:/.test($r())&&!/^\w+:/.test(i))){if(G.fetch&&G.Request&&G.AbortController&&G.Request.prototype.hasOwnProperty("signal"))return function(s,u){const f=new G.AbortController,m=new G.Request(s.url,{method:s.method||"GET",body:s.body,credentials:s.credentials,headers:s.headers,referrer:$r(),referrerPolicy:s.referrerPolicy,signal:f.signal});let y=!1,x=!1;const w=(M=m.url).indexOf("sku=")>0&&Ut(M);var M;s.type==="json"&&m.headers.set("Accept","application/json");const L=(B,F,q)=>{if(x)return;if(B&&B.message!=="SecurityError"&&Dr(B.toString()),F&&q)return O(F);const K=Date.now();G.fetch(m).then(at=>{if(at.ok){const mt=w?at.clone():null;return O(at,mt,K)}return u(new gr(at.statusText,at.status,s.url))}).catch(at=>{at.name!=="AbortError"&&u(new Error(`${at.message} ${s.url}`))})},O=(B,F,q)=>{(s.type==="arrayBuffer"?B.arrayBuffer():s.type==="json"?B.json():B.text()).then(K=>{x||(F&&q&&function(at,mt,lt){if(Me(),!kt)return;const dt={status:mt.status,statusText:mt.statusText,headers:new G.Headers};mt.headers.forEach((Wt,Gt)=>dt.headers.set(Gt,Wt));const vt=zt(mt.headers.get("Cache-Control")||"");if(vt["no-store"])return;vt["max-age"]&&dt.headers.set("Expires",new Date(lt+1e3*vt["max-age"]).toUTCString());const _t=dt.headers.get("Expires");_t&&(new Date(_t).getTime()-lt<42e4||function(Wt,Gt){if(Ze===void 0)try{new Response(new ReadableStream),Ze=!0}catch{Ze=!1}Ze?Gt(Wt.body):Wt.blob().then(Gt)}(mt,Wt=>{const Gt=new G.Response(Wt,dt);Me(),kt&&kt.then(oe=>oe.put(fr(at.url),Gt)).catch(oe=>Dr(oe.message))}))}(m,F,q),y=!0,u(null,K,B.headers.get("Cache-Control"),B.headers.get("Expires")))}).catch(K=>{x||u(new Error(K.message))})};return w?function(B,F){if(Me(),!kt)return F(null);const q=fr(B.url);kt.then(K=>{K.match(q).then(at=>{const mt=function(lt){if(!lt)return!1;const dt=new Date(lt.headers.get("Expires")||0),vt=zt(lt.headers.get("Cache-Control")||"");return dt>Date.now()&&!vt["no-cache"]}(at);K.delete(q),mt&&K.put(q,at.clone()),F(null,at,mt)}).catch(F)}).catch(F)}(m,L):L(null,null),{cancel:()=>{x=!0,y||f.abort()}}}(e,t);if(ii()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",e,t,void 0,!0)}var i;return function(s,u){const f=new G.XMLHttpRequest;f.open(s.method||"GET",s.url,!0),s.type==="arrayBuffer"&&(f.responseType="arraybuffer");for(const m in s.headers)f.setRequestHeader(m,s.headers[m]);return s.type==="json"&&(f.responseType="text",f.setRequestHeader("Accept","application/json")),f.withCredentials=s.credentials==="include",f.onerror=()=>{u(new Error(f.statusText))},f.onload=()=>{if((f.status>=200&&f.status<300||f.status===0)&&f.response!==null){let m=f.response;if(s.type==="json")try{m=JSON.parse(f.response)}catch(y){return u(y)}u(null,m,f.getResponseHeader("Cache-Control"),f.getResponseHeader("Expires"))}else u(new gr(f.statusText,f.status,s.url))},f.send(s.body),{cancel:()=>f.abort()}}(e,t)},Di=function(e,t){return yi(ur(e,{type:"arrayBuffer"}),t)};function sn(e){const t=G.document.createElement("a");return t.href=e,t.protocol===G.document.location.protocol&&t.host===G.document.location.host}const ht="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let X,W;X=[],W=0;const ut=function(e,t){if(At.supported&&(e.headers||(e.headers={}),e.headers.accept="image/webp,*/*"),W>=xt.MAX_PARALLEL_IMAGE_REQUESTS){const f={requestParameters:e,callback:t,cancelled:!1,cancel(){this.cancelled=!0}};return X.push(f),f}W++;let i=!1;const s=()=>{if(!i)for(i=!0,W--;X.length&&W<xt.MAX_PARALLEL_IMAGE_REQUESTS;){const f=X.shift(),{requestParameters:m,callback:y,cancelled:x}=f;x||(f.cancel=ut(m,y).cancel)}},u=Di(e,(f,m,y,x)=>{s(),f?t(f):m&&(G.createImageBitmap?function(w,M){const L=new G.Blob([new Uint8Array(w)],{type:"image/png"});G.createImageBitmap(L).then(O=>{M(null,O)}).catch(O=>{M(new Error(`Could not load image because of ${O.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(m,(w,M)=>t(w,M,y,x)):function(w,M){const L=new G.Image,O=G.URL;L.onload=()=>{M(null,L),O.revokeObjectURL(L.src),L.onload=null,G.requestAnimationFrame(()=>{L.src=ht})},L.onerror=()=>M(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const B=new G.Blob([new Uint8Array(w)],{type:"image/png"});L.src=w.byteLength?O.createObjectURL(B):ht}(m,(w,M)=>t(w,M,y,x)))});return{cancel:()=>{u.cancel(),s()}}},et="NO_ACCESS_TOKEN";function Pt(e){return e.indexOf("mapbox:")===0}function Ut(e){return xt.API_URL_REGEX.test(e)}function Tt(e){return xt.API_CDN_URL_REGEX.test(e)}function Lt(e){return xt.API_STYLE_REGEX.test(e)&&!jt(e)}function jt(e){return xt.API_SPRITE_REGEX.test(e)}const ge=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Se(e){const t=e.match(ge);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function we(e){const t=e.params.length?`?${e.params.join("&")}`:"";return`${e.protocol}://${e.authority}${e.path}${t}`}const dr="mapbox.eventData";function Cr(e){if(!e)return null;const t=e.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(decodeURIComponent(G.atob(t[1]).split("").map(i=>"%"+("00"+i.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class or{constructor(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const i=Cr(xt.ACCESS_TOKEN);let s="";return s=i&&i.u?G.btoa(encodeURIComponent(i.u).replace(/%([0-9A-F]{2})/g,(u,f)=>String.fromCharCode(+("0x"+f)))):xt.ACCESS_TOKEN||"",t?`${dr}.${t}:${s}`:`${dr}:${s}`}fetchEventData(){const t=H("localStorage"),i=this.getStorageKey(),s=this.getStorageKey("uuid");if(t)try{const u=G.localStorage.getItem(i);u&&(this.eventData=JSON.parse(u));const f=G.localStorage.getItem(s);f&&(this.anonId=f)}catch{Dr("Unable to read from LocalStorage")}}saveEventData(){const t=H("localStorage"),i=this.getStorageKey(),s=this.getStorageKey("uuid");if(t)try{G.localStorage.setItem(s,this.anonId),Object.keys(this.eventData).length>=1&&G.localStorage.setItem(i,JSON.stringify(this.eventData))}catch{Dr("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,i,s,u){if(!xt.EVENTS_URL)return;const f=Se(xt.EVENTS_URL);f.params.push(`access_token=${u||xt.ACCESS_TOKEN||""}`);const m={event:this.type,created:new Date(t).toISOString()},y=i?ur(m,i):m,x={url:we(f),headers:{"Content-Type":"text/plain"},body:JSON.stringify([y])};this.pendingRequest=function(w,M){return yi(ur(w,{method:"POST"}),M)}(x,w=>{this.pendingRequest=null,s(w),this.saveEventData(),this.processRequests(u)})}queueRequest(t,i){this.queue.push(t),this.processRequests(i)}}const _r=new class extends or{constructor(e){super("appUserTurnstile"),this._customAccessToken=e}postTurnstileEvent(e,t){xt.EVENTS_URL&&xt.ACCESS_TOKEN&&Array.isArray(e)&&e.some(i=>Pt(i)||Ut(i))&&this.queueRequest(Date.now(),t)}processRequests(e){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=Cr(xt.ACCESS_TOKEN),i=t?t.u:xt.ACCESS_TOKEN;let s=i!==this.eventData.tokenU;Tn(this.anonId)||(this.anonId=je(),s=!0);const u=this.queue.shift();if(this.eventData.lastSuccess){const f=new Date(this.eventData.lastSuccess),m=new Date(u),y=(u-this.eventData.lastSuccess)/864e5;s=s||y>=1||y<-1||f.getDate()!==m.getDate()}else s=!0;s?this.postEvent(u,{sdkIdentifier:"mapbox-gl-js",sdkVersion:ot,skuId:Mt,"enabled.telemetry":!1,userId:this.anonId},f=>{f||(this.eventData.lastSuccess=u,this.eventData.tokenU=i)},e):this.processRequests()}},Ar=_r.postTurnstileEvent.bind(_r),ni=new class extends or{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(e,t,i,s){this.skuToken=t,this.errorCb=s,xt.EVENTS_URL&&(i||xt.ACCESS_TOKEN?this.queueRequest({id:e,timestamp:Date.now()},i):this.errorCb(new Error(et)))}processRequests(e){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:i}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),Tn(this.anonId)||(this.anonId=je()),this.postEvent(i,{sdkIdentifier:"mapbox-gl-js",sdkVersion:ot,skuId:Mt,skuToken:this.skuToken,userId:this.anonId},s=>{s?this.errorCb(s):t&&(this.success[t]=!0)},e))}},sr=ni.postMapLoadEvent.bind(ni),vi=new class extends or{constructor(){super("gljs.performance")}postPerformanceEvent(e,t){xt.EVENTS_URL&&(e||xt.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},e)}processRequests(e){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,performanceData:i}=this.queue.shift(),s=function(u){const f=G.performance.getEntriesByType("resource"),m=G.performance.getEntriesByType("mark"),y=function(O){const B={};if(O){for(const F in O)if(F!=="other")for(const q of O[F]){const K=`${F}ResolveRangeMin`,at=`${F}ResolveRangeMax`,mt=`${F}RequestCount`,lt=`${F}RequestCachedCount`;B[K]=Math.min(B[K]||1/0,q.startTime),B[at]=Math.max(B[at]||-1/0,q.responseEnd);const dt=vt=>{B[vt]===void 0&&(B[vt]=0),++B[vt]};q.transferSize!==void 0&&q.transferSize===0&&dt(lt),dt(mt)}}return B}(function(O,B){const F={};if(O)for(const q of O){const K=B(q);F[K]===void 0&&(F[K]=[]),F[K].push(q)}return F}(f,co)),x=G.devicePixelRatio,w=G.navigator.connection||G.navigator.mozConnection||G.navigator.webkitConnection,M={counters:[],metadata:[],attributes:[]},L=(O,B,F)=>{F!=null&&O.push({name:B,value:F.toString()})};for(const O in y)L(M.counters,O,y[O]);if(u.interactionRange[0]!==1/0&&u.interactionRange[1]!==-1/0&&(L(M.counters,"interactionRangeMin",u.interactionRange[0]),L(M.counters,"interactionRangeMax",u.interactionRange[1])),m)for(const O of Object.keys(Pn)){const B=Pn[O],F=m.find(q=>q.name===B);F&&L(M.counters,B,F.startTime)}return L(M.counters,"visibilityHidden",u.visibilityHidden),L(M.attributes,"style",function(O){if(O)for(const B of O){const F=B.name.split("?")[0];if(Lt(F)){const q=F.split("/").slice(-2);if(q.length===2)return`mapbox://styles/${q[0]}/${q[1]}`}}}(f)),L(M.attributes,"terrainEnabled",u.terrainEnabled?"true":"false"),L(M.attributes,"fogEnabled",u.fogEnabled?"true":"false"),L(M.attributes,"projection",u.projection),L(M.attributes,"zoom",u.zoom),L(M.metadata,"devicePixelRatio",x),L(M.metadata,"connectionEffectiveType",w?w.effectiveType:void 0),L(M.metadata,"navigatorUserAgent",G.navigator.userAgent),L(M.metadata,"screenWidth",G.screen.width),L(M.metadata,"screenHeight",G.screen.height),L(M.metadata,"windowWidth",G.innerWidth),L(M.metadata,"windowHeight",G.innerHeight),L(M.metadata,"mapWidth",u.width/x),L(M.metadata,"mapHeight",u.height/x),L(M.metadata,"webglRenderer",u.renderer),L(M.metadata,"webglVendor",u.vendor),L(M.metadata,"sdkVersion",ot),L(M.metadata,"sdkIdentifier","mapbox-gl-js"),M}(i);for(const u of s.metadata);for(const u of s.counters);for(const u of s.attributes);this.postEvent(t,s,()=>{},e)}},si=vi.postPerformanceEvent.bind(vi),an=new class extends or{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(e,t,i,s){if(!xt.API_URL||!xt.SESSION_PATH)return;const u=Se(xt.API_URL+xt.SESSION_PATH);u.params.push(`sku=${t||""}`),u.params.push(`access_token=${s||xt.ACCESS_TOKEN||""}`);const f={url:we(u),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(m,y){return yi(ur(m,{method:"GET"}),y)}(f,m=>{this.pendingRequest=null,i(m),this.saveEventData(),this.processRequests(s)})}getSessionAPI(e,t,i,s){this.skuToken=t,this.errorCb=s,xt.SESSION_PATH&&xt.API_URL&&(i||xt.ACCESS_TOKEN?this.queueRequest({id:e,timestamp:Date.now()},i):this.errorCb(new Error(et)))}processRequests(e){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:i}=this.queue.shift();t&&this.success[t]||this.getSession(i,this.skuToken,s=>{s?this.errorCb(s):t&&(this.success[t]=!0)},e)}},Kr=an.getSessionAPI.bind(an),ln=new Set,Pn={create:"create",load:"load",fullLoad:"fullLoad"},ml={mark(e){G.performance.mark(e)},measure(e,t,i){G.performance.measure(e,t,i)}};function co(e){const t=e.name.split("?")[0];return Tt(t)&&t.includes("mapbox-gl.js")?"javascript":Tt(t)&&t.includes("mapbox-gl.css")?"css":function(i){return xt.API_FONTS_REGEX.test(i)}(t)?"fontRange":jt(t)?"sprite":Lt(t)?"style":function(i){return xt.API_TILEJSON_REGEX.test(i)}(t)?"tilejson":"other"}const Wr=G.performance;function Ri(e){const t=e?e.url.toString():void 0;return Wr.getEntriesByName(t)}let fi,fa,Ln,Gn;const ai={now:()=>Ln!==void 0?Ln:G.performance.now(),setNow(e){Ln=e},restoreNow(){Ln=void 0},frame(e){const t=G.requestAnimationFrame(e);return{cancel:()=>G.cancelAnimationFrame(t)}},getImageData(e,t=0){const{width:i,height:s}=e;Gn||(Gn=G.document.createElement("canvas"));const u=Gn.getContext("2d",{willReadFrequently:!0});if(!u)throw new Error("failed to create canvas 2d context");return(i>Gn.width||s>Gn.height)&&(Gn.width=i,Gn.height=s),u.clearRect(-t,-t,i+2*t,s+2*t),u.drawImage(e,0,0,i,s),u.getImageData(-t,-t,i+2*t,s+2*t)},resolveURL:e=>(fi||(fi=G.document.createElement("a")),fi.href=e,fi.href),get devicePixelRatio(){return G.devicePixelRatio},get prefersReducedMotion(){return!!G.matchMedia&&(fa==null&&(fa=G.matchMedia("(prefers-reduced-motion: reduce)")),fa.matches)}};function Hs(e,t,i){i[e]&&i[e].indexOf(t)!==-1||(i[e]=i[e]||[],i[e].push(t))}function Po(e,t,i){if(i&&i[e]){const s=i[e].indexOf(t);s!==-1&&i[e].splice(s,1)}}class Zn{constructor(t,i={}){ur(this,i),this.type=t}}class un extends Zn{constructor(t,i={}){super("error",ur({error:t},i))}}class Ks{on(t,i){return this._listeners=this._listeners||{},Hs(t,i,this._listeners),this}off(t,i){return Po(t,i,this._listeners),Po(t,i,this._oneTimeListeners),this}once(t,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},Hs(t,i,this._oneTimeListeners),this):new Promise(s=>this.once(t,s))}fire(t,i){typeof t=="string"&&(t=new Zn(t,i||{}));const s=t.type;if(this.listens(s)){t.target=this;const u=this._listeners&&this._listeners[s]?this._listeners[s].slice():[];for(const y of u)y.call(this,t);const f=this._oneTimeListeners&&this._oneTimeListeners[s]?this._oneTimeListeners[s].slice():[];for(const y of f)Po(s,y,this._oneTimeListeners),y.call(this,t);const m=this._eventedParent;m&&(ur(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),m.fire(t))}else t instanceof un&&console.error(t.error);return this}listens(t){return!!(this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t))}setEventedParent(t,i){return this._eventedParent=t,this._eventedParentData=i,this}}var ie=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"requires":["fill-extrusion-edge-radius"],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Lo(e,...t){for(const i of t)for(const s in i)e[s]=i[s];return e}function Xi(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function Rr(e){if(Array.isArray(e))return e.map(Rr);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){const t={};for(const i in e)t[i]=Rr(e[i]);return t}return Xi(e)}class zl extends Error{constructor(t,i){super(i),this.message=i,this.key=t}}var In=zl;class Ka{constructor(t,i=[]){this.parent=t,this.bindings={};for(const[s,u]of i)this.bindings[s]=u}concat(t){return new Ka(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}var kl=Ka;const Or={kind:"null"},ke={kind:"number"},hr={kind:"string"},Ir={kind:"boolean"},lr={kind:"color"},jo={kind:"object"},Pr={kind:"value"},Qn={kind:"collator"},to={kind:"formatted"},eo={kind:"resolvedImage"};function bo(e,t){return{kind:"array",itemType:e,N:t}}function Oi(e){if(e.kind==="array"){const t=Oi(e.itemType);return typeof e.N=="number"?`array<${t}, ${e.N}>`:e.itemType.kind==="value"?"array":`array<${t}>`}return e.kind}const Ae=[Or,ke,hr,Ir,lr,to,jo,bo(Pr),eo];function qo(e,t){if(t.kind==="error")return null;if(e.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!qo(e.itemType,t.itemType))&&(typeof e.N!="number"||e.N===t.N))return null}else{if(e.kind===t.kind)return null;if(e.kind==="value"){for(const i of Ae)if(!qo(i,t))return null}}return`Expected ${Oi(e)} but found ${Oi(t)} instead.`}function ro(e,t){return t.some(i=>i.kind===e.kind)}function wo(e,t){return t.some(i=>i==="null"?e===null:i==="array"?Array.isArray(e):i==="object"?e&&!Array.isArray(e)&&typeof e=="object":i===typeof e)}var Da,Dn={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Jr(e){return(e=Math.round(e))<0?0:e>255?255:e}function qr(e){return Jr(e[e.length-1]==="%"?parseFloat(e)/100*255:parseInt(e))}function Ni(e){return(t=e[e.length-1]==="%"?parseFloat(e)/100:parseFloat(e))<0?0:t>1?1:t;var t}function Ra(e,t,i){return i<0?i+=1:i>1&&(i-=1),6*i<1?e+(t-e)*i*6:2*i<1?t:3*i<2?e+(t-e)*(2/3-i)*6:e}try{Da={}.parseCSSColor=function(e){var t,i=e.replace(/ /g,"").toLowerCase();if(i in Dn)return Dn[i].slice();if(i[0]==="#")return i.length===4?(t=parseInt(i.substr(1),16))>=0&&t<=4095?[(3840&t)>>4|(3840&t)>>8,240&t|(240&t)>>4,15&t|(15&t)<<4,1]:null:i.length===7&&(t=parseInt(i.substr(1),16))>=0&&t<=16777215?[(16711680&t)>>16,(65280&t)>>8,255&t,1]:null;var s=i.indexOf("("),u=i.indexOf(")");if(s!==-1&&u+1===i.length){var f=i.substr(0,s),m=i.substr(s+1,u-(s+1)).split(","),y=1;switch(f){case"rgba":if(m.length!==4)return null;y=Ni(m.pop());case"rgb":return m.length!==3?null:[qr(m[0]),qr(m[1]),qr(m[2]),y];case"hsla":if(m.length!==4)return null;y=Ni(m.pop());case"hsl":if(m.length!==3)return null;var x=(parseFloat(m[0])%360+360)%360/360,w=Ni(m[1]),M=Ni(m[2]),L=M<=.5?M*(w+1):M+w-M*w,O=2*M-L;return[Jr(255*Ra(O,L,x+1/3)),Jr(255*Ra(O,L,x)),Jr(255*Ra(O,L,x-1/3)),y];default:return null}}return null}}catch{}class Eo{constructor(t,i,s,u=1){this.r=t,this.g=i,this.b=s,this.a=u}static parse(t){if(!t)return;if(t instanceof Eo)return t;if(typeof t!="string")return;const i=Da(t);return i?new Eo(i[0]/255*i[3],i[1]/255*i[3],i[2]/255*i[3],i[3]):void 0}toString(){const[t,i,s,u]=this.toArray();return`rgba(${Math.round(t)},${Math.round(i)},${Math.round(s)},${u})`}toArray(){const{r:t,g:i,b:s,a:u}=this;return u===0?[0,0,0,0]:[255*t/u,255*i/u,255*s/u,u]}toArray01(){const{r:t,g:i,b:s,a:u}=this;return u===0?[0,0,0,0]:[t/u,i/u,s/u,u]}toArray01PremultipliedAlpha(){const{r:t,g:i,b:s,a:u}=this;return[t,i,s,u]}}Eo.black=new Eo(0,0,0,1),Eo.white=new Eo(1,1,1,1),Eo.transparent=new Eo(0,0,0,0),Eo.red=new Eo(1,0,0,1),Eo.blue=new Eo(0,0,1,1);var Yr=Eo;class Oa{constructor(t,i,s){this.sensitivity=t?i?"variant":"case":i?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,i){return this.collator.compare(t,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class To{constructor(t,i,s,u,f){this.text=t.normalize?t.normalize():t,this.image=i,this.scale=s,this.fontStack=u,this.textColor=f}}class br{constructor(t){this.sections=t}static fromString(t){return new br([new To(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.name.length!==0)}static factory(t){return t instanceof br?t:br.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}serialize(){const t=["format"];for(const i of this.sections){if(i.image){t.push(["image",i.image.name]);continue}t.push(i.text);const s={};i.fontStack&&(s["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(s["font-scale"]=i.scale),i.textColor&&(s["text-color"]=["rgba"].concat(i.textColor.toArray())),t.push(s)}return t}}class io{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new io({name:t,available:!1}):null}serialize(){return["image",this.name]}}function Sn(e,t,i,s){return typeof e=="number"&&e>=0&&e<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof i=="number"&&i>=0&&i<=255?s===void 0||typeof s=="number"&&s>=0&&s<=1?null:`Invalid rgba value [${[e,t,i,s].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof s=="number"?[e,t,i,s]:[e,t,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function da(e){if(e===null||typeof e=="string"||typeof e=="boolean"||typeof e=="number"||e instanceof Yr||e instanceof Oa||e instanceof br||e instanceof io)return!0;if(Array.isArray(e)){for(const t of e)if(!da(t))return!1;return!0}if(typeof e=="object"){for(const t in e)if(!da(e[t]))return!1;return!0}return!1}function xi(e){if(e===null)return Or;if(typeof e=="string")return hr;if(typeof e=="boolean")return Ir;if(typeof e=="number")return ke;if(e instanceof Yr)return lr;if(e instanceof Oa)return Qn;if(e instanceof br)return to;if(e instanceof io)return eo;if(Array.isArray(e)){const t=e.length;let i;for(const s of e){const u=xi(s);if(i){if(i===u)continue;i=Pr;break}i=u}return bo(i||Pr,t)}return jo}function li(e){const t=typeof e;return e===null?"":t==="string"||t==="number"||t==="boolean"?String(e):e instanceof Yr||e instanceof br||e instanceof io?e.toString():JSON.stringify(e)}class jn{constructor(t,i){this.type=t,this.value=i}static parse(t,i){if(t.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!da(t[1]))return i.error("invalid value");const s=t[1];let u=xi(s);const f=i.expectedType;return u.kind!=="array"||u.N!==0||!f||f.kind!=="array"||typeof f.N=="number"&&f.N!==0||(u=f),new jn(u,s)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Yr?["rgba"].concat(this.value.toArray()):this.value instanceof br?this.value.serialize():this.value}}var $o=jn,mi=class{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}};const Xo={string:hr,number:ke,boolean:Ir,object:jo};class ps{constructor(t,i){this.type=t,this.args=i}static parse(t,i){if(t.length<2)return i.error("Expected at least one argument.");let s,u=1;const f=t[0];if(f==="array"){let y,x;if(t.length>2){const w=t[1];if(typeof w!="string"||!(w in Xo)||w==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);y=Xo[w],u++}else y=Pr;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return i.error('The length argument to "array" must be a positive integer literal',2);x=t[2],u++}s=bo(y,x)}else s=Xo[f];const m=[];for(;u<t.length;u++){const y=i.parse(t[u],u,Pr);if(!y)return null;m.push(y)}return new ps(s,m)}evaluate(t){for(let i=0;i<this.args.length;i++){const s=this.args[i].evaluate(t);if(!qo(this.type,xi(s)))return s;if(i===this.args.length-1)throw new mi(`Expected value to be of type ${Oi(this.type)}, but found ${Oi(xi(s))} instead.`)}return null}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=this.type,i=[t.kind];if(t.kind==="array"){const s=t.itemType;if(s.kind==="string"||s.kind==="number"||s.kind==="boolean"){i.push(s.kind);const u=t.N;(typeof u=="number"||this.args.length>1)&&i.push(u)}}return i.concat(this.args.map(s=>s.serialize()))}}var ho=ps;class di{constructor(t){this.type=to,this.sections=t}static parse(t,i){if(t.length<2)return i.error("Expected at least one argument.");const s=t[1];if(!Array.isArray(s)&&typeof s=="object")return i.error("First argument must be an image or text section.");const u=[];let f=!1;for(let m=1;m<=t.length-1;++m){const y=t[m];if(f&&typeof y=="object"&&!Array.isArray(y)){f=!1;let x=null;if(y["font-scale"]&&(x=i.parse(y["font-scale"],1,ke),!x))return null;let w=null;if(y["text-font"]&&(w=i.parse(y["text-font"],1,bo(hr)),!w))return null;let M=null;if(y["text-color"]&&(M=i.parse(y["text-color"],1,lr),!M))return null;const L=u[u.length-1];L.scale=x,L.font=w,L.textColor=M}else{const x=i.parse(t[m],1,Pr);if(!x)return null;const w=x.type.kind;if(w!=="string"&&w!=="value"&&w!=="null"&&w!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");f=!0,u.push({content:x,scale:null,font:null,textColor:null})}}return new di(u)}evaluate(t){return new br(this.sections.map(i=>{const s=i.content.evaluate(t);return xi(s)===eo?new To("",s,null,null,null):new To(li(s),null,i.scale?i.scale.evaluate(t):null,i.font?i.font.evaluate(t).join(","):null,i.textColor?i.textColor.evaluate(t):null)}))}eachChild(t){for(const i of this.sections)t(i.content),i.scale&&t(i.scale),i.font&&t(i.font),i.textColor&&t(i.textColor)}outputDefined(){return!1}serialize(){const t=["format"];for(const i of this.sections){t.push(i.content.serialize());const s={};i.scale&&(s["font-scale"]=i.scale.serialize()),i.font&&(s["text-font"]=i.font.serialize()),i.textColor&&(s["text-color"]=i.textColor.serialize()),t.push(s)}return t}}class Ja{constructor(t){this.type=eo,this.input=t}static parse(t,i){if(t.length!==2)return i.error("Expected two arguments.");const s=i.parse(t[1],1,hr);return s?new Ja(s):i.error("No image name provided.")}evaluate(t){const i=this.input.evaluate(t),s=io.fromString(i);return s&&t.availableImages&&(s.available=t.availableImages.indexOf(i)>-1),s}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Do={"to-boolean":Ir,"to-color":lr,"to-number":ke,"to-string":hr};class ji{constructor(t,i){this.type=t,this.args=i}static parse(t,i){if(t.length<2)return i.error("Expected at least one argument.");const s=t[0];if((s==="to-boolean"||s==="to-string")&&t.length!==2)return i.error("Expected one argument.");const u=Do[s],f=[];for(let m=1;m<t.length;m++){const y=i.parse(t[m],m,Pr);if(!y)return null;f.push(y)}return new ji(u,f)}evaluate(t){if(this.type.kind==="boolean")return!!this.args[0].evaluate(t);if(this.type.kind==="color"){let i,s;for(const u of this.args){if(i=u.evaluate(t),s=null,i instanceof Yr)return i;if(typeof i=="string"){const f=t.parseColor(i);if(f)return f}else if(Array.isArray(i)&&(s=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:Sn(i[0],i[1],i[2],i[3]),!s))return new Yr(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new mi(s||`Could not parse color from value '${typeof i=="string"?i:String(JSON.stringify(i))}'`)}if(this.type.kind==="number"){let i=null;for(const s of this.args){if(i=s.evaluate(t),i===null)return 0;const u=Number(i);if(!isNaN(u))return u}throw new mi(`Could not convert ${JSON.stringify(i)} to number.`)}return this.type.kind==="formatted"?br.fromString(li(this.args[0].evaluate(t))):this.type.kind==="resolvedImage"?io.fromString(li(this.args[0].evaluate(t))):li(this.args[0].evaluate(t))}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){if(this.type.kind==="formatted")return new di([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Ja(this.args[0]).serialize();const t=[`to-${this.type.kind}`];return this.eachChild(i=>{t.push(i.serialize())}),t}}var qi=ji;const Ro=["Unknown","Point","LineString","Polygon"];var Bl=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Ro[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,t=this.featureDistanceData.scale,{x:i,y:s}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(i*t-e[0])+this.featureDistanceData.bearing[1]*(s*t-e[1])}return 0}parseColor(e){let t=this._parseColorCache[e];return t||(t=this._parseColorCache[e]=Yr.parse(e)),t}};class Zo{constructor(t,i,s,u){this.name=t,this.type=i,this._evaluate=s,this.args=u}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(t=>t.serialize()))}static parse(t,i){const s=t[0],u=Zo.definitions[s];if(!u)return i.error(`Unknown expression "${s}". If you wanted a literal array, use ["literal", [...]].`,0);const f=Array.isArray(u)?u[0]:u.type,m=Array.isArray(u)?[[u[1],u[2]]]:u.overloads,y=m.filter(([w])=>!Array.isArray(w)||w.length===t.length-1);let x=null;for(const[w,M]of y){x=new ci(i.registry,i.path,null,i.scope);const L=[];let O=!1;for(let B=1;B<t.length;B++){const F=t[B],q=Array.isArray(w)?w[B-1]:w.type,K=x.parse(F,1+L.length,q);if(!K){O=!0;break}L.push(K)}if(!O)if(Array.isArray(w)&&w.length!==L.length)x.error(`Expected ${w.length} arguments, but found ${L.length} instead.`);else{for(let B=0;B<L.length;B++){const F=Array.isArray(w)?w[B]:w.type,q=L[B];x.concat(B+1).checkSubtype(F,q.type)}if(x.errors.length===0)return new Zo(s,f,M,L)}}if(y.length===1)i.errors.push(...x.errors);else{const w=(y.length?y:m).map(([L])=>{return O=L,Array.isArray(O)?`(${O.map(Oi).join(", ")})`:`(${Oi(O.type)}...)`;var O}).join(" | "),M=[];for(let L=1;L<t.length;L++){const O=i.parse(t[L],1+M.length);if(!O)return null;M.push(Oi(O.type))}i.error(`Expected arguments of type ${w}, but found (${M.join(", ")}) instead.`)}return null}static register(t,i){Zo.definitions=i;for(const s in i)t[s]=Zo}}var bs=Zo;class Na{constructor(t,i,s){this.type=Qn,this.locale=s,this.caseSensitive=t,this.diacriticSensitive=i}static parse(t,i){if(t.length!==2)return i.error("Expected one argument.");const s=t[1];if(typeof s!="object"||Array.isArray(s))return i.error("Collator options argument must be an object.");const u=i.parse(s["case-sensitive"]!==void 0&&s["case-sensitive"],1,Ir);if(!u)return null;const f=i.parse(s["diacritic-sensitive"]!==void 0&&s["diacritic-sensitive"],1,Ir);if(!f)return null;let m=null;return s.locale&&(m=i.parse(s.locale,1,hr),!m)?null:new Na(u,f,m)}evaluate(t){return new Oa(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}serialize(){const t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]}}const Zi=8192;function Wo(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function nn(e,t){return!(e[0]<=t[0]||e[2]>=t[2]||e[1]<=t[1]||e[3]>=t[3])}function fs(e,t){const i=(180+e[0])/360,s=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e[1]*Math.PI/360)))/360,u=Math.pow(2,t.z);return[Math.round(i*u*Zi),Math.round(s*u*Zi)]}function Yo(e,t,i){const s=e[0]-t[0],u=e[1]-t[1],f=e[0]-i[0],m=e[1]-i[1];return s*m-f*u==0&&s*f<=0&&u*m<=0}function Js(e,t){let i=!1;for(let m=0,y=t.length;m<y;m++){const x=t[m];for(let w=0,M=x.length;w<M-1;w++){if(Yo(e,x[w],x[w+1]))return!1;(u=x[w])[1]>(s=e)[1]!=(f=x[w+1])[1]>s[1]&&s[0]<(f[0]-u[0])*(s[1]-u[1])/(f[1]-u[1])+u[0]&&(i=!i)}}var s,u,f;return i}function zi(e,t){for(let i=0;i<t.length;i++)if(Js(e,t[i]))return!0;return!1}function Ke(e,t,i,s){const u=s[0]-i[0],f=s[1]-i[1],m=(e[0]-i[0])*f-u*(e[1]-i[1]),y=(t[0]-i[0])*f-u*(t[1]-i[1]);return m>0&&y<0||m<0&&y>0}function ma(e,t,i){for(const w of i)for(let M=0;M<w.length-1;++M)if((y=[(m=w[M+1])[0]-(f=w[M])[0],m[1]-f[1]])[0]*(x=[(u=t)[0]-(s=e)[0],u[1]-s[1]])[1]-y[1]*x[0]!=0&&Ke(s,u,f,m)&&Ke(f,m,s,u))return!0;var s,u,f,m,y,x;return!1}function Xr(e,t){for(let i=0;i<e.length;++i)if(!Js(e[i],t))return!1;for(let i=0;i<e.length-1;++i)if(ma(e[i],e[i+1],t))return!1;return!0}function no(e,t){for(let i=0;i<t.length;i++)if(Xr(e,t[i]))return!0;return!1}function Io(e,t,i){const s=[];for(let u=0;u<e.length;u++){const f=[];for(let m=0;m<e[u].length;m++){const y=fs(e[u][m],i);Wo(t,y),f.push(y)}s.push(f)}return s}function zs(e,t,i){const s=[];for(let u=0;u<e.length;u++){const f=Io(e[u],t,i);s.push(f)}return s}function ga(e,t,i,s){if(e[0]<i[0]||e[0]>i[2]){const u=.5*s;let f=e[0]-i[0]>u?-s:i[0]-e[0]>u?s:0;f===0&&(f=e[0]-i[2]>u?-s:i[2]-e[0]>u?s:0),e[0]+=f}Wo(t,e)}function gl(e,t,i,s){const u=Math.pow(2,s.z)*Zi,f=[s.x*Zi,s.y*Zi],m=[];if(!e)return m;for(const y of e)for(const x of y){const w=[x.x+f[0],x.y+f[1]];ga(w,t,i,u),m.push(w)}return m}function _l(e,t,i,s){const u=Math.pow(2,s.z)*Zi,f=[s.x*Zi,s.y*Zi],m=[];if(!e)return m;for(const x of e){const w=[];for(const M of x){const L=[M.x+f[0],M.y+f[1]];Wo(t,L),w.push(L)}m.push(w)}if(t[2]-t[0]<=u/2){(y=t)[0]=y[1]=1/0,y[2]=y[3]=-1/0;for(const x of m)for(const w of x)ga(w,t,i,u)}var y;return m}class Nr{constructor(t,i){this.type=Ir,this.geojson=t,this.geometries=i}static parse(t,i){if(t.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(da(t[1])){const s=t[1];if(s.type==="FeatureCollection")for(let u=0;u<s.features.length;++u){const f=s.features[u].geometry.type;if(f==="Polygon"||f==="MultiPolygon")return new Nr(s,s.features[u].geometry)}else if(s.type==="Feature"){const u=s.geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new Nr(s,s.geometry)}else if(s.type==="Polygon"||s.type==="MultiPolygon")return new Nr(s,s)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(i,s){const u=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],m=i.canonicalID();if(!m)return!1;if(s.type==="Polygon"){const y=Io(s.coordinates,f,m),x=gl(i.geometry(),u,f,m);if(!nn(u,f))return!1;for(const w of x)if(!Js(w,y))return!1}if(s.type==="MultiPolygon"){const y=zs(s.coordinates,f,m),x=gl(i.geometry(),u,f,m);if(!nn(u,f))return!1;for(const w of x)if(!zi(w,y))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(i,s){const u=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],m=i.canonicalID();if(!m)return!1;if(s.type==="Polygon"){const y=Io(s.coordinates,f,m),x=_l(i.geometry(),u,f,m);if(!nn(u,f))return!1;for(const w of x)if(!Xr(w,y))return!1}if(s.type==="MultiPolygon"){const y=zs(s.coordinates,f,m),x=_l(i.geometry(),u,f,m);if(!nn(u,f))return!1;for(const w of x)if(!no(w,y))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Oo=Nr;function ui(e){if(e instanceof bs&&(e.name==="get"&&e.args.length===1||e.name==="feature-state"||e.name==="has"&&e.args.length===1||e.name==="properties"||e.name==="geometry-type"||e.name==="id"||/^filter-/.test(e.name))||e instanceof Oo)return!1;let t=!0;return e.eachChild(i=>{t&&!ui(i)&&(t=!1)}),t}function No(e){if(e instanceof bs&&e.name==="feature-state")return!1;let t=!0;return e.eachChild(i=>{t&&!No(i)&&(t=!1)}),t}function dn(e,t){if(e instanceof bs&&t.indexOf(e.name)>=0)return!1;let i=!0;return e.eachChild(s=>{i&&!dn(s,t)&&(i=!1)}),i}class Qa{constructor(t,i){this.type=i.type,this.name=t,this.boundExpression=i}static parse(t,i){if(t.length!==2||typeof t[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const s=t[1];return i.scope.has(s)?new Qa(s,i.scope.get(s)):i.error(`Unknown variable "${s}". Make sure "${s}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var zr=Qa;class ds{constructor(t,i=[],s,u=new kl,f=[]){this.registry=t,this.path=i,this.key=i.map(m=>`[${m}]`).join(""),this.scope=u,this.errors=f,this.expectedType=s}parse(t,i,s,u,f={}){return i?this.concat(i,s,u)._parse(t,f):this._parse(t,f)}_parse(t,i){function s(u,f,m){return m==="assert"?new ho(f,[u]):m==="coerce"?new qi(f,[u]):u}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const u=t[0];if(typeof u!="string")return this.error(`Expression name must be a string, but found ${typeof u} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const f=this.registry[u];if(f){let m=f.parse(t,this);if(!m)return null;if(this.expectedType){const y=this.expectedType,x=m.type;if(y.kind!=="string"&&y.kind!=="number"&&y.kind!=="boolean"&&y.kind!=="object"&&y.kind!=="array"||x.kind!=="value")if(y.kind!=="color"&&y.kind!=="formatted"&&y.kind!=="resolvedImage"||x.kind!=="value"&&x.kind!=="string"){if(this.checkSubtype(y,x))return null}else m=s(m,y,i.typeAnnotation||"coerce");else m=s(m,y,i.typeAnnotation||"assert")}if(!(m instanceof $o)&&m.type.kind!=="resolvedImage"&&_a(m)){const y=new Bl;try{m=new $o(m.type,m.evaluate(y))}catch(x){return this.error(x.message),null}}return m}return this.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,i,s){const u=typeof t=="number"?this.path.concat(t):this.path,f=s?this.scope.concat(s):this.scope;return new ds(this.registry,u,i||null,f,this.errors)}error(t,...i){const s=`${this.key}${i.map(u=>`[${u}]`).join("")}`;this.errors.push(new In(s,t))}checkSubtype(t,i){const s=qo(t,i);return s&&this.error(s),s}}var ci=ds;function _a(e){if(e instanceof zr)return _a(e.boundExpression);if(e instanceof bs&&e.name==="error"||e instanceof Na||e instanceof Oo)return!1;const t=e instanceof qi||e instanceof ho;let i=!0;return e.eachChild(s=>{i=t?i&&_a(s):i&&s instanceof $o}),!!i&&ui(e)&&dn(e,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Cn(e,t){const i=e.length-1;let s,u,f=0,m=i,y=0;for(;f<=m;)if(y=Math.floor((f+m)/2),s=e[y],u=e[y+1],s<=t){if(y===i||t<u)return y;f=y+1}else{if(!(s>t))throw new mi("Input is not a number.");m=y-1}return 0}class ws{constructor(t,i,s){this.type=t,this.input=i,this.labels=[],this.outputs=[];for(const[u,f]of s)this.labels.push(u),this.outputs.push(f)}static parse(t,i){if(t.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return i.error("Expected an even number of arguments.");const s=i.parse(t[1],1,ke);if(!s)return null;const u=[];let f=null;i.expectedType&&i.expectedType.kind!=="value"&&(f=i.expectedType);for(let m=1;m<t.length;m+=2){const y=m===1?-1/0:t[m],x=t[m+1],w=m,M=m+1;if(typeof y!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',w);if(u.length&&u[u.length-1][0]>=y)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',w);const L=i.parse(x,M,f);if(!L)return null;f=f||L.type,u.push([y,L])}return new ws(f,s,u)}evaluate(t){const i=this.labels,s=this.outputs;if(i.length===1)return s[0].evaluate(t);const u=this.input.evaluate(t);if(u<=i[0])return s[0].evaluate(t);const f=i.length;return u>=i[f-1]?s[f-1].evaluate(t):s[Cn(i,u)].evaluate(t)}eachChild(t){t(this.input);for(const i of this.outputs)t(i)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){const t=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&t.push(this.labels[i]),t.push(this.outputs[i].serialize());return t}}var yl=ws;function Mr(e,t,i){return e*(1-i)+t*i}var Ur=Object.freeze({__proto__:null,array:function(e,t,i){return e.map((s,u)=>Mr(s,t[u],i))},color:function(e,t,i){return new Yr(Mr(e.r,t.r,i),Mr(e.g,t.g,i),Mr(e.b,t.b,i),Mr(e.a,t.a,i))},number:Mr});const po=.95047,Qs=1.08883,Ho=4/29,mn=6/29,gn=3*mn*mn,Ku=mn*mn*mn,ou=Math.PI/180,ks=180/Math.PI;function fo(e){return e>Ku?Math.pow(e,1/3):e/gn+Ho}function Es(e){return e>mn?e*e*e:gn*(e-Ho)}function Wn(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function mo(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function Ko(e){const t=mo(e.r),i=mo(e.g),s=mo(e.b),u=fo((.4124564*t+.3575761*i+.1804375*s)/po),f=fo((.2126729*t+.7151522*i+.072175*s)/1);return{l:116*f-16,a:500*(u-f),b:200*(f-fo((.0193339*t+.119192*i+.9503041*s)/Qs)),alpha:e.a}}function Bs(e){let t=(e.l+16)/116,i=isNaN(e.a)?t:t+e.a/500,s=isNaN(e.b)?t:t-e.b/200;return t=1*Es(t),i=po*Es(i),s=Qs*Es(s),new Yr(Wn(3.2404542*i-1.5371385*t-.4985314*s),Wn(-.969266*i+1.8760108*t+.041556*s),Wn(.0556434*i-.2040259*t+1.0572252*s),e.alpha)}function Ts(e,t,i){const s=t-e;return e+i*(s>180||s<-180?s-360*Math.round(s/360):s)}const Ji={forward:Ko,reverse:Bs,interpolate:function(e,t,i){return{l:Mr(e.l,t.l,i),a:Mr(e.a,t.a,i),b:Mr(e.b,t.b,i),alpha:Mr(e.alpha,t.alpha,i)}}},ya={forward:function(e){const{l:t,a:i,b:s}=Ko(e),u=Math.atan2(s,i)*ks;return{h:u<0?u+360:u,c:Math.sqrt(i*i+s*s),l:t,alpha:e.a}},reverse:function(e){const t=e.h*ou,i=e.c;return Bs({l:e.l,a:Math.cos(t)*i,b:Math.sin(t)*i,alpha:e.alpha})},interpolate:function(e,t,i){return{h:Ts(e.h,t.h,i),c:Mr(e.c,t.c,i),l:Mr(e.l,t.l,i),alpha:Mr(e.alpha,t.alpha,i)}}};var za=Object.freeze({__proto__:null,hcl:ya,lab:Ji});class cn{constructor(t,i,s,u,f){this.type=t,this.operator=i,this.interpolation=s,this.input=u,this.labels=[],this.outputs=[];for(const[m,y]of f)this.labels.push(m),this.outputs.push(y)}static interpolationFactor(t,i,s,u){let f=0;if(t.name==="exponential")f=ms(i,t.base,s,u);else if(t.name==="linear")f=ms(i,1,s,u);else if(t.name==="cubic-bezier"){const m=t.controlPoints;f=new Ie(m[0],m[1],m[2],m[3]).solve(ms(i,1,s,u))}return f}static parse(t,i){let[s,u,f,...m]=t;if(!Array.isArray(u)||u.length===0)return i.error("Expected an interpolation type expression.",1);if(u[0]==="linear")u={name:"linear"};else if(u[0]==="exponential"){const w=u[1];if(typeof w!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);u={name:"exponential",base:w}}else{if(u[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(u[0])}`,1,0);{const w=u.slice(1);if(w.length!==4||w.some(M=>typeof M!="number"||M<0||M>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);u={name:"cubic-bezier",controlPoints:w}}}if(t.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(f=i.parse(f,2,ke),!f)return null;const y=[];let x=null;s==="interpolate-hcl"||s==="interpolate-lab"?x=lr:i.expectedType&&i.expectedType.kind!=="value"&&(x=i.expectedType);for(let w=0;w<m.length;w+=2){const M=m[w],L=m[w+1],O=w+3,B=w+4;if(typeof M!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',O);if(y.length&&y[y.length-1][0]>=M)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',O);const F=i.parse(L,B,x);if(!F)return null;x=x||F.type,y.push([M,F])}return x.kind==="number"||x.kind==="color"||x.kind==="array"&&x.itemType.kind==="number"&&typeof x.N=="number"?new cn(x,s,u,f,y):i.error(`Type ${Oi(x)} is not interpolatable.`)}evaluate(t){const i=this.labels,s=this.outputs;if(i.length===1)return s[0].evaluate(t);const u=this.input.evaluate(t);if(u<=i[0])return s[0].evaluate(t);const f=i.length;if(u>=i[f-1])return s[f-1].evaluate(t);const m=Cn(i,u),y=cn.interpolationFactor(this.interpolation,u,i[m],i[m+1]),x=s[m].evaluate(t),w=s[m+1].evaluate(t);return this.operator==="interpolate"?Ur[this.type.kind.toLowerCase()](x,w,y):this.operator==="interpolate-hcl"?ya.reverse(ya.interpolate(ya.forward(x),ya.forward(w),y)):Ji.reverse(Ji.interpolate(Ji.forward(x),Ji.forward(w),y))}eachChild(t){t(this.input);for(const i of this.outputs)t(i)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){let t;t=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const i=[this.operator,t,this.input.serialize()];for(let s=0;s<this.labels.length;s++)i.push(this.labels[s],this.outputs[s].serialize());return i}}function ms(e,t,i,s){const u=s-i,f=e-i;return u===0?0:t===1?f/u:(Math.pow(t,f)-1)/(Math.pow(t,u)-1)}var _n=cn;class tl{constructor(t,i){this.type=t,this.args=i}static parse(t,i){if(t.length<2)return i.error("Expectected at least one argument.");let s=null;const u=i.expectedType;u&&u.kind!=="value"&&(s=u);const f=[];for(const y of t.slice(1)){const x=i.parse(y,1+f.length,s,void 0,{typeAnnotation:"omit"});if(!x)return null;s=s||x.type,f.push(x)}const m=u&&f.some(y=>qo(u,y.type));return new tl(m?Pr:s,f)}evaluate(t){let i,s=null,u=0;for(const f of this.args){if(u++,s=f.evaluate(t),s&&s instanceof io&&!s.available&&(i||(i=s),s=null,u===this.args.length))return i;if(s!==null)break}return s}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=["coalesce"];return this.eachChild(i=>{t.push(i.serialize())}),t}}var Rn=tl;class el{constructor(t,i){this.type=i.type,this.bindings=[].concat(t),this.result=i}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const i of this.bindings)t(i[1]);t(this.result)}static parse(t,i){if(t.length<4)return i.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const s=[];for(let f=1;f<t.length-1;f+=2){const m=t[f];if(typeof m!="string")return i.error(`Expected string, but found ${typeof m} instead.`,f);if(/[^a-zA-Z0-9_]/.test(m))return i.error("Variable names must contain only alphanumeric characters or '_'.",f);const y=i.parse(t[f+1],f+1);if(!y)return null;s.push([m,y])}const u=i.parse(t[t.length-1],t.length-1,i.expectedType,s);return u?new el(s,u):null}outputDefined(){return this.result.outputDefined()}serialize(){const t=["let"];for(const[i,s]of this.bindings)t.push(i,s.serialize());return t.push(this.result.serialize()),t}}var ka=el;class ta{constructor(t,i,s){this.type=t,this.index=i,this.input=s}static parse(t,i){if(t.length!==3)return i.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const s=i.parse(t[1],1,ke),u=i.parse(t[2],2,bo(i.expectedType||Pr));return s&&u?new ta(u.type.itemType,s,u):null}evaluate(t){const i=this.index.evaluate(t),s=this.input.evaluate(t);if(i<0)throw new mi(`Array index out of bounds: ${i} < 0.`);if(i>=s.length)throw new mi(`Array index out of bounds: ${i} > ${s.length-1}.`);if(i!==Math.floor(i))throw new mi(`Array index must be an integer, but found ${i} instead.`);return s[i]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var su=ta;class vl{constructor(t,i){this.type=Ir,this.needle=t,this.haystack=i}static parse(t,i){if(t.length!==3)return i.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const s=i.parse(t[1],1,Pr),u=i.parse(t[2],2,Pr);return s&&u?ro(s.type,[Ir,hr,ke,Or,Pr])?new vl(s,u):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Oi(s.type)} instead`):null}evaluate(t){const i=this.needle.evaluate(t),s=this.haystack.evaluate(t);if(s==null)return!1;if(!wo(i,["boolean","string","number","null"]))throw new mi(`Expected first argument to be of type boolean, string, number or null, but found ${Oi(xi(i))} instead.`);if(!wo(s,["string","array"]))throw new mi(`Expected second argument to be of type array or string, but found ${Oi(xi(s))} instead.`);return s.indexOf(i)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var Is=vl;class go{constructor(t,i,s){this.type=ke,this.needle=t,this.haystack=i,this.fromIndex=s}static parse(t,i){if(t.length<=2||t.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const s=i.parse(t[1],1,Pr),u=i.parse(t[2],2,Pr);if(!s||!u)return null;if(!ro(s.type,[Ir,hr,ke,Or,Pr]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Oi(s.type)} instead`);if(t.length===4){const f=i.parse(t[3],3,ke);return f?new go(s,u,f):null}return new go(s,u)}evaluate(t){const i=this.needle.evaluate(t),s=this.haystack.evaluate(t);if(!wo(i,["boolean","string","number","null"]))throw new mi(`Expected first argument to be of type boolean, string, number or null, but found ${Oi(xi(i))} instead.`);if(!wo(s,["string","array"]))throw new mi(`Expected second argument to be of type array or string, but found ${Oi(xi(s))} instead.`);if(this.fromIndex){const u=this.fromIndex.evaluate(t);return s.indexOf(i,u)}return s.indexOf(i)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var yn=go;class ea{constructor(t,i,s,u,f,m){this.inputType=t,this.type=i,this.input=s,this.cases=u,this.outputs=f,this.otherwise=m}static parse(t,i){if(t.length<5)return i.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return i.error("Expected an even number of arguments.");let s,u;i.expectedType&&i.expectedType.kind!=="value"&&(u=i.expectedType);const f={},m=[];for(let w=2;w<t.length-1;w+=2){let M=t[w];const L=t[w+1];Array.isArray(M)||(M=[M]);const O=i.concat(w);if(M.length===0)return O.error("Expected at least one branch label.");for(const F of M){if(typeof F!="number"&&typeof F!="string")return O.error("Branch labels must be numbers or strings.");if(typeof F=="number"&&Math.abs(F)>Number.MAX_SAFE_INTEGER)return O.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof F=="number"&&Math.floor(F)!==F)return O.error("Numeric branch labels must be integer values.");if(s){if(O.checkSubtype(s,xi(F)))return null}else s=xi(F);if(f[String(F)]!==void 0)return O.error("Branch labels must be unique.");f[String(F)]=m.length}const B=i.parse(L,w,u);if(!B)return null;u=u||B.type,m.push(B)}const y=i.parse(t[1],1,Pr);if(!y)return null;const x=i.parse(t[t.length-1],t.length-1,u);return x?y.type.kind!=="value"&&i.concat(1).checkSubtype(s,y.type)?null:new ea(s,u,y,f,m,x):null}evaluate(t){const i=this.input.evaluate(t);return(xi(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),s=[],u={};for(const m of i){const y=u[this.cases[m]];y===void 0?(u[this.cases[m]]=s.length,s.push([this.cases[m],[m]])):s[y][1].push(m)}const f=m=>this.inputType.kind==="number"?Number(m):m;for(const[m,y]of s)t.push(y.length===1?f(y[0]):y.map(f)),t.push(this.outputs[m].serialize());return t.push(this.otherwise.serialize()),t}}var qn=ea;class zo{constructor(t,i,s){this.type=t,this.branches=i,this.otherwise=s}static parse(t,i){if(t.length<4)return i.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return i.error("Expected an odd number of arguments.");let s;i.expectedType&&i.expectedType.kind!=="value"&&(s=i.expectedType);const u=[];for(let m=1;m<t.length-1;m+=2){const y=i.parse(t[m],m,Ir);if(!y)return null;const x=i.parse(t[m+1],m+1,s);if(!x)return null;u.push([y,x]),s=s||x.type}const f=i.parse(t[t.length-1],t.length-1,s);return f?new zo(s,u,f):null}evaluate(t){for(const[i,s]of this.branches)if(i.evaluate(t))return s.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[i,s]of this.branches)t(i),t(s);t(this.otherwise)}outputDefined(){return this.branches.every(([t,i])=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["case"];return this.eachChild(i=>{t.push(i.serialize())}),t}}var Fs=zo;class va{constructor(t,i,s,u){this.type=t,this.input=i,this.beginIndex=s,this.endIndex=u}static parse(t,i){if(t.length<=2||t.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const s=i.parse(t[1],1,Pr),u=i.parse(t[2],2,ke);if(!s||!u)return null;if(!ro(s.type,[bo(Pr),hr,Pr]))return i.error(`Expected first argument to be of type array or string, but found ${Oi(s.type)} instead`);if(t.length===4){const f=i.parse(t[3],3,ke);return f?new va(s.type,s,u,f):null}return new va(s.type,s,u)}evaluate(t){const i=this.input.evaluate(t),s=this.beginIndex.evaluate(t);if(!wo(i,["string","array"]))throw new mi(`Expected first argument to be of type array or string, but found ${Oi(xi(i))} instead.`);if(this.endIndex){const u=this.endIndex.evaluate(t);return i.slice(s,u)}return i.slice(s)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var ra=va;function Jo(e,t){return e==="=="||e==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function gs(e,t,i,s){return s.compare(t,i)===0}function Wi(e,t,i){const s=e!=="=="&&e!=="!=";return class oy{constructor(f,m,y){this.type=Ir,this.lhs=f,this.rhs=m,this.collator=y,this.hasUntypedArgument=f.type.kind==="value"||m.type.kind==="value"}static parse(f,m){if(f.length!==3&&f.length!==4)return m.error("Expected two or three arguments.");const y=f[0];let x=m.parse(f[1],1,Pr);if(!x)return null;if(!Jo(y,x.type))return m.concat(1).error(`"${y}" comparisons are not supported for type '${Oi(x.type)}'.`);let w=m.parse(f[2],2,Pr);if(!w)return null;if(!Jo(y,w.type))return m.concat(2).error(`"${y}" comparisons are not supported for type '${Oi(w.type)}'.`);if(x.type.kind!==w.type.kind&&x.type.kind!=="value"&&w.type.kind!=="value")return m.error(`Cannot compare types '${Oi(x.type)}' and '${Oi(w.type)}'.`);s&&(x.type.kind==="value"&&w.type.kind!=="value"?x=new ho(w.type,[x]):x.type.kind!=="value"&&w.type.kind==="value"&&(w=new ho(x.type,[w])));let M=null;if(f.length===4){if(x.type.kind!=="string"&&w.type.kind!=="string"&&x.type.kind!=="value"&&w.type.kind!=="value")return m.error("Cannot use collator to compare non-string types.");if(M=m.parse(f[3],3,Qn),!M)return null}return new oy(x,w,M)}evaluate(f){const m=this.lhs.evaluate(f),y=this.rhs.evaluate(f);if(s&&this.hasUntypedArgument){const x=xi(m),w=xi(y);if(x.kind!==w.kind||x.kind!=="string"&&x.kind!=="number")throw new mi(`Expected arguments for "${e}" to be (string, string) or (number, number), but found (${x.kind}, ${w.kind}) instead.`)}if(this.collator&&!s&&this.hasUntypedArgument){const x=xi(m),w=xi(y);if(x.kind!=="string"||w.kind!=="string")return t(f,m,y)}return this.collator?i(f,m,y,this.collator.evaluate(f)):t(f,m,y)}eachChild(f){f(this.lhs),f(this.rhs),this.collator&&f(this.collator)}outputDefined(){return!0}serialize(){const f=[e];return this.eachChild(m=>{f.push(m.serialize())}),f}}}const ko=Wi("==",function(e,t,i){return t===i},gs),$n=Wi("!=",function(e,t,i){return t!==i},function(e,t,i,s){return!gs(0,t,i,s)}),au=Wi("<",function(e,t,i){return t<i},function(e,t,i,s){return s.compare(t,i)<0}),Us=Wi(">",function(e,t,i){return t>i},function(e,t,i,s){return s.compare(t,i)>0}),xa=Wi("<=",function(e,t,i){return t<=i},function(e,t,i,s){return s.compare(t,i)<=0}),vn=Wi(">=",function(e,t,i){return t>=i},function(e,t,i,s){return s.compare(t,i)>=0});class hn{constructor(t,i,s,u,f,m){this.type=hr,this.number=t,this.locale=i,this.currency=s,this.unit=u,this.minFractionDigits=f,this.maxFractionDigits=m}static parse(t,i){if(t.length!==3)return i.error("Expected two arguments.");const s=i.parse(t[1],1,ke);if(!s)return null;const u=t[2];if(typeof u!="object"||Array.isArray(u))return i.error("NumberFormat options argument must be an object.");let f=null;if(u.locale&&(f=i.parse(u.locale,1,hr),!f))return null;let m=null;if(u.currency&&(m=i.parse(u.currency,1,hr),!m))return null;let y=null;if(u.unit&&(y=i.parse(u.unit,1,hr),!y))return null;let x=null;if(u["min-fraction-digits"]&&(x=i.parse(u["min-fraction-digits"],1,ke),!x))return null;let w=null;return u["max-fraction-digits"]&&(w=i.parse(u["max-fraction-digits"],1,ke),!w)?null:new hn(s,f,m,y,x,w)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(t):void 0,unit:this.unit?this.unit.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.unit&&t(this.unit),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.unit&&(t.unit=this.unit.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]}}class Yn{constructor(t){this.type=ke,this.input=t}static parse(t,i){if(t.length!==2)return i.error(`Expected 1 argument, but found ${t.length-1} instead.`);const s=i.parse(t[1],1);return s?s.type.kind!=="array"&&s.type.kind!=="string"&&s.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${Oi(s.type)} instead.`):new Yn(s):null}evaluate(t){const i=this.input.evaluate(t);if(typeof i=="string"||Array.isArray(i))return i.length;throw new mi(`Expected value to be of type string or array, but found ${Oi(xi(i))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){const t=["length"];return this.eachChild(i=>{t.push(i.serialize())}),t}}const _o={"==":ko,"!=":$n,">":Us,"<":au,">=":vn,"<=":xa,array:ho,at:su,boolean:ho,case:Fs,coalesce:Rn,collator:Na,format:di,image:Ja,in:Is,"index-of":yn,interpolate:_n,"interpolate-hcl":_n,"interpolate-lab":_n,length:Yn,let:ka,literal:$o,match:qn,number:ho,"number-format":hn,object:ho,slice:ra,step:yl,string:ho,"to-boolean":qi,"to-color":qi,"to-number":qi,"to-string":qi,var:zr,within:Oo};function xl(e,[t,i,s,u]){t=t.evaluate(e),i=i.evaluate(e),s=s.evaluate(e);const f=u?u.evaluate(e):1,m=Sn(t,i,s,f);if(m)throw new mi(m);return new Yr(t/255*f,i/255*f,s/255*f,f)}function yo(e,t){return e in t}function Qo(e,t){const i=t[e];return i===void 0?null:i}function ki(e){return{type:e}}bs.register(_o,{error:[{kind:"error"},[hr],(e,[t])=>{throw new mi(t.evaluate(e))}],typeof:[hr,[Pr],(e,[t])=>Oi(xi(t.evaluate(e)))],"to-rgba":[bo(ke,4),[lr],(e,[t])=>t.evaluate(e).toArray()],rgb:[lr,[ke,ke,ke],xl],rgba:[lr,[ke,ke,ke,ke],xl],has:{type:Ir,overloads:[[[hr],(e,[t])=>yo(t.evaluate(e),e.properties())],[[hr,jo],(e,[t,i])=>yo(t.evaluate(e),i.evaluate(e))]]},get:{type:Pr,overloads:[[[hr],(e,[t])=>Qo(t.evaluate(e),e.properties())],[[hr,jo],(e,[t,i])=>Qo(t.evaluate(e),i.evaluate(e))]]},"feature-state":[Pr,[hr],(e,[t])=>Qo(t.evaluate(e),e.featureState||{})],properties:[jo,[],e=>e.properties()],"geometry-type":[hr,[],e=>e.geometryType()],id:[Pr,[],e=>e.id()],zoom:[ke,[],e=>e.globals.zoom],pitch:[ke,[],e=>e.globals.pitch||0],"distance-from-center":[ke,[],e=>e.distanceFromCenter()],"heatmap-density":[ke,[],e=>e.globals.heatmapDensity||0],"line-progress":[ke,[],e=>e.globals.lineProgress||0],"sky-radial-progress":[ke,[],e=>e.globals.skyRadialProgress||0],accumulated:[Pr,[],e=>e.globals.accumulated===void 0?null:e.globals.accumulated],"+":[ke,ki(ke),(e,t)=>{let i=0;for(const s of t)i+=s.evaluate(e);return i}],"*":[ke,ki(ke),(e,t)=>{let i=1;for(const s of t)i*=s.evaluate(e);return i}],"-":{type:ke,overloads:[[[ke,ke],(e,[t,i])=>t.evaluate(e)-i.evaluate(e)],[[ke],(e,[t])=>-t.evaluate(e)]]},"/":[ke,[ke,ke],(e,[t,i])=>t.evaluate(e)/i.evaluate(e)],"%":[ke,[ke,ke],(e,[t,i])=>t.evaluate(e)%i.evaluate(e)],ln2:[ke,[],()=>Math.LN2],pi:[ke,[],()=>Math.PI],e:[ke,[],()=>Math.E],"^":[ke,[ke,ke],(e,[t,i])=>Math.pow(t.evaluate(e),i.evaluate(e))],sqrt:[ke,[ke],(e,[t])=>Math.sqrt(t.evaluate(e))],log10:[ke,[ke],(e,[t])=>Math.log(t.evaluate(e))/Math.LN10],ln:[ke,[ke],(e,[t])=>Math.log(t.evaluate(e))],log2:[ke,[ke],(e,[t])=>Math.log(t.evaluate(e))/Math.LN2],sin:[ke,[ke],(e,[t])=>Math.sin(t.evaluate(e))],cos:[ke,[ke],(e,[t])=>Math.cos(t.evaluate(e))],tan:[ke,[ke],(e,[t])=>Math.tan(t.evaluate(e))],asin:[ke,[ke],(e,[t])=>Math.asin(t.evaluate(e))],acos:[ke,[ke],(e,[t])=>Math.acos(t.evaluate(e))],atan:[ke,[ke],(e,[t])=>Math.atan(t.evaluate(e))],min:[ke,ki(ke),(e,t)=>Math.min(...t.map(i=>i.evaluate(e)))],max:[ke,ki(ke),(e,t)=>Math.max(...t.map(i=>i.evaluate(e)))],abs:[ke,[ke],(e,[t])=>Math.abs(t.evaluate(e))],round:[ke,[ke],(e,[t])=>{const i=t.evaluate(e);return i<0?-Math.round(-i):Math.round(i)}],floor:[ke,[ke],(e,[t])=>Math.floor(t.evaluate(e))],ceil:[ke,[ke],(e,[t])=>Math.ceil(t.evaluate(e))],"filter-==":[Ir,[hr,Pr],(e,[t,i])=>e.properties()[t.value]===i.value],"filter-id-==":[Ir,[Pr],(e,[t])=>e.id()===t.value],"filter-type-==":[Ir,[hr],(e,[t])=>e.geometryType()===t.value],"filter-<":[Ir,[hr,Pr],(e,[t,i])=>{const s=e.properties()[t.value],u=i.value;return typeof s==typeof u&&s<u}],"filter-id-<":[Ir,[Pr],(e,[t])=>{const i=e.id(),s=t.value;return typeof i==typeof s&&i<s}],"filter->":[Ir,[hr,Pr],(e,[t,i])=>{const s=e.properties()[t.value],u=i.value;return typeof s==typeof u&&s>u}],"filter-id->":[Ir,[Pr],(e,[t])=>{const i=e.id(),s=t.value;return typeof i==typeof s&&i>s}],"filter-<=":[Ir,[hr,Pr],(e,[t,i])=>{const s=e.properties()[t.value],u=i.value;return typeof s==typeof u&&s<=u}],"filter-id-<=":[Ir,[Pr],(e,[t])=>{const i=e.id(),s=t.value;return typeof i==typeof s&&i<=s}],"filter->=":[Ir,[hr,Pr],(e,[t,i])=>{const s=e.properties()[t.value],u=i.value;return typeof s==typeof u&&s>=u}],"filter-id->=":[Ir,[Pr],(e,[t])=>{const i=e.id(),s=t.value;return typeof i==typeof s&&i>=s}],"filter-has":[Ir,[Pr],(e,[t])=>t.value in e.properties()],"filter-has-id":[Ir,[],e=>e.id()!==null&&e.id()!==void 0],"filter-type-in":[Ir,[bo(hr)],(e,[t])=>t.value.indexOf(e.geometryType())>=0],"filter-id-in":[Ir,[bo(Pr)],(e,[t])=>t.value.indexOf(e.id())>=0],"filter-in-small":[Ir,[hr,bo(Pr)],(e,[t,i])=>i.value.indexOf(e.properties()[t.value])>=0],"filter-in-large":[Ir,[hr,bo(Pr)],(e,[t,i])=>function(s,u,f,m){for(;f<=m;){const y=f+m>>1;if(u[y]===s)return!0;u[y]>s?m=y-1:f=y+1}return!1}(e.properties()[t.value],i.value,0,i.value.length-1)],all:{type:Ir,overloads:[[[Ir,Ir],(e,[t,i])=>t.evaluate(e)&&i.evaluate(e)],[ki(Ir),(e,t)=>{for(const i of t)if(!i.evaluate(e))return!1;return!0}]]},any:{type:Ir,overloads:[[[Ir,Ir],(e,[t,i])=>t.evaluate(e)||i.evaluate(e)],[ki(Ir),(e,t)=>{for(const i of t)if(i.evaluate(e))return!0;return!1}]]},"!":[Ir,[Ir],(e,[t])=>!t.evaluate(e)],"is-supported-script":[Ir,[hr],(e,[t])=>{const i=e.globals&&e.globals.isSupportedScript;return!i||i(t.evaluate(e))}],upcase:[hr,[hr],(e,[t])=>t.evaluate(e).toUpperCase()],downcase:[hr,[hr],(e,[t])=>t.evaluate(e).toLowerCase()],concat:[hr,ki(Pr),(e,t)=>t.map(i=>li(i.evaluate(e))).join("")],"resolved-locale":[hr,[Qn],(e,[t])=>t.evaluate(e).resolvedLocale()]});var ba=_o;function xn(e){return{result:"success",value:e}}function Vs(e){return{result:"error",value:e}}function Hn(e){return e["property-type"]==="data-driven"}function Qi(e){return!!e.expression&&e.expression.parameters.indexOf("zoom")>-1}function oo(e){return!!e.expression&&e.expression.interpolated}function Lr(e){return e instanceof Number?"number":e instanceof String?"string":e instanceof Boolean?"boolean":Array.isArray(e)?"array":e===null?"null":typeof e}function _s(e){return typeof e=="object"&&e!==null&&!Array.isArray(e)}function Bo(e){return e}function Ss(e,t){const i=t.type==="color",s=e.stops&&typeof e.stops[0][0]=="object",u=s||!(s||e.property!==void 0),f=e.type||(oo(t)?"exponential":"interval");if(i&&((e=Lo({},e)).stops&&(e.stops=e.stops.map(w=>[w[0],Yr.parse(w[1])])),e.default=Yr.parse(e.default?e.default:t.default)),e.colorSpace&&e.colorSpace!=="rgb"&&!za[e.colorSpace])throw new Error(`Unknown color space: ${e.colorSpace}`);let m,y,x;if(f==="exponential")m=Cs;else if(f==="interval")m=bi;else if(f==="categorical"){m=ts,y=Object.create(null);for(const w of e.stops)y[w[0]]=w[1];x=typeof e.stops[0][0]}else{if(f!=="identity")throw new Error(`Unknown function type "${f}"`);m=Fl}if(s){const w={},M=[];for(let B=0;B<e.stops.length;B++){const F=e.stops[B],q=F[0].zoom;w[q]===void 0&&(w[q]={zoom:q,type:e.type,property:e.property,default:e.default,stops:[]},M.push(q)),w[q].stops.push([F[0].value,F[1]])}const L=[];for(const B of M)L.push([w[B].zoom,Ss(w[B],t)]);const O={name:"linear"};return{kind:"composite",interpolationType:O,interpolationFactor:_n.interpolationFactor.bind(void 0,O),zoomStops:L.map(B=>B[0]),evaluate:({zoom:B},F)=>Cs({stops:L,base:e.base},t,B).evaluate(B,F)}}if(u){const w=f==="exponential"?{name:"exponential",base:e.base!==void 0?e.base:1}:null;return{kind:"camera",interpolationType:w,interpolationFactor:_n.interpolationFactor.bind(void 0,w),zoomStops:e.stops.map(M=>M[0]),evaluate:({zoom:M})=>m(e,t,M,y,x)}}return{kind:"source",evaluate(w,M){const L=M&&M.properties?M.properties[e.property]:void 0;return L===void 0?pn(e.default,t.default):m(e,t,L,y,x)}}}function pn(e,t,i){return e!==void 0?e:t!==void 0?t:i!==void 0?i:void 0}function ts(e,t,i,s,u){return pn(typeof i===u?s[i]:void 0,e.default,t.default)}function bi(e,t,i){if(Lr(i)!=="number")return pn(e.default,t.default);const s=e.stops.length;if(s===1||i<=e.stops[0][0])return e.stops[0][1];if(i>=e.stops[s-1][0])return e.stops[s-1][1];const u=Cn(e.stops.map(f=>f[0]),i);return e.stops[u][1]}function Cs(e,t,i){const s=e.base!==void 0?e.base:1;if(Lr(i)!=="number")return pn(e.default,t.default);const u=e.stops.length;if(u===1||i<=e.stops[0][0])return e.stops[0][1];if(i>=e.stops[u-1][0])return e.stops[u-1][1];const f=Cn(e.stops.map(M=>M[0]),i),m=function(M,L,O,B){const F=B-O,q=M-O;return F===0?0:L===1?q/F:(Math.pow(L,q)-1)/(Math.pow(L,F)-1)}(i,s,e.stops[f][0],e.stops[f+1][0]),y=e.stops[f][1],x=e.stops[f+1][1];let w=Ur[t.type]||Bo;if(e.colorSpace&&e.colorSpace!=="rgb"){const M=za[e.colorSpace];w=(L,O)=>M.reverse(M.interpolate(M.forward(L),M.forward(O),m))}return typeof y.evaluate=="function"?{evaluate(...M){const L=y.evaluate.apply(void 0,M),O=x.evaluate.apply(void 0,M);if(L!==void 0&&O!==void 0)return w(L,O,m)}}:w(y,x,m)}function Fl(e,t,i){return t.type==="color"?i=Yr.parse(i):t.type==="formatted"?i=br.fromString(i.toString()):t.type==="resolvedImage"?i=io.fromString(i.toString()):Lr(i)===t.type||t.type==="enum"&&t.values[i]||(i=void 0),pn(i,e.default,t.default)}class bn{constructor(t,i){this.expression=t,this._warningHistory={},this._evaluator=new Bl,this._defaultValue=i?function(s){return s.type==="color"&&(_s(s.default)||Array.isArray(s.default))?new Yr(0,0,0,0):s.type==="color"?Yr.parse(s.default)||null:s.default===void 0?null:s.default}(i):null,this._enumValues=i&&i.type==="enum"?i.values:null}evaluateWithoutErrorHandling(t,i,s,u,f,m,y,x){return this._evaluator.globals=t,this._evaluator.feature=i,this._evaluator.featureState=s,this._evaluator.canonical=u||null,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=m,this._evaluator.featureTileCoord=y||null,this._evaluator.featureDistanceData=x||null,this.expression.evaluate(this._evaluator)}evaluate(t,i,s,u,f,m,y,x){this._evaluator.globals=t,this._evaluator.feature=i||null,this._evaluator.featureState=s||null,this._evaluator.canonical=u||null,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=m||null,this._evaluator.featureTileCoord=y||null,this._evaluator.featureDistanceData=x||null;try{const w=this.expression.evaluate(this._evaluator);if(w==null||typeof w=="number"&&w!=w)return this._defaultValue;if(this._enumValues&&!(w in this._enumValues))throw new mi(`Expected value to be one of ${Object.keys(this._enumValues).map(M=>JSON.stringify(M)).join(", ")}, but found ${JSON.stringify(w)} instead.`);return w}catch(w){return this._warningHistory[w.message]||(this._warningHistory[w.message]=!0,typeof console<"u"&&console.warn(w.message)),this._defaultValue}}}function So(e){return Array.isArray(e)&&e.length>0&&typeof e[0]=="string"&&e[0]in ba}function ia(e,t){const i=new ci(ba,[],t?function(u){const f={color:lr,string:hr,number:ke,enum:hr,boolean:Ir,formatted:to,resolvedImage:eo};return u.type==="array"?bo(f[u.value]||Pr,u.length):f[u.type]}(t):void 0),s=i.parse(e,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return s?xn(new bn(s,t)):Vs(i.errors)}class Gs{constructor(t,i){this.kind=t,this._styleExpression=i,this.isStateDependent=t!=="constant"&&!No(i.expression)}evaluateWithoutErrorHandling(t,i,s,u,f,m){return this._styleExpression.evaluateWithoutErrorHandling(t,i,s,u,f,m)}evaluate(t,i,s,u,f,m){return this._styleExpression.evaluate(t,i,s,u,f,m)}}class Fo{constructor(t,i,s,u){this.kind=t,this.zoomStops=s,this._styleExpression=i,this.isStateDependent=t!=="camera"&&!No(i.expression),this.interpolationType=u}evaluateWithoutErrorHandling(t,i,s,u,f,m){return this._styleExpression.evaluateWithoutErrorHandling(t,i,s,u,f,m)}evaluate(t,i,s,u,f,m){return this._styleExpression.evaluate(t,i,s,u,f,m)}interpolationFactor(t,i,s){return this.interpolationType?_n.interpolationFactor(this.interpolationType,t,i,s):0}}function Yi(e,t){if((e=ia(e,t)).result==="error")return e;const i=e.value.expression,s=ui(i);if(!s&&!Hn(t))return Vs([new In("","data expressions not supported")]);const u=dn(i,["zoom","pitch","distance-from-center"]);if(!u&&!Qi(t))return Vs([new In("","zoom expressions not supported")]);const f=na(i);return f||u?f instanceof In?Vs([f]):f instanceof _n&&!oo(t)?Vs([new In("",'"interpolate" expressions cannot be used with this property')]):xn(f?new Fo(s?"camera":"composite",e.value,f.labels,f instanceof _n?f.interpolation:void 0):new Gs(s?"constant":"source",e.value)):Vs([new In("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class wn{constructor(t,i){this._parameters=t,this._specification=i,Lo(this,Ss(this._parameters,this._specification))}static deserialize(t){return new wn(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function na(e){let t=null;if(e instanceof ka)t=na(e.result);else if(e instanceof Rn){for(const i of e.args)if(t=na(i),t)break}else(e instanceof yl||e instanceof _n)&&e.input instanceof bs&&e.input.name==="zoom"&&(t=e);return t instanceof In||e.eachChild(i=>{const s=na(i);s instanceof In?t=s:!t&&s?t=new In("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&s&&t!==s&&(t=new In("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}class Le{constructor(t,i,s,u){this.message=(t?`${t}: `:"")+s,u&&(this.identifier=u),i!=null&&i.__line__&&(this.line=i.__line__)}}function Uo(e){const t=e.key,i=e.value,s=e.valueSpec||{},u=e.objectElementValidators||{},f=e.style,m=e.styleSpec;let y=[];const x=Lr(i);if(x!=="object")return[new Le(t,i,`object expected, ${x} found`)];for(const w in i){const M=w.split(".")[0];let L;u[M]?L=u[M]:s[M]?L=R:u["*"]?L=u["*"]:s["*"]&&(L=R),L?y=y.concat(L({key:(t&&`${t}.`)+w,value:i[w],valueSpec:s[M]||s["*"],style:f,styleSpec:m,object:i,objectKey:w},i)):y.push(new Le(t,i[w],`unknown property "${w}"`))}for(const w in s)u[w]||s[w].required&&s[w].default===void 0&&i[w]===void 0&&y.push(new Le(t,i,`missing required property "${w}"`));return y}function rl(e){const t=e.value,i=e.valueSpec,s=e.style,u=e.styleSpec,f=e.key,m=e.arrayElementValidator||R;if(Lr(t)!=="array")return[new Le(f,t,`array expected, ${Lr(t)} found`)];if(i.length&&t.length!==i.length)return[new Le(f,t,`array length ${i.length} expected, length ${t.length} found`)];if(i["min-length"]&&t.length<i["min-length"])return[new Le(f,t,`array length at least ${i["min-length"]} expected, length ${t.length} found`)];let y={type:i.value,values:i.values,minimum:i.minimum,maximum:i.maximum,function:void 0};u.$version<7&&(y.function=i.function),Lr(i.value)==="object"&&(y=i.value);let x=[];for(let w=0;w<t.length;w++)x=x.concat(m({array:t,arrayIndex:w,value:t[w],valueSpec:y,style:s,styleSpec:u,key:`${f}[${w}]`}));return x}function tn(e){const t=e.key,i=e.value,s=e.valueSpec;let u=Lr(i);if(u==="number"&&i!=i&&(u="NaN"),u!=="number")return[new Le(t,i,`number expected, ${u} found`)];if("minimum"in s){let f=s.minimum;if(Lr(s.minimum)==="array"&&(f=s.minimum[e.arrayIndex]),i<f)return[new Le(t,i,`${i} is less than the minimum value ${f}`)]}if("maximum"in s){let f=s.maximum;if(Lr(s.maximum)==="array"&&(f=s.maximum[e.arrayIndex]),i>f)return[new Le(t,i,`${i} is greater than the maximum value ${f}`)]}return[]}function il(e){const t=e.valueSpec,i=Xi(e.value.type);let s,u,f,m={};const y=i!=="categorical"&&e.value.property===void 0,x=!y,w=Lr(e.value.stops)==="array"&&Lr(e.value.stops[0])==="array"&&Lr(e.value.stops[0][0])==="object",M=Uo({key:e.key,value:e.value,valueSpec:e.styleSpec.function,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{stops:function(B){if(i==="identity")return[new Le(B.key,B.value,'identity function may not have a "stops" property')];let F=[];const q=B.value;return F=F.concat(rl({key:B.key,value:q,valueSpec:B.valueSpec,style:B.style,styleSpec:B.styleSpec,arrayElementValidator:L})),Lr(q)==="array"&&q.length===0&&F.push(new Le(B.key,q,"array must have at least one stop")),F},default:function(B){return R({key:B.key,value:B.value,valueSpec:t,style:B.style,styleSpec:B.styleSpec})}}});return i==="identity"&&y&&M.push(new Le(e.key,e.value,'missing required property "property"')),i==="identity"||e.value.stops||M.push(new Le(e.key,e.value,'missing required property "stops"')),i==="exponential"&&e.valueSpec.expression&&!oo(e.valueSpec)&&M.push(new Le(e.key,e.value,"exponential functions not supported")),e.styleSpec.$version>=8&&(x&&!Hn(e.valueSpec)?M.push(new Le(e.key,e.value,"property functions not supported")):y&&!Qi(e.valueSpec)&&M.push(new Le(e.key,e.value,"zoom functions not supported"))),i!=="categorical"&&!w||e.value.property!==void 0||M.push(new Le(e.key,e.value,'"property" property is required')),M;function L(B){let F=[];const q=B.value,K=B.key;if(Lr(q)!=="array")return[new Le(K,q,`array expected, ${Lr(q)} found`)];if(q.length!==2)return[new Le(K,q,`array length 2 expected, length ${q.length} found`)];if(w){if(Lr(q[0])!=="object")return[new Le(K,q,`object expected, ${Lr(q[0])} found`)];if(q[0].zoom===void 0)return[new Le(K,q,"object stop key must have zoom")];if(q[0].value===void 0)return[new Le(K,q,"object stop key must have value")];const at=Xi(q[0].zoom);if(typeof at!="number")return[new Le(K,q[0].zoom,"stop zoom values must be numbers")];if(f&&f>at)return[new Le(K,q[0].zoom,"stop zoom values must appear in ascending order")];at!==f&&(f=at,u=void 0,m={}),F=F.concat(Uo({key:`${K}[0]`,value:q[0],valueSpec:{zoom:{}},style:B.style,styleSpec:B.styleSpec,objectElementValidators:{zoom:tn,value:O}}))}else F=F.concat(O({key:`${K}[0]`,value:q[0],valueSpec:{},style:B.style,styleSpec:B.styleSpec},q));return So(Rr(q[1]))?F.concat([new Le(`${K}[1]`,q[1],"expressions are not allowed in function stops.")]):F.concat(R({key:`${K}[1]`,value:q[1],valueSpec:t,style:B.style,styleSpec:B.styleSpec}))}function O(B,F){const q=Lr(B.value),K=Xi(B.value),at=B.value!==null?B.value:F;if(s){if(q!==s)return[new Le(B.key,at,`${q} stop domain type must match previous stop domain type ${s}`)]}else s=q;if(q!=="number"&&q!=="string"&&q!=="boolean"&&typeof K!="number"&&typeof K!="string"&&typeof K!="boolean")return[new Le(B.key,at,"stop domain value must be a number, string, or boolean")];if(q!=="number"&&i!=="categorical"){let mt=`number expected, ${q} found`;return Hn(t)&&i===void 0&&(mt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Le(B.key,at,mt)]}return i!=="categorical"||q!=="number"||typeof K=="number"&&isFinite(K)&&Math.floor(K)===K?i!=="categorical"&&q==="number"&&typeof K=="number"&&typeof u=="number"&&u!==void 0&&K<u?[new Le(B.key,at,"stop domain values must appear in ascending order")]:(u=K,i==="categorical"&&K in m?[new Le(B.key,at,"stop domain values must be unique")]:(m[K]=!0,[])):[new Le(B.key,at,`integer expected, found ${String(K)}`)]}}function wi(e){const t=(e.expressionContext==="property"?Yi:ia)(Rr(e.value),e.valueSpec);if(t.result==="error")return t.value.map(s=>new Le(`${e.key}${s.key}`,e.value,s.message));const i=t.value.expression||t.value._styleExpression.expression;if(e.expressionContext==="property"&&e.propertyKey==="text-font"&&!i.outputDefined())return[new Le(e.key,e.value,`Invalid data expression for "${e.propertyKey}". Output values must be contained as literals within the expression.`)];if(e.expressionContext==="property"&&e.propertyType==="layout"&&!No(i))return[new Le(e.key,e.value,'"feature-state" data expressions are not supported with layout properties.')];if(e.expressionContext==="filter")return Ba(i,e);if(e.expressionContext&&e.expressionContext.indexOf("cluster")===0){if(!dn(i,["zoom","feature-state"]))return[new Le(e.key,e.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(e.expressionContext==="cluster-initial"&&!ui(i))return[new Le(e.key,e.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ba(e,t){const i=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(const u of t.valueSpec.expression.parameters)i.delete(u);if(i.size===0)return[];const s=[];return e instanceof bs&&i.has(e.name)?[new Le(t.key,t.value,`["${e.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(e.eachChild(u=>{s.push(...Ba(u,t))}),s)}function oa(e){const t=e.key,i=e.value,s=e.valueSpec,u=[];return Array.isArray(s.values)?s.values.indexOf(Xi(i))===-1&&u.push(new Le(t,i,`expected one of [${s.values.join(", ")}], ${JSON.stringify(i)} found`)):Object.keys(s.values).indexOf(Xi(i))===-1&&u.push(new Le(t,i,`expected one of [${Object.keys(s.values).join(", ")}], ${JSON.stringify(i)} found`)),u}function Ul(e){if(e===!0||e===!1)return!0;if(!Array.isArray(e)||e.length===0)return!1;switch(e[0]){case"has":return e.length>=2&&e[1]!=="$id"&&e[1]!=="$type";case"in":return e.length>=3&&(typeof e[1]!="string"||Array.isArray(e[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return e.length!==3||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(const t of e.slice(1))if(!Ul(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}function bl(e,t="fill"){if(e==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Ul(e)||(e=Ms(e));const i=e;let s=!0;try{s=function(w){if(!ys(w))return w;let M=Rr(w);return js(M),M=es(M),M}(i)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(i,null,2)}
        `)}const u=ie[`filter_${t}`],f=ia(s,u);let m=null;if(f.result==="error")throw new Error(f.value.map(w=>`${w.key}: ${w.message}`).join(", "));m=(w,M,L)=>f.value.evaluate(w,M,{},L);let y=null,x=null;if(s!==i){const w=ia(i,u);if(w.result==="error")throw new Error(w.value.map(M=>`${M.key}: ${M.message}`).join(", "));y=(M,L,O,B,F)=>w.value.evaluate(M,L,{},O,void 0,void 0,B,F),x=!ui(w.value.expression)}return{filter:m,dynamicFilter:y||void 0,needGeometry:qs(s),needFeature:!!x}}function es(e){if(!Array.isArray(e))return e;const t=function(i){if(nl.has(i[0])){for(let s=1;s<i.length;s++)if(ys(i[s]))return!0}return i}(e);return t===!0?t:t.map(i=>es(i))}function js(e){let t=!1;const i=[];if(e[0]==="case"){for(let s=1;s<e.length-1;s+=2)t=t||ys(e[s]),i.push(e[s+1]);i.push(e[e.length-1])}else if(e[0]==="match"){t=t||ys(e[1]);for(let s=2;s<e.length-1;s+=2)i.push(e[s+1]);i.push(e[e.length-1])}else if(e[0]==="step"){t=t||ys(e[1]);for(let s=1;s<e.length-1;s+=2)i.push(e[s+1])}t&&(e.length=0,e.push("any",...i));for(let s=1;s<e.length;s++)js(e[s])}function ys(e){if(!Array.isArray(e))return!1;if((t=e[0])==="pitch"||t==="distance-from-center")return!0;var t;for(let i=1;i<e.length;i++)if(ys(e[i]))return!0;return!1}const nl=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Fa(e,t){return e<t?-1:e>t?1:0}function qs(e){if(!Array.isArray(e))return!1;if(e[0]==="within")return!0;for(let t=1;t<e.length;t++)if(qs(e[t]))return!0;return!1}function Ms(e){if(!e)return!0;const t=e[0];return e.length<=1?t!=="any":t==="=="?sa(e[1],e[2],"=="):t==="!="?rs(sa(e[1],e[2],"==")):t==="<"||t===">"||t==="<="||t===">="?sa(e[1],e[2],t):t==="any"?(i=e.slice(1),["any"].concat(i.map(Ms))):t==="all"?["all"].concat(e.slice(1).map(Ms)):t==="none"?["all"].concat(e.slice(1).map(Ms).map(rs)):t==="in"?As(e[1],e.slice(2)):t==="!in"?rs(As(e[1],e.slice(2))):t==="has"?cr(e[1]):t==="!has"?rs(cr(e[1])):t!=="within"||e;var i}function sa(e,t,i){switch(e){case"$type":return[`filter-type-${i}`,t];case"$id":return[`filter-id-${i}`,t];default:return[`filter-${i}`,e,t]}}function As(e,t){if(t.length===0)return!1;switch(e){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(i=>typeof i!=typeof t[0])?["filter-in-large",e,["literal",t.sort(Fa)]]:["filter-in-small",e,["literal",t]]}}function cr(e){switch(e){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",e]}}function rs(e){return["!",e]}function Ps(e){return Ul(Rr(e.value))?wi(Lo({},e,{expressionContext:"filter",valueSpec:e.styleSpec[`filter_${e.layerType||"fill"}`]})):is(e)}function is(e){const t=e.value,i=e.key;if(Lr(t)!=="array")return[new Le(i,t,`array expected, ${Lr(t)} found`)];const s=e.styleSpec;let u,f=[];if(t.length<1)return[new Le(i,t,"filter array must have at least 1 element")];switch(f=f.concat(oa({key:`${i}[0]`,value:t[0],valueSpec:s.filter_operator,style:e.style,styleSpec:e.styleSpec})),Xi(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&Xi(t[1])==="$type"&&f.push(new Le(i,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&f.push(new Le(i,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(u=Lr(t[1]),u!=="string"&&f.push(new Le(`${i}[1]`,t[1],`string expected, ${u} found`)));for(let m=2;m<t.length;m++)u=Lr(t[m]),Xi(t[1])==="$type"?f=f.concat(oa({key:`${i}[${m}]`,value:t[m],valueSpec:s.geometry_type,style:e.style,styleSpec:e.styleSpec})):u!=="string"&&u!=="number"&&u!=="boolean"&&f.push(new Le(`${i}[${m}]`,t[m],`string, number, or boolean expected, ${u} found`));break;case"any":case"all":case"none":for(let m=1;m<t.length;m++)f=f.concat(is({key:`${i}[${m}]`,value:t[m],style:e.style,styleSpec:e.styleSpec}));break;case"has":case"!has":u=Lr(t[1]),t.length!==2?f.push(new Le(i,t,`filter array for "${t[0]}" operator must have 2 elements`)):u!=="string"&&f.push(new Le(`${i}[1]`,t[1],`string expected, ${u} found`));break;case"within":u=Lr(t[1]),t.length!==2?f.push(new Le(i,t,`filter array for "${t[0]}" operator must have 2 elements`)):u!=="object"&&f.push(new Le(`${i}[1]`,t[1],`object expected, ${u} found`))}return f}function Kn(e,t){const i=e.key,s=e.style,u=e.styleSpec,f=e.value,m=e.objectKey,y=u[`${t}_${e.layerType}`];if(!y)return[];const x=m.match(/^(.*)-transition$/);if(t==="paint"&&x&&y[x[1]]&&y[x[1]].transition)return R({key:i,value:f,valueSpec:u.transition,style:s,styleSpec:u});const w=e.valueSpec||y[m];if(!w)return[new Le(i,f,`unknown property "${m}"`)];let M;if(Lr(f)==="string"&&Hn(w)&&!w.tokens&&(M=/^{([^}]+)}$/.exec(f))){const O=`\`{ "type": "identity", "property": ${M?JSON.stringify(M[1]):'"_"'} }\``;return[new Le(i,f,`"${m}" does not support interpolation syntax
Use an identity property function instead: ${O}.`)]}const L=[];return e.layerType==="symbol"&&(m==="text-field"&&s&&!s.glyphs&&L.push(new Le(i,f,'use of "text-field" requires a style "glyphs" property')),m==="text-font"&&_s(Rr(f))&&Xi(f.type)==="identity"&&L.push(new Le(i,f,'"text-font" does not support identity functions'))),L.concat(R({key:e.key,value:f,valueSpec:w,style:s,styleSpec:u,expressionContext:"property",propertyType:t,propertyKey:m}))}function Vl(e){return Kn(e,"paint")}function Jn(e){return Kn(e,"layout")}function Hi(e){let t=[];const i=e.value,s=e.key,u=e.style,f=e.styleSpec;i.type||i.ref||t.push(new Le(s,i,'either "type" or "ref" is required'));let m=Xi(i.type);const y=Xi(i.ref);if(i.id){const x=Xi(i.id);for(let w=0;w<e.arrayIndex;w++){const M=u.layers[w];Xi(M.id)===x&&t.push(new Le(s,i.id,`duplicate layer id "${i.id}", previously used at line ${M.id.__line__}`))}}if("ref"in i){let x;["type","source","source-layer","filter","layout"].forEach(w=>{w in i&&t.push(new Le(s,i[w],`"${w}" is prohibited for ref layers`))}),u.layers.forEach(w=>{Xi(w.id)===y&&(x=w)}),x?x.ref?t.push(new Le(s,i.ref,"ref cannot reference another ref layer")):m=Xi(x.type):typeof y=="string"&&t.push(new Le(s,i.ref,`ref layer "${y}" not found`))}else if(m!=="background"&&m!=="sky")if(i.source){const x=u.sources&&u.sources[i.source],w=x&&Xi(x.type);x?w==="vector"&&m==="raster"?t.push(new Le(s,i.source,`layer "${i.id}" requires a raster source`)):w==="raster"&&m!=="raster"?t.push(new Le(s,i.source,`layer "${i.id}" requires a vector source`)):w!=="vector"||i["source-layer"]?w==="raster-dem"&&m!=="hillshade"?t.push(new Le(s,i.source,"raster-dem source can only be used with layer type 'hillshade'.")):m!=="line"||!i.paint||!i.paint["line-gradient"]&&!i.paint["line-trim-offset"]||w==="geojson"&&x.lineMetrics||t.push(new Le(s,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new Le(s,i,`layer "${i.id}" must specify a "source-layer"`)):t.push(new Le(s,i.source,`source "${i.source}" not found`))}else t.push(new Le(s,i,'missing required property "source"'));return t=t.concat(Uo({key:s,value:i,valueSpec:f.layer,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":()=>[],type:()=>R({key:`${s}.type`,value:i.type,valueSpec:f.layer.type,style:e.style,styleSpec:e.styleSpec,object:i,objectKey:"type"}),filter:x=>Ps(Lo({layerType:m},x)),layout:x=>Uo({layer:i,key:x.key,value:x.value,valueSpec:{},style:x.style,styleSpec:x.styleSpec,objectElementValidators:{"*":w=>Jn(Lo({layerType:m},w))}}),paint:x=>Uo({layer:i,key:x.key,value:x.value,valueSpec:{},style:x.style,styleSpec:x.styleSpec,objectElementValidators:{"*":w=>Vl(Lo({layerType:m},w))}})}})),t}function $s(e){const t=e.value,i=e.key,s=Lr(t);return s!=="string"?[new Le(i,t,`string expected, ${s} found`)]:[]}const Ua={promoteId:function({key:e,value:t}){if(Lr(t)==="string")return $s({key:e,value:t});{const i=[];for(const s in t)i.push(...$s({key:`${e}.${s}`,value:t[s]}));return i}}};function r(e){const t=e.value,i=e.key,s=e.styleSpec,u=e.style;if(!t.type)return[new Le(i,t,'"type" is required')];const f=Xi(t.type);let m;switch(f){case"vector":case"raster":case"raster-dem":return m=Uo({key:i,value:t,valueSpec:s[`source_${f.replace("-","_")}`],style:e.style,styleSpec:s,objectElementValidators:Ua}),m;case"geojson":if(m=Uo({key:i,value:t,valueSpec:s.source_geojson,style:u,styleSpec:s,objectElementValidators:Ua}),t.cluster)for(const y in t.clusterProperties){const[x,w]=t.clusterProperties[y],M=typeof x=="string"?[x,["accumulated"],["get",y]]:x;m.push(...wi({key:`${i}.${y}.map`,value:w,expressionContext:"cluster-map"})),m.push(...wi({key:`${i}.${y}.reduce`,value:M,expressionContext:"cluster-reduce"}))}return m;case"video":return Uo({key:i,value:t,valueSpec:s.source_video,style:u,styleSpec:s});case"image":return Uo({key:i,value:t,valueSpec:s.source_image,style:u,styleSpec:s});case"canvas":return[new Le(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return oa({key:`${i}.type`,value:t.type,valueSpec:{values:o(s)},style:u,styleSpec:s})}}function o(e){return e.source.reduce((t,i)=>{const s=e[i];return s.type.type==="enum"&&(t=t.concat(Object.keys(s.type.values))),t},[])}function c(e){const t=e.value,i=e.styleSpec,s=i.light,u=e.style;let f=[];const m=Lr(t);if(t===void 0)return f;if(m!=="object")return f=f.concat([new Le("light",t,`object expected, ${m} found`)]),f;for(const y in t){const x=y.match(/^(.*)-transition$/);f=f.concat(x&&s[x[1]]&&s[x[1]].transition?R({key:y,value:t[y],valueSpec:i.transition,style:u,styleSpec:i}):s[y]?R({key:y,value:t[y],valueSpec:s[y],style:u,styleSpec:i}):[new Le(y,t[y],`unknown property "${y}"`)])}return f}function p(e){const t=e.value,i=e.key,s=e.style,u=e.styleSpec,f=u.terrain;let m=[];const y=Lr(t);if(t===void 0)return m;if(y!=="object")return m=m.concat([new Le("terrain",t,`object expected, ${y} found`)]),m;for(const x in t){const w=x.match(/^(.*)-transition$/);m=m.concat(w&&f[w[1]]&&f[w[1]].transition?R({key:x,value:t[x],valueSpec:u.transition,style:s,styleSpec:u}):f[x]?R({key:x,value:t[x],valueSpec:f[x],style:s,styleSpec:u}):[new Le(x,t[x],`unknown property "${x}"`)])}if(t.source){const x=s.sources&&s.sources[t.source],w=x&&Xi(x.type);x?w!=="raster-dem"&&m.push(new Le(i,t.source,`terrain cannot be used with a source of type ${String(w)}, it only be used with a "raster-dem" source type`)):m.push(new Le(i,t.source,`source "${t.source}" not found`))}else m.push(new Le(i,t,'terrain is missing required property "source"'));return m}function _(e){const t=e.value,i=e.style,s=e.styleSpec,u=s.fog;let f=[];const m=Lr(t);if(t===void 0)return f;if(m!=="object")return f=f.concat([new Le("fog",t,`object expected, ${m} found`)]),f;for(const y in t){const x=y.match(/^(.*)-transition$/);f=f.concat(x&&u[x[1]]&&u[x[1]].transition?R({key:y,value:t[y],valueSpec:s.transition,style:i,styleSpec:s}):u[y]?R({key:y,value:t[y],valueSpec:u[y],style:i,styleSpec:s}):[new Le(y,t[y],`unknown property "${y}"`)])}return f}const C={"*":()=>[],array:rl,boolean:function(e){const t=e.value,i=e.key,s=Lr(t);return s!=="boolean"?[new Le(i,t,`boolean expected, ${s} found`)]:[]},number:tn,color:function(e){const t=e.key,i=e.value,s=Lr(i);return s!=="string"?[new Le(t,i,`color expected, ${s} found`)]:Da(i)===null?[new Le(t,i,`color expected, "${i}" found`)]:[]},enum:oa,filter:Ps,function:il,layer:Hi,object:Uo,source:r,light:c,terrain:p,fog:_,string:$s,formatted:function(e){return $s(e).length===0?[]:wi(e)},resolvedImage:function(e){return $s(e).length===0?[]:wi(e)},projection:function(e){const t=e.value,i=e.styleSpec,s=i.projection,u=e.style;let f=[];const m=Lr(t);if(m==="object")for(const y in t)f=f.concat(R({key:y,value:t[y],valueSpec:s[y],style:u,styleSpec:i}));else m!=="string"&&(f=f.concat([new Le("projection",t,`object or string expected, ${m} found`)]));return f}};function R(e){const t=e.value,i=e.valueSpec,s=e.styleSpec;return i.expression&&_s(Xi(t))?il(e):i.expression&&So(Rr(t))?wi(e):i.type&&C[i.type]?C[i.type](e):Uo(Lo({},e,{valueSpec:i.type?s[i.type]:i}))}function $(e){const t=e.value,i=e.key,s=$s(e);return s.length||(t.indexOf("{fontstack}")===-1&&s.push(new Le(i,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&s.push(new Le(i,t,'"glyphs" url must include a "{range}" token'))),s}function rt(e,t=ie){return Ht(R({key:"",value:e,valueSpec:t.$root,styleSpec:t,style:e,objectElementValidators:{glyphs:$,"*":()=>[]}}))}const bt=e=>Ht(Vl(e)),Yt=e=>Ht(Jn(e));function Ht(e){return e.slice().sort((t,i)=>t.line&&i.line?t.line-i.line:0)}function Re(e,t){let i=!1;if(t&&t.length)for(const s of t)e.fire(new un(new Error(s.message))),i=!0;return i}var ze=We,Ve=3;function We(e,t,i){var s=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;var u=new Int32Array(this.arrayBuffer);e=u[0],this.d=(t=u[1])+2*(i=u[2]);for(var f=0;f<this.d*this.d;f++){var m=u[Ve+f],y=u[Ve+f+1];s.push(m===y?null:u.subarray(m,y))}var x=u[Ve+s.length+1];this.keys=u.subarray(u[Ve+s.length],x),this.bboxes=u.subarray(x),this.insert=this._insertReadonly}else{this.d=t+2*i;for(var w=0;w<this.d*this.d;w++)s.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=e,this.padding=i,this.scale=t/e,this.uid=0;var M=i/t*e;this.min=-M,this.max=e+M}We.prototype.insert=function(e,t,i,s,u){this._forEachCell(t,i,s,u,this._insertCell,this.uid++),this.keys.push(e),this.bboxes.push(t),this.bboxes.push(i),this.bboxes.push(s),this.bboxes.push(u)},We.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},We.prototype._insertCell=function(e,t,i,s,u,f){this.cells[u].push(f)},We.prototype.query=function(e,t,i,s,u){var f=this.min,m=this.max;if(e<=f&&t<=f&&m<=i&&m<=s&&!u)return Array.prototype.slice.call(this.keys);var y=[];return this._forEachCell(e,t,i,s,this._queryCell,y,{},u),y},We.prototype._queryCell=function(e,t,i,s,u,f,m,y){var x=this.cells[u];if(x!==null)for(var w=this.keys,M=this.bboxes,L=0;L<x.length;L++){var O=x[L];if(m[O]===void 0){var B=4*O;(y?y(M[B+0],M[B+1],M[B+2],M[B+3]):e<=M[B+2]&&t<=M[B+3]&&i>=M[B+0]&&s>=M[B+1])?(m[O]=!0,f.push(w[O])):m[O]=!1}}},We.prototype._forEachCell=function(e,t,i,s,u,f,m,y){for(var x=this._convertToCellCoord(e),w=this._convertToCellCoord(t),M=this._convertToCellCoord(i),L=this._convertToCellCoord(s),O=x;O<=M;O++)for(var B=w;B<=L;B++){var F=this.d*B+O;if((!y||y(this._convertFromCellCoord(O),this._convertFromCellCoord(B),this._convertFromCellCoord(O+1),this._convertFromCellCoord(B+1)))&&u.call(this,e,t,i,s,F,f,m,y))return}},We.prototype._convertFromCellCoord=function(e){return(e-this.padding)/this.scale},We.prototype._convertToCellCoord=function(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))},We.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var e=this.cells,t=Ve+this.cells.length+1+1,i=0,s=0;s<this.cells.length;s++)i+=this.cells[s].length;var u=new Int32Array(t+i+this.keys.length+this.bboxes.length);u[0]=this.extent,u[1]=this.n,u[2]=this.padding;for(var f=t,m=0;m<e.length;m++){var y=e[m];u[Ve+m]=f,u.set(y,f),f+=y.length}return u[Ve+e.length]=f,u.set(this.keys,f),u[Ve+e.length+1]=f+=this.keys.length,u.set(this.bboxes,f),f+=this.bboxes.length,u.buffer};var Vr=gt(ze);const Bi={};function De(e,t,i={}){Object.defineProperty(e,"_classRegistryKey",{value:t,writeable:!1}),Bi[t]={klass:e,omit:i.omit||[]}}De(Object,"Object"),Vr.serialize=function(e,t){const i=e.toArrayBuffer();return t&&t.push(i),{buffer:i}},Vr.deserialize=function(e){return new Vr(e.buffer)},Object.defineProperty(Vr,"name",{value:"Grid"}),De(Vr,"Grid"),De(Yr,"Color"),De(Error,"Error"),De(gr,"AJAXError"),De(io,"ResolvedImage"),De(wn,"StylePropertyFunction"),De(bn,"StyleExpression",{omit:["_evaluator"]}),De(Fo,"ZoomDependentExpression"),De(Gs,"ZoomConstantExpression"),De(bs,"CompoundExpression",{omit:["_evaluate"]});for(const e in ba)Bi[ba[e]._classRegistryKey]||De(ba[e],`Expression${e}`);function Vo(e){return e&&typeof ArrayBuffer<"u"&&(e instanceof ArrayBuffer||e.constructor&&e.constructor.name==="ArrayBuffer")}function vs(e){return G.ImageBitmap&&e instanceof G.ImageBitmap}function aa(e,t){if(e==null||typeof e=="boolean"||typeof e=="number"||typeof e=="string"||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp)return e;if(Vo(e)||vs(e))return t&&t.push(e),e;if(ArrayBuffer.isView(e)){const i=e;return t&&t.push(i.buffer),i}if(e instanceof G.ImageData)return t&&t.push(e.data.buffer),e;if(Array.isArray(e)){const i=[];for(const s of e)i.push(aa(s,t));return i}if(typeof e=="object"){const i=e.constructor,s=i._classRegistryKey;if(!s)throw new Error(`can't serialize object of unregistered class ${s}`);const u=i.serialize?i.serialize(e,t):{};if(!i.serialize){for(const f in e)e.hasOwnProperty(f)&&(Bi[s].omit.indexOf(f)>=0||(u[f]=aa(e[f],t)));e instanceof Error&&(u.message=e.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return s!=="Object"&&(u.$name=s),u}throw new Error("can't serialize object of type "+typeof e)}function ol(e){if(e==null||typeof e=="boolean"||typeof e=="number"||typeof e=="string"||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||Vo(e)||vs(e)||ArrayBuffer.isView(e)||e instanceof G.ImageData)return e;if(Array.isArray(e))return e.map(ol);if(typeof e=="object"){const t=e.$name||"Object",{klass:i}=Bi[t];if(!i)throw new Error(`can't deserialize unregistered class ${t}`);if(i.deserialize)return i.deserialize(e);const s=Object.create(i.prototype);for(const u of Object.keys(e))u!=="$name"&&(s[u]=ol(e[u]));return s}throw new Error("can't deserialize object of type "+typeof e)}const Ue={"Latin-1 Supplement":e=>e>=128&&e<=255,Arabic:e=>e>=1536&&e<=1791,"Arabic Supplement":e=>e>=1872&&e<=1919,"Arabic Extended-A":e=>e>=2208&&e<=2303,"Hangul Jamo":e=>e>=4352&&e<=4607,"Unified Canadian Aboriginal Syllabics":e=>e>=5120&&e<=5759,Khmer:e=>e>=6016&&e<=6143,"Unified Canadian Aboriginal Syllabics Extended":e=>e>=6320&&e<=6399,"General Punctuation":e=>e>=8192&&e<=8303,"Letterlike Symbols":e=>e>=8448&&e<=8527,"Number Forms":e=>e>=8528&&e<=8591,"Miscellaneous Technical":e=>e>=8960&&e<=9215,"Control Pictures":e=>e>=9216&&e<=9279,"Optical Character Recognition":e=>e>=9280&&e<=9311,"Enclosed Alphanumerics":e=>e>=9312&&e<=9471,"Geometric Shapes":e=>e>=9632&&e<=9727,"Miscellaneous Symbols":e=>e>=9728&&e<=9983,"Miscellaneous Symbols and Arrows":e=>e>=11008&&e<=11263,"CJK Radicals Supplement":e=>e>=11904&&e<=12031,"Kangxi Radicals":e=>e>=12032&&e<=12255,"Ideographic Description Characters":e=>e>=12272&&e<=12287,"CJK Symbols and Punctuation":e=>e>=12288&&e<=12351,Hiragana:e=>e>=12352&&e<=12447,Katakana:e=>e>=12448&&e<=12543,Bopomofo:e=>e>=12544&&e<=12591,"Hangul Compatibility Jamo":e=>e>=12592&&e<=12687,Kanbun:e=>e>=12688&&e<=12703,"Bopomofo Extended":e=>e>=12704&&e<=12735,"CJK Strokes":e=>e>=12736&&e<=12783,"Katakana Phonetic Extensions":e=>e>=12784&&e<=12799,"Enclosed CJK Letters and Months":e=>e>=12800&&e<=13055,"CJK Compatibility":e=>e>=13056&&e<=13311,"CJK Unified Ideographs Extension A":e=>e>=13312&&e<=19903,"Yijing Hexagram Symbols":e=>e>=19904&&e<=19967,"CJK Unified Ideographs":e=>e>=19968&&e<=40959,"Yi Syllables":e=>e>=40960&&e<=42127,"Yi Radicals":e=>e>=42128&&e<=42191,"Hangul Jamo Extended-A":e=>e>=43360&&e<=43391,"Hangul Syllables":e=>e>=44032&&e<=55215,"Hangul Jamo Extended-B":e=>e>=55216&&e<=55295,"Private Use Area":e=>e>=57344&&e<=63743,"CJK Compatibility Ideographs":e=>e>=63744&&e<=64255,"Arabic Presentation Forms-A":e=>e>=64336&&e<=65023,"Vertical Forms":e=>e>=65040&&e<=65055,"CJK Compatibility Forms":e=>e>=65072&&e<=65103,"Small Form Variants":e=>e>=65104&&e<=65135,"Arabic Presentation Forms-B":e=>e>=65136&&e<=65279,"Halfwidth and Fullwidth Forms":e=>e>=65280&&e<=65519};function Ju(e){for(const t of e)if(Qu(t.charCodeAt(0)))return!0;return!1}function xp(e){for(const t of e)if(!ah(t.charCodeAt(0)))return!1;return!0}function ah(e){return!(Ue.Arabic(e)||Ue["Arabic Supplement"](e)||Ue["Arabic Extended-A"](e)||Ue["Arabic Presentation Forms-A"](e)||Ue["Arabic Presentation Forms-B"](e))}function Qu(e){return!(e!==746&&e!==747&&(e<4352||!(Ue["Bopomofo Extended"](e)||Ue.Bopomofo(e)||Ue["CJK Compatibility Forms"](e)&&!(e>=65097&&e<=65103)||Ue["CJK Compatibility Ideographs"](e)||Ue["CJK Compatibility"](e)||Ue["CJK Radicals Supplement"](e)||Ue["CJK Strokes"](e)||!(!Ue["CJK Symbols and Punctuation"](e)||e>=12296&&e<=12305||e>=12308&&e<=12319||e===12336)||Ue["CJK Unified Ideographs Extension A"](e)||Ue["CJK Unified Ideographs"](e)||Ue["Enclosed CJK Letters and Months"](e)||Ue["Hangul Compatibility Jamo"](e)||Ue["Hangul Jamo Extended-A"](e)||Ue["Hangul Jamo Extended-B"](e)||Ue["Hangul Jamo"](e)||Ue["Hangul Syllables"](e)||Ue.Hiragana(e)||Ue["Ideographic Description Characters"](e)||Ue.Kanbun(e)||Ue["Kangxi Radicals"](e)||Ue["Katakana Phonetic Extensions"](e)||Ue.Katakana(e)&&e!==12540||!(!Ue["Halfwidth and Fullwidth Forms"](e)||e===65288||e===65289||e===65293||e>=65306&&e<=65310||e===65339||e===65341||e===65343||e>=65371&&e<=65503||e===65507||e>=65512&&e<=65519)||!(!Ue["Small Form Variants"](e)||e>=65112&&e<=65118||e>=65123&&e<=65126)||Ue["Unified Canadian Aboriginal Syllabics"](e)||Ue["Unified Canadian Aboriginal Syllabics Extended"](e)||Ue["Vertical Forms"](e)||Ue["Yijing Hexagram Symbols"](e)||Ue["Yi Syllables"](e)||Ue["Yi Radicals"](e))))}function lh(e){return!(Qu(e)||function(t){return!!(Ue["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||Ue["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||Ue["Letterlike Symbols"](t)||Ue["Number Forms"](t)||Ue["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||Ue["Control Pictures"](t)&&t!==9251||Ue["Optical Character Recognition"](t)||Ue["Enclosed Alphanumerics"](t)||Ue["Geometric Shapes"](t)||Ue["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||Ue["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||Ue["CJK Symbols and Punctuation"](t)||Ue.Katakana(t)||Ue["Private Use Area"](t)||Ue["CJK Compatibility Forms"](t)||Ue["Small Form Variants"](t)||Ue["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(e))}function uh(e){return e>=1424&&e<=2303||Ue["Arabic Presentation Forms-A"](e)||Ue["Arabic Presentation Forms-B"](e)}function bp(e,t){return!(!t&&uh(e)||e>=2304&&e<=3583||e>=3840&&e<=4255||Ue.Khmer(e))}function wp(e){for(const t of e)if(uh(t.charCodeAt(0)))return!0;return!1}const tc="deferred",ec="loading",rc="loaded";let wl=null,h="unavailable",n=null;const l=function(e){e&&typeof e=="string"&&e.indexOf("NetworkError")>-1&&(h="error"),wl&&wl(e)};function d(){g.fire(new Zn("pluginStateChange",{pluginStatus:h,pluginURL:n}))}const g=new Ks,v=function(){return h},I=function(){if(h!==tc||!n)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");h=ec,d(),n&&Di({url:n},e=>{e?l(e):(h=rc,d())})},S={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>h===rc||S.applyArabicShaping!=null,isLoading:()=>h===ec,setState(e){h=e.pluginStatus,n=e.pluginURL},isParsed:()=>S.applyArabicShaping!=null&&S.processBidirectionalText!=null&&S.processStyledBidirectionalText!=null,getPluginURL:()=>n};class P{constructor(t,i){this.zoom=t,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.transition=i.transition,this.pitch=i.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(t){return function(i,s){for(const u of i)if(!bp(u.charCodeAt(0),s))return!1;return!0}(t,S.isLoaded())}}class k{constructor(t,i){this.property=t,this.value=i,this.expression=function(s,u){if(_s(s))return new wn(s,u);if(So(s)){const f=Yi(s,u);if(f.result==="error")throw new Error(f.value.map(m=>`${m.key}: ${m.message}`).join(", "));return f.value}{let f=s;return typeof s=="string"&&u.type==="color"&&(f=Yr.parse(s)),{kind:"constant",evaluate:()=>f}}}(i===void 0?t.specification.default:i,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,i,s){return this.property.possiblyEvaluate(this,t,i,s)}}class N{constructor(t){this.property=t,this.value=new k(t,void 0)}transitioned(t,i){return new Y(this.property,this.value,i,ur({},t.transition,this.transition),t.now)}untransitioned(){return new Y(this.property,this.value,null,{},0)}}class V{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return jr(this._values[t].value.value)}setValue(t,i){this._values.hasOwnProperty(t)||(this._values[t]=new N(this._values[t].property)),this._values[t].value=new k(this._values[t].property,i===null?void 0:jr(i))}getTransition(t){return jr(this._values[t].transition)}setTransition(t,i){this._values.hasOwnProperty(t)||(this._values[t]=new N(this._values[t].property)),this._values[t].transition=jr(i)||void 0}serialize(){const t={};for(const i of Object.keys(this._values)){const s=this.getValue(i);s!==void 0&&(t[i]=s);const u=this.getTransition(i);u!==void 0&&(t[`${i}-transition`]=u)}return t}transitioned(t,i){const s=new tt(this._properties);for(const u of Object.keys(this._values))s._values[u]=this._values[u].transitioned(t,i._values[u]);return s}untransitioned(){const t=new tt(this._properties);for(const i of Object.keys(this._values))t._values[i]=this._values[i].untransitioned();return t}}class Y{constructor(t,i,s,u,f){const m=u.delay||0,y=u.duration||0;f=f||0,this.property=t,this.value=i,this.begin=f+m,this.end=this.begin+y,t.specification.transition&&(u.delay||u.duration)&&(this.prior=s)}possiblyEvaluate(t,i,s){const u=t.now||0,f=this.value.possiblyEvaluate(t,i,s),m=this.prior;if(m){if(u>this.end)return this.prior=null,f;if(this.value.isDataDriven())return this.prior=null,f;if(u<this.begin)return m.possiblyEvaluate(t,i,s);{const y=(u-this.begin)/(this.end-this.begin);return this.property.interpolate(m.possiblyEvaluate(t,i,s),f,_i(y))}}return f}}class tt{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,i,s){const u=new st(this._properties);for(const f of Object.keys(this._values))u._values[f]=this._values[f].possiblyEvaluate(t,i,s);return u}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class nt{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}getValue(t){return jr(this._values[t].value)}setValue(t,i){this._values[t]=new k(this._values[t].property,i===null?void 0:jr(i))}serialize(){const t={};for(const i of Object.keys(this._values)){const s=this.getValue(i);s!==void 0&&(t[i]=s)}return t}possiblyEvaluate(t,i,s){const u=new st(this._properties);for(const f of Object.keys(this._values))u._values[f]=this._values[f].possiblyEvaluate(t,i,s);return u}}class it{constructor(t,i,s){this.property=t,this.value=i,this.parameters=s}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,i,s,u){return this.property.evaluate(this.value,this.parameters,t,i,s,u)}}class st{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class j{constructor(t){this.specification=t}possiblyEvaluate(t,i){return t.expression.evaluate(i)}interpolate(t,i,s){const u=Ur[this.specification.type];return u?u(t,i,s):t}}class Q{constructor(t,i){this.specification=t,this.overrides=i}possiblyEvaluate(t,i,s,u){return new it(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(i,null,{},s,u)}:t.expression,i)}interpolate(t,i,s){if(t.value.kind!=="constant"||i.value.kind!=="constant")return t;if(t.value.value===void 0||i.value.value===void 0)return new it(this,{kind:"constant",value:void 0},t.parameters);const u=Ur[this.specification.type];return u?new it(this,{kind:"constant",value:u(t.value.value,i.value.value,s)},t.parameters):t}evaluate(t,i,s,u,f,m){return t.kind==="constant"?t.value:t.evaluate(i,s,u,f,m)}}class ct{constructor(t){this.specification=t}possiblyEvaluate(t,i,s,u){return!!t.expression.evaluate(i,null,{},s,u)}interpolate(){return!1}}class pt{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const i=new P(0,{});for(const s in t){const u=t[s];u.specification.overridable&&this.overridableProperties.push(s);const f=this.defaultPropertyValues[s]=new k(u,void 0),m=this.defaultTransitionablePropertyValues[s]=new N(u);this.defaultTransitioningPropertyValues[s]=m.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=f.possiblyEvaluate(i)}}}function It(e,t){return 256*(e=Ye(Math.floor(e),0,255))+Ye(Math.floor(t),0,255)}De(Q,"DataDrivenProperty"),De(j,"DataConstantProperty"),De(ct,"ColorRampProperty");const Ct={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class St{constructor(t,i){this._structArray=t,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Bt{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,i){return t._trim(),i&&(t.isTransferred=!0,i.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const i=Object.create(this.prototype);return i.arrayBuffer=t.arrayBuffer,i.length=t.length,i.capacity=t.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Nt(e,t=1){let i=0,s=0;return{members:e.map(u=>{const f=Ct[u.type].BYTES_PER_ELEMENT,m=i=Zt(i,Math.max(t,f)),y=u.components||1;return s=Math.max(s,f),i+=f*y,{name:u.name,type:u.type,components:y,offset:m}}),size:Zt(i,Math.max(s,t)),alignment:t}}function Zt(e,t){return Math.ceil(e/t)*t}class ye extends Bt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i){const s=this.length;return this.resize(s+1),this.emplace(s,t,i)}emplace(t,i,s){const u=2*t;return this.int16[u+0]=i,this.int16[u+1]=s,t}}ye.prototype.bytesPerElement=4,De(ye,"StructArrayLayout2i4");class Vt extends Bt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,s){const u=this.length;return this.resize(u+1),this.emplace(u,t,i,s)}emplace(t,i,s,u){const f=3*t;return this.int16[f+0]=i,this.int16[f+1]=s,this.int16[f+2]=u,t}}Vt.prototype.bytesPerElement=6,De(Vt,"StructArrayLayout3i6");class le extends Bt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,s,u){const f=this.length;return this.resize(f+1),this.emplace(f,t,i,s,u)}emplace(t,i,s,u,f){const m=4*t;return this.int16[m+0]=i,this.int16[m+1]=s,this.int16[m+2]=u,this.int16[m+3]=f,t}}le.prototype.bytesPerElement=8,De(le,"StructArrayLayout4i8");class Qt extends Bt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,s,u,f,m,y){const x=this.length;return this.resize(x+1),this.emplace(x,t,i,s,u,f,m,y)}emplace(t,i,s,u,f,m,y,x){const w=6*t,M=12*t,L=3*t;return this.int16[w+0]=i,this.int16[w+1]=s,this.uint8[M+4]=u,this.uint8[M+5]=f,this.uint8[M+6]=m,this.uint8[M+7]=y,this.float32[L+2]=x,t}}Qt.prototype.bytesPerElement=12,De(Qt,"StructArrayLayout2i4ub1f12");class _e extends Bt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,s,u){const f=this.length;return this.resize(f+1),this.emplace(f,t,i,s,u)}emplace(t,i,s,u,f){const m=4*t;return this.float32[m+0]=i,this.float32[m+1]=s,this.float32[m+2]=u,this.float32[m+3]=f,t}}_e.prototype.bytesPerElement=16,De(_e,"StructArrayLayout4f16");class Xt extends Bt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,s,u,f){const m=this.length;return this.resize(m+1),this.emplace(m,t,i,s,u,f)}emplace(t,i,s,u,f,m){const y=6*t,x=3*t;return this.uint16[y+0]=i,this.uint16[y+1]=s,this.uint16[y+2]=u,this.uint16[y+3]=f,this.float32[x+2]=m,t}}Xt.prototype.bytesPerElement=12,De(Xt,"StructArrayLayout4ui1f12");class se extends Bt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,s,u){const f=this.length;return this.resize(f+1),this.emplace(f,t,i,s,u)}emplace(t,i,s,u,f){const m=4*t;return this.uint16[m+0]=i,this.uint16[m+1]=s,this.uint16[m+2]=u,this.uint16[m+3]=f,t}}se.prototype.bytesPerElement=8,De(se,"StructArrayLayout4ui8");class be extends Bt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,s,u,f,m){const y=this.length;return this.resize(y+1),this.emplace(y,t,i,s,u,f,m)}emplace(t,i,s,u,f,m,y){const x=6*t;return this.int16[x+0]=i,this.int16[x+1]=s,this.int16[x+2]=u,this.int16[x+3]=f,this.int16[x+4]=m,this.int16[x+5]=y,t}}be.prototype.bytesPerElement=12,De(be,"StructArrayLayout6i12");class fe extends Bt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,s,u,f,m,y,x,w,M,L,O){const B=this.length;return this.resize(B+1),this.emplace(B,t,i,s,u,f,m,y,x,w,M,L,O)}emplace(t,i,s,u,f,m,y,x,w,M,L,O,B){const F=12*t;return this.int16[F+0]=i,this.int16[F+1]=s,this.int16[F+2]=u,this.int16[F+3]=f,this.uint16[F+4]=m,this.uint16[F+5]=y,this.uint16[F+6]=x,this.uint16[F+7]=w,this.int16[F+8]=M,this.int16[F+9]=L,this.int16[F+10]=O,this.int16[F+11]=B,t}}fe.prototype.bytesPerElement=24,De(fe,"StructArrayLayout4i4ui4i24");class Ee extends Bt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,s,u,f,m){const y=this.length;return this.resize(y+1),this.emplace(y,t,i,s,u,f,m)}emplace(t,i,s,u,f,m,y){const x=10*t,w=5*t;return this.int16[x+0]=i,this.int16[x+1]=s,this.int16[x+2]=u,this.float32[w+2]=f,this.float32[w+3]=m,this.float32[w+4]=y,t}}Ee.prototype.bytesPerElement=20,De(Ee,"StructArrayLayout3i3f20");class Qe extends Bt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const i=this.length;return this.resize(i+1),this.emplace(i,t)}emplace(t,i){return this.uint32[1*t+0]=i,t}}Qe.prototype.bytesPerElement=4,De(Qe,"StructArrayLayout1ul4");class mr extends Bt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,s,u,f,m,y,x,w,M,L,O,B){const F=this.length;return this.resize(F+1),this.emplace(F,t,i,s,u,f,m,y,x,w,M,L,O,B)}emplace(t,i,s,u,f,m,y,x,w,M,L,O,B,F){const q=20*t,K=10*t;return this.int16[q+0]=i,this.int16[q+1]=s,this.int16[q+2]=u,this.int16[q+3]=f,this.int16[q+4]=m,this.float32[K+3]=y,this.float32[K+4]=x,this.float32[K+5]=w,this.float32[K+6]=M,this.int16[q+14]=L,this.uint32[K+8]=O,this.uint16[q+18]=B,this.uint16[q+19]=F,t}}mr.prototype.bytesPerElement=40,De(mr,"StructArrayLayout5i4f1i1ul2ui40");class $e extends Bt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,s,u,f,m,y){const x=this.length;return this.resize(x+1),this.emplace(x,t,i,s,u,f,m,y)}emplace(t,i,s,u,f,m,y,x){const w=8*t;return this.int16[w+0]=i,this.int16[w+1]=s,this.int16[w+2]=u,this.int16[w+4]=f,this.int16[w+5]=m,this.int16[w+6]=y,this.int16[w+7]=x,t}}$e.prototype.bytesPerElement=16,De($e,"StructArrayLayout3i2i2i16");class nr extends Bt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,s,u,f){const m=this.length;return this.resize(m+1),this.emplace(m,t,i,s,u,f)}emplace(t,i,s,u,f,m){const y=4*t,x=8*t;return this.float32[y+0]=i,this.float32[y+1]=s,this.float32[y+2]=u,this.int16[x+6]=f,this.int16[x+7]=m,t}}nr.prototype.bytesPerElement=16,De(nr,"StructArrayLayout2f1f2i16");class Gr extends Bt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,s,u){const f=this.length;return this.resize(f+1),this.emplace(f,t,i,s,u)}emplace(t,i,s,u,f){const m=12*t,y=3*t;return this.uint8[m+0]=i,this.uint8[m+1]=s,this.float32[y+1]=u,this.float32[y+2]=f,t}}Gr.prototype.bytesPerElement=12,De(Gr,"StructArrayLayout2ub2f12");class kr extends Bt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,s){const u=this.length;return this.resize(u+1),this.emplace(u,t,i,s)}emplace(t,i,s,u){const f=3*t;return this.float32[f+0]=i,this.float32[f+1]=s,this.float32[f+2]=u,t}}kr.prototype.bytesPerElement=12,De(kr,"StructArrayLayout3f12");class Je extends Bt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,s){const u=this.length;return this.resize(u+1),this.emplace(u,t,i,s)}emplace(t,i,s,u){const f=3*t;return this.uint16[f+0]=i,this.uint16[f+1]=s,this.uint16[f+2]=u,t}}Je.prototype.bytesPerElement=6,De(Je,"StructArrayLayout3ui6");class hi extends Bt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,i,s,u,f,m,y,x,w,M,L,O,B,F,q,K,at,mt,lt,dt,vt){const _t=this.length;return this.resize(_t+1),this.emplace(_t,t,i,s,u,f,m,y,x,w,M,L,O,B,F,q,K,at,mt,lt,dt,vt)}emplace(t,i,s,u,f,m,y,x,w,M,L,O,B,F,q,K,at,mt,lt,dt,vt,_t){const Wt=30*t,Gt=15*t,oe=60*t;return this.int16[Wt+0]=i,this.int16[Wt+1]=s,this.int16[Wt+2]=u,this.float32[Gt+2]=f,this.float32[Gt+3]=m,this.uint16[Wt+8]=y,this.uint16[Wt+9]=x,this.uint32[Gt+5]=w,this.uint32[Gt+6]=M,this.uint32[Gt+7]=L,this.uint16[Wt+16]=O,this.uint16[Wt+17]=B,this.uint16[Wt+18]=F,this.float32[Gt+10]=q,this.float32[Gt+11]=K,this.uint8[oe+48]=at,this.uint8[oe+49]=mt,this.uint8[oe+50]=lt,this.uint32[Gt+13]=dt,this.int16[Wt+28]=vt,this.uint8[oe+58]=_t,t}}hi.prototype.bytesPerElement=60,De(hi,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Ei extends Bt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,i,s,u,f,m,y,x,w,M,L,O,B,F,q,K,at,mt,lt,dt,vt,_t,Wt,Gt,oe,ve,te,ce,he,me){const Te=this.length;return this.resize(Te+1),this.emplace(Te,t,i,s,u,f,m,y,x,w,M,L,O,B,F,q,K,at,mt,lt,dt,vt,_t,Wt,Gt,oe,ve,te,ce,he,me)}emplace(t,i,s,u,f,m,y,x,w,M,L,O,B,F,q,K,at,mt,lt,dt,vt,_t,Wt,Gt,oe,ve,te,ce,he,me,Te){const ne=38*t,Be=19*t;return this.int16[ne+0]=i,this.int16[ne+1]=s,this.int16[ne+2]=u,this.float32[Be+2]=f,this.float32[Be+3]=m,this.int16[ne+8]=y,this.int16[ne+9]=x,this.int16[ne+10]=w,this.int16[ne+11]=M,this.int16[ne+12]=L,this.int16[ne+13]=O,this.uint16[ne+14]=B,this.uint16[ne+15]=F,this.uint16[ne+16]=q,this.uint16[ne+17]=K,this.uint16[ne+18]=at,this.uint16[ne+19]=mt,this.uint16[ne+20]=lt,this.uint16[ne+21]=dt,this.uint16[ne+22]=vt,this.uint16[ne+23]=_t,this.uint16[ne+24]=Wt,this.uint16[ne+25]=Gt,this.uint16[ne+26]=oe,this.uint16[ne+27]=ve,this.uint16[ne+28]=te,this.uint32[Be+15]=ce,this.float32[Be+16]=he,this.float32[Be+17]=me,this.float32[Be+18]=Te,t}}Ei.prototype.bytesPerElement=76,De(Ei,"StructArrayLayout3i2f6i15ui1ul3f76");class Ti extends Bt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const i=this.length;return this.resize(i+1),this.emplace(i,t)}emplace(t,i){return this.float32[1*t+0]=i,t}}Ti.prototype.bytesPerElement=4,De(Ti,"StructArrayLayout1f4");class Ii extends Bt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,s,u,f){const m=this.length;return this.resize(m+1),this.emplace(m,t,i,s,u,f)}emplace(t,i,s,u,f,m){const y=5*t;return this.float32[y+0]=i,this.float32[y+1]=s,this.float32[y+2]=u,this.float32[y+3]=f,this.float32[y+4]=m,t}}Ii.prototype.bytesPerElement=20,De(Ii,"StructArrayLayout5f20");class Co extends Bt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,s,u){const f=this.length;return this.resize(f+1),this.emplace(f,t,i,s,u)}emplace(t,i,s,u,f){const m=6*t;return this.uint32[3*t+0]=i,this.uint16[m+2]=s,this.uint16[m+3]=u,this.uint16[m+4]=f,t}}Co.prototype.bytesPerElement=12,De(Co,"StructArrayLayout1ul3ui12");class so extends Bt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i){const s=this.length;return this.resize(s+1),this.emplace(s,t,i)}emplace(t,i,s){const u=2*t;return this.uint16[u+0]=i,this.uint16[u+1]=s,t}}so.prototype.bytesPerElement=4,De(so,"StructArrayLayout2ui4");class Ls extends Bt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const i=this.length;return this.resize(i+1),this.emplace(i,t)}emplace(t,i){return this.uint16[1*t+0]=i,t}}Ls.prototype.bytesPerElement=2,De(Ls,"StructArrayLayout1ui2");class la extends Bt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i){const s=this.length;return this.resize(s+1),this.emplace(s,t,i)}emplace(t,i,s){const u=2*t;return this.float32[u+0]=i,this.float32[u+1]=s,t}}la.prototype.bytesPerElement=8,De(la,"StructArrayLayout2f8");class en extends St{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}en.prototype.size=40;class Si extends mr{get(t){return new en(this,t)}}De(Si,"CollisionBoxArray");class ei extends St{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(t){this._structArray.uint8[this._pos1+49]=t}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(t){this._structArray.uint8[this._pos1+50]=t}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(t){this._structArray.uint32[this._pos4+13]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(t){this._structArray.uint8[this._pos1+58]=t}}ei.prototype.size=60;class On extends hi{get(t){return new ei(this,t)}}De(On,"PlacedSymbolArray");class Go extends St{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(t){this._structArray.uint32[this._pos4+15]=t}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}Go.prototype.size=76;class Ki extends Ei{get(t){return new Go(this,t)}}De(Ki,"SymbolInstanceArray");class ns extends Ti{getoffsetX(t){return this.float32[1*t+0]}}De(ns,"GlyphOffsetArray");class lu extends ye{getx(t){return this.int16[2*t+0]}gety(t){return this.int16[2*t+1]}}De(lu,"SymbolLineVertexArray");class sl extends St{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}sl.prototype.size=12;class Gl extends Co{get(t){return new sl(this,t)}}De(Gl,"FeatureIndexArray");class wa extends so{geta_centroid_pos0(t){return this.uint16[2*t+0]}geta_centroid_pos1(t){return this.uint16[2*t+1]}}De(wa,"FillExtrusionCentroidArray");const Va=Nt([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),al=Nt([{name:"a_dash",components:4,type:"Uint16"}]);var uu={exports:{}},jl={exports:{}};jl.exports=function(e,t){var i,s,u,f,m,y,x,w;for(s=e.length-(i=3&e.length),u=t,m=3432918353,y=461845907,w=0;w<s;)x=255&e.charCodeAt(w)|(255&e.charCodeAt(++w))<<8|(255&e.charCodeAt(++w))<<16|(255&e.charCodeAt(++w))<<24,++w,u=27492+(65535&(f=5*(65535&(u=(u^=x=(65535&(x=(x=(65535&x)*m+(((x>>>16)*m&65535)<<16)&4294967295)<<15|x>>>17))*y+(((x>>>16)*y&65535)<<16)&4294967295)<<13|u>>>19))+((5*(u>>>16)&65535)<<16)&4294967295))+((58964+(f>>>16)&65535)<<16);switch(x=0,i){case 3:x^=(255&e.charCodeAt(w+2))<<16;case 2:x^=(255&e.charCodeAt(w+1))<<8;case 1:u^=x=(65535&(x=(x=(65535&(x^=255&e.charCodeAt(w)))*m+(((x>>>16)*m&65535)<<16)&4294967295)<<15|x>>>17))*y+(((x>>>16)*y&65535)<<16)&4294967295}return u^=e.length,u=2246822507*(65535&(u^=u>>>16))+((2246822507*(u>>>16)&65535)<<16)&4294967295,u=3266489909*(65535&(u^=u>>>13))+((3266489909*(u>>>16)&65535)<<16)&4294967295,(u^=u>>>16)>>>0};var ic=jl.exports,Ad={exports:{}};Ad.exports=function(e,t){for(var i,s=e.length,u=t^s,f=0;s>=4;)i=1540483477*(65535&(i=255&e.charCodeAt(f)|(255&e.charCodeAt(++f))<<8|(255&e.charCodeAt(++f))<<16|(255&e.charCodeAt(++f))<<24))+((1540483477*(i>>>16)&65535)<<16),u=1540483477*(65535&u)+((1540483477*(u>>>16)&65535)<<16)^(i=1540483477*(65535&(i^=i>>>24))+((1540483477*(i>>>16)&65535)<<16)),s-=4,++f;switch(s){case 3:u^=(255&e.charCodeAt(f+2))<<16;case 2:u^=(255&e.charCodeAt(f+1))<<8;case 1:u=1540483477*(65535&(u^=255&e.charCodeAt(f)))+((1540483477*(u>>>16)&65535)<<16)}return u=1540483477*(65535&(u^=u>>>13))+((1540483477*(u>>>16)&65535)<<16),(u^=u>>>15)>>>0};var Pd=ic,Qy=Ad.exports;uu.exports=Pd,uu.exports.murmur3=Pd,uu.exports.murmur2=Qy;var Ep=gt(uu.exports);class ch{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,i,s,u){this.ids.push(Ld(t)),this.positions.push(i,s,u)}getPositions(t){const i=Ld(t);let s=0,u=this.ids.length-1;for(;s<u;){const m=s+u>>1;this.ids[m]>=i?u=m:s=m+1}const f=[];for(;this.ids[s]===i;)f.push({index:this.positions[3*s],start:this.positions[3*s+1],end:this.positions[3*s+2]}),s++;return f}static serialize(t,i){const s=new Float64Array(t.ids),u=new Uint32Array(t.positions);return Tp(s,u,0,s.length-1),i&&i.push(s.buffer,u.buffer),{ids:s,positions:u}}static deserialize(t){const i=new ch;return i.ids=t.ids,i.positions=t.positions,i.indexed=!0,i}}function Ld(e){const t=+e;return!isNaN(t)&&Number.MIN_SAFE_INTEGER<=t&&t<=Number.MAX_SAFE_INTEGER?t:Ep(String(e))}function Tp(e,t,i,s){for(;i<s;){const u=e[i+s>>1];let f=i-1,m=s+1;for(;;){do f++;while(e[f]<u);do m--;while(e[m]>u);if(f>=m)break;hh(e,f,m),hh(t,3*f,3*m),hh(t,3*f+1,3*m+1),hh(t,3*f+2,3*m+2)}m-i<s-m?(Tp(e,t,i,m),i=m+1):(Tp(e,t,m+1,s),s=m)}}function hh(e,t,i){const s=e[t];e[t]=e[i],e[i]=s}De(ch,"FeaturePositionMap");class ll{constructor(t){this.gl=t.gl,this.initialized=!1}fetchUniformLocation(t,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(t,i),this.initialized=!0),!!this.location}}class ph extends ll{constructor(t){super(t),this.current=0}set(t,i,s){this.fetchUniformLocation(t,i)&&this.current!==s&&(this.current=s,this.gl.uniform1f(this.location,s))}}class Dd extends ll{constructor(t){super(t),this.current=[0,0,0,0]}set(t,i,s){this.fetchUniformLocation(t,i)&&(s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]&&s[3]===this.current[3]||(this.current=s,this.gl.uniform4f(this.location,s[0],s[1],s[2],s[3])))}}class Rd extends ll{constructor(t){super(t),this.current=Yr.transparent}set(t,i,s){this.fetchUniformLocation(t,i)&&(s.r===this.current.r&&s.g===this.current.g&&s.b===this.current.b&&s.a===this.current.a||(this.current=s,this.gl.uniform4f(this.location,s.r,s.g,s.b,s.a)))}}const tv=new Float32Array(16),ev=new Float32Array(9),rv=new Float32Array(4);function Ip(e){return[It(255*e.r,255*e.g),It(255*e.b,255*e.a)]}class nc{constructor(t,i,s){this.value=t,this.uniformNames=i.map(u=>`u_${u}`),this.type=s}setUniform(t,i,s,u,f){i.set(t,f,u.constantOr(this.value))}getBinding(t,i){return this.type==="color"?new Rd(t):new ph(t)}}class cu{constructor(t,i){this.uniformNames=i.map(s=>`u_${s}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(t){this.pixelRatio=t.pixelRatio||1,this.pattern=t.tl.concat(t.br)}setUniform(t,i,s,u,f){const m=f==="u_pattern"||f==="u_dash"?this.pattern:f==="u_pixel_ratio"?this.pixelRatio:null;m&&i.set(t,f,m)}getBinding(t,i){return i==="u_pattern"||i==="u_dash"?new Dd(t):new ph(t)}}class ul{constructor(t,i,s,u){this.expression=t,this.type=s,this.maxValue=0,this.paintVertexAttributes=i.map(f=>({name:`a_${f}`,type:"Float32",components:s==="color"?2:1,offset:0})),this.paintVertexArray=new u}populatePaintArray(t,i,s,u,f,m){const y=this.paintVertexArray.length,x=this.expression.evaluate(new P(0),i,{},f,u,m);this.paintVertexArray.resize(t),this._setPaintValue(y,t,x)}updatePaintArray(t,i,s,u,f){const m=this.expression.evaluate({zoom:0},s,u,void 0,f);this._setPaintValue(t,i,m)}_setPaintValue(t,i,s){if(this.type==="color"){const u=Ip(s);for(let f=t;f<i;f++)this.paintVertexArray.emplace(f,u[0],u[1])}else{for(let u=t;u<i;u++)this.paintVertexArray.emplace(u,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ea{constructor(t,i,s,u,f,m){this.expression=t,this.uniformNames=i.map(y=>`u_${y}_t`),this.type=s,this.useIntegerZoom=u,this.zoom=f,this.maxValue=0,this.paintVertexAttributes=i.map(y=>({name:`a_${y}`,type:"Float32",components:s==="color"?4:2,offset:0})),this.paintVertexArray=new m}populatePaintArray(t,i,s,u,f,m){const y=this.expression.evaluate(new P(this.zoom),i,{},f,u,m),x=this.expression.evaluate(new P(this.zoom+1),i,{},f,u,m),w=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(w,t,y,x)}updatePaintArray(t,i,s,u,f){const m=this.expression.evaluate({zoom:this.zoom},s,u,void 0,f),y=this.expression.evaluate({zoom:this.zoom+1},s,u,void 0,f);this._setPaintValue(t,i,m,y)}_setPaintValue(t,i,s,u){if(this.type==="color"){const f=Ip(s),m=Ip(u);for(let y=t;y<i;y++)this.paintVertexArray.emplace(y,f[0],f[1],m[0],m[1])}else{for(let f=t;f<i;f++)this.paintVertexArray.emplace(f,s,u);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(u))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,i,s,u,f){const m=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,y=Ye(this.expression.interpolationFactor(m,this.zoom,this.zoom+1),0,1);i.set(t,f,y)}getBinding(t,i){return new ph(t)}}class El{constructor(t,i,s,u,f){this.expression=t,this.layerId=f,this.paintVertexAttributes=(s==="array"?al:Va).members;for(let m=0;m<i.length;++m);this.paintVertexArray=new u}populatePaintArray(t,i,s){const u=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValues(u,t,i.patterns&&i.patterns[this.layerId],s)}updatePaintArray(t,i,s,u,f,m){this._setPaintValues(t,i,s.patterns&&s.patterns[this.layerId],m)}_setPaintValues(t,i,s,u){if(!u||!s)return;const f=u[s];if(!f)return;const{tl:m,br:y,pixelRatio:x}=f;for(let w=t;w<i;w++)this.paintVertexArray.emplace(w,m[0],m[1],y[0],y[1],x)}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Tl{constructor(t,i,s=()=>!0){this.binders={},this._buffers=[];const u=[];for(const f in t.paint._values){if(!s(f))continue;const m=t.paint.get(f);if(!(m instanceof it&&Hn(m.property.specification)))continue;const y=nv(f,t.type),x=m.value,w=m.property.specification.type,M=!!m.property.useIntegerZoom,L=f==="line-dasharray"||f.endsWith("pattern"),O=f==="line-dasharray"&&t.layout.get("line-cap").value.kind!=="constant";if(x.kind!=="constant"||O)if(x.kind==="source"||O||L){const B=Od(f,w,"source");this.binders[f]=L?new El(x,y,w,B,t.id):new ul(x,y,w,B),u.push(`/a_${f}`)}else{const B=Od(f,w,"composite");this.binders[f]=new Ea(x,y,w,M,i,B),u.push(`/z_${f}`)}else this.binders[f]=L?new cu(x.value,y):new nc(x.value,y,w),u.push(`/u_${f}`)}this.cacheKey=u.sort().join("")}getMaxValue(t){const i=this.binders[t];return i instanceof ul||i instanceof Ea?i.maxValue:0}populatePaintArrays(t,i,s,u,f,m){for(const y in this.binders){const x=this.binders[y];(x instanceof ul||x instanceof Ea||x instanceof El)&&x.populatePaintArray(t,i,s,u,f,m)}}setConstantPatternPositions(t){for(const i in this.binders){const s=this.binders[i];s instanceof cu&&s.setConstantPatternPositions(t)}}updatePaintArrays(t,i,s,u,f,m){let y=!1;for(const x in t){const w=i.getPositions(x);for(const M of w){const L=s.feature(M.index);for(const O in this.binders){const B=this.binders[O];if((B instanceof ul||B instanceof Ea||B instanceof El)&&B.expression.isStateDependent===!0){const F=u.paint.get(O);B.expression=F.value,B.updatePaintArray(M.start,M.end,L,t[x],f,m),y=!0}}}}return y}defines(){const t=[];for(const i in this.binders){const s=this.binders[i];(s instanceof nc||s instanceof cu)&&t.push(...s.uniformNames.map(u=>`#define HAS_UNIFORM_${u}`))}return t}getBinderAttributes(){const t=[];for(const i in this.binders){const s=this.binders[i];if(s instanceof ul||s instanceof Ea||s instanceof El)for(let u=0;u<s.paintVertexAttributes.length;u++)t.push(s.paintVertexAttributes[u].name)}return t}getBinderUniforms(){const t=[];for(const i in this.binders){const s=this.binders[i];if(s instanceof nc||s instanceof cu||s instanceof Ea)for(const u of s.uniformNames)t.push(u)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t){const i=[];for(const s in this.binders){const u=this.binders[s];if(u instanceof nc||u instanceof cu||u instanceof Ea)for(const f of u.uniformNames)i.push({name:f,property:s,binding:u.getBinding(t,f)})}return i}setUniforms(t,i,s,u,f){for(const{name:m,property:y,binding:x}of s)this.binders[y].setUniform(t,x,f,u.get(y),m)}updatePaintBuffers(){this._buffers=[];for(const t in this.binders){const i=this.binders[t];(i instanceof ul||i instanceof Ea||i instanceof El)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer)}}upload(t){for(const i in this.binders){const s=this.binders[i];(s instanceof ul||s instanceof Ea||s instanceof El)&&s.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const i=this.binders[t];(i instanceof ul||i instanceof Ea||i instanceof El)&&i.destroy()}}}class ql{constructor(t,i,s=()=>!0){this.programConfigurations={};for(const u of t)this.programConfigurations[u.id]=new Tl(u,i,s);this.needsUpload=!1,this._featureMap=new ch,this._bufferOffset=0}populatePaintArrays(t,i,s,u,f,m,y){for(const x in this.programConfigurations)this.programConfigurations[x].populatePaintArrays(t,i,u,f,m,y);i.id!==void 0&&this._featureMap.add(i.id,s,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,i,s,u,f){for(const m of s)this.needsUpload=this.programConfigurations[m.id].updatePaintArrays(t,this._featureMap,i,m,u,f)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}const iv={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function nv(e,t){return iv[e]||[e.replace(`${t}-`,"").replace(/-/g,"_")]}const ov={"line-pattern":{source:Xt,composite:Xt},"fill-pattern":{source:Xt,composite:Xt},"fill-extrusion-pattern":{source:Xt,composite:Xt},"line-dasharray":{source:se,composite:se}},sv={color:{source:la,composite:_e},number:{source:Ti,composite:la}};function Od(e,t,i){const s=ov[e];return s&&s[i]||sv[t][i]}De(nc,"ConstantBinder"),De(cu,"PatternConstantBinder"),De(ul,"SourceExpressionBinder"),De(El,"PatternCompositeBinder"),De(Ea,"CompositeExpressionBinder"),De(Tl,"ProgramConfiguration",{omit:["_buffers"]}),De(ql,"ProgramConfigurationSet");const Nd="-transition";class Ta extends Ks{constructor(t,i){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&t.type!=="sky"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),i.layout&&(this._unevaluatedLayout=new nt(i.layout)),i.paint)){this._transitionablePaint=new V(i.paint);for(const s in t.paint)this.setPaintProperty(s,t.paint[s],{validate:!1});for(const s in t.layout)this.setLayoutProperty(s,t.layout[s],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new st(i.paint)}}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,i,s={}){i!=null&&this._validate(Yt,`layers.${this.id}.layout.${t}`,t,i,s)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,i):this.visibility=i)}getPaintProperty(t){return Br(t,Nd)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,i,s={}){if(i!=null&&this._validate(bt,`layers.${this.id}.paint.${t}`,t,i,s))return!1;if(Br(t,Nd))return this._transitionablePaint.setTransition(t.slice(0,-11),i||void 0),!1;{const u=this._transitionablePaint._values[t],f=u.value.isDataDriven(),m=u.value;this._transitionablePaint.setValue(t,i),this._handleSpecialPaintPropertyUpdate(t);const y=this._transitionablePaint._values[t].value,x=y.isDataDriven(),w=Br(t,"pattern")||t==="line-dasharray";return x||f||w||this._handleOverridablePaintPropertyUpdate(t,m,y)}}_handleSpecialPaintPropertyUpdate(t){}getProgramIds(){return null}getProgramConfiguration(t){return null}_handleOverridablePaintPropertyUpdate(t,i,s){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,i){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,i)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),qe(t,(i,s)=>!(i===void 0||s==="layout"&&!Object.keys(i).length||s==="paint"&&!Object.keys(i).length))}_validate(t,i,s,u,f={}){return(!f||f.validate!==!1)&&Re(this,t.call(rt,{key:i,layerType:this.type,objectKey:s,value:u,styleSpec:ie,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const i=this.paint.get(t);if(i instanceof it&&Hn(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=bl(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const av=Nt([{name:"a_pos",components:2,type:"Int16"}],4),lv=Nt([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Nn{constructor(t=[]){this.segments=t}prepareSegment(t,i,s,u){let f=this.segments[this.segments.length-1];return t>Nn.MAX_VERTEX_ARRAY_LENGTH&&Dr(`Max vertices per segment is ${Nn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!f||f.vertexLength+t>Nn.MAX_VERTEX_ARRAY_LENGTH||f.sortKey!==u)&&(f={vertexOffset:i.length,primitiveOffset:s.length,vertexLength:0,primitiveLength:0},u!==void 0&&(f.sortKey=u),this.segments.push(f)),f}get(){return this.segments}destroy(){for(const t of this.segments)for(const i in t.vaos)t.vaos[i].destroy()}static simpleSegment(t,i,s,u){return new Nn([{vertexOffset:t,primitiveOffset:i,vertexLength:s,primitiveLength:u,vaos:{},sortKey:0}])}}Nn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,De(Nn,"SegmentVector");var ir=8192;class Il{constructor(t,i){t&&(i?this.setSouthWest(t).setNorthEast(i):t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))}setNorthEast(t){return this._ne=t instanceof Ci?new Ci(t.lng,t.lat):Ci.convert(t),this}setSouthWest(t){return this._sw=t instanceof Ci?new Ci(t.lng,t.lat):Ci.convert(t),this}extend(t){const i=this._sw,s=this._ne;let u,f;if(t instanceof Ci)u=t,f=t;else{if(!(t instanceof Il))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(Il.convert(t)):this.extend(Ci.convert(t)):typeof t=="object"&&t!==null&&t.hasOwnProperty("lat")&&(t.hasOwnProperty("lon")||t.hasOwnProperty("lng"))?this.extend(Ci.convert(t)):this;if(u=t._sw,f=t._ne,!u||!f)return this}return i||s?(i.lng=Math.min(u.lng,i.lng),i.lat=Math.min(u.lat,i.lat),s.lng=Math.max(f.lng,s.lng),s.lat=Math.max(f.lat,s.lat)):(this._sw=new Ci(u.lng,u.lat),this._ne=new Ci(f.lng,f.lat)),this}getCenter(){return new Ci((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Ci(this.getWest(),this.getNorth())}getSouthEast(){return new Ci(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:i,lat:s}=Ci.convert(t);let u=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(u=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=s&&s<=this._ne.lat&&u}static convert(t){return!t||t instanceof Il?t:new Il(t)}}var fh=1e-6,Ds=typeof Float32Array<"u"?Float32Array:Array;function zd(){var e=new Ds(9);return Ds!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function kd(e,t,i){var s=t[0],u=t[1],f=t[2],m=t[3],y=t[4],x=t[5],w=t[6],M=t[7],L=t[8],O=i[0],B=i[1],F=i[2],q=i[3],K=i[4],at=i[5],mt=i[6],lt=i[7],dt=i[8];return e[0]=O*s+B*m+F*w,e[1]=O*u+B*y+F*M,e[2]=O*f+B*x+F*L,e[3]=q*s+K*m+at*w,e[4]=q*u+K*y+at*M,e[5]=q*f+K*x+at*L,e[6]=mt*s+lt*m+dt*w,e[7]=mt*u+lt*y+dt*M,e[8]=mt*f+lt*x+dt*L,e}function Ia(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Sp(e,t){var i=t[0],s=t[1],u=t[2],f=t[3],m=t[4],y=t[5],x=t[6],w=t[7],M=t[8],L=t[9],O=t[10],B=t[11],F=t[12],q=t[13],K=t[14],at=t[15],mt=i*y-s*m,lt=i*x-u*m,dt=i*w-f*m,vt=s*x-u*y,_t=s*w-f*y,Wt=u*w-f*x,Gt=M*q-L*F,oe=M*K-O*F,ve=M*at-B*F,te=L*K-O*q,ce=L*at-B*q,he=O*at-B*K,me=mt*he-lt*ce+dt*te+vt*ve-_t*oe+Wt*Gt;return me?(e[0]=(y*he-x*ce+w*te)*(me=1/me),e[1]=(u*ce-s*he-f*te)*me,e[2]=(q*Wt-K*_t+at*vt)*me,e[3]=(O*_t-L*Wt-B*vt)*me,e[4]=(x*ve-m*he-w*oe)*me,e[5]=(i*he-u*ve+f*oe)*me,e[6]=(K*dt-F*Wt-at*lt)*me,e[7]=(M*Wt-O*dt+B*lt)*me,e[8]=(m*ce-y*ve+w*Gt)*me,e[9]=(s*ve-i*ce-f*Gt)*me,e[10]=(F*_t-q*dt+at*mt)*me,e[11]=(L*dt-M*_t-B*mt)*me,e[12]=(y*oe-m*te-x*Gt)*me,e[13]=(i*te-s*oe+u*Gt)*me,e[14]=(q*lt-F*vt-K*mt)*me,e[15]=(M*vt-L*lt+O*mt)*me,e):null}function $l(e,t,i){var s=t[0],u=t[1],f=t[2],m=t[3],y=t[4],x=t[5],w=t[6],M=t[7],L=t[8],O=t[9],B=t[10],F=t[11],q=t[12],K=t[13],at=t[14],mt=t[15],lt=i[0],dt=i[1],vt=i[2],_t=i[3];return e[0]=lt*s+dt*y+vt*L+_t*q,e[1]=lt*u+dt*x+vt*O+_t*K,e[2]=lt*f+dt*w+vt*B+_t*at,e[3]=lt*m+dt*M+vt*F+_t*mt,e[4]=(lt=i[4])*s+(dt=i[5])*y+(vt=i[6])*L+(_t=i[7])*q,e[5]=lt*u+dt*x+vt*O+_t*K,e[6]=lt*f+dt*w+vt*B+_t*at,e[7]=lt*m+dt*M+vt*F+_t*mt,e[8]=(lt=i[8])*s+(dt=i[9])*y+(vt=i[10])*L+(_t=i[11])*q,e[9]=lt*u+dt*x+vt*O+_t*K,e[10]=lt*f+dt*w+vt*B+_t*at,e[11]=lt*m+dt*M+vt*F+_t*mt,e[12]=(lt=i[12])*s+(dt=i[13])*y+(vt=i[14])*L+(_t=i[15])*q,e[13]=lt*u+dt*x+vt*O+_t*K,e[14]=lt*f+dt*w+vt*B+_t*at,e[15]=lt*m+dt*M+vt*F+_t*mt,e}function oc(e,t,i){var s,u,f,m,y,x,w,M,L,O,B,F,q=i[0],K=i[1],at=i[2];return t===e?(e[12]=t[0]*q+t[4]*K+t[8]*at+t[12],e[13]=t[1]*q+t[5]*K+t[9]*at+t[13],e[14]=t[2]*q+t[6]*K+t[10]*at+t[14],e[15]=t[3]*q+t[7]*K+t[11]*at+t[15]):(u=t[1],f=t[2],m=t[3],y=t[4],x=t[5],w=t[6],M=t[7],L=t[8],O=t[9],B=t[10],F=t[11],e[0]=s=t[0],e[1]=u,e[2]=f,e[3]=m,e[4]=y,e[5]=x,e[6]=w,e[7]=M,e[8]=L,e[9]=O,e[10]=B,e[11]=F,e[12]=s*q+y*K+L*at+t[12],e[13]=u*q+x*K+O*at+t[13],e[14]=f*q+w*K+B*at+t[14],e[15]=m*q+M*K+F*at+t[15]),e}function Xl(e,t,i){var s=i[0],u=i[1],f=i[2];return e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s,e[3]=t[3]*s,e[4]=t[4]*u,e[5]=t[5]*u,e[6]=t[6]*u,e[7]=t[7]*u,e[8]=t[8]*f,e[9]=t[9]*f,e[10]=t[10]*f,e[11]=t[11]*f,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Cp(e,t,i){var s=Math.sin(i),u=Math.cos(i),f=t[4],m=t[5],y=t[6],x=t[7],w=t[8],M=t[9],L=t[10],O=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=f*u+w*s,e[5]=m*u+M*s,e[6]=y*u+L*s,e[7]=x*u+O*s,e[8]=w*u-f*s,e[9]=M*u-m*s,e[10]=L*u-y*s,e[11]=O*u-x*s,e}function dh(e,t,i){var s=Math.sin(i),u=Math.cos(i),f=t[0],m=t[1],y=t[2],x=t[3],w=t[8],M=t[9],L=t[10],O=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=f*u-w*s,e[1]=m*u-M*s,e[2]=y*u-L*s,e[3]=x*u-O*s,e[8]=f*s+w*u,e[9]=m*s+M*u,e[10]=y*s+L*u,e[11]=x*s+O*u,e}function Bd(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Fd(e,t,i){var s,u,f,m=i[0],y=i[1],x=i[2],w=Math.hypot(m,y,x);return w<fh?null:(m*=w=1/w,y*=w,x*=w,s=Math.sin(t),u=Math.cos(t),e[0]=m*m*(f=1-u)+u,e[1]=y*m*f+x*s,e[2]=x*m*f-y*s,e[3]=0,e[4]=m*y*f-x*s,e[5]=y*y*f+u,e[6]=x*y*f+m*s,e[7]=0,e[8]=m*x*f+y*s,e[9]=y*x*f-m*s,e[10]=x*x*f+u,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var uv=$l;function Mp(){var e=new Ds(3);return Ds!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function Ud(e){var t=new Ds(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function sc(e){return Math.hypot(e[0],e[1],e[2])}function hu(e,t,i){var s=new Ds(3);return s[0]=e,s[1]=t,s[2]=i,s}function cl(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e}function Ap(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e}function Vd(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e[2]=t[2]*i[2],e}function ac(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e[2]=Math.min(t[2],i[2]),e}function lc(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e[2]=Math.max(t[2],i[2]),e}function Xs(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e}function uc(e,t,i,s){return e[0]=t[0]+i[0]*s,e[1]=t[1]+i[1]*s,e[2]=t[2]+i[2]*s,e}function os(e,t){var i=t[0],s=t[1],u=t[2],f=i*i+s*s+u*u;return f>0&&(f=1/Math.sqrt(f)),e[0]=t[0]*f,e[1]=t[1]*f,e[2]=t[2]*f,e}function ua(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Pp(e,t,i){var s=t[0],u=t[1],f=t[2],m=i[0],y=i[1],x=i[2];return e[0]=u*x-f*y,e[1]=f*m-s*x,e[2]=s*y-u*m,e}function Mn(e,t,i){var s=t[0],u=t[1],f=t[2],m=i[3]*s+i[7]*u+i[11]*f+i[15];return e[0]=(i[0]*s+i[4]*u+i[8]*f+i[12])/(m=m||1),e[1]=(i[1]*s+i[5]*u+i[9]*f+i[13])/m,e[2]=(i[2]*s+i[6]*u+i[10]*f+i[14])/m,e}function Gd(e,t,i){var s=i[0],u=i[1],f=i[2],m=t[0],y=t[1],x=t[2],w=u*x-f*y,M=f*m-s*x,L=s*y-u*m,O=u*L-f*M,B=f*w-s*L,F=s*M-u*w,q=2*i[3];return M*=q,L*=q,B*=2,F*=2,e[0]=m+(w*=q)+(O*=2),e[1]=y+M+B,e[2]=x+L+F,e}var cc,Sa=Ap,cv=Vd,hv=sc;function jd(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e}function qd(e,t){var i=t[0],s=t[1],u=t[2],f=t[3],m=i*i+s*s+u*u+f*f;return m>0&&(m=1/Math.sqrt(m)),e[0]=i*m,e[1]=s*m,e[2]=u*m,e[3]=f*m,e}function Zl(e,t,i){var s=t[0],u=t[1],f=t[2],m=t[3];return e[0]=i[0]*s+i[4]*u+i[8]*f+i[12]*m,e[1]=i[1]*s+i[5]*u+i[9]*f+i[13]*m,e[2]=i[2]*s+i[6]*u+i[10]*f+i[14]*m,e[3]=i[3]*s+i[7]*u+i[11]*f+i[15]*m,e}function $d(){var e=new Ds(4);return Ds!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function Xd(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function Zd(e,t,i){i*=.5;var s=t[0],u=t[1],f=t[2],m=t[3],y=Math.sin(i),x=Math.cos(i);return e[0]=s*x+m*y,e[1]=u*x+f*y,e[2]=f*x-u*y,e[3]=m*x-s*y,e}function Wd(e,t,i){i*=.5;var s=t[0],u=t[1],f=t[2],m=t[3],y=Math.sin(i),x=Math.cos(i);return e[0]=s*x-f*y,e[1]=u*x+m*y,e[2]=f*x+s*y,e[3]=m*x-u*y,e}Mp(),cc=new Ds(4),Ds!=Float32Array&&(cc[0]=0,cc[1]=0,cc[2]=0,cc[3]=0);var pv=qd;Mp(),hu(1,0,0),hu(0,1,0),$d(),$d(),zd();const fv=Nt([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Yd}=fv,Hd=Nt([{name:"a_pos_3",components:3,type:"Int16"}]);var hc=Nt([{name:"a_pos",type:"Int16",components:2}]);class Lp{constructor(t,i){this.pos=t,this.dir=i}intersectsPlane(t,i,s){const u=ua(i,this.dir);if(Math.abs(u)<1e-6)return!1;const f=((t[0]-this.pos[0])*i[0]+(t[1]-this.pos[1])*i[1]+(t[2]-this.pos[2])*i[2])/u;return s[0]=this.pos[0]+this.dir[0]*f,s[1]=this.pos[1]+this.dir[1]*f,s[2]=this.pos[2]+this.dir[2]*f,!0}closestPointOnSphere(t,i,s){if(function(B,F){var q=B[0],K=B[1],at=B[2],mt=F[0],lt=F[1],dt=F[2];return Math.abs(q-mt)<=fh*Math.max(1,Math.abs(q),Math.abs(mt))&&Math.abs(K-lt)<=fh*Math.max(1,Math.abs(K),Math.abs(lt))&&Math.abs(at-dt)<=fh*Math.max(1,Math.abs(at),Math.abs(dt))}(this.pos,t)||i===0)return s[0]=s[1]=s[2]=0,!1;const[u,f,m]=this.dir,y=this.pos[0]-t[0],x=this.pos[1]-t[1],w=this.pos[2]-t[2],M=u*u+f*f+m*m,L=2*(y*u+x*f+w*m),O=L*L-4*M*(y*y+x*x+w*w-i*i);if(O<0){const B=Math.max(-L/2,0),F=y+u*B,q=x+f*B,K=w+m*B,at=Math.hypot(F,q,K);return s[0]=F*i/at,s[1]=q*i/at,s[2]=K*i/at,!1}{const B=(-L-Math.sqrt(O))/(2*M);if(B<0){const F=Math.hypot(y,x,w);return s[0]=y*i/F,s[1]=x*i/F,s[2]=w*i/F,!1}return s[0]=y+u*B,s[1]=x+f*B,s[2]=w+m*B,!0}}}class Dp{constructor(t,i,s,u,f){this.TL=t,this.TR=i,this.BR=s,this.BL=u,this.horizon=f}static fromInvProjectionMatrix(t,i,s){const u=[-1,1,1],f=[1,1,1],m=[1,-1,1],y=[-1,-1,1],x=Mn(u,u,t),w=Mn(f,f,t),M=Mn(m,m,t),L=Mn(y,y,t);return new Dp(x,w,M,L,i/s)}}class Rp{constructor(t,i){this.points=t,this.planes=i}static fromInvProjectionMatrix(t,i,s,u){const f=Math.pow(2,s),m=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(x=>{const w=Zl([],x,t),M=1/w[3]/i*f;return function(L,O,B){return L[0]=O[0]*B[0],L[1]=O[1]*B[1],L[2]=O[2]*B[2],L[3]=O[3]*B[3],L}(w,w,[M,M,u?1/w[3]:M,M])}),y=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(x=>{const w=os([],Pp([],Sa([],m[x[0]],m[x[1]]),Sa([],m[x[2]],m[x[1]]))),M=-ua(w,m[x[1]]);return w.concat(M)});return new Rp(m,y)}}class ss{static fromPoints(t){const i=[1/0,1/0,1/0],s=[-1/0,-1/0,-1/0];for(const u of t)ac(i,i,u),lc(s,s,u);return new ss(i,s)}static applyTransform(t,i){const s=t.getCorners();for(let u=0;u<s.length;++u)Mn(s[u],s[u],i);return ss.fromPoints(s)}constructor(t,i){this.min=t,this.max=i,this.center=Xs([],cl([],this.min,this.max),.5)}quadrant(t){const i=[t%2==0,t<2],s=Ud(this.min),u=Ud(this.max);for(let f=0;f<i.length;f++)s[f]=i[f]?this.min[f]:this.center[f],u[f]=i[f]?this.center[f]:this.max[f];return u[2]=this.max[2],new ss(s,u)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}distanceZ(t){return Math.max(Math.min(this.max[2],t[2]),this.min[2])-t[2]}getCorners(){const t=this.min,i=this.max;return[[t[0],t[1],t[2]],[i[0],t[1],t[2]],[i[0],i[1],t[2]],[t[0],i[1],t[2]],[t[0],t[1],i[2]],[i[0],t[1],i[2]],[i[0],i[1],i[2]],[t[0],i[1],i[2]]]}intersects(t){const i=this.getCorners();let s=!0;for(let u=0;u<t.planes.length;u++){const f=t.planes[u];let m=0;for(let y=0;y<i.length;y++)m+=ua(f,i[y])+f[3]>=0;if(m===0)return 0;m!==i.length&&(s=!1)}if(s)return 2;for(let u=0;u<3;u++){let f=Number.MAX_VALUE,m=-Number.MAX_VALUE;for(let y=0;y<t.points.length;y++){const x=t.points[y][u]-this.min[u];f=Math.min(f,x),m=Math.max(m,x)}if(m<0||f>this.max[u]-this.min[u])return 0}return 1}}const Op=5,Kd=6,Ga=ir/Math.PI/2,dv=16383,Wl=64,pc=[Wl,32,16],ca=-Ga,ha=Ga,mv=[new ss([ca,ca,ca],[ha,ha,ha]),new ss([ca,ca,ca],[0,0,ha]),new ss([0,ca,ca],[ha,0,ha]),new ss([ca,0,ca],[0,ha,ha]),new ss([0,0,ca],[ha,ha,ha])];function mh(e){return e*Ga/mc}function Jd(e,t,i,s=!0){const u=Xs([],e._camera.position,e.worldSize),f=[t,i,1,1];Zl(f,f,e.pixelMatrixInverse),jd(f,f,1/f[3]);const m=os([],Sa([],f,u)),y=e.globeMatrix,x=[y[12],y[13],y[14]],w=Sa([],x,u),M=sc(w),L=os([],w),O=e.worldSize/(2*Math.PI),B=ua(L,m),F=Math.asin(O/M);if(F<Math.acos(B)){if(!s)return null;const ve=[],te=[];Xs(ve,m,M/B),os(te,Sa(te,ve,w)),os(m,cl(m,w,Xs(m,te,Math.tan(F)*M)))}const q=[];new Lp(u,m).closestPointOnSphere(x,O,q);const K=os([],ft(y,0)),at=os([],ft(y,1)),mt=os([],ft(y,2)),lt=ua(K,q),dt=ua(at,q),vt=ua(mt,q),_t=ae(Math.asin(-dt/O));let Wt=ae(Math.atan2(lt,vt));Wt=e.center.lng+function(ve,te){const ce=(te-ve+180)%360-180;return ce<-180?ce+360:ce}(e.center.lng,Wt);const Gt=qa(Wt),oe=Ye($a(_t),0,1);return new mu(Gt,oe)}class gv{constructor(t,i,s){this.a=Sa([],t,s),this.b=Sa([],i,s),this.center=s;const u=os([],this.a),f=os([],this.b);this.angle=Math.acos(ua(u,f))}}function Np(e,t){if(e.angle===0)return null;let i;return i=e.a[t]===0?1/e.angle*.5*Math.PI:1/e.angle*Math.atan(e.b[t]/e.a[t]/Math.sin(e.angle)-1/Math.tan(e.angle)),i<0||i>1?null:function(s,u,f,m){const y=Math.sin(f);return s*(Math.sin((1-m)*f)/y)+u*(Math.sin(m*f)/y)}(e.a[t],e.b[t],e.angle,Ye(i,0,1))+e.center[t]}function ja(e){if(e.z<=1)return mv[e.z+2*e.y+e.x];const t=zp(gh(e));return ss.fromPoints(t)}function Yl(e,t,i){return Xs(e,e,1-i),uc(e,e,t,i)}function Qd(e,t){const i=du(t.zoom);if(i===0)return ja(e);const s=gh(e),u=zp(s),f=qa(s.getWest())*t.worldSize,m=qa(s.getEast())*t.worldSize,y=$a(s.getNorth())*t.worldSize,x=$a(s.getSouth())*t.worldSize,w=[f,y,0],M=[m,y,0],L=[f,x,0],O=[m,x,0],B=Sp([],t.globeMatrix);return Mn(w,w,B),Mn(M,M,B),Mn(L,L,B),Mn(O,O,B),u[0]=Yl(u[0],L,i),u[1]=Yl(u[1],O,i),u[2]=Yl(u[2],M,i),u[3]=Yl(u[3],w,i),ss.fromPoints(u)}function tm(e,t,i){for(const s of e)Mn(s,s,t),Xs(s,s,i)}function _v(e,t,i){const s=t/e.worldSize,u=e.globeMatrix;if(i.z<=1){const Gt=ja(i).getCorners();return tm(Gt,u,s),ss.fromPoints(Gt)}const f=gh(i),m=zp(f);tm(m,u,s);const y=Number.MAX_VALUE,x=[-y,-y,-y],w=[y,y,y];if(f.contains(e.center)){for(const ve of m)ac(w,w,ve),lc(x,x,ve);x[2]=0;const Gt=e.point,oe=[Gt.x*s,Gt.y*s,0];return ac(w,w,oe),lc(x,x,oe),new ss(w,x)}const M=[u[12]*s,u[13]*s,u[14]*s],L=f.getCenter(),O=Ye(e.center.lat,-Ao,Ao),B=Ye(L.lat,-Ao,Ao),F=qa(e.center.lng),q=$a(O);let K=F-qa(L.lng);const at=q-$a(B);K>.5?K-=1:K<-.5&&(K+=1);let mt=0;Math.abs(K)>Math.abs(at)?mt=K>=0?1:3:(mt=at>=0?0:2,uc(M,M,[u[4]*s,u[5]*s,u[6]*s],-Math.sin(Kt(at>=0?f.getSouth():f.getNorth()))*Ga));const lt=m[mt],dt=m[(mt+1)%4],vt=new gv(lt,dt,M),_t=[Np(vt,0)||lt[0],Np(vt,1)||lt[1],Np(vt,2)||lt[2]],Wt=du(e.zoom);if(Wt>0){const Gt=function({x:ve,y:te,z:ce},he,me,Te,ne){const Be=1/(1<<ce);let Xe=ve*Be,Fe=Xe+Be,yr=te*Be,Ce=yr+Be,er=0;const vr=(Xe+Fe)/2-Te;return vr>.5?er=-1:vr<-.5&&(er=1),Xe=((Xe+er)*he-(Te*=he))*me+Te,Fe=((Fe+er)*he-Te)*me+Te,yr=(yr*he-(ne*=he))*me+ne,Ce=(Ce*he-ne)*me+ne,[[Xe,Ce,0],[Fe,Ce,0],[Fe,yr,0],[Xe,yr,0]]}(i,t,e._pixelsPerMercatorPixel,F,q);for(let ve=0;ve<m.length;ve++)Yl(m[ve],Gt[ve],Wt);const oe=cl([],Gt[mt],Gt[(mt+1)%4]);Xs(oe,oe,.5),Yl(_t,oe,Wt)}for(const Gt of m)ac(w,w,Gt),lc(x,x,Gt);return w[2]=Math.min(lt[2],dt[2]),ac(w,w,_t),lc(x,x,_t),new ss(w,x)}function gh({x:e,y:t,z:i}){const s=1/(1<<i),u=new Ci(Zs(e*s),Mo((t+1)*s)),f=new Ci(Zs((e+1)*s),Mo(t*s));return new Il(u,f)}function zp(e){const t=Kt(e.getNorth()),i=Kt(e.getSouth()),s=Math.cos(t),u=Math.cos(i),f=Math.sin(t),m=Math.sin(i),y=e.getWest(),x=e.getEast();return[pu(u,m,y),pu(u,m,x),pu(s,f,x),pu(s,f,y)]}function pu(e,t,i,s=Ga){return i=Kt(i),[e*Math.sin(i)*s,-t*s,e*Math.cos(i)*s]}function fu(e,t,i){return pu(Math.cos(Kt(e)),Math.sin(Kt(e)),t,i)}function fc(e,t,i,s){const u=1<<i.z,f=(e/ir+i.x)/u;return fu(Mo((t/ir+i.y)/u),Zs(f),s)}function _h({min:e,max:t}){return dv/Math.max(t[0]-e[0],t[1]-e[1],t[2]-e[2])}const em=new Float64Array(16);function dc(e){const t=_h(e),i=Bd(em,[t,t,t]);return oc(i,i,((s=[])[0]=-(u=e.min)[0],s[1]=-u[1],s[2]=-u[2],s));var s,u}function kp(e){const t=(s=e.min,(i=em)[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=s[0],i[13]=s[1],i[14]=s[2],i[15]=1,i);var i,s;const u=1/_h(e);return Xl(t,t,[u,u,u])}function rm(e,t,i,s,u){const f=function(x){const w=ir/(2*Math.PI);return x/(2*Math.PI)/w}(i),m=[e,t,-i/(2*Math.PI)],y=Ia(new Float64Array(16));return oc(y,y,m),Xl(y,y,[f,f,f]),Cp(y,y,Kt(-u)),dh(y,y,Kt(-s)),y}function du(e){return ti(Op,Kd,e)}function im(e,t){const i=fu(t.lat,t.lng),s=function(F){const q=fu(F._center.lat,F._center.lng);let K=Pp([],hu(0,1,0),q);const at=Fd([],-F.angle,q);K=Mn(K,K,at),Fd(at,-F._pitch,K);const mt=os([],q);return Xs(mt,mt,mh(F.cameraToCenterDistance/F.pixelsPerMeter)),Mn(mt,mt,at),cl([],q,mt)}(e);return m=(u=Ap([],s,i))[0],y=u[1],x=u[2],w=(f=i)[0],M=f[1],L=f[2],B=(O=Math.sqrt(m*m+y*y+x*x)*Math.sqrt(w*w+M*M+L*L))&&ua(u,f)/O,Math.acos(Math.min(Math.max(B,-1),1));var u,f,m,y,x,w,M,L,O,B}function Bp(e,t){return im(e,t)>Math.PI/2*1.01}const nm=Kt(85),yv=Math.cos(nm),vv=Math.sin(nm),mc=63710088e-1,om=2*Math.PI*mc;class Sl{constructor(t,i){if(isNaN(t)||isNaN(i))throw new Error(`Invalid LngLat object: (${t}, ${i})`);if(this.lng=+t,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Sl(Pe(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const i=Math.PI/180,s=this.lat*i,u=t.lat*i,f=Math.sin(s)*Math.sin(u)+Math.cos(s)*Math.cos(u)*Math.cos((t.lng-this.lng)*i);return mc*Math.acos(Math.min(f,1))}toBounds(t=0){const i=360*t/40075017,s=i/Math.cos(Math.PI/180*this.lat);return new Il(new Sl(this.lng-s,this.lat-i),new Sl(this.lng+s,this.lat+i))}toEcef(t){const i=mh(t);return fu(this.lat,this.lng,Ga+i)}static convert(t){if(t instanceof Sl)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new Sl(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new Sl(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var Ci=Sl;function Fp(e){return om*Math.cos(e*Math.PI/180)}function qa(e){return(180+e)/360}function $a(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function Ca(e,t){return e/Fp(t)}function Zs(e){return 360*e-180}function Mo(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}function sm(e,t){return e*Fp(Mo(t))}const Ao=85.051129;function am(e){return 1/Math.cos(e*Math.PI/180)}class mu{constructor(t,i,s=0){this.x=+t,this.y=+i,this.z=+s}static fromLngLat(t,i=0){const s=Ci.convert(t);return new mu(qa(s.lng),$a(s.lat),Ca(i,s.lat))}toLngLat(){return new Ci(Zs(this.x),Mo(this.y))}toAltitude(){return sm(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/om*am(Mo(this.y))}}function Up(e,t,i,s,u,f,m,y,x){const w=(t+s)/2,M=(i+u)/2,L=new $t(w,M);y(L),function(O,B,F,q,K,at){const mt=F-K,lt=q-at;return Math.abs((q-B)*mt-(F-O)*lt)/Math.hypot(mt,lt)}(L.x,L.y,f.x,f.y,m.x,m.y)>=x?(Up(e,t,i,w,M,f,L,y,x),Up(e,w,M,s,u,L,m,y,x)):e.push(m)}function lm(e,t,i){let s=e[0],u=s.x,f=s.y;t(s);const m=[s];for(let y=1;y<e.length;y++){const x=e[y],{x:w,y:M}=x;t(x),Up(m,u,f,w,M,s,x,t,i),u=w,f=M,s=x}return m}function Vp(e,t,i,s){if(s(t,i)){const u=t.add(i)._mult(.5);Vp(e,t,u,s),Vp(e,u,i,s)}else e.push(i)}function xv(e,t){let i=e[0];const s=[i];for(let u=1;u<e.length;u++){const f=e[u];Vp(s,i,f,t),i=f}return s}const Gp=Math.pow(2,14)-1,um=-Gp-1;function bv(e,t){const i=Math.round(e.x*t),s=Math.round(e.y*t);return e.x=Ye(i,um,Gp),e.y=Ye(s,um,Gp),(i<e.x||i>e.x+1||s<e.y||s>e.y+1)&&Dr("Geometry exceeds allowed extent, reduce your vector tile buffer size"),e}function hl(e,t,i){const s=e.loadGeometry(),u=e.extent,f=ir/u;if(t&&i&&i.projection.isReprojectedInTileSpace){const m=1<<t.z,{scale:y,x,y:w,projection:M}=i,L=O=>{const B=Zs((t.x+O.x/u)/m),F=Mo((t.y+O.y/u)/m),q=M.project(B,F);O.x=(q.x*y-x)*u,O.y=(q.y*y-w)*u};for(let O=0;O<s.length;O++)if(e.type!==1)s[O]=lm(s[O],L,1);else{const B=[];for(const F of s[O])F.x<0||F.x>=u||F.y<0||F.y>=u||(L(F),B.push(F));s[O]=B}}for(const m of s)for(const y of m)bv(y,f);return s}function Hl(e,t){return{type:e.type,id:e.id,properties:e.properties,geometry:t?hl(e):[]}}function yh(e,t,i,s,u){e.emplaceBack(2*t+(s+1)/2,2*i+(u+1)/2)}function vh(e,t,i){e.emplaceBack(t.x,t.y,t.z,i[0]*16384,i[1]*16384,i[2]*16384)}class jp{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.id),this.index=t.index,this.hasPattern=!1,this.projection=t.projection,this.layoutVertexArray=new ye,this.indexArray=new Je,this.segments=new Nn,this.programConfigurations=new ql(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(t,i,s,u){const f=this.layers[0],m=[];let y=null;f.type==="circle"&&(y=f.layout.get("circle-sort-key"));for(const{feature:w,id:M,index:L,sourceLayerIndex:O}of t){const B=this.layers[0]._featureFilter.needGeometry,F=Hl(w,B);if(!this.layers[0]._featureFilter.filter(new P(this.zoom),F,s))continue;const q=y?y.evaluate(F,{},s):void 0,K={id:M,properties:w.properties,type:w.type,sourceLayerIndex:O,index:L,geometry:B?F.geometry:hl(w,s,u),patterns:{},sortKey:q};m.push(K)}y&&m.sort((w,M)=>w.sortKey-M.sortKey);let x=null;u.projection.name==="globe"&&(this.globeExtVertexArray=new be,x=u.projection);for(const w of m){const{geometry:M,index:L,sourceLayerIndex:O}=w,B=t[L].feature;this.addFeature(w,M,L,i.availableImages,s,x),i.featureIndex.insert(B,M,L,O,this.index)}}update(t,i,s,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,i,this.stateDependentLayers,s,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,av.members),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,lv.members))),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(t,i,s,u,f,m){for(const y of i)for(const x of y){const w=x.x,M=x.y;if(w<0||w>=ir||M<0||M>=ir)continue;if(m){const B=m.projectTilePoint(w,M,f),F=m.upVector(f,w,M),q=this.globeExtVertexArray;vh(q,B,F),vh(q,B,F),vh(q,B,F),vh(q,B,F)}const L=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),O=L.vertexLength;yh(this.layoutVertexArray,w,M,-1,-1),yh(this.layoutVertexArray,w,M,1,-1),yh(this.layoutVertexArray,w,M,1,1),yh(this.layoutVertexArray,w,M,-1,1),this.indexArray.emplaceBack(O,O+1,O+2),this.indexArray.emplaceBack(O,O+2,O+3),L.vertexLength+=4,L.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,{},u,f)}}function cm(e,t){for(let i=0;i<e.length;i++)if(Kl(t,e[i]))return!0;for(let i=0;i<t.length;i++)if(Kl(e,t[i]))return!0;return!!qp(e,t)}function wv(e,t,i){return!!Kl(e,t)||!!$p(t,e,i)}function hm(e,t){if(e.length===1)return fm(t,e[0]);for(let i=0;i<t.length;i++){const s=t[i];for(let u=0;u<s.length;u++)if(Kl(e,s[u]))return!0}for(let i=0;i<e.length;i++)if(fm(t,e[i]))return!0;for(let i=0;i<t.length;i++)if(qp(e,t[i]))return!0;return!1}function Ev(e,t,i){if(e.length>1){if(qp(e,t))return!0;for(let s=0;s<t.length;s++)if($p(t[s],e,i))return!0}for(let s=0;s<e.length;s++)if($p(e[s],t,i))return!0;return!1}function qp(e,t){if(e.length===0||t.length===0)return!1;for(let i=0;i<e.length-1;i++){const s=e[i],u=e[i+1];for(let f=0;f<t.length-1;f++)if(Tv(s,u,t[f],t[f+1]))return!0}return!1}function Tv(e,t,i,s){return Hr(e,i,s)!==Hr(t,i,s)&&Hr(e,t,i)!==Hr(e,t,s)}function $p(e,t,i){const s=i*i;if(t.length===1)return e.distSqr(t[0])<s;for(let u=1;u<t.length;u++)if(pm(e,t[u-1],t[u])<s)return!0;return!1}function pm(e,t,i){const s=t.distSqr(i);if(s===0)return e.distSqr(t);const u=((e.x-t.x)*(i.x-t.x)+(e.y-t.y)*(i.y-t.y))/s;return e.distSqr(u<0?t:u>1?i:i.sub(t)._mult(u)._add(t))}function fm(e,t){let i,s,u,f=!1;for(let m=0;m<e.length;m++){i=e[m];for(let y=0,x=i.length-1;y<i.length;x=y++)s=i[y],u=i[x],s.y>t.y!=u.y>t.y&&t.x<(u.x-s.x)*(t.y-s.y)/(u.y-s.y)+s.x&&(f=!f)}return f}function Kl(e,t){let i=!1;for(let s=0,u=e.length-1;s<e.length;u=s++){const f=e[s],m=e[u];f.y>t.y!=m.y>t.y&&t.x<(m.x-f.x)*(t.y-f.y)/(m.y-f.y)+f.x&&(i=!i)}return i}function dm(e,t,i,s,u){for(const m of e)if(t<=m.x&&i<=m.y&&s>=m.x&&u>=m.y)return!0;const f=[new $t(t,i),new $t(t,u),new $t(s,u),new $t(s,i)];if(e.length>2){for(const m of f)if(Kl(e,m))return!0}for(let m=0;m<e.length-1;m++)if(Iv(e[m],e[m+1],f))return!0;return!1}function Iv(e,t,i){const s=i[0],u=i[2];if(e.x<s.x&&t.x<s.x||e.x>u.x&&t.x>u.x||e.y<s.y&&t.y<s.y||e.y>u.y&&t.y>u.y)return!1;const f=Hr(e,t,i[0]);return f!==Hr(e,t,i[1])||f!==Hr(e,t,i[2])||f!==Hr(e,t,i[3])}function gu(e,t,i){const s=t.paint.get(e).value;return s.kind==="constant"?s.value:i.programConfigurations.get(t.id).getMaxValue(e)}function xh(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function mm(e,t,i,s,u){if(!t[0]&&!t[1])return e;const f=$t.convert(t)._mult(u);i==="viewport"&&f._rotate(-s);const m=[];for(let y=0;y<e.length;y++)m.push(e[y].sub(f));return m}function gm(e,t,i,s){const u=$t.convert(e)._mult(s);return t==="viewport"&&u._rotate(-i),u}De(jp,"CircleBucket",{omit:["layers"]});const Sv=new pt({"circle-sort-key":new Q(ie.layout_circle["circle-sort-key"])});var Cv={paint:new pt({"circle-radius":new Q(ie.paint_circle["circle-radius"]),"circle-color":new Q(ie.paint_circle["circle-color"]),"circle-blur":new Q(ie.paint_circle["circle-blur"]),"circle-opacity":new Q(ie.paint_circle["circle-opacity"]),"circle-translate":new j(ie.paint_circle["circle-translate"]),"circle-translate-anchor":new j(ie.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new j(ie.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new j(ie.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Q(ie.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Q(ie.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Q(ie.paint_circle["circle-stroke-opacity"])}),layout:Sv};function _m(e,t,i,s,u,f,m,y,x){if(f&&e.queryGeometry.isAboveHorizon)return!1;f&&(x*=e.pixelToTileUnitsFactor);const w=e.tileID.canonical,M=i.projection.upVectorScale(w,i.center.lat,i.worldSize).metersToTile;for(const L of t)for(const O of L){const B=O.add(y),F=u&&i.elevation?i.elevation.exaggeration()*u.getElevationAt(B.x,B.y,!0):0,q=i.projection.projectTilePoint(B.x,B.y,w);if(F>0){const lt=i.projection.upVector(w,B.x,B.y);q.x+=lt[0]*M*F,q.y+=lt[1]*M*F,q.z+=lt[2]*M*F}const K=f?B:Mv(q.x,q.y,q.z,s),at=f?e.tilespaceRays.map(lt=>Pv(lt,F)):e.queryGeometry.screenGeometry,mt=Zl([],[q.x,q.y,q.z,1],s);if(!m&&f?x*=mt[3]/i.cameraToCenterDistance:m&&!f&&(x*=i.cameraToCenterDistance/mt[3]),f){const lt=Mo((O.y/ir+w.y)/(1<<w.z));x/=i.projection.pixelsPerMeter(lt,1)/Ca(1,lt)}if(wv(at,K,x))return!0}return!1}function Mv(e,t,i,s){const u=Zl([],[e,t,i,1],s);return new $t(u[0]/u[3],u[1]/u[3])}const ym=hu(0,0,0),Av=hu(0,0,1);function Pv(e,t){const i=Mp();return ym[2]=t,e.intersectsPlane(ym,Av,i),new $t(i[0],i[1])}class vm extends jp{}function xm(e,{width:t,height:i},s,u){if(u){if(u instanceof Uint8ClampedArray)u=new Uint8Array(u.buffer);else if(u.length!==t*i*s)throw new RangeError("mismatched image size")}else u=new Uint8Array(t*i*s);return e.width=t,e.height=i,e.data=u,e}function bm(e,t,i){const{width:s,height:u}=t;s===e.width&&u===e.height||(Xp(e,t,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,s),height:Math.min(e.height,u)},i),e.width=s,e.height=u,e.data=t.data)}function Xp(e,t,i,s,u,f){if(u.width===0||u.height===0)return t;if(u.width>e.width||u.height>e.height||i.x>e.width-u.width||i.y>e.height-u.height)throw new RangeError("out of range source coordinates for image copy");if(u.width>t.width||u.height>t.height||s.x>t.width-u.width||s.y>t.height-u.height)throw new RangeError("out of range destination coordinates for image copy");const m=e.data,y=t.data;for(let x=0;x<u.height;x++){const w=((i.y+x)*e.width+i.x)*f,M=((s.y+x)*t.width+s.x)*f;for(let L=0;L<u.width*f;L++)y[M+L]=m[w+L]}return t}De(vm,"HeatmapBucket",{omit:["layers"]});class pl{constructor(t,i){xm(this,t,1,i)}resize(t){bm(this,new pl(t),1)}clone(){return new pl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,i,s,u,f){Xp(t,i,s,u,f,1)}}class Rs{constructor(t,i){xm(this,t,4,i)}resize(t){bm(this,new Rs(t),4)}replace(t,i){i?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Rs({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,i,s,u,f){Xp(t,i,s,u,f,4)}}De(pl,"AlphaImage"),De(Rs,"RGBAImage");var Lv={paint:new pt({"heatmap-radius":new Q(ie.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Q(ie.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new j(ie.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ct(ie.paint_heatmap["heatmap-color"]),"heatmap-opacity":new j(ie.paint_heatmap["heatmap-opacity"])})};function Zp(e){const t={},i=e.resolution||256,s=e.clips?e.clips.length:1,u=e.image||new Rs({width:i,height:s}),f=(m,y,x)=>{t[e.evaluationKey]=x;const w=e.expression.evaluate(t);u.data[m+y+0]=Math.floor(255*w.r/w.a),u.data[m+y+1]=Math.floor(255*w.g/w.a),u.data[m+y+2]=Math.floor(255*w.b/w.a),u.data[m+y+3]=Math.floor(255*w.a)};if(e.clips)for(let m=0,y=0;m<s;++m,y+=4*i)for(let x=0,w=0;x<i;x++,w+=4){const M=x/(i-1),{start:L,end:O}=e.clips[m];f(y,w,L*(1-M)+O*M)}else for(let m=0,y=0;m<i;m++,y+=4)f(0,y,m/(i-1));return u}var Dv={paint:new pt({"hillshade-illumination-direction":new j(ie.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new j(ie.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new j(ie.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new j(ie.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new j(ie.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new j(ie.paint_hillshade["hillshade-accent-color"])})};const Rv=Nt([{name:"a_pos",components:2,type:"Int16"}],4),{members:Ov}=Rv;var Wp={exports:{}};function bh(e,t,i){i=i||2;var s,u,f,m,y,x,w,M=t&&t.length,L=M?t[0]*i:e.length,O=wm(e,0,L,i,!0),B=[];if(!O||O.next===O.prev)return B;if(M&&(O=function(q,K,at,mt){var lt,dt,vt,_t=[];for(lt=0,dt=K.length;lt<dt;lt++)(vt=wm(q,K[lt]*mt,lt<dt-1?K[lt+1]*mt:q.length,mt,!1))===vt.next&&(vt.steiner=!0),_t.push(Gv(vt));for(_t.sort(Fv),lt=0;lt<_t.length;lt++)at=Uv(_t[lt],at);return at}(e,t,O,i)),e.length>80*i){s=f=e[0],u=m=e[1];for(var F=i;F<L;F+=i)(y=e[F])<s&&(s=y),(x=e[F+1])<u&&(u=x),y>f&&(f=y),x>m&&(m=x);w=(w=Math.max(f-s,m-u))!==0?32767/w:0}return gc(O,B,i,s,u,w,0),B}function wm(e,t,i,s,u){var f,m;if(u===Kp(e,t,i,s)>0)for(f=t;f<i;f+=s)m=Im(f,e[f],e[f+1],m);else for(f=i-s;f>=t;f-=s)m=Im(f,e[f],e[f+1],m);return m&&wh(m,m.next)&&(yc(m),m=m.next),m}function Jl(e,t){if(!e)return e;t||(t=e);var i,s=e;do if(i=!1,s.steiner||!wh(s,s.next)&&zn(s.prev,s,s.next)!==0)s=s.next;else{if(yc(s),(s=t=s.prev)===s.next)break;i=!0}while(i||s!==t);return t}function gc(e,t,i,s,u,f,m){if(e){!m&&f&&function(M,L,O,B){var F=M;do F.z===0&&(F.z=Yp(F.x,F.y,L,O,B)),F.prevZ=F.prev,F.nextZ=F.next,F=F.next;while(F!==M);F.prevZ.nextZ=null,F.prevZ=null,function(q){var K,at,mt,lt,dt,vt,_t,Wt,Gt=1;do{for(at=q,q=null,dt=null,vt=0;at;){for(vt++,mt=at,_t=0,K=0;K<Gt&&(_t++,mt=mt.nextZ);K++);for(Wt=Gt;_t>0||Wt>0&&mt;)_t!==0&&(Wt===0||!mt||at.z<=mt.z)?(lt=at,at=at.nextZ,_t--):(lt=mt,mt=mt.nextZ,Wt--),dt?dt.nextZ=lt:q=lt,lt.prevZ=dt,dt=lt;at=mt}dt.nextZ=null,Gt*=2}while(vt>1)}(F)}(e,s,u,f);for(var y,x,w=e;e.prev!==e.next;)if(y=e.prev,x=e.next,f?zv(e,s,u,f):Nv(e))t.push(y.i/i|0),t.push(e.i/i|0),t.push(x.i/i|0),yc(e),e=x.next,w=x.next;else if((e=x)===w){m?m===1?gc(e=kv(Jl(e),t,i),t,i,s,u,f,2):m===2&&Bv(e,t,i,s,u,f):gc(Jl(e),t,i,s,u,f,1);break}}}function Nv(e){var t=e.prev,i=e,s=e.next;if(zn(t,i,s)>=0)return!1;for(var u=t.x,f=i.x,m=s.x,y=t.y,x=i.y,w=s.y,M=u<f?u<m?u:m:f<m?f:m,L=y<x?y<w?y:w:x<w?x:w,O=u>f?u>m?u:m:f>m?f:m,B=y>x?y>w?y:w:x>w?x:w,F=s.next;F!==t;){if(F.x>=M&&F.x<=O&&F.y>=L&&F.y<=B&&_u(u,y,f,x,m,w,F.x,F.y)&&zn(F.prev,F,F.next)>=0)return!1;F=F.next}return!0}function zv(e,t,i,s){var u=e.prev,f=e,m=e.next;if(zn(u,f,m)>=0)return!1;for(var y=u.x,x=f.x,w=m.x,M=u.y,L=f.y,O=m.y,B=y<x?y<w?y:w:x<w?x:w,F=M<L?M<O?M:O:L<O?L:O,q=y>x?y>w?y:w:x>w?x:w,K=M>L?M>O?M:O:L>O?L:O,at=Yp(B,F,t,i,s),mt=Yp(q,K,t,i,s),lt=e.prevZ,dt=e.nextZ;lt&&lt.z>=at&&dt&&dt.z<=mt;){if(lt.x>=B&&lt.x<=q&&lt.y>=F&&lt.y<=K&&lt!==u&&lt!==m&&_u(y,M,x,L,w,O,lt.x,lt.y)&&zn(lt.prev,lt,lt.next)>=0||(lt=lt.prevZ,dt.x>=B&&dt.x<=q&&dt.y>=F&&dt.y<=K&&dt!==u&&dt!==m&&_u(y,M,x,L,w,O,dt.x,dt.y)&&zn(dt.prev,dt,dt.next)>=0))return!1;dt=dt.nextZ}for(;lt&&lt.z>=at;){if(lt.x>=B&&lt.x<=q&&lt.y>=F&&lt.y<=K&&lt!==u&&lt!==m&&_u(y,M,x,L,w,O,lt.x,lt.y)&&zn(lt.prev,lt,lt.next)>=0)return!1;lt=lt.prevZ}for(;dt&&dt.z<=mt;){if(dt.x>=B&&dt.x<=q&&dt.y>=F&&dt.y<=K&&dt!==u&&dt!==m&&_u(y,M,x,L,w,O,dt.x,dt.y)&&zn(dt.prev,dt,dt.next)>=0)return!1;dt=dt.nextZ}return!0}function kv(e,t,i){var s=e;do{var u=s.prev,f=s.next.next;!wh(u,f)&&Em(u,s,s.next,f)&&_c(u,f)&&_c(f,u)&&(t.push(u.i/i|0),t.push(s.i/i|0),t.push(f.i/i|0),yc(s),yc(s.next),s=e=f),s=s.next}while(s!==e);return Jl(s)}function Bv(e,t,i,s,u,f){var m=e;do{for(var y=m.next.next;y!==m.prev;){if(m.i!==y.i&&jv(m,y)){var x=Tm(m,y);return m=Jl(m,m.next),x=Jl(x,x.next),gc(m,t,i,s,u,f,0),void gc(x,t,i,s,u,f,0)}y=y.next}m=m.next}while(m!==e)}function Fv(e,t){return e.x-t.x}function Uv(e,t){var i=function(u,f){var m,y=f,x=u.x,w=u.y,M=-1/0;do{if(w<=y.y&&w>=y.next.y&&y.next.y!==y.y){var L=y.x+(w-y.y)*(y.next.x-y.x)/(y.next.y-y.y);if(L<=x&&L>M&&(M=L,m=y.x<y.next.x?y:y.next,L===x))return m}y=y.next}while(y!==f);if(!m)return null;var O,B=m,F=m.x,q=m.y,K=1/0;y=m;do x>=y.x&&y.x>=F&&x!==y.x&&_u(w<q?x:M,w,F,q,w<q?M:x,w,y.x,y.y)&&(O=Math.abs(w-y.y)/(x-y.x),_c(y,u)&&(O<K||O===K&&(y.x>m.x||y.x===m.x&&Vv(m,y)))&&(m=y,K=O)),y=y.next;while(y!==B);return m}(e,t);if(!i)return t;var s=Tm(i,e);return Jl(s,s.next),Jl(i,i.next)}function Vv(e,t){return zn(e.prev,e,t.prev)<0&&zn(t.next,e,e.next)<0}function Yp(e,t,i,s,u){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-i)*u|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-s)*u|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Gv(e){var t=e,i=e;do(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next;while(t!==e);return i}function _u(e,t,i,s,u,f,m,y){return(u-m)*(t-y)>=(e-m)*(f-y)&&(e-m)*(s-y)>=(i-m)*(t-y)&&(i-m)*(f-y)>=(u-m)*(s-y)}function jv(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(i,s){var u=i;do{if(u.i!==i.i&&u.next.i!==i.i&&u.i!==s.i&&u.next.i!==s.i&&Em(u,u.next,i,s))return!0;u=u.next}while(u!==i);return!1}(e,t)&&(_c(e,t)&&_c(t,e)&&function(i,s){var u=i,f=!1,m=(i.x+s.x)/2,y=(i.y+s.y)/2;do u.y>y!=u.next.y>y&&u.next.y!==u.y&&m<(u.next.x-u.x)*(y-u.y)/(u.next.y-u.y)+u.x&&(f=!f),u=u.next;while(u!==i);return f}(e,t)&&(zn(e.prev,e,t.prev)||zn(e,t.prev,t))||wh(e,t)&&zn(e.prev,e,e.next)>0&&zn(t.prev,t,t.next)>0)}function zn(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function wh(e,t){return e.x===t.x&&e.y===t.y}function Em(e,t,i,s){var u=Th(zn(e,t,i)),f=Th(zn(e,t,s)),m=Th(zn(i,s,e)),y=Th(zn(i,s,t));return u!==f&&m!==y||!(u!==0||!Eh(e,i,t))||!(f!==0||!Eh(e,s,t))||!(m!==0||!Eh(i,e,s))||!(y!==0||!Eh(i,t,s))}function Eh(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function Th(e){return e>0?1:e<0?-1:0}function _c(e,t){return zn(e.prev,e,e.next)<0?zn(e,t,e.next)>=0&&zn(e,e.prev,t)>=0:zn(e,t,e.prev)<0||zn(e,e.next,t)<0}function Tm(e,t){var i=new Hp(e.i,e.x,e.y),s=new Hp(t.i,t.x,t.y),u=e.next,f=t.prev;return e.next=t,t.prev=e,i.next=u,u.prev=i,s.next=i,i.prev=s,f.next=s,s.prev=f,s}function Im(e,t,i,s){var u=new Hp(e,t,i);return s?(u.next=s.next,u.prev=s,s.next.prev=u,s.next=u):(u.prev=u,u.next=u),u}function yc(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Hp(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Kp(e,t,i,s){for(var u=0,f=t,m=i-s;f<i;f+=s)u+=(e[m]-e[f])*(e[f+1]+e[m+1]),m=f;return u}Wp.exports=bh,Wp.exports.default=bh,bh.deviation=function(e,t,i,s){var u=t&&t.length,f=Math.abs(Kp(e,0,u?t[0]*i:e.length,i));if(u)for(var m=0,y=t.length;m<y;m++)f-=Math.abs(Kp(e,t[m]*i,m<y-1?t[m+1]*i:e.length,i));var x=0;for(m=0;m<s.length;m+=3){var w=s[m]*i,M=s[m+1]*i,L=s[m+2]*i;x+=Math.abs((e[w]-e[L])*(e[M+1]-e[w+1])-(e[w]-e[M])*(e[L+1]-e[w+1]))}return f===0&&x===0?0:Math.abs((x-f)/f)},bh.flatten=function(e){for(var t=e[0][0].length,i={vertices:[],holes:[],dimensions:t},s=0,u=0;u<e.length;u++){for(var f=0;f<e[u].length;f++)for(var m=0;m<t;m++)i.vertices.push(e[u][f][m]);u>0&&i.holes.push(s+=e[u-1].length)}return i};var Jp=gt(Wp.exports);function qv(e,t,i,s,u){Sm(e,t,i,s||e.length-1,u||$v)}function Sm(e,t,i,s,u){for(;s>i;){if(s-i>600){var f=s-i+1,m=t-i+1,y=Math.log(f),x=.5*Math.exp(2*y/3),w=.5*Math.sqrt(y*x*(f-x)/f)*(m-f/2<0?-1:1);Sm(e,t,Math.max(i,Math.floor(t-m*x/f+w)),Math.min(s,Math.floor(t+(f-m)*x/f+w)),u)}var M=e[t],L=i,O=s;for(vc(e,i,t),u(e[s],M)>0&&vc(e,i,s);L<O;){for(vc(e,L,O),L++,O--;u(e[L],M)<0;)L++;for(;u(e[O],M)>0;)O--}u(e[i],M)===0?vc(e,i,O):vc(e,++O,s),O<=t&&(i=O+1),t<=O&&(s=O-1)}}function vc(e,t,i){var s=e[t];e[t]=e[i],e[i]=s}function $v(e,t){return e<t?-1:e>t?1:0}function Qp(e,t){const i=e.length;if(i<=1)return[e];const s=[];let u,f;for(let m=0;m<i;m++){const y=rn(e[m]);y!==0&&(e[m].area=Math.abs(y),f===void 0&&(f=y<0),f===y<0?(u&&s.push(u),u=[e[m]]):u.push(e[m]))}if(u&&s.push(u),t>1)for(let m=0;m<s.length;m++)s[m].length<=t||(qv(s[m],t,1,s[m].length-1,Xv),s[m]=s[m].slice(0,t));return s}function Xv(e,t){return t.area-e.area}function tf(e,t,i){const s=i.patternDependencies;let u=!1;for(const f of t){const m=f.paint.get(`${e}-pattern`);m.isConstant()||(u=!0);const y=m.constantOr(null);y&&(u=!0,s[y]=!0)}return u}function ef(e,t,i,s,u){const f=u.patternDependencies;for(const m of t){const y=m.paint.get(`${e}-pattern`).value;if(y.kind!=="constant"){let x=y.evaluate({zoom:s},i,{},u.availableImages);x=x&&x.name?x.name:x,f[x]=!0,i.patterns[m.id]=x}}return i}class Ih{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ye,this.indexArray=new Je,this.indexArray2=new so,this.programConfigurations=new ql(t.layers,t.zoom),this.segments=new Nn,this.segments2=new Nn,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.projection=t.projection}populate(t,i,s,u){this.hasPattern=tf("fill",this.layers,i);const f=this.layers[0].layout.get("fill-sort-key"),m=[];for(const{feature:y,id:x,index:w,sourceLayerIndex:M}of t){const L=this.layers[0]._featureFilter.needGeometry,O=Hl(y,L);if(!this.layers[0]._featureFilter.filter(new P(this.zoom),O,s))continue;const B=f?f.evaluate(O,{},s,i.availableImages):void 0,F={id:x,properties:y.properties,type:y.type,sourceLayerIndex:M,index:w,geometry:L?O.geometry:hl(y,s,u),patterns:{},sortKey:B};m.push(F)}f&&m.sort((y,x)=>y.sortKey-x.sortKey);for(const y of m){const{geometry:x,index:w,sourceLayerIndex:M}=y;if(this.hasPattern){const L=ef("fill",this.layers,y,this.zoom,i);this.patternFeatures.push(L)}else this.addFeature(y,x,w,s,{},i.availableImages);i.featureIndex.insert(t[w].feature,x,w,M,this.index)}}update(t,i,s,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,i,this.stateDependentLayers,s,u)}addFeatures(t,i,s,u,f){for(const m of this.patternFeatures)this.addFeature(m,m.geometry,m.index,i,s,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ov),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,i,s,u,f,m=[]){for(const y of Qp(i,500)){let x=0;for(const F of y)x+=F.length;const w=this.segments.prepareSegment(x,this.layoutVertexArray,this.indexArray),M=w.vertexLength,L=[],O=[];for(const F of y){if(F.length===0)continue;F!==y[0]&&O.push(L.length/2);const q=this.segments2.prepareSegment(F.length,this.layoutVertexArray,this.indexArray2),K=q.vertexLength;this.layoutVertexArray.emplaceBack(F[0].x,F[0].y),this.indexArray2.emplaceBack(K+F.length-1,K),L.push(F[0].x),L.push(F[0].y);for(let at=1;at<F.length;at++)this.layoutVertexArray.emplaceBack(F[at].x,F[at].y),this.indexArray2.emplaceBack(K+at-1,K+at),L.push(F[at].x),L.push(F[at].y);q.vertexLength+=F.length,q.primitiveLength+=F.length}const B=Jp(L,O);for(let F=0;F<B.length;F+=3)this.indexArray.emplaceBack(M+B[F],M+B[F+1],M+B[F+2]);w.vertexLength+=x,w.primitiveLength+=B.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,f,m,u)}}De(Ih,"FillBucket",{omit:["layers","patternFeatures"]});const Zv=new pt({"fill-sort-key":new Q(ie.layout_fill["fill-sort-key"])});var Wv={paint:new pt({"fill-antialias":new j(ie.paint_fill["fill-antialias"]),"fill-opacity":new Q(ie.paint_fill["fill-opacity"]),"fill-color":new Q(ie.paint_fill["fill-color"]),"fill-outline-color":new Q(ie.paint_fill["fill-outline-color"]),"fill-translate":new j(ie.paint_fill["fill-translate"]),"fill-translate-anchor":new j(ie.paint_fill["fill-translate-anchor"]),"fill-pattern":new Q(ie.paint_fill["fill-pattern"])}),layout:Zv};const Yv=Nt([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Hv=Nt([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Kv=Nt([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Jv}=Yv;var Sh={},Qv=de,Cm=yu;function yu(e,t,i,s,u){this.properties={},this.extent=i,this.type=0,this._pbf=e,this._geometry=-1,this._keys=s,this._values=u,e.readFields(tx,this,t)}function tx(e,t,i){e==1?t.id=i.readVarint():e==2?function(s,u){for(var f=s.readVarint()+s.pos;s.pos<f;){var m=u._keys[s.readVarint()],y=u._values[s.readVarint()];u.properties[m]=y}}(i,t):e==3?t.type=i.readVarint():e==4&&(t._geometry=i.pos)}function ex(e){for(var t,i,s=0,u=0,f=e.length,m=f-1;u<f;m=u++)s+=((i=e[m]).x-(t=e[u]).x)*(t.y+i.y);return s}yu.types=["Unknown","Point","LineString","Polygon"],yu.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t,i=e.readVarint()+e.pos,s=1,u=0,f=0,m=0,y=[];e.pos<i;){if(u<=0){var x=e.readVarint();s=7&x,u=x>>3}if(u--,s===1||s===2)f+=e.readSVarint(),m+=e.readSVarint(),s===1&&(t&&y.push(t),t=[]),t.push(new Qv(f,m));else{if(s!==7)throw new Error("unknown command "+s);t&&t.push(t[0].clone())}}return t&&y.push(t),y},yu.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,i=1,s=0,u=0,f=0,m=1/0,y=-1/0,x=1/0,w=-1/0;e.pos<t;){if(s<=0){var M=e.readVarint();i=7&M,s=M>>3}if(s--,i===1||i===2)(u+=e.readSVarint())<m&&(m=u),u>y&&(y=u),(f+=e.readSVarint())<x&&(x=f),f>w&&(w=f);else if(i!==7)throw new Error("unknown command "+i)}return[m,x,y,w]},yu.prototype.toGeoJSON=function(e,t,i){var s,u,f=this.extent*Math.pow(2,i),m=this.extent*e,y=this.extent*t,x=this.loadGeometry(),w=yu.types[this.type];function M(B){for(var F=0;F<B.length;F++){var q=B[F];B[F]=[360*(q.x+m)/f-180,360/Math.PI*Math.atan(Math.exp((180-360*(q.y+y)/f)*Math.PI/180))-90]}}switch(this.type){case 1:var L=[];for(s=0;s<x.length;s++)L[s]=x[s][0];M(x=L);break;case 2:for(s=0;s<x.length;s++)M(x[s]);break;case 3:for(x=function(B){var F=B.length;if(F<=1)return[B];for(var q,K,at=[],mt=0;mt<F;mt++){var lt=ex(B[mt]);lt!==0&&(K===void 0&&(K=lt<0),K===lt<0?(q&&at.push(q),q=[B[mt]]):q.push(B[mt]))}return q&&at.push(q),at}(x),s=0;s<x.length;s++)for(u=0;u<x[s].length;u++)M(x[s][u])}x.length===1?x=x[0]:w="Multi"+w;var O={type:"Feature",geometry:{type:w,coordinates:x},properties:this.properties};return"id"in this&&(O.id=this.id),O};var rx=Cm,Mm=Am;function Am(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(ix,this,t),this.length=this._features.length}function ix(e,t,i){e===15?t.version=i.readVarint():e===1?t.name=i.readString():e===5?t.extent=i.readVarint():e===2?t._features.push(i.pos):e===3?t._keys.push(i.readString()):e===4&&t._values.push(function(s){for(var u=null,f=s.readVarint()+s.pos;s.pos<f;){var m=s.readVarint()>>3;u=m===1?s.readString():m===2?s.readFloat():m===3?s.readDouble():m===4?s.readVarint64():m===5?s.readVarint():m===6?s.readSVarint():m===7?s.readBoolean():null}return u}(i))}Am.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var t=this._pbf.readVarint()+this._pbf.pos;return new rx(this._pbf,t,this.extent,this._keys,this._values)};var nx=Mm;function ox(e,t,i){if(e===3){var s=new nx(i,i.readVarint()+i.pos);s.length&&(t[s.name]=s)}}var rf=Sh.VectorTile=function(e,t){this.layers=e.readFields(ox,{},t)},Ch=Sh.VectorTileFeature=Cm;function Mh(e,t,i,s){const u=[],f=s===0?(m,y,x,w,M,L)=>{m.push(new $t(L,x+(L-y)/(w-y)*(M-x)))}:(m,y,x,w,M,L)=>{m.push(new $t(y+(L-x)/(M-x)*(w-y),L))};for(const m of e){const y=[];for(const x of m){if(x.length<=2)continue;const w=[];for(let O=0;O<x.length-1;O++){const B=x[O].x,F=x[O].y,q=x[O+1].x,K=x[O+1].y,at=s===0?B:F,mt=s===0?q:K;at<t?mt>t&&f(w,B,F,q,K,t):at>i?mt<i&&f(w,B,F,q,K,i):w.push(x[O]),mt<t&&at>=t&&f(w,B,F,q,K,t),mt>i&&at<=i&&f(w,B,F,q,K,i)}let M=x[x.length-1];const L=s===0?M.x:M.y;L>=t&&L<=i&&w.push(M),w.length&&(M=w[w.length-1],w[0].x===M.x&&w[0].y===M.y||w.push(w[0]),y.push(w))}y.length&&u.push(y)}return u}Sh.VectorTileLayer=Mm;const sx=Ch.types,ax=Math.pow(2,13);function xc(e,t,i,s,u,f,m,y){e.emplaceBack((t<<1)+m,(i<<1)+f,(Math.floor(s*ax)<<1)+u,Math.round(y))}function bc(e,t,i){e.emplaceBack(t.x,t.y,t.z,i[0]*16384,i[1]*16384,i[2]*16384)}class Pm{constructor(){this.acc=new $t(0,0),this.polyCount=[]}startRing(t){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new $t(t.x,t.y),this.max=new $t(t.x,t.y))}append(t,i){this.currentPolyCount.edges++,this.acc._add(t);const s=this.min,u=this.max;t.x<s.x?s.x=t.x:t.x>u.x&&(u.x=t.x),t.y<s.y?s.y=t.y:t.y>u.y&&(u.y=t.y),((t.x===0||t.x===ir)&&t.x===i.x)!=((t.y===0||t.y===ir)&&t.y===i.y)&&this.processBorderOverlap(t,i),i.x<0!=t.x<0&&this.addBorderIntersection(0,Mr(i.y,t.y,(0-i.x)/(t.x-i.x))),i.x>ir!=t.x>ir&&this.addBorderIntersection(1,Mr(i.y,t.y,(ir-i.x)/(t.x-i.x))),i.y<0!=t.y<0&&this.addBorderIntersection(2,Mr(i.x,t.x,(0-i.y)/(t.y-i.y))),i.y>ir!=t.y>ir&&this.addBorderIntersection(3,Mr(i.x,t.x,(ir-i.y)/(t.y-i.y)))}addBorderIntersection(t,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const s=this.borders[t];i<s[0]&&(s[0]=i),i>s[1]&&(s[1]=i)}processBorderOverlap(t,i){if(t.x===i.x){if(t.y===i.y)return;const s=t.x===0?0:1;this.addBorderIntersection(s,i.y),this.addBorderIntersection(s,t.y)}else{const s=t.y===0?2:3;this.addBorderIntersection(s,i.x),this.addBorderIntersection(s,t.x)}}centroid(){const t=this.polyCount.reduce((i,s)=>i+s.edges,0);return t!==0?this.acc.div(t)._round():new $t(0,0)}span(){return new $t(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((t,i)=>t+ +(i[0]!==Number.MAX_VALUE),0)}}class wc{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.id),this.index=t.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=t.projection,this.layoutVertexArray=new le,this.centroidVertexArray=new wa,this.indexArray=new Je,this.programConfigurations=new ql(t.layers,t.zoom),this.segments=new Nn,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.enableTerrain=t.enableTerrain}populate(t,i,s,u){this.features=[],this.hasPattern=tf("fill-extrusion",this.layers,i),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(f){const m=Math.exp(Math.PI*(1-f.y/(1<<f.z)*2));return 80150034*m/(m*m+1)/ir/(1<<f.z)}(s),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:f,id:m,index:y,sourceLayerIndex:x}of t){const w=this.layers[0]._featureFilter.needGeometry,M=Hl(f,w);if(!this.layers[0]._featureFilter.filter(new P(this.zoom),M,s))continue;const L={id:m,sourceLayerIndex:x,index:y,geometry:w?M.geometry:hl(f,s,u),properties:f.properties,type:f.type,patterns:{}},O=this.layoutVertexArray.length;this.hasPattern?this.features.push(ef("fill-extrusion",this.layers,L,this.zoom,i)):this.addFeature(L,L.geometry,y,s,{},i.availableImages,u),i.featureIndex.insert(f,L.geometry,y,x,this.index,O)}this.sortBorders()}addFeatures(t,i,s,u,f){for(const m of this.features){const{geometry:y}=m;this.addFeature(m,y,m.index,i,s,u,f)}this.sortBorders()}update(t,i,s,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,i,this.stateDependentLayers,s,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Jv),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=t.createVertexBuffer(this.layoutVertexExtArray,Kv.members,!0))),this.programConfigurations.upload(t),this.uploaded=!0}uploadCentroid(t){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,Hv.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,i,s,u,f,m,y){const x=[new $t(0,0),new $t(ir,ir)],w=y.projection,M=w.name==="globe",L=this.enableTerrain&&!M?new Pm:null,O=sx[t.type]==="Polygon";M&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new be);const B=Qp(i,500);for(let at=B.length-1;at>=0;at--){const mt=B[at];(mt.length===0||(F=mt[0]).every(lt=>lt.x<=0)||F.every(lt=>lt.x>=ir)||F.every(lt=>lt.y<=0)||F.every(lt=>lt.y>=ir))&&B.splice(at,1)}var F;let q;if(M)q=km(B,x,u);else{q=[];for(const at of B)q.push({polygon:at,bounds:x})}const K=O?this.edgeRadius:0;for(const{polygon:at,bounds:mt}of q){let lt=0,dt=0;for(const _t of at)O&&!_t[0].equals(_t[_t.length-1])&&_t.push(_t[0]),dt+=O?_t.length-1:_t.length;const vt=this.segments.prepareSegment((O?5:4)*dt,this.layoutVertexArray,this.indexArray);if(O){const _t=[],Wt=[];lt=vt.vertexLength;for(const oe of at){let ve,te;oe.length&&oe!==at[0]&&Wt.push(_t.length/2),ve=oe[1].sub(oe[0])._perp()._unit();for(let ce=1;ce<oe.length;ce++){const he=oe[ce],me=oe[ce===oe.length-1?1:ce+1];let{x:Te,y:ne}=he;if(K){te=me.sub(he)._perp()._unit();const Be=ve.add(te)._unit(),Xe=K*Math.min(4,1/(ve.x*Be.x+ve.y*Be.y));Te+=Xe*Be.x,ne+=Xe*Be.y,ve=te}xc(this.layoutVertexArray,Te,ne,0,0,1,1,0),vt.vertexLength++,_t.push(he.x,he.y),M&&bc(this.layoutVertexExtArray,w.projectTilePoint(Te,ne,u),w.upVector(u,Te,ne))}}const Gt=Jp(_t,Wt);for(let oe=0;oe<Gt.length;oe+=3)this.indexArray.emplaceBack(lt+Gt[oe],lt+Gt[oe+2],lt+Gt[oe+1]),vt.primitiveLength++}for(const _t of at){L&&_t.length&&L.startRing(_t[0]);let Wt,Gt,oe,ve=_t.length>4&&Om(_t[_t.length-2],_t[0],_t[1]),te=K?lx(_t[_t.length-2],_t[0],_t[1],K):0;Gt=_t[1].sub(_t[0])._perp()._unit();let ce=!0;for(let he=1,me=0;he<_t.length;he++){let Te=_t[he-1],ne=_t[he];const Be=_t[he===_t.length-1?1:he+1];if(L&&O&&L.currentPolyCount.top++,Rm(ne,Te,mt)){K&&(Gt=Be.sub(ne)._perp()._unit(),ce=!ce);continue}L&&L.append(ne,Te);const Xe=ne.sub(Te)._perp(),Fe=Xe.x/(Math.abs(Xe.x)+Math.abs(Xe.y)),yr=Xe.y>0?1:0,Ce=Te.dist(ne);if(me+Ce>32768&&(me=0),K){oe=Be.sub(ne)._perp()._unit();let xr=Dm(Te,ne,Be,Lm(Gt,oe),K);isNaN(xr)&&(xr=0);const ar=ne.sub(Te)._unit();Te=Te.add(ar.mult(te))._round(),ne=ne.add(ar.mult(-xr))._round(),te=xr,Gt=oe}const er=vt.vertexLength,vr=_t.length>4&&Om(Te,ne,Be);let Qr=Nm(me,ve,ce);if(xc(this.layoutVertexArray,Te.x,Te.y,Fe,yr,0,0,Qr),xc(this.layoutVertexArray,Te.x,Te.y,Fe,yr,0,1,Qr),me+=Ce,Qr=Nm(me,vr,!ce),ve=vr,xc(this.layoutVertexArray,ne.x,ne.y,Fe,yr,0,0,Qr),xc(this.layoutVertexArray,ne.x,ne.y,Fe,yr,0,1,Qr),vt.vertexLength+=4,this.indexArray.emplaceBack(er+0,er+1,er+2),this.indexArray.emplaceBack(er+1,er+3,er+2),vt.primitiveLength+=2,K){const xr=lt+(he===1?_t.length-2:he-2),ar=he===1?lt:xr+1;if(this.indexArray.emplaceBack(er+1,xr,er+3),this.indexArray.emplaceBack(xr,ar,er+3),vt.primitiveLength+=2,Wt===void 0&&(Wt=er),!Rm(Be,_t[he],mt)){const $i=he===_t.length-1?Wt:vt.vertexLength;this.indexArray.emplaceBack(er+2,er+3,$i),this.indexArray.emplaceBack(er+3,$i+1,$i),this.indexArray.emplaceBack(er+3,ar,$i+1),vt.primitiveLength+=3}ce=!ce}if(M){const xr=this.layoutVertexExtArray,ar=w.projectTilePoint(Te.x,Te.y,u),$i=w.projectTilePoint(ne.x,ne.y,u),wr=w.upVector(u,Te.x,Te.y),Er=w.upVector(u,ne.x,ne.y);bc(xr,ar,wr),bc(xr,ar,wr),bc(xr,$i,Er),bc(xr,$i,Er)}}O&&(lt+=_t.length-1)}}if(L&&L.polyCount.length>0){if(L.borders){L.vertexArrayOffset=this.centroidVertexArray.length;const at=L.borders,mt=this.featuresOnBorder.push(L)-1;for(let lt=0;lt<4;lt++)at[lt][0]!==Number.MAX_VALUE&&this.borders[lt].push(mt)}this.encodeCentroid(L.borders?void 0:L.centroid(),L)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,f,m,u)}sortBorders(){for(let t=0;t<4;t++)this.borders[t].sort((i,s)=>this.featuresOnBorder[i].borders[t][0]-this.featuresOnBorder[s].borders[t][0])}encodeCentroid(t,i,s=!0){let u,f;if(t)if(t.y!==0){const y=i.span()._mult(this.tileToMeter);u=(Math.max(t.x,1)<<3)+Math.min(7,Math.round(y.x/10)),f=(Math.max(t.y,1)<<3)+Math.min(7,Math.round(y.y/10))}else u=Math.ceil(7*(t.x+450)),f=0;else u=0,f=+s;let m=s?this.centroidVertexArray.length:i.vertexArrayOffset;for(const y of i.polyCount){s&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*y.edges+y.top);for(let x=0;x<y.top;x++)this.centroidVertexArray.emplace(m++,u,f);for(let x=0;x<2*y.edges;x++)this.centroidVertexArray.emplace(m++,0,f),this.centroidVertexArray.emplace(m++,u,f)}}}function Lm(e,t){const i=e.add(t)._unit();return e.x*i.x+e.y*i.y}function lx(e,t,i,s){const u=t.sub(e)._perp()._unit(),f=i.sub(t)._perp()._unit();return Dm(e,t,i,Lm(u,f),s)}function Dm(e,t,i,s,u){const f=Math.sqrt(1-s*s);return Math.min(e.dist(t)/3,t.dist(i)/3,u*f/s)}function Rm(e,t,i){return e.x<i[0].x&&t.x<i[0].x||e.x>i[1].x&&t.x>i[1].x||e.y<i[0].y&&t.y<i[0].y||e.y>i[1].y&&t.y>i[1].y}function Om(e,t,i){if(e.x<0||e.x>=ir||t.x<0||t.x>=ir||i.x<0||i.x>=ir)return!1;const s=i.sub(t),u=s.perp(),f=e.sub(t);return(s.x*f.x+s.y*f.y)/Math.sqrt((s.x*s.x+s.y*s.y)*(f.x*f.x+f.y*f.y))>-.866&&u.x*f.x+u.y*f.y<0}function Nm(e,t,i){const s=t?2|e:-3&e;return i?1|s:-2&s}function zm(){const e=Math.PI/32,t=Math.tan(e),i=mc;return i*Math.sqrt(1+2*t*t)-i}function km(e,t,i){const s=1<<i.z,u=Zs(i.x/s),f=Zs((i.x+1)/s),m=Mo(i.y/s),y=Mo((i.y+1)/s);return function(x,w,M,L,O=0,B){const F=[];if(!x.length||!M||!L)return F;const q=(_t,Wt)=>{for(const Gt of _t)F.push({polygon:Gt,bounds:Wt})},K=Math.ceil(Math.log2(M)),at=Math.ceil(Math.log2(L)),mt=K-at,lt=[];for(let _t=0;_t<Math.abs(mt);_t++)lt.push(mt>0?0:1);for(let _t=0;_t<Math.min(K,at);_t++)lt.push(0),lt.push(1);let dt=x;if(dt=Mh(dt,w[0].y-O,w[1].y+O,1),dt=Mh(dt,w[0].x-O,w[1].x+O,0),!dt.length)return F;const vt=[];for(lt.length?vt.push({polygons:dt,bounds:w,depth:0}):q(dt,w);vt.length;){const _t=vt.pop(),Wt=_t.depth,Gt=lt[Wt],oe=_t.bounds[0],ve=_t.bounds[1],te=Gt===0?oe.x:oe.y,ce=Gt===0?ve.x:ve.y,he=B?B(Gt,te,ce):.5*(te+ce),me=Mh(_t.polygons,te-O,he+O,Gt),Te=Mh(_t.polygons,he-O,ce+O,Gt);if(me.length){const ne=[oe,new $t(Gt===0?he:ve.x,Gt===1?he:ve.y)];lt.length>Wt+1?vt.push({polygons:me,bounds:ne,depth:Wt+1}):q(me,ne)}if(Te.length){const ne=[new $t(Gt===0?he:oe.x,Gt===1?he:oe.y),ve];lt.length>Wt+1?vt.push({polygons:Te,bounds:ne,depth:Wt+1}):q(Te,ne)}}return F}(e,t,Math.ceil((f-u)/11.25),Math.ceil((m-y)/11.25),1,(x,w,M)=>{if(x===0)return .5*(w+M);{const L=Mo((i.y+w/ir)/s);return($a(.5*(Mo((i.y+M/ir)/s)+L))*s-i.y)*ir}})}De(wc,"FillExtrusionBucket",{omit:["layers","features"]}),De(Pm,"PartMetadata");const ux=new pt({"fill-extrusion-edge-radius":new j(ie["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var cx={paint:new pt({"fill-extrusion-opacity":new j(ie["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Q(ie["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new j(ie["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new j(ie["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Q(ie["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Q(ie["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Q(ie["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new j(ie["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new j(ie["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new j(ie["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-rounded-roof":new j(ie["paint_fill-extrusion"]["fill-extrusion-rounded-roof"])}),layout:ux};function Bm(e,t,i){var s=2*Math.PI*6378137/256/Math.pow(2,i);return[e*s-2*Math.PI*6378137/2,t*s-2*Math.PI*6378137/2]}class Ah{constructor(t,i,s){this.z=t,this.x=i,this.y=s,this.key=Ec(0,t,t,i,s)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,i){const s=function(f,m,y){var x=Bm(256*f,256*(m=Math.pow(2,y)-m-1),y),w=Bm(256*(f+1),256*(m+1),y);return x[0]+","+x[1]+","+w[0]+","+w[1]}(this.x,this.y,this.z),u=function(f,m,y){let x,w="";for(let M=f;M>0;M--)x=1<<M-1,w+=(m&x?1:0)+(y&x?2:0);return w}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(i==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",u).replace("{bbox-epsg-3857}",s)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Fm{constructor(t,i){this.wrap=t,this.canonical=i,this.key=Ec(t,i.z,i.z,i.x,i.y)}}class as{constructor(t,i,s,u,f){this.overscaledZ=t,this.wrap=i,this.canonical=new Ah(s,+u,+f),this.key=i===0&&t===s?this.canonical.key:Ec(i,t,s,u,f)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){const i=this.canonical.z-t;return t>this.canonical.z?new as(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new as(t,this.wrap,t,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(t,i=!0){if(this.overscaledZ===t&&i)return this.key;if(t>this.canonical.z)return Ec(this.wrap*+i,t,this.canonical.z,this.canonical.x,this.canonical.y);{const s=this.canonical.z-t;return Ec(this.wrap*+i,t,t,this.canonical.x>>s,this.canonical.y>>s)}}isChildOf(t){if(t.wrap!==this.wrap)return!1;const i=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>i&&t.canonical.y===this.canonical.y>>i}children(t){if(this.overscaledZ>=t)return[new as(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,s=2*this.canonical.x,u=2*this.canonical.y;return[new as(i,this.wrap,i,s,u),new as(i,this.wrap,i,s+1,u),new as(i,this.wrap,i,s,u+1),new as(i,this.wrap,i,s+1,u+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new as(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new as(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Fm(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Ec(e,t,i,s,u){const f=1<<Math.min(i,22);let m=f*(u%f)+s%f;return e&&i<22&&(m+=f*f*((e<0?-2*e-1:2*e)%(1<<2*(22-i)))),16*(32*m+i)+(t-i)}De(Ah,"CanonicalTileID"),De(as,"OverscaledTileID",{omit:["projMatrix"]});class vu extends $t{constructor(t,i,s){super(t,i),this.z=s}}function Tc(e,t){return e.x*t.x+e.y*t.y}function Um(e,t){if(e.length===1){let i=0;const s=t[i++];let u;for(;!u||s.equals(u);)if(u=t[i++],!u)return 1/0;for(;i<t.length;i++){const f=t[i],m=e[0],y=u.sub(s),x=f.sub(s),w=m.sub(s),M=Tc(y,y),L=Tc(y,x),O=Tc(x,x),B=Tc(w,y),F=Tc(w,x),q=M*O-L*L,K=(O*B-L*F)/q,at=(M*F-L*B)/q,mt=s.z*(1-K-at)+u.z*K+f.z*at;if(isFinite(mt))return mt}return 1/0}{let i=1/0;for(const s of t)i=Math.min(i,s.z);return i}}function Vm(e,t,i,s,u,f,m,y){const x=m*u.getElevationAt(e,t,!0,!0),w=f[0]!==0,M=w?f[1]===0?m*(f[0]/7-450):m*function(L,O,B){const F=Math.floor(O[0]/8),q=Math.floor(O[1]/8),K=10*(O[0]-8*F),at=10*(O[1]-8*q),mt=L.getElevationAt(F,q,!0,!0),lt=L.getMeterToDEM(B),dt=Math.floor(.5*(K*lt-1)),vt=Math.floor(.5*(at*lt-1)),_t=L.tileCoordToPixel(F,q),Wt=2*dt+1,Gt=2*vt+1,oe=function(Te,ne,Be,Xe,Fe){return[Te.getElevationAtPixel(ne,Be,!0),Te.getElevationAtPixel(ne+Fe,Be,!0),Te.getElevationAtPixel(ne,Be+Fe,!0),Te.getElevationAtPixel(ne+Xe,Be+Fe,!0)]}(L,_t.x-dt,_t.y-vt,Wt,Gt),ve=Math.abs(oe[0]-oe[1]),te=Math.abs(oe[2]-oe[3]),ce=Math.abs(oe[0]-oe[2])+Math.abs(oe[1]-oe[3]),he=Math.min(.25,.5*lt*(ve+te)/Wt),me=Math.min(.25,.5*lt*ce/Gt);return mt+Math.max(he*K,me*at)}(u,f,y):x;return{base:x+(i===0)?-1:i,top:w?Math.max(M+s,x+i+2):x+s}}const hx=Nt([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:px}=hx,fx=Nt([{name:"a_packed",components:4,type:"Float32"}]),{members:dx}=fx,mx=Ch.types,gx=Math.cos(Math.PI/180*37.5);class Ph{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.id),this.index=t.index,this.projection=t.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new Qt,this.layoutVertexArray2=new _e,this.indexArray=new Je,this.programConfigurations=new ql(t.layers,t.zoom),this.segments=new Nn,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(t,i,s,u){this.hasPattern=tf("line",this.layers,i);const f=this.layers[0].layout.get("line-sort-key"),m=[];for(const{feature:M,id:L,index:O,sourceLayerIndex:B}of t){const F=this.layers[0]._featureFilter.needGeometry,q=Hl(M,F);if(!this.layers[0]._featureFilter.filter(new P(this.zoom),q,s))continue;const K=f?f.evaluate(q,{},s):void 0,at={id:L,properties:M.properties,type:M.type,sourceLayerIndex:B,index:O,geometry:F?q.geometry:hl(M,s,u),patterns:{},sortKey:K};m.push(at)}f&&m.sort((M,L)=>M.sortKey-L.sortKey);const{lineAtlas:y,featureIndex:x}=i,w=this.addConstantDashes(y);for(const M of m){const{geometry:L,index:O,sourceLayerIndex:B}=M;if(w&&this.addFeatureDashes(M,y),this.hasPattern){const F=ef("line",this.layers,M,this.zoom,i);this.patternFeatures.push(F)}else this.addFeature(M,L,O,s,y.positions,i.availableImages);x.insert(t[O].feature,L,O,B,this.index)}}addConstantDashes(t){let i=!1;for(const s of this.layers){const u=s.paint.get("line-dasharray").value,f=s.layout.get("line-cap").value;if(u.kind!=="constant"||f.kind!=="constant")i=!0;else{const m=f.value,y=u.value;if(!y)continue;t.addDash(y,m)}}return i}addFeatureDashes(t,i){const s=this.zoom;for(const u of this.layers){const f=u.paint.get("line-dasharray").value,m=u.layout.get("line-cap").value;if(f.kind==="constant"&&m.kind==="constant")continue;let y,x;if(f.kind==="constant"){if(y=f.value,!y)continue}else y=f.evaluate({zoom:s},t);x=m.kind==="constant"?m.value:m.evaluate({zoom:s},t),i.addDash(y,x),t.patterns[u.id]=i.getKey(y,x)}}update(t,i,s,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,i,this.stateDependentLayers,s,u)}addFeatures(t,i,s,u,f){for(const m of this.patternFeatures)this.addFeature(m,m.geometry,m.index,i,s,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,dx)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,px),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,i,s,u,f,m){const y=this.layers[0].layout,x=y.get("line-join").evaluate(t,{}),w=y.get("line-cap").evaluate(t,{}),M=y.get("line-miter-limit"),L=y.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const O of i)this.addLine(O,t,x,w,M,L);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,f,m,u)}addLine(t,i,s,u,f,m){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let at=0;at<t.length-1;at++)this.totalDistance+=t[at].dist(t[at+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const y=mx[i.type]==="Polygon";let x=t.length;for(;x>=2&&t[x-1].equals(t[x-2]);)x--;let w=0;for(;w<x-1&&t[w].equals(t[w+1]);)w++;if(x<(y?3:2))return;s==="bevel"&&(f=1.05);const M=this.overscaling<=16?15*ir/(512*this.overscaling):0,L=this.segments.prepareSegment(10*x,this.layoutVertexArray,this.indexArray);let O,B,F,q,K;this.e1=this.e2=-1,y&&(O=t[x-2],K=t[w].sub(O)._unit()._perp());for(let at=w;at<x;at++){if(F=at===x-1?y?t[w+1]:void 0:t[at+1],F&&t[at].equals(F))continue;K&&(q=K),O&&(B=O),O=t[at],K=F?F.sub(O)._unit()._perp():q,q=q||K;let mt=q.add(K);mt.x===0&&mt.y===0||mt._unit();const lt=q.x*K.x+q.y*K.y,dt=mt.x*K.x+mt.y*K.y,vt=dt!==0?1/dt:1/0,_t=2*Math.sqrt(2-2*dt),Wt=dt<gx&&B&&F,Gt=q.x*K.y-q.y*K.x>0;if(Wt&&at>w){const te=O.dist(B);if(te>2*M){const ce=O.sub(O.sub(B)._mult(M/te)._round());this.updateDistance(B,ce),this.addCurrentVertex(ce,q,0,0,L),B=ce}}const oe=B&&F;let ve=oe?s:y?"butt":u;if(oe&&ve==="round"&&(vt<m?ve="miter":vt<=2&&(ve="fakeround")),ve==="miter"&&vt>f&&(ve="bevel"),ve==="bevel"&&(vt>2&&(ve="flipbevel"),vt<f&&(ve="miter")),B&&this.updateDistance(B,O),ve==="miter")mt._mult(vt),this.addCurrentVertex(O,mt,0,0,L);else if(ve==="flipbevel"){if(vt>100)mt=K.mult(-1);else{const te=vt*q.add(K).mag()/q.sub(K).mag();mt._perp()._mult(te*(Gt?-1:1))}this.addCurrentVertex(O,mt,0,0,L),this.addCurrentVertex(O,mt.mult(-1),0,0,L)}else if(ve==="bevel"||ve==="fakeround"){const te=-Math.sqrt(vt*vt-1),ce=Gt?te:0,he=Gt?0:te;if(B&&this.addCurrentVertex(O,q,ce,he,L),ve==="fakeround"){const me=Math.round(180*_t/Math.PI/20);for(let Te=1;Te<me;Te++){let ne=Te/me;if(ne!==.5){const Xe=ne-.5;ne+=ne*Xe*(ne-1)*((1.0904+lt*(lt*(3.55645-1.43519*lt)-3.2452))*Xe*Xe+(.848013+lt*(.215638*lt-1.06021)))}const Be=K.sub(q)._mult(ne)._add(q)._unit()._mult(Gt?-1:1);this.addHalfVertex(O,Be.x,Be.y,!1,Gt,0,L)}}F&&this.addCurrentVertex(O,K,-ce,-he,L)}else if(ve==="butt")this.addCurrentVertex(O,mt,0,0,L);else if(ve==="square"){const te=B?1:-1;B||this.addCurrentVertex(O,mt,te,te,L),this.addCurrentVertex(O,mt,0,0,L),B&&this.addCurrentVertex(O,mt,te,te,L)}else ve==="round"&&(B&&(this.addCurrentVertex(O,q,0,0,L),this.addCurrentVertex(O,q,1,1,L,!0)),F&&(this.addCurrentVertex(O,K,-1,-1,L,!0),this.addCurrentVertex(O,K,0,0,L)));if(Wt&&at<x-1){const te=O.dist(F);if(te>2*M){const ce=O.add(F.sub(O)._mult(M/te)._round());this.updateDistance(O,ce),this.addCurrentVertex(ce,K,0,0,L),O=ce}}}}addCurrentVertex(t,i,s,u,f,m=!1){const y=i.y*u-i.x,x=-i.y-i.x*u;this.addHalfVertex(t,i.x+i.y*s,i.y-i.x*s,m,!1,s,f),this.addHalfVertex(t,y,x,m,!0,-u,f)}addHalfVertex({x:t,y:i},s,u,f,m,y,x){this.layoutVertexArray.emplaceBack((t<<1)+(f?1:0),(i<<1)+(m?1:0),Math.round(63*s)+128,Math.round(63*u)+128,1+(y===0?0:y<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const w=x.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,w),x.primitiveLength++),m?this.e2=w:this.e1=w}updateScaledDistance(){if(this.lineClips){const t=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=t*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(t,i){this.distance+=t.dist(i),this.updateScaledDistance()}}De(Ph,"LineBucket",{omit:["layers","patternFeatures"]});const _x=new pt({"line-cap":new Q(ie.layout_line["line-cap"]),"line-join":new Q(ie.layout_line["line-join"]),"line-miter-limit":new j(ie.layout_line["line-miter-limit"]),"line-round-limit":new j(ie.layout_line["line-round-limit"]),"line-sort-key":new Q(ie.layout_line["line-sort-key"])});var Gm={paint:new pt({"line-opacity":new Q(ie.paint_line["line-opacity"]),"line-color":new Q(ie.paint_line["line-color"]),"line-translate":new j(ie.paint_line["line-translate"]),"line-translate-anchor":new j(ie.paint_line["line-translate-anchor"]),"line-width":new Q(ie.paint_line["line-width"]),"line-gap-width":new Q(ie.paint_line["line-gap-width"]),"line-offset":new Q(ie.paint_line["line-offset"]),"line-blur":new Q(ie.paint_line["line-blur"]),"line-dasharray":new Q(ie.paint_line["line-dasharray"]),"line-pattern":new Q(ie.paint_line["line-pattern"]),"line-gradient":new ct(ie.paint_line["line-gradient"]),"line-trim-offset":new j(ie.paint_line["line-trim-offset"])}),layout:_x};const jm=new class extends Q{possiblyEvaluate(e,t){return t=new P(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,transition:t.transition}),super.possiblyEvaluate(e,t)}evaluate(e,t,i,s){return t=ur({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(e,t,i,s)}}(Gm.paint.properties["line-width"].specification);function qm(e,t){return t>0?t+2*e:e}jm.useIntegerZoom=!0;const yx=Nt([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),vx=Nt([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),xx=Nt([{name:"a_projected_pos",components:4,type:"Float32"}],4);Nt([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const bx=Nt([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),wx=Nt([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Nt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const $m=Nt([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Ex=Nt([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Nt([{name:"triangle",components:3,type:"Uint16"}]),Nt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Nt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Nt([{type:"Float32",name:"offsetX"}]),Nt([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var vo=24;const Ma=128;function nf(e,t){const{expression:i}=t;if(i.kind==="constant")return{kind:"constant",layoutSize:i.evaluate(new P(e+1))};if(i.kind==="source")return{kind:"source"};{const{zoomStops:s,interpolationType:u}=i;let f=0;for(;f<s.length&&s[f]<=e;)f++;f=Math.max(0,f-1);let m=f;for(;m<s.length&&s[m]<e+1;)m++;m=Math.min(s.length-1,m);const y=s[f],x=s[m];return i.kind==="composite"?{kind:"composite",minZoom:y,maxZoom:x,interpolationType:u}:{kind:"camera",minZoom:y,maxZoom:x,minSize:i.evaluate(new P(y)),maxSize:i.evaluate(new P(x)),interpolationType:u}}}function Lh(e,{uSize:t,uSizeT:i},{lowerSize:s,upperSize:u}){return e.kind==="source"?s/Ma:e.kind==="composite"?Mr(s/Ma,u/Ma,i):t}function xu(e,t){let i=0,s=0;if(e.kind==="constant")s=e.layoutSize;else if(e.kind!=="source"){const{interpolationType:u,minZoom:f,maxZoom:m}=e,y=u?Ye(_n.interpolationFactor(u,t,f,m),0,1):0;e.kind==="camera"?s=Mr(e.minSize,e.maxSize,y):i=y}return{uSizeT:i,uSize:s}}var Tx=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Ma,evaluateSizeForFeature:Lh,evaluateSizeForZoom:xu,getSizeData:nf});function Ix(e,t,i){return e.sections.forEach(s=>{s.text=function(u,f,m){const y=f.layout.get("text-transform").evaluate(m,{});return y==="uppercase"?u=u.toLocaleUpperCase():y==="lowercase"&&(u=u.toLocaleLowerCase()),S.applyArabicShaping&&(u=S.applyArabicShaping(u)),u}(s.text,t,i)}),e}const Ic={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂","←":"↑","→":"↓"};function Sx(e){return e==="︶"||e==="﹈"||e==="︸"||e==="﹄"||e==="﹂"||e==="︾"||e==="︼"||e==="︺"||e==="︘"||e==="﹀"||e==="︐"||e==="︓"||e==="︔"||e==="｀"||e==="￣"||e==="︑"||e==="︒"}function Cx(e){return e==="︵"||e==="﹇"||e==="︷"||e==="﹃"||e==="﹁"||e==="︽"||e==="︻"||e==="︹"||e==="︗"||e==="︿"}var Xm=Fi,Zm=function(e,t,i,s,u){var f,m,y=8*u-s-1,x=(1<<y)-1,w=x>>1,M=-7,L=u-1,O=-1,B=e[t+L];for(L+=O,f=B&(1<<-M)-1,B>>=-M,M+=y;M>0;f=256*f+e[t+L],L+=O,M-=8);for(m=f&(1<<-M)-1,f>>=-M,M+=s;M>0;m=256*m+e[t+L],L+=O,M-=8);if(f===0)f=1-w;else{if(f===x)return m?NaN:1/0*(B?-1:1);m+=Math.pow(2,s),f-=w}return(B?-1:1)*m*Math.pow(2,f-s)},Wm=function(e,t,i,s,u,f){var m,y,x,w=8*f-u-1,M=(1<<w)-1,L=M>>1,O=u===23?Math.pow(2,-24)-Math.pow(2,-77):0,B=0,F=1,q=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(y=isNaN(t)?1:0,m=M):(m=Math.floor(Math.log(t)/Math.LN2),t*(x=Math.pow(2,-m))<1&&(m--,x*=2),(t+=m+L>=1?O/x:O*Math.pow(2,1-L))*x>=2&&(m++,x/=2),m+L>=M?(y=0,m=M):m+L>=1?(y=(t*x-1)*Math.pow(2,u),m+=L):(y=t*Math.pow(2,L-1)*Math.pow(2,u),m=0));u>=8;e[i+B]=255&y,B+=F,y/=256,u-=8);for(m=m<<u|y,w+=u;w>0;e[i+B]=255&m,B+=F,m/=256,w-=8);e[i+B-F]|=128*q};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function Fi(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}Fi.Varint=0,Fi.Fixed64=1,Fi.Bytes=2,Fi.Fixed32=5;var of=4294967296,Ym=1/of,Hm=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function fl(e){return e.type===Fi.Bytes?e.readVarint()+e.pos:e.pos+1}function bu(e,t,i){return i?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function Km(e,t,i){var s=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));i.realloc(s);for(var u=i.pos-1;u>=e;u--)i.buf[u+s]=i.buf[u]}function Mx(e,t){for(var i=0;i<e.length;i++)t.writeVarint(e[i])}function Ax(e,t){for(var i=0;i<e.length;i++)t.writeSVarint(e[i])}function Px(e,t){for(var i=0;i<e.length;i++)t.writeFloat(e[i])}function Lx(e,t){for(var i=0;i<e.length;i++)t.writeDouble(e[i])}function Dx(e,t){for(var i=0;i<e.length;i++)t.writeBoolean(e[i])}function Rx(e,t){for(var i=0;i<e.length;i++)t.writeFixed32(e[i])}function Ox(e,t){for(var i=0;i<e.length;i++)t.writeSFixed32(e[i])}function Nx(e,t){for(var i=0;i<e.length;i++)t.writeFixed64(e[i])}function zx(e,t){for(var i=0;i<e.length;i++)t.writeSFixed64(e[i])}function Dh(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function wu(e,t,i){e[i]=t,e[i+1]=t>>>8,e[i+2]=t>>>16,e[i+3]=t>>>24}function Jm(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}Fi.prototype={destroy:function(){this.buf=null},readFields:function(e,t,i){for(i=i||this.length;this.pos<i;){var s=this.readVarint(),u=s>>3,f=this.pos;this.type=7&s,e(u,t,this),this.pos===f&&this.skip(s)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=Dh(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=Jm(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=Dh(this.buf,this.pos)+Dh(this.buf,this.pos+4)*of;return this.pos+=8,e},readSFixed64:function(){var e=Dh(this.buf,this.pos)+Jm(this.buf,this.pos+4)*of;return this.pos+=8,e},readFloat:function(){var e=Zm(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=Zm(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,i,s=this.buf;return t=127&(i=s[this.pos++]),i<128?t:(t|=(127&(i=s[this.pos++]))<<7,i<128?t:(t|=(127&(i=s[this.pos++]))<<14,i<128?t:(t|=(127&(i=s[this.pos++]))<<21,i<128?t:function(u,f,m){var y,x,w=m.buf;if(y=(112&(x=w[m.pos++]))>>4,x<128||(y|=(127&(x=w[m.pos++]))<<3,x<128)||(y|=(127&(x=w[m.pos++]))<<10,x<128)||(y|=(127&(x=w[m.pos++]))<<17,x<128)||(y|=(127&(x=w[m.pos++]))<<24,x<128)||(y|=(1&(x=w[m.pos++]))<<31,x<128))return bu(u,y,f);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(i=s[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=12&&Hm?function(i,s,u){return Hm.decode(i.subarray(s,u))}(this.buf,t,e):function(i,s,u){for(var f="",m=s;m<u;){var y,x,w,M=i[m],L=null,O=M>239?4:M>223?3:M>191?2:1;if(m+O>u)break;O===1?M<128&&(L=M):O===2?(192&(y=i[m+1]))==128&&(L=(31&M)<<6|63&y)<=127&&(L=null):O===3?(x=i[m+2],(192&(y=i[m+1]))==128&&(192&x)==128&&((L=(15&M)<<12|(63&y)<<6|63&x)<=2047||L>=55296&&L<=57343)&&(L=null)):O===4&&(x=i[m+2],w=i[m+3],(192&(y=i[m+1]))==128&&(192&x)==128&&(192&w)==128&&((L=(15&M)<<18|(63&y)<<12|(63&x)<<6|63&w)<=65535||L>=1114112)&&(L=null)),L===null?(L=65533,O=1):L>65535&&(L-=65536,f+=String.fromCharCode(L>>>10&1023|55296),L=56320|1023&L),f+=String.fromCharCode(L),m+=O}return f}(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==Fi.Bytes)return e.push(this.readVarint(t));var i=fl(this);for(e=e||[];this.pos<i;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==Fi.Bytes)return e.push(this.readSVarint());var t=fl(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==Fi.Bytes)return e.push(this.readBoolean());var t=fl(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==Fi.Bytes)return e.push(this.readFloat());var t=fl(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==Fi.Bytes)return e.push(this.readDouble());var t=fl(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==Fi.Bytes)return e.push(this.readFixed32());var t=fl(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==Fi.Bytes)return e.push(this.readSFixed32());var t=fl(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==Fi.Bytes)return e.push(this.readFixed64());var t=fl(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==Fi.Bytes)return e.push(this.readSFixed64());var t=fl(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===Fi.Varint)for(;this.buf[this.pos++]>127;);else if(t===Fi.Bytes)this.pos=this.readVarint()+this.pos;else if(t===Fi.Fixed32)this.pos+=4;else{if(t!==Fi.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var i=new Uint8Array(t);i.set(this.buf),this.buf=i,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),wu(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),wu(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),wu(this.buf,-1&e,this.pos),wu(this.buf,Math.floor(e*Ym),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),wu(this.buf,-1&e,this.pos),wu(this.buf,Math.floor(e*Ym),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(t,i){var s,u;if(t>=0?(s=t%4294967296|0,u=t/4294967296|0):(u=~(-t/4294967296),4294967295^(s=~(-t%4294967296))?s=s+1|0:(s=0,u=u+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),function(f,m,y){y.buf[y.pos++]=127&f|128,f>>>=7,y.buf[y.pos++]=127&f|128,f>>>=7,y.buf[y.pos++]=127&f|128,f>>>=7,y.buf[y.pos++]=127&f|128,y.buf[y.pos]=127&(f>>>=7)}(s,0,i),function(f,m){var y=(7&f)<<4;m.buf[m.pos++]|=y|((f>>>=3)?128:0),f&&(m.buf[m.pos++]=127&f|((f>>>=7)?128:0),f&&(m.buf[m.pos++]=127&f|((f>>>=7)?128:0),f&&(m.buf[m.pos++]=127&f|((f>>>=7)?128:0),f&&(m.buf[m.pos++]=127&f|((f>>>=7)?128:0),f&&(m.buf[m.pos++]=127&f)))))}(u,i)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(!!e)},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function(s,u,f){for(var m,y,x=0;x<u.length;x++){if((m=u.charCodeAt(x))>55295&&m<57344){if(!y){m>56319||x+1===u.length?(s[f++]=239,s[f++]=191,s[f++]=189):y=m;continue}if(m<56320){s[f++]=239,s[f++]=191,s[f++]=189,y=m;continue}m=y-55296<<10|m-56320|65536,y=null}else y&&(s[f++]=239,s[f++]=191,s[f++]=189,y=null);m<128?s[f++]=m:(m<2048?s[f++]=m>>6|192:(m<65536?s[f++]=m>>12|224:(s[f++]=m>>18|240,s[f++]=m>>12&63|128),s[f++]=m>>6&63|128),s[f++]=63&m|128)}return f}(this.buf,e,this.pos);var i=this.pos-t;i>=128&&Km(t,i,this),this.pos=t-1,this.writeVarint(i),this.pos+=i},writeFloat:function(e){this.realloc(4),Wm(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),Wm(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var i=0;i<t;i++)this.buf[this.pos++]=e[i]},writeRawMessage:function(e,t){this.pos++;var i=this.pos;e(t,this);var s=this.pos-i;s>=128&&Km(i,s,this),this.pos=i-1,this.writeVarint(s),this.pos+=s},writeMessage:function(e,t,i){this.writeTag(e,Fi.Bytes),this.writeRawMessage(t,i)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,Mx,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,Ax,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,Dx,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,Px,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,Lx,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,Rx,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,Ox,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,Nx,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,zx,t)},writeBytesField:function(e,t){this.writeTag(e,Fi.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,Fi.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,Fi.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,Fi.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,Fi.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,Fi.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,Fi.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,Fi.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,Fi.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,Fi.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,!!t)}};var Rh=gt(Xm);const sf=3;function kx(e,t,i){t.glyphs=[],e===1&&i.readMessage(Bx,t)}function Bx(e,t,i){if(e===3){const{id:s,bitmap:u,width:f,height:m,left:y,top:x,advance:w}=i.readMessage(Fx,{});t.glyphs.push({id:s,bitmap:new pl({width:f+2*sf,height:m+2*sf},u),metrics:{width:f,height:m,left:y,top:x,advance:w}})}else e===4?t.ascender=i.readSVarint():e===5&&(t.descender=i.readSVarint())}function Fx(e,t,i){e===1?t.id=i.readVarint():e===2?t.bitmap=i.readBytes():e===3?t.width=i.readVarint():e===4?t.height=i.readVarint():e===5?t.left=i.readSVarint():e===6?t.top=i.readSVarint():e===7&&(t.advance=i.readVarint())}const Qm=sf;function af(e){let t=0,i=0;for(const m of e)t+=m.w*m.h,i=Math.max(i,m.w);e.sort((m,y)=>y.h-m.h);const s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),i),h:1/0}];let u=0,f=0;for(const m of e)for(let y=s.length-1;y>=0;y--){const x=s[y];if(!(m.w>x.w||m.h>x.h)){if(m.x=x.x,m.y=x.y,f=Math.max(f,m.y+m.h),u=Math.max(u,m.x+m.w),m.w===x.w&&m.h===x.h){const w=s.pop();y<s.length&&(s[y]=w)}else m.h===x.h?(x.x+=m.w,x.w-=m.w):m.w===x.w?(x.y+=m.h,x.h-=m.h):(s.push({x:x.x+m.w,y:x.y,w:x.w-m.w,h:m.h}),x.y+=m.h,x.h-=m.h);break}}return{w:u,h:f,fill:t/(u*f)||0}}const xs=1;class lf{constructor(t,{pixelRatio:i,version:s,stretchX:u,stretchY:f,content:m}){this.paddedRect=t,this.pixelRatio=i,this.stretchX=u,this.stretchY=f,this.content=m,this.version=s}get tl(){return[this.paddedRect.x+xs,this.paddedRect.y+xs]}get br(){return[this.paddedRect.x+this.paddedRect.w-xs,this.paddedRect.y+this.paddedRect.h-xs]}get displaySize(){return[(this.paddedRect.w-2*xs)/this.pixelRatio,(this.paddedRect.h-2*xs)/this.pixelRatio]}}class tg{constructor(t,i){const s={},u={};this.haveRenderCallbacks=[];const f=[];this.addImages(t,s,f),this.addImages(i,u,f);const{w:m,h:y}=af(f),x=new Rs({width:m||1,height:y||1});for(const w in t){const M=t[w],L=s[w].paddedRect;Rs.copy(M.data,x,{x:0,y:0},{x:L.x+xs,y:L.y+xs},M.data)}for(const w in i){const M=i[w],L=u[w].paddedRect,O=L.x+xs,B=L.y+xs,F=M.data.width,q=M.data.height;Rs.copy(M.data,x,{x:0,y:0},{x:O,y:B},M.data),Rs.copy(M.data,x,{x:0,y:q-1},{x:O,y:B-1},{width:F,height:1}),Rs.copy(M.data,x,{x:0,y:0},{x:O,y:B+q},{width:F,height:1}),Rs.copy(M.data,x,{x:F-1,y:0},{x:O-1,y:B},{width:1,height:q}),Rs.copy(M.data,x,{x:0,y:0},{x:O+F,y:B},{width:1,height:q})}this.image=x,this.iconPositions=s,this.patternPositions=u}addImages(t,i,s){for(const u in t){const f=t[u],m={x:0,y:0,w:f.data.width+2*xs,h:f.data.height+2*xs};s.push(m),i[u]=new lf(m,f),f.hasRenderCallback&&this.haveRenderCallbacks.push(u)}}patchUpdatedImages(t,i){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(s=>t.hasImage(s)),t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const s in t.updatedImages)this.patchUpdatedImage(this.iconPositions[s],t.getImage(s),i),this.patchUpdatedImage(this.patternPositions[s],t.getImage(s),i)}patchUpdatedImage(t,i,s){if(!t||!i||t.version===i.version)return;t.version=i.version;const[u,f]=t.tl;s.update(i.data,void 0,{x:u,y:f})}}De(lf,"ImagePosition"),De(tg,"ImageAtlas");const Ws={horizontal:1,vertical:2,horizontalOnly:3},eg=-17;class Sc{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,i){const s=new Sc;return s.scale=t||1,s.fontStack=i,s}static forImage(t){const i=new Sc;return i.imageName=t,i}}class Eu{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,i){const s=new Eu;for(let u=0;u<t.sections.length;u++){const f=t.sections[u];f.image?s.addImageSection(f):s.addTextSection(f,i)}return s}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSections(){return this.sections}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(t){this.text=function(i,s){let u="";for(let f=0;f<i.length;f++){const m=i.charCodeAt(f+1)||null,y=i.charCodeAt(f-1)||null;u+=!s&&(m&&lh(m)&&!Ic[i[f+1]]||y&&lh(y)&&!Ic[i[f-1]])||!Ic[i[f]]?i[f]:Ic[i[f]]}return u}(this.text,t)}trim(){let t=0;for(let s=0;s<this.text.length&&Oh[this.text.charCodeAt(s)];s++)t++;let i=this.text.length;for(let s=this.text.length-1;s>=0&&s>=t&&Oh[this.text.charCodeAt(s)];s--)i--;this.text=this.text.substring(t,i),this.sectionIndex=this.sectionIndex.slice(t,i)}substring(t,i){const s=new Eu;return s.text=this.text.substring(t,i),s.sectionIndex=this.sectionIndex.slice(t,i),s.sections=this.sections,s}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,i)=>Math.max(t,this.sections[i].scale),0)}addTextSection(t,i){this.text+=t.text,this.sections.push(Sc.forText(t.scale,t.fontStack||i));const s=this.sections.length-1;for(let u=0;u<t.text.length;++u)this.sectionIndex.push(s)}addImageSection(t){const i=t.image?t.image.name:"";if(i.length===0)return void Dr("Can't add FormattedSection with an empty image.");const s=this.getNextImageSectionCharCode();s?(this.text+=String.fromCharCode(s),this.sections.push(Sc.forImage(i)),this.sectionIndex.push(this.sections.length-1)):Dr("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function uf(e,t,i,s,u,f,m,y,x,w,M,L,O,B,F){const q=Eu.fromFeature(e,u);L===Ws.vertical&&q.verticalizePunctuation(O);let K=[];const at=function(_t,Wt,Gt,oe,ve,te){if(!_t)return[];const ce=[],he=function(Be,Xe,Fe,yr,Ce,er){let vr=0;for(let Qr=0;Qr<Be.length();Qr++){const xr=Be.getSection(Qr);vr+=rg(Be.getCharCode(Qr),xr,yr,Ce,Xe,er)}return vr/Math.max(1,Math.ceil(vr/Fe))}(_t,Wt,Gt,oe,ve,te),me=_t.text.indexOf("​")>=0;let Te=0;for(let Be=0;Be<_t.length();Be++){const Xe=_t.getSection(Be),Fe=_t.getCharCode(Be);if(Oh[Fe]||(Te+=rg(Fe,Xe,oe,ve,Wt,te)),Be<_t.length()-1){const yr=!((ne=Fe)<11904||!(Ue["Bopomofo Extended"](ne)||Ue.Bopomofo(ne)||Ue["CJK Compatibility Forms"](ne)||Ue["CJK Compatibility Ideographs"](ne)||Ue["CJK Compatibility"](ne)||Ue["CJK Radicals Supplement"](ne)||Ue["CJK Strokes"](ne)||Ue["CJK Symbols and Punctuation"](ne)||Ue["CJK Unified Ideographs Extension A"](ne)||Ue["CJK Unified Ideographs"](ne)||Ue["Enclosed CJK Letters and Months"](ne)||Ue["Halfwidth and Fullwidth Forms"](ne)||Ue.Hiragana(ne)||Ue["Ideographic Description Characters"](ne)||Ue["Kangxi Radicals"](ne)||Ue["Katakana Phonetic Extensions"](ne)||Ue.Katakana(ne)||Ue["Vertical Forms"](ne)||Ue["Yi Radicals"](ne)||Ue["Yi Syllables"](ne)));(Ux[Fe]||yr||Xe.imageName)&&ce.push(ng(Be+1,Te,he,ce,Vx(Fe,_t.getCharCode(Be+1),yr&&me),!1))}}var ne;return og(ng(_t.length(),Te,he,ce,0,!0))}(q,w,f,t,s,B),{processBidirectionalText:mt,processStyledBidirectionalText:lt}=S;if(mt&&q.sections.length===1){const _t=mt(q.toString(),at);for(const Wt of _t){const Gt=new Eu;Gt.text=Wt,Gt.sections=q.sections;for(let oe=0;oe<Wt.length;oe++)Gt.sectionIndex.push(0);K.push(Gt)}}else if(lt){const _t=lt(q.text,q.sectionIndex,at);for(const Wt of _t){const Gt=new Eu;Gt.text=Wt[0],Gt.sectionIndex=Wt[1],Gt.sections=q.sections,K.push(Gt)}}else K=function(_t,Wt){const Gt=[],oe=_t.text;let ve=0;for(const te of Wt)Gt.push(_t.substring(ve,te)),ve=te;return ve<oe.length&&Gt.push(_t.substring(ve,oe.length)),Gt}(q,at);const dt=[],vt={positionedLines:dt,text:q.toString(),top:M[1],bottom:M[1],left:M[0],right:M[0],writingMode:L,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(_t,Wt,Gt,oe,ve,te,ce,he,me,Te,ne,Be){let Xe=0,Fe=0,yr=0;const Ce=he==="right"?1:he==="left"?0:.5;let er=!1;for(const wr of ve){const Er=wr.getSections();for(const Mi of Er){if(Mi.imageName)continue;const Ui=Wt[Mi.fontStack];if(Ui&&(er=Ui.ascender!==void 0&&Ui.descender!==void 0,!er))break}if(!er)break}let vr=0;for(const wr of ve){wr.trim();const Er=wr.getMaxScale(),Mi=(Er-1)*vo,Ui={positionedGlyphs:[],lineOffset:0};_t.positionedLines[vr]=Ui;const Vi=Ui.positionedGlyphs;let Ai=0;if(!wr.length()){Fe+=te,++vr;continue}let on=0,En=0;for(let Pi=0;Pi<wr.length();Pi++){const Xn=wr.getSection(Pi),Bn=wr.getSectionIndex(Pi),fn=wr.getCharCode(Pi);let ri=Xn.scale,Fn=null,Gi=null,ls=null,Un=vo,xo=0;const ao=!(me===Ws.horizontal||!ne&&!Qu(fn)||ne&&(Oh[fn]||(Qr=fn,Ue.Arabic(Qr)||Ue["Arabic Supplement"](Qr)||Ue["Arabic Extended-A"](Qr)||Ue["Arabic Presentation Forms-A"](Qr)||Ue["Arabic Presentation Forms-B"](Qr))));if(Xn.imageName){const us=oe[Xn.imageName];if(!us)continue;ls=Xn.imageName,_t.iconsInText=_t.iconsInText||!0,Gi=us.paddedRect;const lo=us.displaySize;ri=ri*vo/Be,Fn={width:lo[0],height:lo[1],left:xs,top:-Qm,advance:ao?lo[1]:lo[0],localGlyph:!1},xo=er?-Fn.height*ri:eg+Er*vo-lo[1]*ri,Un=Fn.advance;const La=(ao?lo[0]:lo[1])*ri-vo*Er;La>0&&La>Ai&&(Ai=La)}else{const us=Gt[Xn.fontStack];if(!us)continue;us[fn]&&(Gi=us[fn]);const lo=Wt[Xn.fontStack];if(!lo)continue;const La=lo.glyphs[fn];if(!La)continue;if(Fn=La.metrics,Un=fn!==8203?vo:0,er){const Pu=lo.ascender!==void 0?Math.abs(lo.ascender):0,zc=lo.descender!==void 0?Math.abs(lo.descender):0,kc=(Pu+zc)*ri;on<kc&&(on=kc,En=(Pu-zc)/2*ri),xo=-Pu*ri}else xo=eg+(Er-ri)*vo}ao?(_t.verticalizable=!0,Vi.push({glyph:fn,imageName:ls,x:Xe,y:Fe+xo,vertical:ao,scale:ri,localGlyph:Fn.localGlyph,fontStack:Xn.fontStack,sectionIndex:Bn,metrics:Fn,rect:Gi}),Xe+=Un*ri+Te):(Vi.push({glyph:fn,imageName:ls,x:Xe,y:Fe+xo,vertical:ao,scale:ri,localGlyph:Fn.localGlyph,fontStack:Xn.fontStack,sectionIndex:Bn,metrics:Fn,rect:Gi}),Xe+=Fn.advance*ri+Te)}Vi.length!==0&&(yr=Math.max(Xe-Te,yr),er?sg(Vi,Ce,Ai,En,te*Er/2):sg(Vi,Ce,Ai,0,te/2)),Xe=0;const kn=te*Er+Ai;Ui.lineOffset=Math.max(Ai,Mi),Fe+=kn,++vr}var Qr;const xr=Fe,{horizontalAlign:ar,verticalAlign:$i}=cf(ce);(function(wr,Er,Mi,Ui,Vi,Ai){const on=(Er-Mi)*Vi,En=-Ai*Ui;for(const kn of wr)for(const Pi of kn.positionedGlyphs)Pi.x+=on,Pi.y+=En})(_t.positionedLines,Ce,ar,$i,yr,xr),_t.top+=-$i*xr,_t.bottom=_t.top+xr,_t.left+=-ar*yr,_t.right=_t.left+yr,_t.hasBaseline=er}(vt,t,i,s,K,m,y,x,L,w,O,F),!function(_t){for(const Wt of _t)if(Wt.positionedGlyphs.length!==0)return!1;return!0}(dt)&&vt}const Oh={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Ux={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function rg(e,t,i,s,u,f){if(t.imageName){const m=s[t.imageName];return m?m.displaySize[0]*t.scale*vo/f+u:0}{const m=i[t.fontStack],y=m&&m.glyphs[e];return y?y.metrics.advance*t.scale+u:0}}function ig(e,t,i,s){const u=Math.pow(e-t,2);return s?e<t?u/2:2*u:u+Math.abs(i)*i}function Vx(e,t,i){let s=0;return e===10&&(s-=1e4),i&&(s+=150),e!==40&&e!==65288||(s+=50),t!==41&&t!==65289||(s+=50),s}function ng(e,t,i,s,u,f){let m=null,y=ig(t,i,u,f);for(const x of s){const w=ig(t-x.x,i,u,f)+x.badness;w<=y&&(m=x,y=w)}return{index:e,x:t,priorBreak:m,badness:y}}function og(e){return e?og(e.priorBreak).concat(e.index):[]}function cf(e){let t=.5,i=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(e){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:t,verticalAlign:i}}function sg(e,t,i,s,u){if(!(t||i||s||u))return;const f=e.length-1,m=e[f],y=(m.x+m.metrics.advance*m.scale)*t;for(let x=0;x<=f;x++)e[x].x-=y,e[x].y+=i+s+u}function Gx(e,t,i){const{horizontalAlign:s,verticalAlign:u}=cf(i),f=t[0]-e.displaySize[0]*s,m=t[1]-e.displaySize[1]*u;return{image:e,top:m,bottom:m+e.displaySize[1],left:f,right:f+e.displaySize[0]}}function ag(e,t,i,s,u,f){const m=e.image;let y;if(m.content){const K=m.content,at=m.pixelRatio||1;y=[K[0]/at,K[1]/at,m.displaySize[0]-K[2]/at,m.displaySize[1]-K[3]/at]}const x=t.left*f,w=t.right*f;let M,L,O,B;i==="width"||i==="both"?(B=u[0]+x-s[3],L=u[0]+w+s[1]):(B=u[0]+(x+w-m.displaySize[0])/2,L=B+m.displaySize[0]);const F=t.top*f,q=t.bottom*f;return i==="height"||i==="both"?(M=u[1]+F-s[0],O=u[1]+q+s[2]):(M=u[1]+(F+q-m.displaySize[1])/2,O=M+m.displaySize[1]),{image:m,top:M,right:L,bottom:O,left:B,collisionPadding:y}}class dl extends $t{constructor(t,i,s,u,f){super(t,i),this.angle=u,this.z=s,f!==void 0&&(this.segment=f)}clone(){return new dl(this.x,this.y,this.z,this.angle,this.segment)}}function lg(e,t,i,s,u){if(t.segment===void 0)return!0;let f=t,m=t.segment+1,y=0;for(;y>-i/2;){if(m--,m<0)return!1;y-=e[m].dist(f),f=e[m]}y+=e[m].dist(e[m+1]),m++;const x=[];let w=0;for(;y<i/2;){const M=e[m],L=e[m+1];if(!L)return!1;let O=e[m-1].angleTo(M)-M.angleTo(L);for(O=Math.abs((O+3*Math.PI)%(2*Math.PI)-Math.PI),x.push({distance:y,angleDelta:O}),w+=O;y-x[0].distance>s;)w-=x.shift().angleDelta;if(w>u)return!1;m++,y+=M.dist(L)}return!0}function ug(e){let t=0;for(let i=0;i<e.length-1;i++)t+=e[i].dist(e[i+1]);return t}function cg(e,t,i){return e?.6*t*i:0}function hg(e,t){return Math.max(e?e.right-e.left:0,t?t.right-t.left:0)}function jx(e,t,i,s,u,f){const m=cg(i,u,f),y=hg(i,s)*f;let x=0;const w=ug(e)/2;for(let M=0;M<e.length-1;M++){const L=e[M],O=e[M+1],B=L.dist(O);if(x+B>w){const F=(w-x)/B,q=Mr(L.x,O.x,F),K=Mr(L.y,O.y,F),at=new dl(q,K,0,O.angleTo(L),M);return!m||lg(e,at,y,m,t)?at:void 0}x+=B}}function qx(e,t,i,s,u,f,m,y,x){const w=cg(s,f,m),M=hg(s,u),L=M*m,O=e[0].x===0||e[0].x===x||e[0].y===0||e[0].y===x;return t-L<t/4&&(t=L+t/4),pg(e,O?t/2*y%t:(M/2+2*f)*m*y%t,t,w,i,L,O,!1,x)}function pg(e,t,i,s,u,f,m,y,x){const w=f/2,M=ug(e);let L=0,O=t-i,B=[];for(let F=0;F<e.length-1;F++){const q=e[F],K=e[F+1],at=q.dist(K),mt=K.angleTo(q);for(;O+i<L+at;){O+=i;const lt=(O-L)/at,dt=Mr(q.x,K.x,lt),vt=Mr(q.y,K.y,lt);if(dt>=0&&dt<x&&vt>=0&&vt<x&&O-w>=0&&O+w<=M){const _t=new dl(dt,vt,0,mt,F);_t._round(),s&&!lg(e,_t,f,s,u)||B.push(_t)}}L+=at}return y||B.length||m||(B=pg(e,L/2,i,s,u,f,m,!0,x)),B}function fg(e,t,i,s,u){const f=[];for(let m=0;m<e.length;m++){const y=e[m];let x;for(let w=0;w<y.length-1;w++){let M=y[w],L=y[w+1];M.x<t&&L.x<t||(M.x<t?M=new $t(t,M.y+(t-M.x)/(L.x-M.x)*(L.y-M.y))._round():L.x<t&&(L=new $t(t,M.y+(t-M.x)/(L.x-M.x)*(L.y-M.y))._round()),M.y<i&&L.y<i||(M.y<i?M=new $t(M.x+(i-M.y)/(L.y-M.y)*(L.x-M.x),i)._round():L.y<i&&(L=new $t(M.x+(i-M.y)/(L.y-M.y)*(L.x-M.x),i)._round()),M.x>=s&&L.x>=s||(M.x>=s?M=new $t(s,M.y+(s-M.x)/(L.x-M.x)*(L.y-M.y))._round():L.x>=s&&(L=new $t(s,M.y+(s-M.x)/(L.x-M.x)*(L.y-M.y))._round()),M.y>=u&&L.y>=u||(M.y>=u?M=new $t(M.x+(u-M.y)/(L.y-M.y)*(L.x-M.x),u)._round():L.y>=u&&(L=new $t(M.x+(u-M.y)/(L.y-M.y)*(L.x-M.x),u)._round()),x&&M.equals(x[x.length-1])||(x=[M],f.push(x)),x.push(L)))))}}return f}De(dl,"Anchor");const Cc=1e20;function dg(e,t,i,s,u,f,m,y,x){for(let w=t;w<t+s;w++)mg(e,i*f+w,f,u,m,y,x);for(let w=i;w<i+u;w++)mg(e,w*f+t,1,s,m,y,x)}function mg(e,t,i,s,u,f,m){f[0]=0,m[0]=-Cc,m[1]=Cc,u[0]=e[t];for(let y=1,x=0,w=0;y<s;y++){u[y]=e[t+y*i];const M=y*y;do{const L=f[x];w=(u[y]-u[L]+M-L*L)/(y-L)/2}while(w<=m[x]&&--x>-1);x++,f[x]=y,m[x]=w,m[x+1]=Cc}for(let y=0,x=0;y<s;y++){for(;m[x+1]<y;)x++;const w=f[x],M=y-w;e[t+y*i]=u[w]+M*M}}const Aa=2,hf={none:0,ideographs:1,all:2};class Tu{constructor(t,i,s){this.requestManager=t,this.localGlyphMode=i,this.localFontFamily=s,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(t){this.url=t}getGlyphs(t,i){const s=[];for(const u in t)for(const f of t[u])s.push({stack:u,id:f});tr(s,({stack:u,id:f},m)=>{let y=this.entries[u];y||(y=this.entries[u]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let x=y.glyphs[f];if(x!==void 0)return void m(null,{stack:u,id:f,glyph:x});if(x=this._tinySDF(y,u,f),x)return y.glyphs[f]=x,void m(null,{stack:u,id:f,glyph:x});const w=Math.floor(f/256);if(256*w>65535)return void m(new Error("glyphs > 65535 not supported"));if(y.ranges[w])return void m(null,{stack:u,id:f,glyph:x});let M=y.requests[w];M||(M=y.requests[w]=[],Tu.loadGlyphRange(u,w,this.url,this.requestManager,(L,O)=>{if(O){y.ascender=O.ascender,y.descender=O.descender;for(const B in O.glyphs)this._doesCharSupportLocalGlyph(+B)||(y.glyphs[+B]=O.glyphs[+B]);y.ranges[w]=!0}for(const B of M)B(L,O);delete y.requests[w]})),M.push((L,O)=>{L?m(L):O&&m(null,{stack:u,id:f,glyph:O.glyphs[f]||null})})},(u,f)=>{if(u)i(u);else if(f){const m={};for(const{stack:y,id:x,glyph:w}of f)m[y]===void 0&&(m[y]={}),m[y].glyphs===void 0&&(m[y].glyphs={}),m[y].glyphs[x]=w&&{id:w.id,bitmap:w.bitmap.clone(),metrics:w.metrics},m[y].ascender=this.entries[y].ascender,m[y].descender=this.entries[y].descender;i(null,m)}})}_doesCharSupportLocalGlyph(t){return this.localGlyphMode!==hf.none&&(this.localGlyphMode===hf.all?!!this.localFontFamily:!!this.localFontFamily&&(Ue["CJK Unified Ideographs"](t)||Ue["Hangul Syllables"](t)||Ue.Hiragana(t)||Ue.Katakana(t)||Ue["CJK Symbols and Punctuation"](t)))}_tinySDF(t,i,s){const u=this.localFontFamily;if(!u||!this._doesCharSupportLocalGlyph(s))return;let f=t.tinySDF;if(!f){let q="400";/bold/i.test(i)?q="900":/medium/i.test(i)?q="500":/light/i.test(i)&&(q="200"),f=t.tinySDF=new Tu.TinySDF({fontFamily:u,fontWeight:q,fontSize:24*Aa,buffer:3*Aa,radius:8*Aa}),f.fontWeight=q}if(this.localGlyphs[f.fontWeight][s])return this.localGlyphs[f.fontWeight][s];const m=String.fromCharCode(s),{data:y,width:x,height:w,glyphWidth:M,glyphHeight:L,glyphLeft:O,glyphTop:B,glyphAdvance:F}=f.draw(m);return this.localGlyphs[f.fontWeight][s]={id:s,bitmap:new pl({width:x,height:w},y),metrics:{width:M/Aa,height:L/Aa,left:O/Aa,top:B/Aa-27,advance:F/Aa,localGlyph:!0}}}}Tu.loadGlyphRange=function(e,t,i,s,u){const f=256*t,m=f+255,y=s.transformRequest(s.normalizeGlyphsURL(i).replace("{fontstack}",e).replace("{range}",`${f}-${m}`),Fr.Glyphs);Di(y,(x,w)=>{if(x)u(x);else if(w){const M={},L=function(O){return new Rh(O).readFields(kx,{})}(w);for(const O of L.glyphs)M[O.id]=O;u(null,{glyphs:M,ascender:L.ascender,descender:L.descender})}})},Tu.TinySDF=class{constructor({fontSize:e=24,buffer:t=3,radius:i=8,cutoff:s=.25,fontFamily:u="sans-serif",fontWeight:f="normal",fontStyle:m="normal"}={}){this.buffer=t,this.cutoff=s,this.radius=i;const y=this.size=e+4*t,x=this._createCanvas(y),w=this.ctx=x.getContext("2d",{willReadFrequently:!0});w.font=`${m} ${f} ${e}px ${u}`,w.textBaseline="alphabetic",w.textAlign="left",w.fillStyle="black",this.gridOuter=new Float64Array(y*y),this.gridInner=new Float64Array(y*y),this.f=new Float64Array(y),this.z=new Float64Array(y+1),this.v=new Uint16Array(y)}_createCanvas(e){const t=document.createElement("canvas");return t.width=t.height=e,t}draw(e){const{width:t,actualBoundingBoxAscent:i,actualBoundingBoxDescent:s,actualBoundingBoxLeft:u,actualBoundingBoxRight:f}=this.ctx.measureText(e),m=Math.ceil(i),y=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(f-u))),x=Math.min(this.size-this.buffer,m+Math.ceil(s)),w=y+2*this.buffer,M=x+2*this.buffer,L=Math.max(w*M,0),O=new Uint8ClampedArray(L),B={data:O,width:w,height:M,glyphWidth:y,glyphHeight:x,glyphTop:m,glyphLeft:0,glyphAdvance:t};if(y===0||x===0)return B;const{ctx:F,buffer:q,gridInner:K,gridOuter:at}=this;F.clearRect(q,q,y,x),F.fillText(e,q,q+m);const mt=F.getImageData(q,q,y,x);at.fill(Cc,0,L),K.fill(0,0,L);for(let lt=0;lt<x;lt++)for(let dt=0;dt<y;dt++){const vt=mt.data[4*(lt*y+dt)+3]/255;if(vt===0)continue;const _t=(lt+q)*w+dt+q;if(vt===1)at[_t]=0,K[_t]=Cc;else{const Wt=.5-vt;at[_t]=Wt>0?Wt*Wt:0,K[_t]=Wt<0?Wt*Wt:0}}dg(at,0,0,w,M,w,this.f,this.v,this.z),dg(K,q,q,y,x,w,this.f,this.v,this.z);for(let lt=0;lt<L;lt++){const dt=Math.sqrt(at[lt])-Math.sqrt(K[lt]);O[lt]=Math.round(255-255*(dt/this.radius+this.cutoff))}return B}};const Iu=xs;function gg(e,t,i,s){const u=[],f=e.image,m=f.pixelRatio,y=f.paddedRect.w-2*Iu,x=f.paddedRect.h-2*Iu,w=e.right-e.left,M=e.bottom-e.top,L=f.stretchX||[[0,y]],O=f.stretchY||[[0,x]],B=(te,ce)=>te+ce[1]-ce[0],F=L.reduce(B,0),q=O.reduce(B,0),K=y-F,at=x-q;let mt=0,lt=F,dt=0,vt=q,_t=0,Wt=K,Gt=0,oe=at;if(f.content&&s){const te=f.content;mt=Nh(L,0,te[0]),dt=Nh(O,0,te[1]),lt=Nh(L,te[0],te[2]),vt=Nh(O,te[1],te[3]),_t=te[0]-mt,Gt=te[1]-dt,Wt=te[2]-te[0]-lt,oe=te[3]-te[1]-vt}const ve=(te,ce,he,me)=>{const Te=zh(te.stretch-mt,lt,w,e.left),ne=kh(te.fixed-_t,Wt,te.stretch,F),Be=zh(ce.stretch-dt,vt,M,e.top),Xe=kh(ce.fixed-Gt,oe,ce.stretch,q),Fe=zh(he.stretch-mt,lt,w,e.left),yr=kh(he.fixed-_t,Wt,he.stretch,F),Ce=zh(me.stretch-dt,vt,M,e.top),er=kh(me.fixed-Gt,oe,me.stretch,q),vr=new $t(Te,Be),Qr=new $t(Fe,Be),xr=new $t(Fe,Ce),ar=new $t(Te,Ce),$i=new $t(ne/m,Xe/m),wr=new $t(yr/m,er/m),Er=t*Math.PI/180;if(Er){const Vi=Math.sin(Er),Ai=Math.cos(Er),on=[Ai,-Vi,Vi,Ai];vr._matMult(on),Qr._matMult(on),ar._matMult(on),xr._matMult(on)}const Mi=te.stretch+te.fixed,Ui=ce.stretch+ce.fixed;return{tl:vr,tr:Qr,bl:ar,br:xr,tex:{x:f.paddedRect.x+Iu+Mi,y:f.paddedRect.y+Iu+Ui,w:he.stretch+he.fixed-Mi,h:me.stretch+me.fixed-Ui},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:$i,pixelOffsetBR:wr,minFontScaleX:Wt/m/w,minFontScaleY:oe/m/M,isSDF:i}};if(s&&(f.stretchX||f.stretchY)){const te=_g(L,K,F),ce=_g(O,at,q);for(let he=0;he<te.length-1;he++){const me=te[he],Te=te[he+1];for(let ne=0;ne<ce.length-1;ne++)u.push(ve(me,ce[ne],Te,ce[ne+1]))}}else u.push(ve({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:y+1},{fixed:0,stretch:x+1}));return u}function Nh(e,t,i){let s=0;for(const u of e)s+=Math.max(t,Math.min(i,u[1]))-Math.max(t,Math.min(i,u[0]));return s}function _g(e,t,i){const s=[{fixed:-Iu,stretch:0}];for(const[u,f]of e){const m=s[s.length-1];s.push({fixed:u-m.stretch,stretch:m.stretch}),s.push({fixed:u-m.stretch,stretch:m.stretch+(f-u)})}return s.push({fixed:t+Iu,stretch:i}),s}function zh(e,t,i,s){return e/t*i+s}function kh(e,t,i,s){return e-t*i/s}function $x(e,t,i,s){const u=t+e.positionedLines[s].lineOffset;return s===0?i+u/2:i+(u+(t+e.positionedLines[s-1].lineOffset))/2}class Xx{constructor(t=[],i=Zx){if(this.data=t,this.length=this.data.length,this.compare=i,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const t=this.data[0],i=this.data.pop();return this.length--,this.length>0&&(this.data[0]=i,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:i,compare:s}=this,u=i[t];for(;t>0;){const f=t-1>>1,m=i[f];if(s(u,m)>=0)break;i[t]=m,t=f}i[t]=u}_down(t){const{data:i,compare:s}=this,u=this.length>>1,f=i[t];for(;t<u;){let m=1+(t<<1),y=i[m];const x=m+1;if(x<this.length&&s(i[x],y)<0&&(m=x,y=i[x]),s(y,f)>=0)break;i[t]=y,t=m}i[t]=f}}function Zx(e,t){return e<t?-1:e>t?1:0}function Wx(e,t=1,i=!1){let s=1/0,u=1/0,f=-1/0,m=-1/0;const y=e[0];for(let B=0;B<y.length;B++){const F=y[B];(!B||F.x<s)&&(s=F.x),(!B||F.y<u)&&(u=F.y),(!B||F.x>f)&&(f=F.x),(!B||F.y>m)&&(m=F.y)}const x=Math.min(f-s,m-u);let w=x/2;const M=new Xx([],Yx);if(x===0)return new $t(s,u);for(let B=s;B<f;B+=x)for(let F=u;F<m;F+=x)M.push(new Su(B+w,F+w,w,e));let L=function(B){let F=0,q=0,K=0;const at=B[0];for(let mt=0,lt=at.length,dt=lt-1;mt<lt;dt=mt++){const vt=at[mt],_t=at[dt],Wt=vt.x*_t.y-_t.x*vt.y;q+=(vt.x+_t.x)*Wt,K+=(vt.y+_t.y)*Wt,F+=3*Wt}return new Su(q/F,K/F,0,B)}(e),O=M.length;for(;M.length;){const B=M.pop();(B.d>L.d||!L.d)&&(L=B,i&&console.log("found best %d after %d probes",Math.round(1e4*B.d)/1e4,O)),B.max-L.d<=t||(w=B.h/2,M.push(new Su(B.p.x-w,B.p.y-w,w,e)),M.push(new Su(B.p.x+w,B.p.y-w,w,e)),M.push(new Su(B.p.x-w,B.p.y+w,w,e)),M.push(new Su(B.p.x+w,B.p.y+w,w,e)),O+=4)}return i&&(console.log(`num probes: ${O}`),console.log(`best distance: ${L.d}`)),L.p}function Yx(e,t){return t.max-e.max}class Su{constructor(t,i,s,u){this.p=new $t(t,i),this.h=s,this.d=function(f,m){let y=!1,x=1/0;for(let w=0;w<m.length;w++){const M=m[w];for(let L=0,O=M.length,B=O-1;L<O;B=L++){const F=M[L],q=M[B];F.y>f.y!=q.y>f.y&&f.x<(q.x-F.x)*(f.y-F.y)/(q.y-F.y)+F.x&&(y=!y),x=Math.min(x,pm(f,F,q))}}return(y?1:-1)*Math.sqrt(x)}(this.p,u),this.max=this.d+this.h*Math.SQRT2}}const Cu=7,pf=Number.POSITIVE_INFINITY,Hx=Math.sqrt(2);function yg(e,[t,i]){let s=0,u=0;if(i===pf){t<0&&(t=0);const f=t/Hx;switch(e){case"top-right":case"top-left":u=f-Cu;break;case"bottom-right":case"bottom-left":u=-f+Cu;break;case"bottom":u=-t+Cu;break;case"top":u=t-Cu}switch(e){case"top-right":case"bottom-right":s=-f;break;case"top-left":case"bottom-left":s=f;break;case"left":s=t;break;case"right":s=-t}}else{switch(t=Math.abs(t),i=Math.abs(i),e){case"top-right":case"top-left":case"top":u=i-Cu;break;case"bottom-right":case"bottom-left":case"bottom":u=-i+Cu}switch(e){case"top-right":case"bottom-right":case"right":s=-t;break;case"top-left":case"bottom-left":case"left":s=t}}return[s,u]}function Kx(e,t,i,s,u,f,m,y,x,w){e.createArrays(),e.tilePixelRatio=ir/(512*e.overscaling),e.compareText={},e.iconsNeedLinear=!1;const M=e.layers[0].layout,L=e.layers[0]._unevaluatedLayout._values,O={};if(e.textSizeData.kind==="composite"){const{minZoom:q,maxZoom:K}=e.textSizeData;O.compositeTextSizes=[L["text-size"].possiblyEvaluate(new P(q),y),L["text-size"].possiblyEvaluate(new P(K),y)]}if(e.iconSizeData.kind==="composite"){const{minZoom:q,maxZoom:K}=e.iconSizeData;O.compositeIconSizes=[L["icon-size"].possiblyEvaluate(new P(q),y),L["icon-size"].possiblyEvaluate(new P(K),y)]}O.layoutTextSize=L["text-size"].possiblyEvaluate(new P(x+1),y),O.layoutIconSize=L["icon-size"].possiblyEvaluate(new P(x+1),y),O.textMaxSize=L["text-size"].possiblyEvaluate(new P(18),y);const B=M.get("text-rotation-alignment")==="map"&&M.get("symbol-placement")!=="point",F=M.get("text-size");for(const q of e.features){const K=M.get("text-font").evaluate(q,{},y).join(","),at=F.evaluate(q,{},y),mt=O.layoutTextSize.evaluate(q,{},y),lt=(O.layoutIconSize.evaluate(q,{},y),{horizontal:{},vertical:void 0}),dt=q.text;let vt,_t=[0,0];if(dt){const oe=dt.toString(),ve=M.get("text-letter-spacing").evaluate(q,{},y)*vo,te=M.get("text-line-height").evaluate(q,{},y)*vo,ce=xp(oe)?ve:0,he=M.get("text-anchor").evaluate(q,{},y),me=M.get("text-variable-anchor");if(!me){const Fe=M.get("text-radial-offset").evaluate(q,{},y);_t=Fe?yg(he,[Fe*vo,pf]):M.get("text-offset").evaluate(q,{},y).map(yr=>yr*vo)}let Te=B?"center":M.get("text-justify").evaluate(q,{},y);const ne=M.get("symbol-placement")==="point",Be=ne?M.get("text-max-width").evaluate(q,{},y)*vo:1/0,Xe=Fe=>{e.allowVerticalPlacement&&Ju(oe)&&(lt.vertical=uf(dt,t,i,u,K,Be,te,he,Fe,ce,_t,Ws.vertical,!0,mt,at))};if(!B&&me){const Fe=Te==="auto"?me.map(Ce=>ff(Ce)):[Te];let yr=!1;for(let Ce=0;Ce<Fe.length;Ce++){const er=Fe[Ce];if(!lt.horizontal[er])if(yr)lt.horizontal[er]=lt.horizontal[0];else{const vr=uf(dt,t,i,u,K,Be,te,"center",er,ce,_t,Ws.horizontal,!1,mt,at);vr&&(lt.horizontal[er]=vr,yr=vr.positionedLines.length===1)}}Xe("left")}else{if(Te==="auto"&&(Te=ff(he)),ne||M.get("text-writing-mode").indexOf("horizontal")>=0||!Ju(oe)){const Fe=uf(dt,t,i,u,K,Be,te,he,Te,ce,_t,Ws.horizontal,!1,mt,at);Fe&&(lt.horizontal[Te]=Fe)}Xe(ne?"left":Te)}}let Wt=!1;if(q.icon&&q.icon.name){const oe=s[q.icon.name];oe&&(vt=Gx(u[q.icon.name],M.get("icon-offset").evaluate(q,{},y),M.get("icon-anchor").evaluate(q,{},y)),Wt=oe.sdf,e.sdfIcons===void 0?e.sdfIcons=oe.sdf:e.sdfIcons!==oe.sdf&&Dr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(oe.pixelRatio!==e.pixelRatio||M.get("icon-rotate").constantOr(1)!==0)&&(e.iconsNeedLinear=!0))}const Gt=xg(lt.horizontal)||lt.vertical;e.iconsInText||(e.iconsInText=!!Gt&&Gt.iconsInText),(Gt||vt)&&Jx(e,q,lt,vt,s,O,mt,0,_t,Wt,m,y,w)}f&&e.generateCollisionDebugBuffers(x,e.collisionBoxArray)}function ff(e){switch(e){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Jx(e,t,i,s,u,f,m,y,x,w,M,L,O){let B=f.textMaxSize.evaluate(t,{},L);B===void 0&&(B=m);const F=e.layers[0].layout,q=F.get("icon-offset").evaluate(t,{},L),K=xg(i.horizontal)||i.vertical,at=O.name==="globe",mt=vo,lt=m/mt,dt=e.tilePixelRatio*B/mt,vt=(he=e.overscaling,e.zoom>18&&he>2&&(he>>=1),Math.max(ir/(512*he),1)*F.get("symbol-spacing")),_t=F.get("text-padding")*e.tilePixelRatio,Wt=F.get("icon-padding")*e.tilePixelRatio,Gt=Kt(F.get("text-max-angle")),oe=F.get("text-rotation-alignment")==="map"&&F.get("symbol-placement")!=="point",ve=F.get("icon-rotation-alignment")==="map"&&F.get("symbol-placement")!=="point",te=F.get("symbol-placement"),ce=vt/2;var he;const me=F.get("icon-text-fit");let Te;s&&me!=="none"&&(e.allowVerticalPlacement&&i.vertical&&(Te=ag(s,i.vertical,me,F.get("icon-text-fit-padding"),q,lt)),K&&(s=ag(s,K,me,F.get("icon-text-fit-padding"),q,lt)));const ne=(Be,Xe,Fe)=>{if(Xe.x<0||Xe.x>=ir||Xe.y<0||Xe.y>=ir)return;let yr=null;if(at){const{x:Ce,y:er,z:vr}=O.projectTilePoint(Xe.x,Xe.y,Fe);yr={anchor:new dl(Ce,er,vr,0,void 0),up:O.upVector(Fe,Xe.x,Xe.y)}}(function(Ce,er,vr,Qr,xr,ar,$i,wr,Er,Mi,Ui,Vi,Ai,on,En,kn,Pi,Xn,Bn,fn,ri,Fn,Gi,ls,Un){const xo=Ce.addToLineVertexArray(er,Qr);let ao,us,lo,La,Pu,zc,kc,Qg=0,t_=0,e_=0,r_=0,Mf=-1,Af=-1;const Ya={};let i_=Ep("");const eu=vr?vr.anchor:er;let Pf=0,Lf=0;if(Er._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Pf,Lf]=Er.layout.get("text-offset").evaluate(ri,{},Un).map(Os=>Os*vo):(Pf=Er.layout.get("text-radial-offset").evaluate(ri,{},Un)*vo,Lf=pf),Ce.allowVerticalPlacement&&xr.vertical){const Os=xr.vertical;if(En)zc=df(Os),wr&&(kc=df(wr));else{const Ns=Er.layout.get("text-rotate").evaluate(ri,{},Un)+90;lo=Bh(Mi,eu,er,Ui,Vi,Ai,Os,on,Ns,kn),wr&&(La=Bh(Mi,eu,er,Ui,Vi,Ai,wr,Xn,Ns))}}if(ar){const Os=Er.layout.get("icon-rotate").evaluate(ri,{},Un),Ns=Er.layout.get("icon-text-fit")!=="none",Bc=gg(ar,Os,Gi,Ns),Rf=wr?gg(wr,Os,Gi,Ns):void 0;us=Bh(Mi,eu,er,Ui,Vi,Ai,ar,Xn,Os),Qg=4*Bc.length;const n_=Ce.iconSizeData;let ru=null;n_.kind==="source"?(ru=[Ma*Er.layout.get("icon-size").evaluate(ri,{},Un)],ru[0]>Cl&&Dr(`${Ce.layerIds[0]}: Value for "icon-size" is >= ${Mc}. Reduce your "icon-size".`)):n_.kind==="composite"&&(ru=[Ma*Fn.compositeIconSizes[0].evaluate(ri,{},Un),Ma*Fn.compositeIconSizes[1].evaluate(ri,{},Un)],(ru[0]>Cl||ru[1]>Cl)&&Dr(`${Ce.layerIds[0]}: Value for "icon-size" is >= ${Mc}. Reduce your "icon-size".`)),Ce.addSymbols(Ce.icon,Bc,ru,fn,Bn,ri,!1,vr,er,xo.lineStartIndex,xo.lineLength,-1,ls,Un),Mf=Ce.icon.placedSymbolArray.length-1,Rf&&(t_=4*Rf.length,Ce.addSymbols(Ce.icon,Rf,ru,fn,Bn,ri,Ws.vertical,vr,er,xo.lineStartIndex,xo.lineLength,-1,ls,Un),Af=Ce.icon.placedSymbolArray.length-1)}for(const Os in xr.horizontal){const Ns=xr.horizontal[Os];ao||(i_=Ep(Ns.text),En?Pu=df(Ns):ao=Bh(Mi,eu,er,Ui,Vi,Ai,Ns,on,Er.layout.get("text-rotate").evaluate(ri,{},Un),kn));const Bc=Ns.positionedLines.length===1;if(e_+=vg(Ce,vr,er,Ns,$i,Er,En,ri,kn,xo,xr.vertical?Ws.horizontal:Ws.horizontalOnly,Bc?Object.keys(xr.horizontal):[Os],Ya,Mf,Fn,ls,Un),Bc)break}xr.vertical&&(r_+=vg(Ce,vr,er,xr.vertical,$i,Er,En,ri,kn,xo,Ws.vertical,["vertical"],Ya,Af,Fn,ls,Un));let Rl=-1;const Df=(Os,Ns)=>Os?Math.max(Os,Ns):Ns;Rl=Df(Pu,Rl),Rl=Df(zc,Rl),Rl=Df(kc,Rl);const S0=Rl>-1?1:0;Ce.glyphOffsetArray.length>=Al.MAX_GLYPHS&&Dr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),ri.sortKey!==void 0&&Ce.addToSortKeyRanges(Ce.symbolInstances.length,ri.sortKey),Ce.symbolInstances.emplaceBack(eu.x,eu.y,eu.z,er.x,er.y,Ya.right>=0?Ya.right:-1,Ya.center>=0?Ya.center:-1,Ya.left>=0?Ya.left:-1,Ya.vertical>=0?Ya.vertical:-1,Mf,Af,i_,ao!==void 0?ao:Ce.collisionBoxArray.length,ao!==void 0?ao+1:Ce.collisionBoxArray.length,lo!==void 0?lo:Ce.collisionBoxArray.length,lo!==void 0?lo+1:Ce.collisionBoxArray.length,us!==void 0?us:Ce.collisionBoxArray.length,us!==void 0?us+1:Ce.collisionBoxArray.length,La||Ce.collisionBoxArray.length,La?La+1:Ce.collisionBoxArray.length,Ui,e_,r_,Qg,t_,S0,0,Pf,Lf,Rl)})(e,Xe,yr,Be,i,s,u,Te,e.layers[0],e.collisionBoxArray,t.index,t.sourceLayerIndex,e.index,_t,oe,x,0,Wt,ve,q,t,f,w,M,L)};if(te==="line")for(const Be of fg(t.geometry,0,0,ir,ir)){const Xe=qx(Be,vt,Gt,i.vertical||K,s,mt,dt,e.overscaling,ir);for(const Fe of Xe)K&&Qx(e,K.text,ce,Fe)||ne(Be,Fe,L)}else if(te==="line-center"){for(const Be of t.geometry)if(Be.length>1){const Xe=jx(Be,Gt,i.vertical||K,s,mt,dt);Xe&&ne(Be,Xe,L)}}else if(t.type==="Polygon")for(const Be of Qp(t.geometry,0)){const Xe=Wx(Be,16);ne(Be[0],new dl(Xe.x,Xe.y,0,0,void 0),L)}else if(t.type==="LineString")for(const Be of t.geometry)ne(Be,new dl(Be[0].x,Be[0].y,0,0,void 0),L);else if(t.type==="Point")for(const Be of t.geometry)for(const Xe of Be)ne([Xe],new dl(Xe.x,Xe.y,0,0,void 0),L)}const Mc=255,Cl=Mc*Ma;function vg(e,t,i,s,u,f,m,y,x,w,M,L,O,B,F,q,K){const at=function(dt,vt,_t,Wt,Gt,oe,ve,te){const ce=[];if(vt.positionedLines.length===0)return ce;const he=Wt.layout.get("text-rotate").evaluate(oe,{})*Math.PI/180,me=function(Fe){const yr=Fe[0],Ce=Fe[1],er=yr*Ce;return er>0?[yr,-Ce]:er<0?[-yr,Ce]:yr===0?[Ce,yr]:[Ce,-yr]}(_t);let Te=Math.abs(vt.top-vt.bottom);for(const Fe of vt.positionedLines)Te-=Fe.lineOffset;const ne=vt.positionedLines.length,Be=Te/ne;let Xe=vt.top-_t[1];for(let Fe=0;Fe<ne;++Fe){const yr=vt.positionedLines[Fe];Xe=$x(vt,Be,Xe,Fe);for(const Ce of yr.positionedGlyphs){if(!Ce.rect)continue;const er=Ce.rect||{};let vr=Qm+1,Qr=!0,xr=1,ar=0;if(Ce.imageName){const Gi=ve[Ce.imageName];if(!Gi)continue;if(Gi.sdf){Dr("SDF images are not supported in formatted text and will be ignored.");continue}Qr=!1,xr=Gi.pixelRatio,vr=xs/xr}const $i=(Gt||te)&&Ce.vertical,wr=Ce.metrics.advance*Ce.scale/2,Er=Ce.metrics,Mi=Ce.rect;if(Mi===null)continue;te&&vt.verticalizable&&(ar=Ce.imageName?wr-Ce.metrics.width*Ce.scale/2:0);const Ui=Gt?[Ce.x+wr,Ce.y]:[0,0];let Vi=[0,0],Ai=[0,0],on=!1;Gt||($i?(Ai=[Ce.x+wr+me[0],Ce.y+me[1]-ar],on=!0):Vi=[Ce.x+wr+_t[0],Ce.y+_t[1]-ar]);const En=Mi.w*Ce.scale/(xr*(Ce.localGlyph?Aa:1)),kn=Mi.h*Ce.scale/(xr*(Ce.localGlyph?Aa:1));let Pi,Xn,Bn,fn;if($i){const Gi=Ce.y-Xe,ls=new $t(-wr,wr-Gi),Un=-Math.PI/2,xo=new $t(...Ai);Pi=new $t(-wr+Vi[0],Vi[1]),Pi._rotateAround(Un,ls)._add(xo),Pi.x+=-Gi+wr,Pi.y-=(Er.left-vr)*Ce.scale;const ao=Ce.imageName?Er.advance*Ce.scale:vo*Ce.scale,us=String.fromCharCode(Ce.glyph);Sx(us)?Pi.x+=(1-vr)*Ce.scale:Cx(us)?Pi.x+=ao-Er.height*Ce.scale+(-vr-1)*Ce.scale:Pi.x+=Ce.imageName||Er.width+2*vr===Mi.w&&Er.height+2*vr===Mi.h?(ao-kn)/2:(ao-(Er.height+2*vr)*Ce.scale)/2,Xn=new $t(Pi.x,Pi.y-En),Bn=new $t(Pi.x+kn,Pi.y),fn=new $t(Pi.x+kn,Pi.y-En)}else{const Gi=(Er.left-vr)*Ce.scale-wr+Vi[0],ls=(-Er.top-vr)*Ce.scale+Vi[1],Un=Gi+En,xo=ls+kn;Pi=new $t(Gi,ls),Xn=new $t(Un,ls),Bn=new $t(Gi,xo),fn=new $t(Un,xo)}if(he){let Gi;Gi=Gt?new $t(0,0):on?new $t(me[0],me[1]):new $t(_t[0],_t[1]),Pi._rotateAround(he,Gi),Xn._rotateAround(he,Gi),Bn._rotateAround(he,Gi),fn._rotateAround(he,Gi)}const ri=new $t(0,0),Fn=new $t(0,0);ce.push({tl:Pi,tr:Xn,bl:Bn,br:fn,tex:er,writingMode:vt.writingMode,glyphOffset:Ui,sectionIndex:Ce.sectionIndex,isSDF:Qr,pixelOffsetTL:ri,pixelOffsetBR:Fn,minFontScaleX:0,minFontScaleY:0})}}return ce}(0,s,x,f,m,y,u,e.allowVerticalPlacement),mt=e.textSizeData;let lt=null;mt.kind==="source"?(lt=[Ma*f.layout.get("text-size").evaluate(y,{},K)],lt[0]>Cl&&Dr(`${e.layerIds[0]}: Value for "text-size" is >= ${Mc}. Reduce your "text-size".`)):mt.kind==="composite"&&(lt=[Ma*F.compositeTextSizes[0].evaluate(y,{},K),Ma*F.compositeTextSizes[1].evaluate(y,{},K)],(lt[0]>Cl||lt[1]>Cl)&&Dr(`${e.layerIds[0]}: Value for "text-size" is >= ${Mc}. Reduce your "text-size".`)),e.addSymbols(e.text,at,lt,x,m,y,M,t,i,w.lineStartIndex,w.lineLength,B,q,K);for(const dt of L)O[dt]=e.text.placedSymbolArray.length-1;return 4*at.length}function xg(e){for(const t in e)return e[t];return null}function Bh(e,t,i,s,u,f,m,y,x,w){let M=m.top,L=m.bottom,O=m.left,B=m.right;const F=m.collisionPadding;if(F&&(O-=F[0],M-=F[1],B+=F[2],L+=F[3]),x){const q=new $t(O,M),K=new $t(B,M),at=new $t(O,L),mt=new $t(B,L),lt=Kt(x);let dt=new $t(0,0);w&&(dt=new $t(w[0],w[1])),q._rotateAround(lt,dt),K._rotateAround(lt,dt),at._rotateAround(lt,dt),mt._rotateAround(lt,dt),O=Math.min(q.x,K.x,at.x,mt.x),B=Math.max(q.x,K.x,at.x,mt.x),M=Math.min(q.y,K.y,at.y,mt.y),L=Math.max(q.y,K.y,at.y,mt.y)}return e.emplaceBack(t.x,t.y,t.z,i.x,i.y,O,M,B,L,y,s,u,f),e.length-1}function df(e){e.collisionPadding&&(e.top-=e.collisionPadding[1],e.bottom+=e.collisionPadding[3]);const t=e.bottom-e.top;return t>0?Math.max(10,t):null}function Qx(e,t,i,s){const u=e.compareText;if(t in u){const f=u[t];for(let m=f.length-1;m>=0;m--)if(s.dist(f[m])<i)return!0}else u[t]=[];return u[t].push(s),!1}function bg(e,t){const i=e.fovAboveCenter,s=e.elevation?e.elevation.getMinElevationBelowMSL()*t:0,u=(e._camera.position[2]*e.worldSize-s)/Math.cos(e._pitch),f=Math.sin(i)*u/Math.sin(Math.max(Math.PI/2-e._pitch-i,.01)),m=Math.sin(e._pitch)*f+u;return Math.min(1.01*m,u*(1/e._horizonShift))}function Ql(e,t){if(!t.isReprojectedInTileSpace)return{scale:1<<e.z,x:e.x,y:e.y,x2:e.x+1,y2:e.y+1,projection:t};const i=Math.pow(2,-e.z),s=e.x*i,u=(e.x+1)*i,f=e.y*i,m=(e.y+1)*i,y=Zs(s),x=Zs(u),w=Mo(f),M=Mo(m),L=t.project(y,w),O=t.project(x,w),B=t.project(x,M),F=t.project(y,M);let q=Math.min(L.x,O.x,B.x,F.x),K=Math.min(L.y,O.y,B.y,F.y),at=Math.max(L.x,O.x,B.x,F.x),mt=Math.max(L.y,O.y,B.y,F.y);const lt=i/16;function dt(_t,Wt,Gt,oe,ve,te){const ce=(Gt+ve)/2,he=(oe+te)/2,me=t.project(Zs(ce),Mo(he)),Te=Math.max(0,q-me.x,K-me.y,me.x-at,me.y-mt);q=Math.min(q,me.x),at=Math.max(at,me.x),K=Math.min(K,me.y),mt=Math.max(mt,me.y),Te>lt&&(dt(_t,me,Gt,oe,ce,he),dt(me,Wt,ce,he,ve,te))}dt(L,O,s,f,u,f),dt(O,B,u,f,u,m),dt(B,F,u,m,s,m),dt(F,L,s,m,s,f),q-=lt,K-=lt,at+=lt,mt+=lt;const vt=1/Math.max(at-q,mt-K);return{scale:vt,x:q*vt,y:K*vt,x2:at*vt,y2:mt*vt,projection:t}}const t0=Ia(new Float32Array(16));class Ml{constructor(t){this.spec=t,this.name=t.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(t,i){return{x:0,y:0,z:0}}unproject(t,i){return new Ci(0,0)}projectTilePoint(t,i,s){return{x:t,y:i,z:0}}locationPoint(t,i,s=!0){return t._coordinatePoint(t.locationCoordinate(i),s)}pixelsPerMeter(t,i){return Ca(1,t)*i}pixelSpaceConversion(t,i,s){return 1}farthestPixelDistance(t){return bg(t,t.pixelsPerMeter)}pointCoordinate(t,i,s,u){const f=t.horizonLineFromTop(!1),m=new $t(i,Math.max(f,s));return t.rayIntersectionCoordinate(t.pointRayIntersection(m,u))}pointCoordinate3D(t,i,s){const u=new $t(i,s);if(t.elevation)return t.elevation.pointCoordinate(u);{const f=this.pointCoordinate(t,u.x,u.y,0);return[f.x,f.y,f.z]}}isPointAboveHorizon(t,i){if(t.elevation)return!this.pointCoordinate3D(t,i.x,i.y);const s=t.horizonLineFromTop();return i.y<s}createInversionMatrix(t,i){return t0}createTileMatrix(t,i,s){let u,f,m;const y=s.canonical,x=Ia(new Float64Array(16));if(this.isReprojectedInTileSpace){const w=Ql(y,this);u=1,f=w.x+s.wrap*w.scale,m=w.y,Xl(x,x,[u/w.scale,u/w.scale,t.pixelsPerMeter/i])}else u=i/t.zoomScale(y.z),f=(y.x+Math.pow(2,y.z)*s.wrap)*u,m=y.y*u;return oc(x,x,[f,m,0]),Xl(x,x,[u/ir,u/ir,1]),x}upVector(t,i,s){return[0,0,1]}upVectorScale(t,i,s){return{metersToTile:1}}}class e0 extends Ml{constructor(t){super(t),this.range=[4,7],this.center=t.center||[-96,37.5];const[i,s]=this.parallels=t.parallels||[29.5,45.5],u=Math.sin(Kt(i));this.n=(u+Math.sin(Kt(s)))/2,this.c=1+u*(2*this.n-u),this.r0=Math.sqrt(this.c)/this.n}project(t,i){const{n:s,c:u,r0:f}=this,m=Kt(t-this.center[0]),y=Kt(i),x=Math.sqrt(u-2*s*Math.sin(y))/s;return{x:x*Math.sin(m*s),y:x*Math.cos(m*s)-f,z:0}}unproject(t,i){const{n:s,c:u,r0:f}=this,m=f+i;let y=Math.atan2(t,Math.abs(m))*Math.sign(m);m*s<0&&(y-=Math.PI*Math.sign(t)*Math.sign(m));const x=Kt(this.center[0])*s;y=Pe(y,-Math.PI-x,Math.PI-x);const w=Ye(ae(y/s)+this.center[0],-180,180),M=Math.asin(Ye((u-(t*t+m*m)*s*s)/(2*s),-1,1)),L=Ye(ae(M),-Ao,Ao);return new Ci(w,L)}}const Ac=1.340264,Pc=-.081106,Lc=893e-6,Dc=.003796,Fh=Math.sqrt(3)/2;class r0 extends Ml{project(t,i){i=i/180*Math.PI,t=t/180*Math.PI;const s=Math.asin(Fh*Math.sin(i)),u=s*s,f=u*u*u;return{x:.5*(t*Math.cos(s)/(Fh*(Ac+3*Pc*u+f*(7*Lc+9*Dc*u)))/Math.PI+.5),y:1-.5*(s*(Ac+Pc*u+f*(Lc+Dc*u))/Math.PI+1),z:0}}unproject(t,i){t=(2*t-.5)*Math.PI;let s=i=(2*(1-i)-1)*Math.PI,u=s*s,f=u*u*u;for(let M,L,O,B=0;B<12&&(L=s*(Ac+Pc*u+f*(Lc+Dc*u))-i,O=Ac+3*Pc*u+f*(7*Lc+9*Dc*u),M=L/O,s=Ye(s-M,-Math.PI/3,Math.PI/3),u=s*s,f=u*u*u,!(Math.abs(M)<1e-12));++B);const m=Fh*t*(Ac+3*Pc*u+f*(7*Lc+9*Dc*u))/Math.cos(s),y=Math.asin(Math.sin(s)/Fh),x=Ye(180*m/Math.PI,-180,180),w=Ye(180*y/Math.PI,-Ao,Ao);return new Ci(x,w)}}class i0 extends Ml{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0}project(t,i){return{x:.5+t/360,y:.5-i/360,z:0}}unproject(t,i){const s=360*(t-.5),u=Ye(360*(.5-i),-Ao,Ao);return new Ci(s,u)}}const Mu=Math.PI/2;function Uh(e){return Math.tan((Mu+e)/2)}class n0 extends Ml{constructor(t){super(t),this.center=t.center||[0,30];const[i,s]=this.parallels=t.parallels||[30,30];let u=Kt(i),f=Kt(s);this.southernCenter=u+f<0,this.southernCenter&&(u=-u,f=-f);const m=Math.cos(u),y=Uh(u);this.n=u===f?Math.sin(u):Math.log(m/Math.cos(f))/Math.log(Uh(f)/y),this.f=m*Math.pow(Uh(u),this.n)/this.n}project(t,i){i=Kt(i),this.southernCenter&&(i=-i),t=Kt(t-this.center[0]);const s=1e-6,{n:u,f}=this;f>0?i<-Mu+s&&(i=-Mu+s):i>Mu-s&&(i=Mu-s);const m=f/Math.pow(Uh(i),u);let y=m*Math.sin(u*t),x=f-m*Math.cos(u*t);return y=.5*(y/Math.PI+.5),x=.5*(x/Math.PI+.5),{x:y,y:this.southernCenter?x:1-x,z:0}}unproject(t,i){t=(2*t-.5)*Math.PI,this.southernCenter&&(i=1-i),i=(2*(1-i)-.5)*Math.PI;const{n:s,f:u}=this,f=u-i,m=Math.sign(f),y=Math.sign(s)*Math.sqrt(t*t+f*f);let x=Math.atan2(t,Math.abs(f))*m;f*s<0&&(x-=Math.PI*Math.sign(t)*m);const w=Ye(ae(x/s)+this.center[0],-180,180),M=Ye(ae(2*Math.atan(Math.pow(u/y,1/s))-Mu),-Ao,Ao);return new Ci(w,this.southernCenter?-M:M)}}class wg extends Ml{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(t,i){return{x:qa(t),y:$a(i),z:0}}unproject(t,i){const s=Zs(t),u=Mo(i);return new Ci(s,u)}}const Eg=Kt(Ao);class o0 extends Ml{project(t,i){const s=(i=Kt(i))*i,u=s*s;return{x:.5*((t=Kt(t))*(.8707-.131979*s+u*(u*(.003971*s-.001529*u)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+s*(.015085+u*(.028874*s-.044475-.005916*u)))/Math.PI+1),z:0}}unproject(t,i){t=(2*t-.5)*Math.PI;let s=i=(2*(1-i)-1)*Math.PI,u=25,f=0,m=s*s;do{m=s*s;const w=m*m;f=(s*(1.007226+m*(.015085+w*(.028874*m-.044475-.005916*w)))-i)/(1.007226+m*(.045255+w*(.259866*m-.311325-.005916*11*w))),s=Ye(s-f,-Eg,Eg)}while(Math.abs(f)>1e-6&&--u>0);m=s*s;const y=Ye(ae(t/(.8707+m*(m*(m*m*m*(.003971-.001529*m)-.013791)-.131979))),-180,180),x=ae(s);return new Ci(y,x)}}const Tg=Kt(Ao);class s0 extends Ml{project(t,i){i=Kt(i),t=Kt(t);const s=Math.cos(i),u=2/Math.PI,f=Math.acos(s*Math.cos(t/2)),m=Math.sin(f)/f,y=.5*(t*u+2*s*Math.sin(t/2)/m)||0,x=.5*(i+Math.sin(i)/m)||0;return{x:.5*(y/Math.PI+.5),y:1-.5*(x/Math.PI+1),z:0}}unproject(t,i){let s=t=(2*t-.5)*Math.PI,u=i=(2*(1-i)-1)*Math.PI,f=25;const m=1e-6;let y=0,x=0;do{const w=Math.cos(u),M=Math.sin(u),L=2*M*w,O=M*M,B=w*w,F=Math.cos(s/2),q=Math.sin(s/2),K=2*F*q,at=q*q,mt=1-B*F*F,lt=mt?1/mt:0,dt=mt?Math.acos(w*F)*Math.sqrt(1/mt):0,vt=.5*(2*dt*w*q+2*s/Math.PI)-t,_t=.5*(dt*M+u)-i,Wt=.5*lt*(B*at+dt*w*F*O)+1/Math.PI,Gt=lt*(K*L/4-dt*M*q),oe=.125*lt*(L*q-dt*M*B*K),ve=.5*lt*(O*F+dt*at*w)+.5,te=Gt*oe-ve*Wt;y=(_t*Gt-vt*ve)/te,x=(vt*oe-_t*Wt)/te,s=Ye(s-y,-Math.PI,Math.PI),u=Ye(u-x,-Tg,Tg)}while((Math.abs(y)>m||Math.abs(x)>m)&&--f>0);return new Ci(ae(s),ae(u))}}class Ig extends Ml{constructor(t){super(t),this.center=t.center||[0,0],this.parallels=t.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Kt(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(t,i){const{scale:s,cosPhi:u}=this;return{x:Kt(t)*u*s+.5,y:-Math.sin(Kt(i))/u*s+.5,z:0}}unproject(t,i){const{scale:s,cosPhi:u}=this,f=-(i-.5)/s,m=Ye(ae((t-.5)/s)/u,-180,180),y=Math.asin(Ye(f*u,-1,1)),x=Ye(ae(y),-Ao,Ao);return new Ci(m,x)}}class a0 extends wg{constructor(t){super(t),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(t,i,s){const u=fc(t,i,s);return Mn(u,u,dc(ja(s))),{x:u[0],y:u[1],z:u[2]}}locationPoint(t,i){const s=fu(i.lat,i.lng),u=os([],s),f=t.elevation?t.elevation.getAtPointOrZero(t.locationCoordinate(i),t._centerAltitude):t._centerAltitude;uc(s,s,u,Ca(1,0)*ir*f);const m=Ia(new Float64Array(16));return $l(m,t.pixelMatrix,t.globeMatrix),Mn(s,s,m),new $t(s[0],s[1])}pixelsPerMeter(t,i){return Ca(1,0)*i}pixelSpaceConversion(t,i,s){const u=Ca(1,t)*i,f=Mr(Ca(1,45)*i,u,s);return this.pixelsPerMeter(t,i)/f}createTileMatrix(t,i,s){const u=kp(ja(s.canonical));return $l(new Float64Array(16),t.globeMatrix,u)}createInversionMatrix(t,i){const{center:s}=t,u=dc(ja(i));return dh(u,u,Kt(s.lng)),Cp(u,u,Kt(s.lat)),Xl(u,u,[t._pixelsPerMercatorPixel,t._pixelsPerMercatorPixel,1]),Float32Array.from(u)}pointCoordinate(t,i,s,u){return Jd(t,i,s,!0)||new mu(0,0)}pointCoordinate3D(t,i,s){const u=this.pointCoordinate(t,i,s,0);return[u.x,u.y,u.z]}isPointAboveHorizon(t,i){return!Jd(t,i.x,i.y,!1)}farthestPixelDistance(t){const i=function(u,f){const m=u.cameraToCenterDistance,y=u._centerAltitude*f,x=u._camera,w=u._camera.forward(),M=cl([],Xs([],w,-m),[0,0,y]),L=u.worldSize/(2*Math.PI),O=[0,0,-L],B=u.width/u.height,F=Math.tan(u.fovAboveCenter),q=Xs([],x.up(),F),K=Xs([],x.right(),F*B),at=os([],cl([],cl([],w,q),K)),mt=[];let lt;if(new Lp(M,at).closestPointOnSphere(O,L,mt)){const dt=cl([],mt,O),vt=Sa([],dt,M);lt=Math.cos(u.fovAboveCenter)*sc(vt)}else{const dt=Sa([],M,O),vt=Sa([],O,M);os(vt,vt);const _t=sc(dt)-L;lt=Math.sqrt(_t*(_t+2*L));const Wt=Math.acos(lt/(L+_t))-Math.acos(ua(w,vt));lt*=Math.cos(Wt)}return 1.01*lt}(t,this.pixelsPerMeter(t.center.lat,t.worldSize)),s=du(t.zoom);if(s>0){const u=bg(t,Ca(1,t.center.lat)*t.worldSize),f=t.worldSize/(2*Math.PI),m=Math.max(t.width,t.height)/t.worldSize*Math.PI;return Mr(i,u+f*(1-Math.cos(m)),Math.pow(s,10))}return i}upVector(t,i,s){return fc(i,s,t,1)}upVectorScale(t){return{metersToTile:mh(_h(ja(t)))}}}function Sg(e){const t=e.parallels,i=!!t&&Math.abs(t[0]+t[1])<.01;switch(e.name){case"mercator":return new wg(e);case"equirectangular":return new i0(e);case"naturalEarth":return new o0(e);case"equalEarth":return new r0(e);case"winkelTripel":return new s0(e);case"albers":return i?new Ig(e):new e0(e);case"lambertConformalConic":return i?new Ig(e):new n0(e);case"globe":return new a0(e)}throw new Error(`Invalid projection name: ${e.name}`)}const l0=Ch.types,u0=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Vh(e,t,i,s,u,f,m,y,x,w,M,L,O){const B=y?Math.min(Cl,Math.round(y[0])):0,F=y?Math.min(Cl,Math.round(y[1])):0;e.emplaceBack(t,i,Math.round(32*s),Math.round(32*u),f,m,(B<<1)+(x?1:0),F,16*w,16*M,256*L,256*O)}function Gh(e,t,i,s,u,f,m){e.emplaceBack(t,i,s,u,f,m)}function jh(e,t,i,s,u){e.emplaceBack(t,i,s,u),e.emplaceBack(t,i,s,u),e.emplaceBack(t,i,s,u),e.emplaceBack(t,i,s,u)}function c0(e){for(const t of e.sections)if(wp(t.text))return!0;return!1}class mf{constructor(t){this.layoutVertexArray=new fe,this.indexArray=new Je,this.programConfigurations=t,this.segments=new Nn,this.dynamicLayoutVertexArray=new _e,this.opacityVertexArray=new Qe,this.placedSymbolArray=new On,this.globeExtVertexArray=new Ee}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,i,s,u){this.isEmpty()||(s&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,yx.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,xx.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,u0,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,vx.members,!0)),this.opacityVertexBuffer.itemSize=1),(s||u)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}De(mf,"SymbolBuffers");class gf{constructor(t,i,s){this.layoutVertexArray=new t,this.layoutAttributes=i,this.indexArray=new s,this.segments=new Nn,this.collisionVertexArray=new Gr,this.collisionVertexArrayExt=new kr}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,bx.members,!0),this.collisionVertexBufferExt=t.createVertexBuffer(this.collisionVertexArrayExt,wx.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}De(gf,"CollisionBuffers");class Al{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(m=>m.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Ia([]),this.placementViewportMatrix=Ia([]);const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=nf(this.zoom,i["text-size"]),this.iconSizeData=nf(this.zoom,i["icon-size"]);const s=this.layers[0].layout,u=s.get("symbol-sort-key"),f=s.get("symbol-z-order");this.canOverlap=s.get("text-allow-overlap")||s.get("icon-allow-overlap")||s.get("text-ignore-placement")||s.get("icon-ignore-placement"),this.sortFeaturesByKey=f!=="viewport-y"&&u.constantOr(1)!==void 0,this.sortFeaturesByY=(f==="viewport-y"||f==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=s.get("text-writing-mode").map(m=>Ws[m]),this.stateDependentLayerIds=this.layers.filter(m=>m.isStateDependent()).map(m=>m.id),this.sourceID=t.sourceID,this.projection=t.projection}createArrays(){this.text=new mf(new ql(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new mf(new ql(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new ns,this.lineVertexArray=new lu,this.symbolInstances=new Ki}calculateGlyphDependencies(t,i,s,u,f){for(let m=0;m<t.length;m++)if(i[t.charCodeAt(m)]=!0,u&&f){const y=Ic[t.charAt(m)];y&&(i[y.charCodeAt(0)]=!0)}}populate(t,i,s,u){const f=this.layers[0],m=f.layout,y=this.projection.name==="globe",x=m.get("text-font"),w=m.get("text-field"),M=m.get("icon-image"),L=(w.value.kind!=="constant"||w.value.value instanceof br&&!w.value.value.isEmpty()||w.value.value.toString().length>0)&&(x.value.kind!=="constant"||x.value.value.length>0),O=M.value.kind!=="constant"||!!M.value.value||Object.keys(M.parameters).length>0,B=m.get("symbol-sort-key");if(this.features=[],!L&&!O)return;const F=i.iconDependencies,q=i.glyphDependencies,K=i.availableImages,at=new P(this.zoom);for(const{feature:mt,id:lt,index:dt,sourceLayerIndex:vt}of t){const _t=f._featureFilter.needGeometry,Wt=Hl(mt,_t);if(!f._featureFilter.filter(at,Wt,s))continue;if(_t||(Wt.geometry=hl(mt,s,u)),y&&mt.type!==1&&s.z<=5){const te=Wt.geometry,ce=.98078528056,he=(me,Te)=>ua(fc(me.x,me.y,s,1),fc(Te.x,Te.y,s,1))<ce;for(let me=0;me<te.length;me++)te[me]=xv(te[me],he)}let Gt,oe;if(L){const te=f.getValueAndResolveTokens("text-field",Wt,s,K),ce=br.factory(te);c0(ce)&&(this.hasRTLText=!0),(!this.hasRTLText||v()==="unavailable"||this.hasRTLText&&S.isParsed())&&(Gt=Ix(ce,f,Wt))}if(O){const te=f.getValueAndResolveTokens("icon-image",Wt,s,K);oe=te instanceof io?te:io.fromString(te)}if(!Gt&&!oe)continue;const ve=this.sortFeaturesByKey?B.evaluate(Wt,{},s):void 0;if(this.features.push({id:lt,text:Gt,icon:oe,index:dt,sourceLayerIndex:vt,geometry:Wt.geometry,properties:mt.properties,type:l0[mt.type],sortKey:ve}),oe&&(F[oe.name]=!0),Gt){const te=x.evaluate(Wt,{},s).join(","),ce=m.get("text-rotation-alignment")==="map"&&m.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Ws.vertical)>=0;for(const he of Gt.sections)if(he.image)F[he.image.name]=!0;else{const me=Ju(Gt.toString()),Te=he.fontStack||te,ne=q[Te]=q[Te]||{};this.calculateGlyphDependencies(he.text,ne,ce,this.allowVerticalPlacement,me)}}}m.get("symbol-placement")==="line"&&(this.features=function(mt){const lt={},dt={},vt=[];let _t=0;function Wt(te){vt.push(mt[te]),_t++}function Gt(te,ce,he){const me=dt[te];return delete dt[te],dt[ce]=me,vt[me].geometry[0].pop(),vt[me].geometry[0]=vt[me].geometry[0].concat(he[0]),me}function oe(te,ce,he){const me=lt[ce];return delete lt[ce],lt[te]=me,vt[me].geometry[0].shift(),vt[me].geometry[0]=he[0].concat(vt[me].geometry[0]),me}function ve(te,ce,he){const me=he?ce[0][ce[0].length-1]:ce[0][0];return`${te}:${me.x}:${me.y}`}for(let te=0;te<mt.length;te++){const ce=mt[te],he=ce.geometry,me=ce.text?ce.text.toString():null;if(!me){Wt(te);continue}const Te=ve(me,he),ne=ve(me,he,!0);if(Te in dt&&ne in lt&&dt[Te]!==lt[ne]){const Be=oe(Te,ne,he),Xe=Gt(Te,ne,vt[Be].geometry);delete lt[Te],delete dt[ne],dt[ve(me,vt[Xe].geometry,!0)]=Xe,vt[Be].geometry=null}else Te in dt?Gt(Te,ne,he):ne in lt?oe(Te,ne,he):(Wt(te),lt[Te]=_t-1,dt[ne]=_t-1)}return vt.filter(te=>te.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((mt,lt)=>mt.sortKey-lt.sortKey)}update(t,i,s,u){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,i,this.layers,s,u),this.icon.programConfigurations.updatePaintArrays(t,i,this.layers,s,u))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=Sg(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,i){const s=this.lineVertexArray.length;if(t.segment!==void 0)for(const{x:u,y:f}of i)this.lineVertexArray.emplaceBack(u,f);return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}}addSymbols(t,i,s,u,f,m,y,x,w,M,L,O,B,F){const q=t.indexArray,K=t.layoutVertexArray,at=t.globeExtVertexArray,mt=t.segments.prepareSegment(4*i.length,K,q,this.canOverlap?m.sortKey:void 0),lt=this.glyphOffsetArray.length,dt=mt.vertexLength,vt=this.allowVerticalPlacement&&y===Ws.vertical?Math.PI/2:0,_t=m.text&&m.text.sections;for(let Gt=0;Gt<i.length;Gt++){const{tl:oe,tr:ve,bl:te,br:ce,tex:he,pixelOffsetTL:me,pixelOffsetBR:Te,minFontScaleX:ne,minFontScaleY:Be,glyphOffset:Xe,isSDF:Fe,sectionIndex:yr}=i[Gt],Ce=mt.vertexLength,er=Xe[1];if(Vh(K,w.x,w.y,oe.x,er+oe.y,he.x,he.y,s,Fe,me.x,me.y,ne,Be),Vh(K,w.x,w.y,ve.x,er+ve.y,he.x+he.w,he.y,s,Fe,Te.x,me.y,ne,Be),Vh(K,w.x,w.y,te.x,er+te.y,he.x,he.y+he.h,s,Fe,me.x,Te.y,ne,Be),Vh(K,w.x,w.y,ce.x,er+ce.y,he.x+he.w,he.y+he.h,s,Fe,Te.x,Te.y,ne,Be),x){const{x:vr,y:Qr,z:xr}=x.anchor,[ar,$i,wr]=x.up;Gh(at,vr,Qr,xr,ar,$i,wr),Gh(at,vr,Qr,xr,ar,$i,wr),Gh(at,vr,Qr,xr,ar,$i,wr),Gh(at,vr,Qr,xr,ar,$i,wr),jh(t.dynamicLayoutVertexArray,vr,Qr,xr,vt)}else jh(t.dynamicLayoutVertexArray,w.x,w.y,w.z,vt);q.emplaceBack(Ce,Ce+1,Ce+2),q.emplaceBack(Ce+1,Ce+2,Ce+3),mt.vertexLength+=4,mt.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Xe[0]),Gt!==i.length-1&&yr===i[Gt+1].sectionIndex||t.programConfigurations.populatePaintArrays(K.length,m,m.index,{},B,F,_t&&_t[yr])}const Wt=x?x.anchor:w;t.placedSymbolArray.emplaceBack(Wt.x,Wt.y,Wt.z,w.x,w.y,lt,this.glyphOffsetArray.length-lt,dt,M,L,w.segment,s?s[0]:0,s?s[1]:0,u[0],u[1],y,0,!1,0,O,0)}_commitLayoutVertex(t,i,s,u,f,m,y){t.emplaceBack(i,s,u,f,m,Math.round(y.x),Math.round(y.y))}_addCollisionDebugVertices(t,i,s,u,f,m,y){const x=s.segments.prepareSegment(4,s.layoutVertexArray,s.indexArray),w=x.vertexLength,M=y.tileAnchorX,L=y.tileAnchorY;for(let B=0;B<4;B++)s.collisionVertexArray.emplaceBack(0,0,0,0);s.collisionVertexArrayExt.emplaceBack(i,-t.padding,-t.padding),s.collisionVertexArrayExt.emplaceBack(i,t.padding,-t.padding),s.collisionVertexArrayExt.emplaceBack(i,t.padding,t.padding),s.collisionVertexArrayExt.emplaceBack(i,-t.padding,t.padding),this._commitLayoutVertex(s.layoutVertexArray,u,f,m,M,L,new $t(t.x1,t.y1)),this._commitLayoutVertex(s.layoutVertexArray,u,f,m,M,L,new $t(t.x2,t.y1)),this._commitLayoutVertex(s.layoutVertexArray,u,f,m,M,L,new $t(t.x2,t.y2)),this._commitLayoutVertex(s.layoutVertexArray,u,f,m,M,L,new $t(t.x1,t.y2)),x.vertexLength+=4;const O=s.indexArray;O.emplaceBack(w,w+1),O.emplaceBack(w+1,w+2),O.emplaceBack(w+2,w+3),O.emplaceBack(w+3,w),x.primitiveLength+=4}_addTextDebugCollisionBoxes(t,i,s,u,f,m){for(let y=u;y<f;y++){const x=s.get(y),w=this.getSymbolInstanceTextSize(t,m,i,y);this._addCollisionDebugVertices(x,w,this.textCollisionBox,x.projectedAnchorX,x.projectedAnchorY,x.projectedAnchorZ,m)}}_addIconDebugCollisionBoxes(t,i,s,u,f,m){for(let y=u;y<f;y++){const x=s.get(y),w=this.getSymbolInstanceIconSize(t,i,m.placedIconSymbolIndex);this._addCollisionDebugVertices(x,w,this.iconCollisionBox,x.projectedAnchorX,x.projectedAnchorY,x.projectedAnchorZ,m)}}generateCollisionDebugBuffers(t,i){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new gf($e,$m.members,so),this.iconCollisionBox=new gf($e,$m.members,so);const s=xu(this.iconSizeData,t),u=xu(this.textSizeData,t);for(let f=0;f<this.symbolInstances.length;f++){const m=this.symbolInstances.get(f);this._addTextDebugCollisionBoxes(u,t,i,m.textBoxStartIndex,m.textBoxEndIndex,m),this._addTextDebugCollisionBoxes(u,t,i,m.verticalTextBoxStartIndex,m.verticalTextBoxEndIndex,m),this._addIconDebugCollisionBoxes(s,t,i,m.iconBoxStartIndex,m.iconBoxEndIndex,m),this._addIconDebugCollisionBoxes(s,t,i,m.verticalIconBoxStartIndex,m.verticalIconBoxEndIndex,m)}}getSymbolInstanceTextSize(t,i,s,u){const f=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:u),m=Lh(this.textSizeData,t,f)/vo;return this.tilePixelRatio*m}getSymbolInstanceIconSize(t,i,s){const u=this.icon.placedSymbolArray.get(s),f=Lh(this.iconSizeData,t,u);return this.tilePixelRatio*f}_commitDebugCollisionVertexUpdate(t,i,s){t.emplaceBack(i,-s,-s),t.emplaceBack(i,s,-s),t.emplaceBack(i,s,s),t.emplaceBack(i,-s,s)}_updateTextDebugCollisionBoxes(t,i,s,u,f,m){for(let y=u;y<f;y++){const x=s.get(y),w=this.getSymbolInstanceTextSize(t,m,i,y);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,w,x.padding)}}_updateIconDebugCollisionBoxes(t,i,s,u,f,m){for(let y=u;y<f;y++){const x=s.get(y),w=this.getSymbolInstanceIconSize(t,i,m);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,w,x.padding)}}updateCollisionDebugBuffers(t,i){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const s=xu(this.iconSizeData,t),u=xu(this.textSizeData,t);for(let f=0;f<this.symbolInstances.length;f++){const m=this.symbolInstances.get(f);this._updateTextDebugCollisionBoxes(u,t,i,m.textBoxStartIndex,m.textBoxEndIndex,m),this._updateTextDebugCollisionBoxes(u,t,i,m.verticalTextBoxStartIndex,m.verticalTextBoxEndIndex,m),this._updateIconDebugCollisionBoxes(s,t,i,m.iconBoxStartIndex,m.iconBoxEndIndex,m.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(s,t,i,m.verticalIconBoxStartIndex,m.verticalIconBoxEndIndex,m.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(t,i,s,u,f,m,y,x,w){const M={};if(i<s){const{x1:L,y1:O,x2:B,y2:F,padding:q,projectedAnchorX:K,projectedAnchorY:at,projectedAnchorZ:mt,tileAnchorX:lt,tileAnchorY:dt,featureIndex:vt}=t.get(i);M.textBox={x1:L,y1:O,x2:B,y2:F,padding:q,projectedAnchorX:K,projectedAnchorY:at,projectedAnchorZ:mt,tileAnchorX:lt,tileAnchorY:dt},M.textFeatureIndex=vt}if(u<f){const{x1:L,y1:O,x2:B,y2:F,padding:q,projectedAnchorX:K,projectedAnchorY:at,projectedAnchorZ:mt,tileAnchorX:lt,tileAnchorY:dt,featureIndex:vt}=t.get(u);M.verticalTextBox={x1:L,y1:O,x2:B,y2:F,padding:q,projectedAnchorX:K,projectedAnchorY:at,projectedAnchorZ:mt,tileAnchorX:lt,tileAnchorY:dt},M.verticalTextFeatureIndex=vt}if(m<y){const{x1:L,y1:O,x2:B,y2:F,padding:q,projectedAnchorX:K,projectedAnchorY:at,projectedAnchorZ:mt,tileAnchorX:lt,tileAnchorY:dt,featureIndex:vt}=t.get(m);M.iconBox={x1:L,y1:O,x2:B,y2:F,padding:q,projectedAnchorX:K,projectedAnchorY:at,projectedAnchorZ:mt,tileAnchorX:lt,tileAnchorY:dt},M.iconFeatureIndex=vt}if(x<w){const{x1:L,y1:O,x2:B,y2:F,padding:q,projectedAnchorX:K,projectedAnchorY:at,projectedAnchorZ:mt,tileAnchorX:lt,tileAnchorY:dt,featureIndex:vt}=t.get(x);M.verticalIconBox={x1:L,y1:O,x2:B,y2:F,padding:q,projectedAnchorX:K,projectedAnchorY:at,projectedAnchorZ:mt,tileAnchorX:lt,tileAnchorY:dt},M.verticalIconFeatureIndex=vt}return M}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const s=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,i){const s=t.placedSymbolArray.get(i),u=s.vertexStartIndex+4*s.numGlyphs;for(let f=s.vertexStartIndex;f<u;f+=4)t.indexArray.emplaceBack(f,f+1,f+2),t.indexArray.emplaceBack(f+1,f+2,f+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(t),s=Math.cos(t),u=[],f=[],m=[];for(let y=0;y<this.symbolInstances.length;++y){m.push(y);const x=this.symbolInstances.get(y);u.push(0|Math.round(i*x.tileAnchorX+s*x.tileAnchorY)),f.push(x.featureIndex)}return m.sort((y,x)=>u[y]-u[x]||f[x]-f[y]),m}addToSortKeyRanges(t,i){const s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===i?s.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const s=this.symbolInstances.get(i);this.featureSortOrder.push(s.featureIndex);const{rightJustifiedTextSymbolIndex:u,centerJustifiedTextSymbolIndex:f,leftJustifiedTextSymbolIndex:m,verticalPlacedTextSymbolIndex:y,placedIconSymbolIndex:x,verticalPlacedIconSymbolIndex:w}=s;u>=0&&this.addIndicesForPlacedSymbol(this.text,u),f>=0&&f!==u&&this.addIndicesForPlacedSymbol(this.text,f),m>=0&&m!==f&&m!==u&&this.addIndicesForPlacedSymbol(this.text,m),y>=0&&this.addIndicesForPlacedSymbol(this.text,y),x>=0&&this.addIndicesForPlacedSymbol(this.icon,x),w>=0&&this.addIndicesForPlacedSymbol(this.icon,w)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}De(Al,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Al.MAX_GLYPHS=65535,Al.addDynamicAttributes=jh;const h0=new pt({"symbol-placement":new j(ie.layout_symbol["symbol-placement"]),"symbol-spacing":new j(ie.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new j(ie.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Q(ie.layout_symbol["symbol-sort-key"]),"symbol-z-order":new j(ie.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new j(ie.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new j(ie.layout_symbol["icon-ignore-placement"]),"icon-optional":new j(ie.layout_symbol["icon-optional"]),"icon-rotation-alignment":new j(ie.layout_symbol["icon-rotation-alignment"]),"icon-size":new Q(ie.layout_symbol["icon-size"]),"icon-text-fit":new j(ie.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new j(ie.layout_symbol["icon-text-fit-padding"]),"icon-image":new Q(ie.layout_symbol["icon-image"]),"icon-rotate":new Q(ie.layout_symbol["icon-rotate"]),"icon-padding":new j(ie.layout_symbol["icon-padding"]),"icon-keep-upright":new j(ie.layout_symbol["icon-keep-upright"]),"icon-offset":new Q(ie.layout_symbol["icon-offset"]),"icon-anchor":new Q(ie.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new j(ie.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new j(ie.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new j(ie.layout_symbol["text-rotation-alignment"]),"text-field":new Q(ie.layout_symbol["text-field"]),"text-font":new Q(ie.layout_symbol["text-font"]),"text-size":new Q(ie.layout_symbol["text-size"]),"text-max-width":new Q(ie.layout_symbol["text-max-width"]),"text-line-height":new Q(ie.layout_symbol["text-line-height"]),"text-letter-spacing":new Q(ie.layout_symbol["text-letter-spacing"]),"text-justify":new Q(ie.layout_symbol["text-justify"]),"text-radial-offset":new Q(ie.layout_symbol["text-radial-offset"]),"text-variable-anchor":new j(ie.layout_symbol["text-variable-anchor"]),"text-anchor":new Q(ie.layout_symbol["text-anchor"]),"text-max-angle":new j(ie.layout_symbol["text-max-angle"]),"text-writing-mode":new j(ie.layout_symbol["text-writing-mode"]),"text-rotate":new Q(ie.layout_symbol["text-rotate"]),"text-padding":new j(ie.layout_symbol["text-padding"]),"text-keep-upright":new j(ie.layout_symbol["text-keep-upright"]),"text-transform":new Q(ie.layout_symbol["text-transform"]),"text-offset":new Q(ie.layout_symbol["text-offset"]),"text-allow-overlap":new j(ie.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new j(ie.layout_symbol["text-ignore-placement"]),"text-optional":new j(ie.layout_symbol["text-optional"])});var _f={paint:new pt({"icon-opacity":new Q(ie.paint_symbol["icon-opacity"]),"icon-color":new Q(ie.paint_symbol["icon-color"]),"icon-halo-color":new Q(ie.paint_symbol["icon-halo-color"]),"icon-halo-width":new Q(ie.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Q(ie.paint_symbol["icon-halo-blur"]),"icon-translate":new j(ie.paint_symbol["icon-translate"]),"icon-translate-anchor":new j(ie.paint_symbol["icon-translate-anchor"]),"text-opacity":new Q(ie.paint_symbol["text-opacity"]),"text-color":new Q(ie.paint_symbol["text-color"],{runtimeType:lr,getOverride:e=>e.textColor,hasOverride:e=>!!e.textColor}),"text-halo-color":new Q(ie.paint_symbol["text-halo-color"]),"text-halo-width":new Q(ie.paint_symbol["text-halo-width"]),"text-halo-blur":new Q(ie.paint_symbol["text-halo-blur"]),"text-translate":new j(ie.paint_symbol["text-translate"]),"text-translate-anchor":new j(ie.paint_symbol["text-translate-anchor"])}),layout:h0};class Cg{constructor(t){this.type=t.property.overrides?t.property.overrides.runtimeType:Or,this.defaultValue=t}evaluate(t){if(t.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(t.formattedSection))return i.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}De(Cg,"FormatSectionOverride",{omit:["defaultValue"]});class qh extends Ta{constructor(t){super(t,_f)}recalculate(t,i){super.recalculate(t,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const s=this.layout.get("text-writing-mode");if(s){const u=[];for(const f of s)u.indexOf(f)<0&&u.push(f);this.layout._values["text-writing-mode"]=u}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(t,i,s,u){const f=this.layout.get(t).evaluate(i,{},s,u),m=this._unevaluatedLayout._values[t];return m.isDataDriven()||So(m.value)||!f?f:function(y,x){return x.replace(/{([^{}]+)}/g,(w,M)=>M in y?String(y[M]):"")}(i.properties,f)}createBucket(t){return new Al(t)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const t of _f.paint.overridableProperties){if(!qh.hasPaintOverride(this.layout,t))continue;const i=this.paint.get(t),s=new Cg(i),u=new bn(s,i.property.specification);let f=null;f=i.value.kind==="constant"||i.value.kind==="source"?new Gs("source",u):new Fo("composite",u,i.value.zoomStops,i.value._interpolationType),this.paint._values[t]=new it(i.property,f,i.parameters)}}_handleOverridablePaintPropertyUpdate(t,i,s){return!(!this.layout||i.isDataDriven()||s.isDataDriven())&&qh.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,i){const s=t.get("text-field"),u=_f.paint.properties[i];let f=!1;const m=y=>{for(const x of y)if(u.overrides&&u.overrides.hasOverride(x))return void(f=!0)};if(s.value.kind==="constant"&&s.value.value instanceof br)m(s.value.value.sections);else if(s.value.kind==="source"){const y=w=>{f||(w instanceof $o&&xi(w.value)===to?m(w.value.sections):w instanceof di?m(w.sections):w.eachChild(y))},x=s.value;x._styleExpression&&y(x._styleExpression.expression)}return f}getProgramConfiguration(t){return new Tl(this,t)}}var p0={paint:new pt({"background-color":new j(ie.paint_background["background-color"]),"background-pattern":new j(ie.paint_background["background-pattern"]),"background-opacity":new j(ie.paint_background["background-opacity"])})},f0={paint:new pt({"raster-opacity":new j(ie.paint_raster["raster-opacity"]),"raster-hue-rotate":new j(ie.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new j(ie.paint_raster["raster-brightness-min"]),"raster-brightness-max":new j(ie.paint_raster["raster-brightness-max"]),"raster-saturation":new j(ie.paint_raster["raster-saturation"]),"raster-contrast":new j(ie.paint_raster["raster-contrast"]),"raster-resampling":new j(ie.paint_raster["raster-resampling"]),"raster-fade-duration":new j(ie.paint_raster["raster-fade-duration"])})};class d0 extends Ta{constructor(t){super(t,{}),this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isLayerDraped(){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(t){this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl)}onRemove(t){this.implementation.onRemove&&this.implementation.onRemove(t,t.painter.context.gl)}}var m0={paint:new pt({"sky-type":new j(ie.paint_sky["sky-type"]),"sky-atmosphere-sun":new j(ie.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new j(ie.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new j(ie.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new j(ie.paint_sky["sky-gradient-radius"]),"sky-gradient":new ct(ie.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new j(ie.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new j(ie.paint_sky["sky-atmosphere-color"]),"sky-opacity":new j(ie.paint_sky["sky-opacity"])})};function yf(e,t,i){const s=[0,0,1],u=Xd([]);return Wd(u,u,i?-Kt(e)+Math.PI:Kt(e)),Zd(u,u,-Kt(t)),Gd(s,s,u),os(s,s)}const g0={circle:class extends Ta{constructor(e){super(e,Cv)}createBucket(e){return new jp(e)}queryRadius(e){const t=e;return gu("circle-radius",this,t)+gu("circle-stroke-width",this,t)+xh(this.paint.get("circle-translate"))}queryIntersectsFeature(e,t,i,s,u,f,m,y){const x=gm(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),f.angle,e.pixelToTileUnitsFactor),w=this.paint.get("circle-radius").evaluate(t,i)+this.paint.get("circle-stroke-width").evaluate(t,i);return _m(e,s,f,m,y,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",x,w)}getProgramIds(){return["circle"]}getProgramConfiguration(e){return new Tl(this,e)}},heatmap:class extends Ta{createBucket(e){return new vm(e)}constructor(e){super(e,Lv),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){e==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Zp({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(e){return gu("heatmap-radius",this,e)}queryIntersectsFeature(e,t,i,s,u,f,m,y){const x=this.paint.get("heatmap-radius").evaluate(t,i);return _m(e,s,f,m,y,!0,!0,new $t(0,0),x)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(e){return new Tl(this,e)}},hillshade:class extends Ta{constructor(e){super(e,Dv)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends Ta{constructor(e){super(e,Wv)}getProgramIds(){const e=this.paint.get("fill-pattern"),t=e&&e.constantOr(1),i=[t?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(t&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getProgramConfiguration(e){return new Tl(this,e)}recalculate(e,t){super.recalculate(e,t);const i=this.paint._values["fill-outline-color"];i.value.kind==="constant"&&i.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new Ih(e)}queryRadius(){return xh(this.paint.get("fill-translate"))}queryIntersectsFeature(e,t,i,s,u,f){return!e.queryGeometry.isAboveHorizon&&hm(mm(e.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),f.angle,e.pixelToTileUnitsFactor),s)}isTileClipped(){return!0}},"fill-extrusion":class extends Ta{constructor(e){super(e,cx)}createBucket(e){return new wc(e)}queryRadius(){return xh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(e){return new Tl(this,e)}queryIntersectsFeature(e,t,i,s,u,f,m,y,x){const w=gm(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),f.angle,e.pixelToTileUnitsFactor),M=this.paint.get("fill-extrusion-height").evaluate(t,i),L=this.paint.get("fill-extrusion-base").evaluate(t,i),O=[0,0],B=y&&f.elevation,F=f.elevation?f.elevation.exaggeration():1,q=e.tile.getBucket(this);if(B&&q instanceof wc){const dt=q.centroidVertexArray,vt=x+1;vt<dt.length&&(O[0]=dt.geta_centroid_pos0(vt),O[1]=dt.geta_centroid_pos1(vt))}if(O[0]===0&&O[1]===1)return!1;f.projection.name==="globe"&&(s=km([s],[new $t(0,0),new $t(ir,ir)],e.tileID.canonical).map(dt=>dt.polygon).flat());const K=B?y:null,[at,mt]=function(dt,vt,_t,Wt,Gt,oe,ve,te,ce,he,me){return dt.projection.name==="globe"?function(Te,ne,Be,Xe,Fe,yr,Ce,er,vr,Qr,xr){const ar=[],$i=[],wr=Te.projection.upVectorScale(xr,Te.center.lat,Te.worldSize).metersToTile,Er=[0,0,0,1],Mi=[0,0,0,1],Ui=(Ai,on,En,kn)=>{Ai[0]=on,Ai[1]=En,Ai[2]=kn,Ai[3]=1},Vi=zm();Be>0&&(Be+=Vi),Xe+=Vi;for(const Ai of ne){const on=[],En=[];for(const kn of Ai){const Pi=kn.x+Fe.x,Xn=kn.y+Fe.y,Bn=Te.projection.projectTilePoint(Pi,Xn,xr),fn=Te.projection.upVector(xr,kn.x,kn.y);let ri=Be,Fn=Xe;if(Ce){const Gi=Vm(Pi,Xn,Be,Xe,Ce,er,vr,Qr);ri+=Gi.base,Fn+=Gi.top}Be!==0?Ui(Er,Bn.x+fn[0]*wr*ri,Bn.y+fn[1]*wr*ri,Bn.z+fn[2]*wr*ri):Ui(Er,Bn.x,Bn.y,Bn.z),Ui(Mi,Bn.x+fn[0]*wr*Fn,Bn.y+fn[1]*wr*Fn,Bn.z+fn[2]*wr*Fn),Mn(Er,Er,yr),Mn(Mi,Mi,yr),on.push(new vu(Er[0],Er[1],Er[2])),En.push(new vu(Mi[0],Mi[1],Mi[2]))}ar.push(on),$i.push(En)}return[ar,$i]}(dt,vt,_t,Wt,Gt,oe,ve,te,ce,he,me):ve?function(Te,ne,Be,Xe,Fe,yr,Ce,er,vr){const Qr=[],xr=[],ar=[0,0,0,1];for(const $i of Te){const wr=[],Er=[];for(const Mi of $i){const Ui=Mi.x+Xe.x,Vi=Mi.y+Xe.y,Ai=Vm(Ui,Vi,ne,Be,yr,Ce,er,vr);ar[0]=Ui,ar[1]=Vi,ar[2]=Ai.base,ar[3]=1,Zl(ar,ar,Fe),ar[3]=Math.max(ar[3],1e-5);const on=new vu(ar[0]/ar[3],ar[1]/ar[3],ar[2]/ar[3]);ar[0]=Ui,ar[1]=Vi,ar[2]=Ai.top,ar[3]=1,Zl(ar,ar,Fe),ar[3]=Math.max(ar[3],1e-5);const En=new vu(ar[0]/ar[3],ar[1]/ar[3],ar[2]/ar[3]);wr.push(on),Er.push(En)}Qr.push(wr),xr.push(Er)}return[Qr,xr]}(vt,_t,Wt,Gt,oe,ve,te,ce,he):function(Te,ne,Be,Xe,Fe){const yr=[],Ce=[],er=Fe[8]*ne,vr=Fe[9]*ne,Qr=Fe[10]*ne,xr=Fe[11]*ne,ar=Fe[8]*Be,$i=Fe[9]*Be,wr=Fe[10]*Be,Er=Fe[11]*Be;for(const Mi of Te){const Ui=[],Vi=[];for(const Ai of Mi){const on=Ai.x+Xe.x,En=Ai.y+Xe.y,kn=Fe[0]*on+Fe[4]*En+Fe[12],Pi=Fe[1]*on+Fe[5]*En+Fe[13],Xn=Fe[2]*on+Fe[6]*En+Fe[14],Bn=Fe[3]*on+Fe[7]*En+Fe[15],fn=kn+er,ri=Pi+vr,Fn=Xn+Qr,Gi=Math.max(Bn+xr,1e-5),ls=kn+ar,Un=Pi+$i,xo=Xn+wr,ao=Math.max(Bn+Er,1e-5);Ui.push(new vu(fn/Gi,ri/Gi,Fn/Gi)),Vi.push(new vu(ls/ao,Un/ao,xo/ao))}yr.push(Ui),Ce.push(Vi)}return[yr,Ce]}(vt,_t,Wt,Gt,oe)}(f,s,L,M,w,m,K,O,F,f.center.lat,e.tileID.canonical),lt=e.queryGeometry;return function(dt,vt,_t){let Wt=1/0;hm(_t,vt)&&(Wt=Um(_t,vt[0]));for(let Gt=0;Gt<vt.length;Gt++){const oe=vt[Gt],ve=dt[Gt];for(let te=0;te<oe.length-1;te++){const ce=oe[te],he=[ce,oe[te+1],ve[te+1],ve[te],ce];cm(_t,he)&&(Wt=Math.min(Wt,Um(_t,he)))}}return Wt!==1/0&&Wt}(at,mt,lt.isPointQuery()?lt.screenBounds:lt.screenGeometry)}},line:class extends Ta{constructor(e){super(e,Gm),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(e){if(e==="line-gradient"){const t=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=t._styleExpression&&t._styleExpression.expression instanceof yl,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(e,t){super.recalculate(e,t),this.paint._values["line-floorwidth"]=jm.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new Ph(e)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(e){return new Tl(this,e)}queryRadius(e){const t=e,i=qm(gu("line-width",this,t),gu("line-gap-width",this,t)),s=gu("line-offset",this,t);return i/2+Math.abs(s)+xh(this.paint.get("line-translate"))}queryIntersectsFeature(e,t,i,s,u,f){if(e.queryGeometry.isAboveHorizon)return!1;const m=mm(e.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),f.angle,e.pixelToTileUnitsFactor),y=e.pixelToTileUnitsFactor/2*qm(this.paint.get("line-width").evaluate(t,i),this.paint.get("line-gap-width").evaluate(t,i)),x=this.paint.get("line-offset").evaluate(t,i);return x&&(s=function(w,M){const L=[],O=new $t(0,0);for(let B=0;B<w.length;B++){const F=w[B],q=[];for(let K=0;K<F.length;K++){const at=F[K],mt=F[K+1],lt=K===0?O:at.sub(F[K-1])._unit()._perp(),dt=K===F.length-1?O:mt.sub(at)._unit()._perp(),vt=lt._add(dt)._unit();vt._mult(1/(vt.x*dt.x+vt.y*dt.y)),q.push(vt._mult(M)._add(at))}L.push(q)}return L}(s,x*e.pixelToTileUnitsFactor)),function(w,M,L){for(let O=0;O<M.length;O++){const B=M[O];if(w.length>=3){for(let F=0;F<B.length;F++)if(Kl(w,B[F]))return!0}if(Ev(w,B,L))return!0}return!1}(m,s,y)}isTileClipped(){return!0}},symbol:qh,background:class extends Ta{constructor(e){super(e,p0)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Ta{constructor(e){super(e,f0)}getProgramIds(){return["raster"]}},sky:class extends Ta{constructor(e){super(e,m0),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){e==="sky-gradient"?this._updateColorRamp():e!=="sky-atmosphere-sun"&&e!=="sky-atmosphere-halo-color"&&e!=="sky-atmosphere-color"&&e!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Zp({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(e){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const t=e.style.light.properties.get("position");return this._lightPosition.azimuthal!==t.azimuthal||this._lightPosition.polar!==t.polar}return!1}getCenter(e,t){if(this.paint.get("sky-type")==="atmosphere"){const s=this.paint.get("sky-atmosphere-sun"),u=!s,f=e.style.light,m=f.properties.get("position");return u&&f.properties.get("anchor")==="viewport"&&Dr("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),u?yf(m.azimuthal,90-m.polar,t):yf(s[0],90-s[1],t)}const i=this.paint.get("sky-gradient-center");return yf(i[0],90-i[1],t)}is3D(){return!1}isSky(){return!0}markSkyboxValid(e){this._skyboxInvalidated=!1,this._lightPosition=e.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const e=this.paint.get("sky-type");return e==="atmosphere"?["skyboxCapture","skybox"]:e==="gradient"?["skyboxGradient"]:null}}};class Rc{constructor(t,i,s,u){this.context=t,this.format=s,this.texture=t.gl.createTexture(),this.update(i,u)}update(t,i,s){const{width:u,height:f}=t,{context:m}=this,{gl:y}=m,{HTMLImageElement:x,HTMLCanvasElement:w,HTMLVideoElement:M,ImageData:L,ImageBitmap:O}=G;if(y.bindTexture(y.TEXTURE_2D,this.texture),m.pixelStoreUnpackFlipY.set(!1),m.pixelStoreUnpack.set(1),m.pixelStoreUnpackPremultiplyAlpha.set(this.format===y.RGBA&&(!i||i.premultiply!==!1)),s||this.size&&this.size[0]===u&&this.size[1]===f){const{x:B,y:F}=s||{x:0,y:0};t instanceof x||t instanceof w||t instanceof M||t instanceof L||O&&t instanceof O?y.texSubImage2D(y.TEXTURE_2D,0,B,F,y.RGBA,y.UNSIGNED_BYTE,t):y.texSubImage2D(y.TEXTURE_2D,0,B,F,u,f,y.RGBA,y.UNSIGNED_BYTE,t.data)}else this.size=[u,f],t instanceof x||t instanceof w||t instanceof M||t instanceof L||O&&t instanceof O?y.texImage2D(y.TEXTURE_2D,0,this.format,this.format,y.UNSIGNED_BYTE,t):y.texImage2D(y.TEXTURE_2D,0,this.format,u,f,0,this.format,y.UNSIGNED_BYTE,t.data);this.useMipmap=!!(i&&i.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&y.generateMipmap(y.TEXTURE_2D)}bind(t,i){const{context:s}=this,{gl:u}=s;u.bindTexture(u.TEXTURE_2D,this.texture),t!==this.filter&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,t),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,this.useMipmap?t===u.NEAREST?u.NEAREST_MIPMAP_NEAREST:u.LINEAR_MIPMAP_NEAREST:t),this.filter=t),i!==this.wrap&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,i),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,i),this.wrap=i)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class _0{constructor(t){this._callback=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class y0{constructor(){this.tasks={},this.taskQueue=[],oi(["process"],this),this.invoker=new _0(this.process),this.nextId=0}add(t,i){const s=this.nextId++,u=function({type:f,isSymbolTile:m,zoom:y}){return y=y||0,f==="message"?0:f!=="maybePrepare"||m?f!=="parseTile"||m?f==="parseTile"&&m?300-y:f==="maybePrepare"&&m?400-y:500:200-y:100-y}(i);if(u===0){ii();try{t()}finally{}return{cancel:()=>{}}}return this.tasks[s]={fn:t,metadata:i,priority:u,id:s},this.taskQueue.push(s),this.invoker.trigger(),{cancel:()=>{delete this.tasks[s]}}}process(){ii();try{if(this.taskQueue=this.taskQueue.filter(s=>!!this.tasks[s]),!this.taskQueue.length)return;const t=this.pick();if(t===null)return;const i=this.tasks[t];if(delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let t=null,i=1/0;for(let u=0;u<this.taskQueue.length;u++){const f=this.tasks[this.taskQueue[u]];f.priority<i&&(i=f.priority,t=u)}if(t===null)return null;const s=this.taskQueue[t];return this.taskQueue.splice(t,1),s}remove(){this.invoker.remove()}}class Mg{constructor(t){this._stringToNumber={},this._numberToString=[];for(let i=0;i<t.length;i++){const s=t[i];this._stringToNumber[s]=i,this._numberToString[i]=s}}encode(t){return this._stringToNumber[t]}decode(t){return this._numberToString[t]}}const v0=["tile","layer","source","sourceLayer","state"];class Ag{constructor(t,i,s,u,f){this.type="Feature",this._vectorTileFeature=t,this._z=i,this._x=s,this._y=u,this.properties=t.properties,this.id=f}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};this.id!==void 0&&(t.id=this.id);for(const i of v0)this[i]!==void 0&&(t[i]=this[i]);return t}}const pa=32,Xa=33,Pl=new Uint16Array(8184);for(let e=0;e<2046;e++){let t=e+2,i=0,s=0,u=0,f=0,m=0,y=0;for(1&t?u=f=m=pa:i=s=y=pa;(t>>=1)>1;){const w=i+u>>1,M=s+f>>1;1&t?(u=i,f=s,i=m,s=y):(i=u,s=f,u=m,f=y),m=w,y=M}const x=4*e;Pl[x+0]=i,Pl[x+1]=s,Pl[x+2]=u,Pl[x+3]=f}const Za=new Uint16Array(2178),Ll=new Uint8Array(1089),$h=new Uint16Array(1089);function Pg(e){return e===0?-.03125:e===32?.03125:0}var Lg=Nt([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const Dg={type:2,extent:ir,loadGeometry:()=>[[new $t(0,0),new $t(ir+1,0),new $t(ir+1,ir+1),new $t(0,ir+1),new $t(0,0)]]};class vf{constructor(t,i,s,u,f){this.tileID=t,this.uid=Li(),this.uses=0,this.tileSize=i,this.tileZoom=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=f,this.expiredRequestCount=0,this.state="loading",u&&u.transform&&(this.projection=u.transform.projection)}registerFadeDuration(t){const i=t+this.timeAdded;i<ai.now()||this.fadeEndTime&&i<this.fadeEndTime||(this.fadeEndTime=i)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=Ql(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,i,s){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(u,f){const m={};if(!f)return m;for(const y of u){const x=y.layerIds.map(w=>f.getLayer(w)).filter(Boolean);if(x.length!==0){y.layers=x,y.stateDependentLayerIds&&(y.stateDependentLayers=y.stateDependentLayerIds.map(w=>x.filter(M=>M.id===w)[0]));for(const w of x)m[w.id]=y}}return m}(t.buckets,i.style),this.hasSymbolBuckets=!1;for(const u in this.buckets){const f=this.buckets[u];if(f instanceof Al){if(this.hasSymbolBuckets=!0,!s)break;f.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const u in this.buckets){const f=this.buckets[u];if(f instanceof Al&&f.hasRTLText){this.hasRTLText=!0,S.isLoading()||S.isLoaded()||v()!=="deferred"||I();break}}this.queryPadding=0;for(const u in this.buckets){const f=this.buckets[u];this.queryPadding=Math.max(this.queryPadding,i.style.getLayer(u).queryRadius(f))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas)}else this.collisionBoxArray=new Si}unloadVectorData(){if(this.hasData()){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(t){return this.buckets[t.id]}upload(t){for(const s in this.buckets){const u=this.buckets[s];u.uploadPending()&&u.upload(t)}const i=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Rc(t,this.imageAtlas.image,i.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Rc(t,this.glyphAtlasImage,i.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Rc(t,this.lineAtlas.image,i.ALPHA),this.lineAtlas.uploaded=!0)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,i,s,u,f,m,y,x){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:u,pixelPosMatrix:y,transform:m,params:f,tileTransform:this.tileTransform},t,i,s):{}}querySourceFeatures(t,i){const s=this.latestFeatureIndex;if(!s||!s.rawTileData)return;const u=s.loadVTLayers(),f=i?i.sourceLayer:"",m=u._geojsonTileLayer||u[f];if(!m)return;const y=bl(i&&i.filter),{z:x,x:w,y:M}=this.tileID.canonical,L={z:x,x:w,y:M};for(let O=0;O<m.length;O++){const B=m.feature(O);if(y.needGeometry){const K=Hl(B,!0);if(!y.filter(new P(this.tileID.overscaledZ),K,this.tileID.canonical))continue}else if(!y.filter(new P(this.tileID.overscaledZ),B))continue;const F=s.getId(B,f),q=new Ag(B,x,w,M,F);q.tile=L,t.push(q)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const i=this.expirationTime;if(t.cacheControl){const s=zt(t.cacheControl);s["max-age"]&&(this.expirationTime=Date.now()+1e3*s["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const s=Date.now();let u=!1;if(this.expirationTime>s)u=!1;else if(i)if(this.expirationTime<i)u=!0;else{const f=this.expirationTime-i;f?this.expirationTime=s+Math.max(f,3e4):u=!0}else u=!0;u?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,i){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0||!i)return;const s=this.latestFeatureIndex.loadVTLayers(),u=i.style.listImages();for(const f in this.buckets){if(!i.style.hasLayer(f))continue;const m=this.buckets[f],y=m.layers[0].sourceLayer||"_geojsonTileLayer",x=s[y],w=t[y];if(!x||!w||Object.keys(w).length===0)continue;if(m.update(w,x,u,this.imageAtlas&&this.imageAtlas.patternPositions||{}),m instanceof Ph||m instanceof Ih){const L=i.style._getSourceCache(m.layers[0].source);i._terrain&&i._terrain.enabled&&L&&m.programConfigurations.needsUpload&&i._terrain._clearRenderCacheForTile(L.id,this.tileID)}const M=i&&i.style&&i.style.getLayer(f);M&&(this.queryPadding=Math.max(this.queryPadding,M.queryRadius(m)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<ai.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=ai.now()+t}setTexture(t,i){const s=i.context,u=s.gl;this.texture=this.texture||i.getTileTexture(t.width),this.texture?this.texture.update(t,{useMipmap:!0}):(this.texture=new Rc(s,t,u.RGBA,{useMipmap:!0}),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE))}setDependencies(t,i){const s={};for(const u of i)s[u]=!0;this.dependencies[t]=s}hasDependency(t,i){for(const s of t){const u=this.dependencies[s];if(u){for(const f of i)if(u[f])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,i){if(!i||i.name==="mercator"||this._tileDebugBuffer)return;const s=hl(Dg,this.tileID.canonical,this.tileTransform)[0],u=new ye,f=new Ls;for(let m=0;m<s.length;m++){const{x:y,y:x}=s[m];u.emplaceBack(y,x),f.emplaceBack(m)}f.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(f),this._tileDebugBuffer=t.createVertexBuffer(u,hc.members),this._tileDebugSegments=Nn.simpleSegment(0,0,u.length,f.length)}_makeTileBoundsBuffers(t,i){if(this._tileBoundsBuffer||!i||i.name==="mercator")return;const s=hl(Dg,this.tileID.canonical,this.tileTransform)[0];let u,f;if(this.isRaster){const m=function(y,x){const w=Ql(y,x),M=Math.pow(2,y.z);for(let K=0;K<Xa;K++)for(let at=0;at<Xa;at++){const mt=Zs((y.x+(at+Pg(at))/pa)/M),lt=Mo((y.y+(K+Pg(K))/pa)/M),dt=x.project(mt,lt),vt=K*Xa+at;Za[2*vt+0]=Math.round((dt.x*w.scale-w.x)*ir),Za[2*vt+1]=Math.round((dt.y*w.scale-w.y)*ir)}Ll.fill(0),$h.fill(0);for(let K=2045;K>=0;K--){const at=4*K,mt=Pl[at+0],lt=Pl[at+1],dt=Pl[at+2],vt=Pl[at+3],_t=mt+dt>>1,Wt=lt+vt>>1,Gt=_t+Wt-lt,oe=Wt+mt-_t,ve=lt*Xa+mt,te=vt*Xa+dt,ce=Wt*Xa+_t,he=Math.hypot((Za[2*ve+0]+Za[2*te+0])/2-Za[2*ce+0],(Za[2*ve+1]+Za[2*te+1])/2-Za[2*ce+1])>=16;Ll[ce]=Ll[ce]||(he?1:0),K<1022&&(Ll[ce]=Ll[ce]||Ll[(lt+oe>>1)*Xa+(mt+Gt>>1)]||Ll[(vt+oe>>1)*Xa+(dt+Gt>>1)])}const L=new le,O=new Je;let B=0;function F(K,at){const mt=at*Xa+K;return $h[mt]===0&&(L.emplaceBack(Za[2*mt+0],Za[2*mt+1],K*ir/pa,at*ir/pa),$h[mt]=++B),$h[mt]-1}function q(K,at,mt,lt,dt,vt){const _t=K+mt>>1,Wt=at+lt>>1;if(Math.abs(K-dt)+Math.abs(at-vt)>1&&Ll[Wt*Xa+_t])q(dt,vt,K,at,_t,Wt),q(mt,lt,dt,vt,_t,Wt);else{const Gt=F(K,at),oe=F(mt,lt),ve=F(dt,vt);O.emplaceBack(Gt,oe,ve)}}return q(0,0,pa,pa,pa,0),q(pa,pa,0,0,0,pa),{vertices:L,indices:O}}(this.tileID.canonical,i);u=m.vertices,f=m.indices}else{u=new le,f=new Je;for(const{x:y,y:x}of s)u.emplaceBack(y,x,0,0);const m=Jp(u.int16,void 0,4);for(let y=0;y<m.length;y+=3)f.emplaceBack(m[y],m[y+1],m[y+2])}this._tileBoundsBuffer=t.createVertexBuffer(u,Lg.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(f),this._tileBoundsSegments=Nn.simpleSegment(0,0,u.length,f.length)}_makeGlobeTileDebugBuffers(t,i){const s=i.projection;if(!s||s.name!=="globe"||i.freezeTileCoverage)return;const u=this.tileID.canonical,f=dc(Qd(u,i)),m=du(i.zoom);let y;m>0&&(y=Sp(new Float64Array(16),i.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,u,i,f,y,m),this._makeGlobeTileDebugTextBuffer(t,u,i,f,y,m)}_globePoint(t,i,s,u,f,m,y){let x=fc(t,i,s);if(m){const w=1<<s.z,M=qa(u.center.lng),L=$a(u.center.lat),O=(s.x+.5)/w-M;let B=0;O>.5?B=-1:O<-.5&&(B=1);let F=(t/ir+s.x)/w+B,q=(i/ir+s.y)/w;F=(F-M)*u._pixelsPerMercatorPixel+M,q=(q-L)*u._pixelsPerMercatorPixel+L;const K=[F*u.worldSize,q*u.worldSize,0];Mn(K,K,m),x=Yl(x,K,y)}return Mn(x,x,f)}_makeGlobeTileDebugBorderBuffer(t,i,s,u,f,m){const y=new ye,x=new Ls,w=new Vt,M=(O,B,F,q,K)=>{const at=(F-O)/(K-1),mt=(q-B)/(K-1),lt=y.length;for(let dt=0;dt<K;dt++){const vt=O+dt*at,_t=B+dt*mt;y.emplaceBack(vt,_t);const Wt=this._globePoint(vt,_t,i,s,u,f,m);w.emplaceBack(Wt[0],Wt[1],Wt[2]),x.emplaceBack(lt+dt)}},L=ir;M(0,0,L,0,16),M(L,0,L,L,16),M(L,L,0,L,16),M(0,L,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(x),this._tileDebugBuffer=t.createVertexBuffer(y,hc.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(w,Hd.members),this._tileDebugSegments=Nn.simpleSegment(0,0,y.length,x.length)}_makeGlobeTileDebugTextBuffer(t,i,s,u,f,m){const y=ir/4,x=new ye,w=new Je,M=new Vt,L=25;w.reserve(32),x.reserve(L),M.reserve(L);const O=(B,F)=>L*B+F;for(let B=0;B<L;B++){const F=B*y;for(let q=0;q<L;q++){const K=q*y;x.emplaceBack(K,F);const at=this._globePoint(K,F,i,s,u,f,m);M.emplaceBack(at[0],at[1],at[2])}}for(let B=0;B<4;B++)for(let F=0;F<4;F++){const q=O(B,F),K=O(B,F+1),at=O(B+1,F),mt=O(B+1,F+1);w.emplaceBack(q,K,at),w.emplaceBack(at,K,mt)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(w),this._tileDebugTextBuffer=t.createVertexBuffer(x,hc.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(M,Hd.members),this._tileDebugTextSegments=Nn.simpleSegment(0,0,L,32)}}class x0{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,i,s){const u=String(i);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][u]=this.stateChanges[t][u]||{},ur(this.stateChanges[t][u],s),this.deletedStates[t]===null){this.deletedStates[t]={};for(const f in this.state[t])f!==u&&(this.deletedStates[t][f]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][u]===null){this.deletedStates[t][u]={};for(const f in this.state[t][u])s[f]||(this.deletedStates[t][u][f]=null)}else for(const f in s)this.deletedStates[t]&&this.deletedStates[t][u]&&this.deletedStates[t][u][f]===null&&delete this.deletedStates[t][u][f]}removeFeatureState(t,i,s){if(this.deletedStates[t]===null)return;const u=String(i);if(this.deletedStates[t]=this.deletedStates[t]||{},s&&i!==void 0)this.deletedStates[t][u]!==null&&(this.deletedStates[t][u]=this.deletedStates[t][u]||{},this.deletedStates[t][u][s]=null);else if(i!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][u])for(s in this.deletedStates[t][u]={},this.stateChanges[t][u])this.deletedStates[t][u][s]=null;else this.deletedStates[t][u]=null;else this.deletedStates[t]=null}getState(t,i){const s=String(i),u=ur({},(this.state[t]||{})[s],(this.stateChanges[t]||{})[s]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const f=this.deletedStates[t][i];if(f===null)return{};for(const m in f)delete u[m]}return u}initializeTileState(t,i){t.setFeatureState(this.state,i)}coalesceChanges(t,i){const s={};for(const u in this.stateChanges){this.state[u]=this.state[u]||{};const f={};for(const m in this.stateChanges[u])this.state[u][m]||(this.state[u][m]={}),ur(this.state[u][m],this.stateChanges[u][m]),f[m]=this.state[u][m];s[u]=f}for(const u in this.deletedStates){this.state[u]=this.state[u]||{};const f={};if(this.deletedStates[u]===null)for(const m in this.state[u])f[m]={},this.state[u][m]={};else for(const m in this.deletedStates[u]){if(this.deletedStates[u][m]===null)this.state[u][m]={};else if(this.state[u][m])for(const y of Object.keys(this.deletedStates[u][m]))delete this.state[u][m][y];f[m]=this.state[u][m]}s[u]=s[u]||{},ur(s[u],f)}if(this.stateChanges={},this.deletedStates={},Object.keys(s).length!==0)for(const u in t)t[u].setFeatureState(s,i)}}class Rg{constructor(t){this.size=t,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(t,i){const s=this.toIdx(t,i);return{min:this.minimums[s],max:this.maximums[s]}}isLeaf(t,i){return this.leaves[this.toIdx(t,i)]}toIdx(t,i){return i*this.size+t}}function Og(e,t,i,s){let u=0,f=Number.MAX_VALUE;for(let m=0;m<3;m++)if(Math.abs(s[m])<1e-15){if(i[m]<e[m]||i[m]>t[m])return null}else{const y=1/s[m];let x=(e[m]-i[m])*y,w=(t[m]-i[m])*y;if(x>w){const M=x;x=w,w=M}if(x>u&&(u=x),w<f&&(f=w),u>f)return null}return u}function Ng(e,t,i,s,u,f,m,y,x,w,M){const L=s-e,O=u-t,B=f-i,F=m-e,q=y-t,K=x-i,at=M[1]*K-M[2]*q,mt=M[2]*F-M[0]*K,lt=M[0]*q-M[1]*F,dt=L*at+O*mt+B*lt;if(Math.abs(dt)<1e-15)return null;const vt=1/dt,_t=w[0]-e,Wt=w[1]-t,Gt=w[2]-i,oe=(_t*at+Wt*mt+Gt*lt)*vt;if(oe<0||oe>1)return null;const ve=Wt*B-Gt*O,te=Gt*L-_t*B,ce=_t*O-Wt*L,he=(M[0]*ve+M[1]*te+M[2]*ce)*vt;return he<0||oe+he>1?null:(F*ve+q*te+K*ce)*vt}function zg(e,t,i){return(e-t)/(i-t)}function kg(e,t,i,s,u,f,m,y,x){const w=1<<i,M=f-s,L=m-u,O=(e+1)/w*M+s,B=(t+0)/w*L+u,F=(t+1)/w*L+u;y[0]=(e+0)/w*M+s,y[1]=B,x[0]=O,x[1]=F}class Bg{constructor(t){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=t,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const i=function(f){const m=Math.ceil(Math.log2(f.dim/8)),y=[];let x=Math.ceil(Math.pow(2,m));const w=1/x,M=(B,F,q,K,at)=>{const mt=K?1:0,lt=(B+1)*q-mt,dt=F*q,vt=(F+1)*q-mt;at[0]=B*q,at[1]=dt,at[2]=lt,at[3]=vt};let L=new Rg(x);const O=[];for(let B=0;B<x*x;B++){M(B%x,Math.floor(B/x),w,!1,O);const F=Dl(O[0],O[1],f),q=Dl(O[2],O[1],f),K=Dl(O[2],O[3],f),at=Dl(O[0],O[3],f);L.minimums.push(Math.min(F,q,K,at)),L.maximums.push(Math.max(F,q,K,at)),L.leaves.push(1)}for(y.push(L),x/=2;x>=1;x/=2){const B=y[y.length-1];L=new Rg(x);for(let F=0;F<x*x;F++){M(F%x,Math.floor(F/x),2,!0,O);const q=B.getElevation(O[0],O[1]),K=B.getElevation(O[2],O[1]),at=B.getElevation(O[2],O[3]),mt=B.getElevation(O[0],O[3]),lt=B.isLeaf(O[0],O[1]),dt=B.isLeaf(O[2],O[1]),vt=B.isLeaf(O[2],O[3]),_t=B.isLeaf(O[0],O[3]),Wt=Math.min(q.min,K.min,at.min,mt.min),Gt=Math.max(q.max,K.max,at.max,mt.max),oe=lt&&dt&&vt&&_t;L.maximums.push(Gt),L.minimums.push(Wt),L.leaves.push(Gt-Wt<=5&&oe?1:0)}y.push(L)}return y}(this.dem),s=i.length-1,u=i[s];this._addNode(u.minimums[0],u.maximums[0],u.leaves[0]),this._construct(i,0,0,s,0)}raycastRoot(t,i,s,u,f,m,y=1){return Og([t,i,-100],[s,u,this.maximums[0]*y],f,m)}raycast(t,i,s,u,f,m,y=1){if(!this.nodeCount)return null;const x=this.raycastRoot(t,i,s,u,f,m,y);if(x==null)return null;const w=[],M=[],L=[],O=[],B=[{idx:0,t:x,nodex:0,nodey:0,depth:0}];for(;B.length>0;){const{idx:F,t:q,nodex:K,nodey:at,depth:mt}=B.pop();if(this.leaves[F]){kg(K,at,mt,t,i,s,u,L,O);const dt=1<<mt,vt=(K+0)/dt,_t=(K+1)/dt,Wt=(at+0)/dt,Gt=(at+1)/dt,oe=Dl(vt,Wt,this.dem)*y,ve=Dl(_t,Wt,this.dem)*y,te=Dl(_t,Gt,this.dem)*y,ce=Dl(vt,Gt,this.dem)*y,he=Ng(L[0],L[1],oe,O[0],L[1],ve,O[0],O[1],te,f,m),me=Ng(O[0],O[1],te,L[0],O[1],ce,L[0],L[1],oe,f,m),Te=Math.min(he!==null?he:Number.MAX_VALUE,me!==null?me:Number.MAX_VALUE);if(Te!==Number.MAX_VALUE)return Te;{const ne=uc([],f,m,q);if(Fg(oe,ve,ce,te,zg(ne[0],L[0],O[0]),zg(ne[1],L[1],O[1]))>=ne[2])return q}continue}let lt=0;for(let dt=0;dt<this._siblingOffset.length;dt++){kg((K<<1)+this._siblingOffset[dt][0],(at<<1)+this._siblingOffset[dt][1],mt+1,t,i,s,u,L,O),L[2]=-100,O[2]=this.maximums[this.childOffsets[F]+dt]*y;const vt=Og(L,O,f,m);if(vt!=null){const _t=vt;w[dt]=_t;let Wt=!1;for(let Gt=0;Gt<lt&&!Wt;Gt++)_t>=w[M[Gt]]&&(M.splice(Gt,0,dt),Wt=!0);Wt||(M[lt]=dt),lt++}}for(let dt=0;dt<lt;dt++){const vt=M[dt];B.push({idx:this.childOffsets[F]+vt,t:w[vt],nodex:(K<<1)+this._siblingOffset[vt][0],nodey:(at<<1)+this._siblingOffset[vt][1],depth:mt+1})}}return null}_addNode(t,i,s){return this.minimums.push(t),this.maximums.push(i),this.leaves.push(s),this.childOffsets.push(0),this.nodeCount++}_construct(t,i,s,u,f){if(t[u].isLeaf(i,s)===1)return;this.childOffsets[f]||(this.childOffsets[f]=this.nodeCount);const m=u-1,y=t[m];let x=0,w=0;for(let M=0;M<this._siblingOffset.length;M++){const L=2*i+this._siblingOffset[M][0],O=2*s+this._siblingOffset[M][1],B=y.getElevation(L,O),F=y.isLeaf(L,O),q=this._addNode(B.min,B.max,F);F&&(x|=1<<M),w||(w=q)}for(let M=0;M<this._siblingOffset.length;M++)x&1<<M||this._construct(t,2*i+this._siblingOffset[M][0],2*s+this._siblingOffset[M][1],m,w+M)}}function Fg(e,t,i,s,u,f){return Mr(Mr(e,i,f),Mr(t,s,f),u)}function Dl(e,t,i){const s=i.dim,u=Ye(e*s-.5,0,s-1),f=Ye(t*s-.5,0,s-1),m=Math.floor(u),y=Math.floor(f),x=Math.min(m+1,s-1),w=Math.min(y+1,s-1);return Fg(i.get(m,y),i.get(x,y),i.get(m,w),i.get(x,w),u-m,f-y)}const Ug={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function b0(e,t,i){return(256*e*256+256*t+i)/10-1e4}function w0(e,t,i){return 256*e+t+i/256-32768}class Xh{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(t,i,s,u=!1,f=!1){if(this.uid=t,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(s&&s!=="mapbox"&&s!=="terrarium")return Dr(`"${s}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;const m=this.dim=i.height-2,y=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.encoding=s||"mapbox",this.borderReady=u,!u){for(let x=0;x<m;x++)y[this._idx(-1,x)]=y[this._idx(0,x)],y[this._idx(m,x)]=y[this._idx(m-1,x)],y[this._idx(x,-1)]=y[this._idx(x,0)],y[this._idx(x,m)]=y[this._idx(x,m-1)];y[this._idx(-1,-1)]=y[this._idx(0,0)],y[this._idx(m,-1)]=y[this._idx(m-1,0)],y[this._idx(-1,m)]=y[this._idx(0,m-1)],y[this._idx(m,m)]=y[this._idx(m-1,m-1)],f&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new Bg(this)}get(t,i,s=!1){s&&(t=Ye(t,-1,this.dim),i=Ye(i,-1,this.dim));const u=4*this._idx(t,i);return(this.encoding==="terrarium"?w0:b0)(this.pixels[u],this.pixels[u+1],this.pixels[u+2])}static getUnpackVector(t){return Ug[t]}get unpackVector(){return Ug[this.encoding]}_idx(t,i){if(t<-1||t>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(t+1)}static pack(t,i){const s=[0,0,0,0],u=Xh.getUnpackVector(i);let f=Math.floor((t+u[3])/u[2]);return s[2]=f%256,f=Math.floor(f/256),s[1]=f%256,f=Math.floor(f/256),s[0]=f,s}getPixels(){return new Rs({width:this.stride,height:this.stride},this.pixels)}backfillBorder(t,i,s){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let u=i*this.dim,f=i*this.dim+this.dim,m=s*this.dim,y=s*this.dim+this.dim;switch(i){case-1:u=f-1;break;case 1:f=u+1}switch(s){case-1:m=y-1;break;case 1:y=m+1}const x=-i*this.dim,w=-s*this.dim;for(let M=m;M<y;M++)for(let L=u;L<f;L++){const O=4*this._idx(L,M),B=4*this._idx(L+x,M+w);this.pixels[O+0]=t.pixels[B+0],this.pixels[O+1]=t.pixels[B+1],this.pixels[O+2]=t.pixels[B+2],this.pixels[O+3]=t.pixels[B+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}De(Xh,"DEMData"),De(Bg,"DemMinMaxQuadTree",{omit:["dem"]});class E0{constructor(t,i){this.max=t,this.onRemove=i,this.reset()}reset(){for(const t in this.data)for(const i of this.data[t])i.timeout&&clearTimeout(i.timeout),this.onRemove(i.value);return this.data={},this.order=[],this}add(t,i,s){const u=t.wrapped().key;this.data[u]===void 0&&(this.data[u]=[]);const f={value:i,timeout:void 0};if(s!==void 0&&(f.timeout=setTimeout(()=>{this.remove(t,f)},s)),this.data[u].push(f),this.order.push(u),this.order.length>this.max){const m=this._getAndRemoveByKey(this.order[0]);m&&this.onRemove(m)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const i=this.data[t].shift();return i.timeout&&clearTimeout(i.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),i.value}getByKey(t){const i=this.data[t];return i?i[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,i){if(!this.has(t))return this;const s=t.wrapped().key,u=i===void 0?0:this.data[s].indexOf(i),f=this.data[s][u];return this.data[s].splice(u,1),f.timeout&&clearTimeout(f.timeout),this.data[s].length===0&&delete this.data[s],this.onRemove(f.value),this.order.splice(this.order.indexOf(s),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const i=this._getAndRemoveByKey(this.order[0]);i&&this.onRemove(i)}return this}filter(t){const i=[];for(const s in this.data)for(const u of this.data[s])t(u.value)||i.push(u);for(const s of i)this.remove(s.value.tileID,s)}}class Au{constructor(t,i,s){this.func=t,this.mask=i,this.range=s}}Au.ReadOnly=!1,Au.ReadWrite=!0,Au.disabled=new Au(519,Au.ReadOnly,[0,1]);const xf=7680;class bf{constructor(t,i,s,u,f,m){this.test=t,this.ref=i,this.mask=s,this.fail=u,this.depthFail=f,this.pass=m}}bf.disabled=new bf({func:519,mask:0},0,0,xf,xf,xf);class Wa{constructor(t,i,s){this.blendFunction=t,this.blendColor=i,this.mask=s}}Wa.Replace=[1,0],Wa.disabled=new Wa(Wa.Replace,Yr.transparent,[!1,!1,!1,!1]),Wa.unblended=new Wa(Wa.Replace,Yr.transparent,[!0,!0,!0,!0]),Wa.alphaBlended=new Wa([1,771],Yr.transparent,[!0,!0,!0,!0]);const wf=1029,Ef=2305;class Pa{constructor(t,i,s){this.enable=t,this.mode=i,this.frontFace=s}}Pa.disabled=new Pa(!1,wf,Ef),Pa.backCCW=new Pa(!0,wf,Ef),Pa.backCW=new Pa(!0,wf,2304),Pa.frontCW=new Pa(!0,1028,2304),Pa.frontCCW=new Pa(!0,1028,Ef);class tu extends Ks{constructor(t,i,s){super(),this.id=t,this._onlySymbols=s,i.on("data",u=>{u.dataType==="source"&&u.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&u.dataType==="source"&&u.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),i.on("error",()=>{this._sourceErrored=!0}),this._source=i,this._tiles={},this._cache=new E0(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=i.minTileCacheSize,this._maxTileCacheSize=i.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new x0,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(t){this.map=t,this._minTileCacheSize=this._minTileCacheSize===void 0&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles){const i=this._tiles[t];if(i.state!=="loaded"&&i.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,i){return t.isSymbolTile=this._onlySymbols,this._source.loadTile(t,i)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t,()=>{})}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t,()=>{})}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const i in this._tiles){const s=this._tiles[i];s.upload(t),s.prepare(this.map.style.imageManager)}}getIds(){return Ot(this._tiles).map(t=>t.tileID).sort(Vg).map(t=>t.key)}getRenderableIds(t){const i=[];for(const s in this._tiles)this._isIdRenderable(+s,t)&&i.push(this._tiles[s]);return t?i.sort((s,u)=>{const f=s.tileID,m=u.tileID,y=new $t(f.canonical.x,f.canonical.y)._rotate(this.transform.angle),x=new $t(m.canonical.x,m.canonical.y)._rotate(this.transform.angle);return f.overscaledZ-m.overscaledZ||x.y-y.y||x.x-y.x}).map(s=>s.tileID.key):i.map(s=>s.tileID).sort(Vg).map(s=>s.key)}hasRenderableParent(t){const i=this.findLoadedParent(t,0);return!!i&&this._isIdRenderable(i.tileID.key)}_isIdRenderable(t,i){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(i||!this._tiles[t].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(+t,"reloading")}}_reloadTile(t,i){const s=this._tiles[t];s&&(s.state!=="loading"&&(s.state=i),this._loadTile(s,this._tileLoaded.bind(this,s,t,i)))}_tileLoaded(t,i,s,u){if(u)if(t.state="errored",u.status!==404)this._source.fire(new un(u,{tile:t}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const f=this.map.painter.terrain;this.update(this.transform,f.getScaledDemTileSize(),!0),f.resetTileLookupCache(this.id)}else this.update(this.transform);else t.timeAdded=ai.now(),s==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(i,t),this._source.type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new Zn("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id}))}_backfillDEM(t){const i=this.getRenderableIds();for(let u=0;u<i.length;u++){const f=i[u];if(t.neighboringTiles&&t.neighboringTiles[f]){const m=this.getTileByID(f);s(t,m),s(m,t)}}function s(u,f){if(!u.dem||u.dem.borderReady)return;u.needsHillshadePrepare=!0,u.needsDEMTextureUpload=!0;let m=f.tileID.canonical.x-u.tileID.canonical.x;const y=f.tileID.canonical.y-u.tileID.canonical.y,x=Math.pow(2,u.tileID.canonical.z),w=f.tileID.key;m===0&&y===0||Math.abs(y)>1||(Math.abs(m)>1&&(Math.abs(m+x)===1?m+=x:Math.abs(m-x)===1&&(m-=x)),f.dem&&u.dem&&(u.dem.backfillBorder(f.dem,m,y),u.neighboringTiles&&u.neighboringTiles[w]&&(u.neighboringTiles[w].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,i,s,u){for(const f in this._tiles){let m=this._tiles[f];if(u[f]||!m.hasData()||m.tileID.overscaledZ<=i||m.tileID.overscaledZ>s)continue;let y=m.tileID;for(;m&&m.tileID.overscaledZ>i+1;){const w=m.tileID.scaledTo(m.tileID.overscaledZ-1);m=this._tiles[w.key],m&&m.hasData()&&(y=w)}let x=y;for(;x.overscaledZ>i;)if(x=x.scaledTo(x.overscaledZ-1),t[x.key]){u[y.key]=y;break}}}findLoadedParent(t,i){if(t.key in this._loadedParentTiles){const s=this._loadedParentTiles[t.key];return s&&s.tileID.overscaledZ>=i?s:null}for(let s=t.overscaledZ-1;s>=i;s--){const u=t.scaledTo(s),f=this._getLoadedTile(u);if(f)return f}}_getLoadedTile(t){const i=this._tiles[t.key];return i&&i.hasData()?i:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,i){i=i||this._source.tileSize;const s=Math.ceil(t.width/i)+1,u=Math.ceil(t.height/i)+1,f=Math.floor(s*u*5),m=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,f):f,y=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,m):m;this._cache.setMaxSize(y)}handleWrapJump(t){const i=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,i){const s={};for(const u in this._tiles){const f=this._tiles[u];f.tileID=f.tileID.unwrapTo(f.tileID.wrap+i),s[f.tileID.key]=f}this._tiles=s;for(const u in this._timers)clearTimeout(this._timers[u]),delete this._timers[u];for(const u in this._tiles)this._setTileReloadTimer(+u,this._tiles[u])}}update(t,i,s){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!s)return;let u;this.updateCacheSize(t,i),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?u=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(y=>new as(y.canonical.z,y.wrap,y.canonical.z,y.canonical.x,y.canonical.y)):(u=t.coveringTiles({tileSize:i||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!s,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(u=u.filter(y=>this._source.hasTile(y)))):u=[];const f=this._updateRetainedTiles(u);if(Gg(this._source.type)&&u.length!==0){const y={},x={},w=Object.keys(f);for(const L of w){const O=f[L],B=this._tiles[L];if(!B||B.fadeEndTime&&B.fadeEndTime<=ai.now())continue;const F=this.findLoadedParent(O,Math.max(O.overscaledZ-tu.maxOverzooming,this._source.minzoom));F&&(this._addTile(F.tileID),y[F.tileID.key]=F.tileID),x[L]=O}const M=u[u.length-1].overscaledZ;for(const L in this._tiles){const O=this._tiles[L];if(f[L]||!O.hasData())continue;let B=O.tileID;for(;B.overscaledZ>M;){B=B.scaledTo(B.overscaledZ-1);const F=this._tiles[B.key];if(F&&F.hasData()&&x[B.key]){f[L]=O.tileID;break}}}for(const L in y)f[L]||(this._coveredTiles[L]=!0,f[L]=y[L])}for(const y in f)this._tiles[y].clearFadeHold();const m=function(y,x){const w=[];for(const M in y)M in x||w.push(M);return w}(this._tiles,f);for(const y of m){const x=this._tiles[y];x.hasSymbolBuckets&&!x.holdingForFade()?x.setHoldDuration(this.map._fadeDuration):x.hasSymbolBuckets&&!x.symbolFadeFinished()||this._removeTile(+y)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const i={};if(t.length===0)return i;const s={},u=t.reduce((w,M)=>Math.min(w,M.overscaledZ),1/0),f=t[0].overscaledZ,m=Math.max(f-tu.maxOverzooming,this._source.minzoom),y=Math.max(f+tu.maxUnderzooming,this._source.minzoom),x={};for(const w of t){const M=this._addTile(w);i[w.key]=w,M.hasData()||u<this._source.maxzoom&&(x[w.key]=w)}this._retainLoadedChildren(x,u,y,i);for(const w of t){let M=this._tiles[w.key];if(M.hasData())continue;if(w.canonical.z>=this._source.maxzoom){const O=w.children(this._source.maxzoom)[0],B=this.getTile(O);if(B&&B.hasData()){i[O.key]=O;continue}}else{const O=w.children(this._source.maxzoom);if(i[O[0].key]&&i[O[1].key]&&i[O[2].key]&&i[O[3].key])continue}let L=M.wasRequested();for(let O=w.overscaledZ-1;O>=m;--O){const B=w.scaledTo(O);if(s[B.key]||(s[B.key]=!0,M=this.getTile(B),!M&&L&&(M=this._addTile(B)),M&&(i[B.key]=B,L=M.wasRequested(),M.hasData())))break}}return i}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const i=[];let s,u=this._tiles[t].tileID;for(;u.overscaledZ>0;){if(u.key in this._loadedParentTiles){s=this._loadedParentTiles[u.key];break}i.push(u.key);const f=u.scaledTo(u.overscaledZ-1);if(s=this._getLoadedTile(f),s)break;u=f}for(const f of i)this._loadedParentTiles[f]=s}}_addTile(t){let i=this._tiles[t.key];if(i)return i;i=this._cache.getAndRemove(t),i&&(this._setTileReloadTimer(t.key,i),i.tileID=t,this._state.initializeTileState(i,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,i)));const s=!!i;if(!s){const u=this.map?this.map.painter:null;i=new vf(t,this._source.tileSize*t.overscaleFactor(),this.transform.tileZoom,u,this._isRaster),this._loadTile(i,this._tileLoaded.bind(this,i,t.key,i.state))}return i?(i.uses++,this._tiles[t.key]=i,s||this._source.fire(new Zn("dataloading",{tile:i,coord:i.tileID,dataType:"source"})),i):null}_setTileReloadTimer(t,i){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const s=i.getExpiryTimeout();s&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},s))}_removeTile(t){const i=this._tiles[t];i&&(i.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),i.uses>0||(i.hasData()&&i.state!=="reloading"?this._cache.add(i.tileID,i,i.getExpiryTimeout()):(i.aborted=!0,this._abortTile(i),this._unloadTile(i))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,i,s){const u=[],f=this.transform;if(!f)return u;const m=f.projection.name==="globe",y=qa(f.center.lng);for(const x in this._tiles){const w=this._tiles[x];if(s&&w.clearQueryDebugViz(),w.holdingForFade())continue;let M;if(m){const L=w.tileID.canonical;if(L.z===0){const O=[Math.abs(Ye(y,...Oc(L,-1))-y),Math.abs(Ye(y,...Oc(L,1))-y)];M=[0,2*O.indexOf(Math.min(...O))-1]}else{const O=[Math.abs(Ye(y,...Oc(L,-1))-y),Math.abs(Ye(y,...Oc(L,0))-y),Math.abs(Ye(y,...Oc(L,1))-y)];M=[O.indexOf(Math.min(...O))-1]}}else M=[0];for(const L of M){const O=t.containsTile(w,f,i,L);O&&u.push(O)}}return u}getVisibleCoordinates(t){const i=this.getRenderableIds(t).map(s=>this._tiles[s].tileID);for(const s of i)s.projMatrix=this.transform.calculateProjMatrix(s.toUnwrapped());return i}hasTransition(){if(this._source.hasTransition())return!0;if(Gg(this._source.type))for(const t in this._tiles){const i=this._tiles[t];if(i.fadeEndTime!==void 0&&i.fadeEndTime>=ai.now())return!0}return!1}setFeatureState(t,i,s){this._state.updateState(t=t||"_geojsonTileLayer",i,s)}removeFeatureState(t,i,s){this._state.removeFeatureState(t=t||"_geojsonTileLayer",i,s)}getFeatureState(t,i){return this._state.getState(t=t||"_geojsonTileLayer",i)}setDependencies(t,i,s){const u=this._tiles[t];u&&u.setDependencies(i,s)}reloadTilesForDependencies(t,i){for(const s in this._tiles)this._tiles[s].hasDependency(t,i)&&this._reloadTile(+s,"reloading");this._cache.filter(s=>!s.hasDependency(t,i))}_preloadTiles(t,i){if(!this._sourceLoaded){const y=()=>{this._sourceLoaded&&(this._source.off("data",y),this._preloadTiles(t,i))};return void this._source.on("data",y)}const s=new Map,u=Array.isArray(t)?t:[t],f=this.map.painter.terrain,m=this.usedForTerrain&&f?f.getScaledDemTileSize():this._source.tileSize;for(const y of u){const x=y.coveringTiles({tileSize:m,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const w of x)s.set(w.key,w);this.usedForTerrain&&y.updateElevation(!1)}tr(Array.from(s.values()),(y,x)=>{const w=new vf(y,this._source.tileSize*y.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(w,M=>{this._source.type==="raster-dem"&&w.dem&&this._backfillDEM(w),x(M,w)})},i)}}function Vg(e,t){const i=Math.abs(2*e.wrap)-+(e.wrap<0),s=Math.abs(2*t.wrap)-+(t.wrap<0);return e.overscaledZ-t.overscaledZ||s-i||t.canonical.y-e.canonical.y||t.canonical.x-e.canonical.x}function Gg(e){return e==="raster"||e==="image"||e==="video"||e==="custom"}function Oc(e,t){const i=1<<e.z;return[e.x/i+t,(e.x+1)/i+t]}tu.maxOverzooming=10,tu.maxUnderzooming=3;class Zh{constructor(t,i,s){this._demTile=t,this._dem=this._demTile.dem,this._scale=i,this._offset=s}static create(t,i,s){const u=s||t.findDEMTileFor(i);if(!u||!u.dem)return;const f=u.dem,m=u.tileID,y=1<<i.canonical.z-m.canonical.z;return new Zh(u,u.tileSize/ir/y,[(i.canonical.x/y-m.canonical.x)*f.dim,(i.canonical.y/y-m.canonical.y)*f.dim])}tileCoordToPixel(t,i){const s=i*this._scale+this._offset[1],u=Math.floor(t*this._scale+this._offset[0]),f=Math.floor(s);return new $t(u,f)}getElevationAt(t,i,s,u){const f=t*this._scale+this._offset[0],m=i*this._scale+this._offset[1],y=Math.floor(f),x=Math.floor(m),w=this._dem;return u=!!u,s?Mr(Mr(w.get(y,x,u),w.get(y,x+1,u),m-x),Mr(w.get(y+1,x,u),w.get(y+1,x+1,u),m-x),f-y):w.get(y,x,u)}getElevationAtPixel(t,i,s){return this._dem.get(t,i,!!s)}getMeterToDEM(t){return(1<<this._demTile.tileID.canonical.z)*Ca(1,t)*this._dem.stride}}class jg{constructor(t,i){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Vr(ir,16,0),this.featureIndexArray=new Gl,this.promoteId=i}insert(t,i,s,u,f,m=0){const y=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,u,f,m);const x=this.grid;for(let w=0;w<i.length;w++){const M=i[w],L=[1/0,1/0,-1/0,-1/0];for(let O=0;O<M.length;O++){const B=M[O];L[0]=Math.min(L[0],B.x),L[1]=Math.min(L[1],B.y),L[2]=Math.max(L[2],B.x),L[3]=Math.max(L[3],B.y)}L[0]<ir&&L[1]<ir&&L[2]>=0&&L[3]>=0&&x.insert(y,L[0],L[1],L[2],L[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new rf(new Rh(this.rawTileData)).layers,this.sourceLayerCoder=new Mg(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const t in this.vtLayers)this.vtFeatures[t]=[]}return this.vtLayers}query(t,i,s,u){this.loadVTLayers();const f=t.params||{},m=bl(f.filter),y=t.tileResult,x=t.transform,w=y.bufferedTilespaceBounds,M=this.grid.query(w.min.x,w.min.y,w.max.x,w.max.y,(F,q,K,at)=>dm(y.bufferedTilespaceGeometry,F,q,K,at));M.sort(T0);let L=null;x.elevation&&M.length>0&&(L=Zh.create(x.elevation,this.tileID));const O={};let B;for(let F=0;F<M.length;F++){const q=M[F];if(q===B)continue;B=q;const K=this.featureIndexArray.get(q);let at=null;this.loadMatchingFeature(O,K,m,f.layers,f.availableImages,i,s,u,(mt,lt,dt,vt=0)=>(at||(at=hl(mt,this.tileID.canonical,t.tileTransform)),lt.queryIntersectsFeature(y,mt,dt,at,this.z,t.transform,t.pixelPosMatrix,L,vt)))}return O}loadMatchingFeature(t,i,s,u,f,m,y,x,w){const{featureIndex:M,bucketIndex:L,sourceLayerIndex:O,layoutVertexArrayOffset:B}=i,F=this.bucketLayerIDs[L];if(u&&!function(mt,lt){for(let dt=0;dt<mt.length;dt++)if(lt.indexOf(mt[dt])>=0)return!0;return!1}(u,F))return;const q=this.sourceLayerCoder.decode(O),K=this.vtLayers[q].feature(M);if(s.needGeometry){const mt=Hl(K,!0);if(!s.filter(new P(this.tileID.overscaledZ),mt,this.tileID.canonical))return}else if(!s.filter(new P(this.tileID.overscaledZ),K))return;const at=this.getId(K,q);for(let mt=0;mt<F.length;mt++){const lt=F[mt];if(u&&u.indexOf(lt)<0)continue;const dt=m[lt];if(!dt)continue;let vt={};at!==void 0&&x&&(vt=x.getState(dt.sourceLayer||"_geojsonTileLayer",at));const _t=ur({},y[lt]);_t.paint=qg(_t.paint,dt.paint,K,vt,f),_t.layout=qg(_t.layout,dt.layout,K,vt,f);const Wt=!w||w(K,dt,vt,B);if(!Wt)continue;const Gt=new Ag(K,this.z,this.x,this.y,at);Gt.layer=_t;let oe=t[lt];oe===void 0&&(oe=t[lt]=[]),oe.push({featureIndex:M,feature:Gt,intersectionZ:Wt})}}lookupSymbolFeatures(t,i,s,u,f,m,y,x){const w={};this.loadVTLayers();const M=bl(f);for(const L of t)this.loadMatchingFeature(w,{bucketIndex:s,sourceLayerIndex:u,featureIndex:L,layoutVertexArrayOffset:0},M,m,y,x,i);return w}loadFeature(t){const{featureIndex:i,sourceLayerIndex:s}=t;this.loadVTLayers();const u=this.sourceLayerCoder.decode(s),f=this.vtFeatures[u];if(f[i])return f[i];const m=this.vtLayers[u].feature(i);return f[i]=m,m}hasLayer(t){for(const i of this.bucketLayerIDs)for(const s of i)if(t===s)return!0;return!1}getId(t,i){let s=t.id;if(this.promoteId){const u=typeof this.promoteId=="string"?this.promoteId:this.promoteId[i];u!=null&&(s=t.properties[u]),typeof s=="boolean"&&(s=Number(s))}return s}}function qg(e,t,i,s,u){return He(e,(f,m)=>{const y=t instanceof st?t.get(m):null;return y&&y.evaluate?y.evaluate(i,s,u):y})}function T0(e,t){return t-e}De(jg,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class $g{constructor(t,i){this.width=t,this.height=i,this.nextRow=0,this.image=new pl({width:t,height:i}),this.positions={},this.uploaded=!1}getDash(t,i){const s=this.getKey(t,i);return this.positions[s]}trim(){const t=this.width,i=this.height=Zr(this.nextRow);this.image.resize({width:t,height:i})}getKey(t,i){return t.join(",")+i}getDashRanges(t,i,s){const u=[];let f=t.length%2==1?-t[t.length-1]*s:0,m=t[0]*s,y=!0;u.push({left:f,right:m,isDash:y,zeroLength:t[0]===0});let x=t[0];for(let w=1;w<t.length;w++){y=!y;const M=t[w];f=x*s,x+=M,m=x*s,u.push({left:f,right:m,isDash:y,zeroLength:M===0})}return u}addRoundDash(t,i,s){const u=i/2;for(let f=-s;f<=s;f++){const m=this.width*(this.nextRow+s+f);let y=0,x=t[y];for(let w=0;w<this.width;w++){w/x.right>1&&(x=t[++y]);const M=Math.abs(w-x.left),L=Math.abs(w-x.right),O=Math.min(M,L);let B;const F=f/s*(u+1);if(x.isDash){const q=u-Math.abs(F);B=Math.sqrt(O*O+q*q)}else B=u-Math.sqrt(O*O+F*F);this.image.data[m+w]=Math.max(0,Math.min(255,B+128))}}}addRegularDash(t,i){for(let x=t.length-1;x>=0;--x){const w=t[x],M=t[x+1];w.zeroLength?t.splice(x,1):M&&M.isDash===w.isDash&&(M.left=w.left,t.splice(x,1))}const s=t[0],u=t[t.length-1];s.isDash===u.isDash&&(s.left=u.left-this.width,u.right=s.right+this.width);const f=this.width*this.nextRow;let m=0,y=t[m];for(let x=0;x<this.width;x++){x/y.right>1&&(y=t[++m]);const w=Math.abs(x-y.left),M=Math.abs(x-y.right),L=Math.min(w,M);this.image.data[f+x]=Math.max(0,Math.min(255,(y.isDash?L:-L)+i+128))}}addDash(t,i){const s=this.getKey(t,i);if(this.positions[s])return this.positions[s];const u=i==="round",f=u?7:0,m=2*f+1;if(this.nextRow+m>this.height)return Dr("LineAtlas out of space"),null;t.length===0&&t.push(1);let y=0;for(let M=0;M<t.length;M++)t[M]<0&&(Dr("Negative value is found in line dasharray, replacing values with 0"),t[M]=0),y+=t[M];if(y!==0){const M=this.width/y,L=this.getDashRanges(t,this.width,M);u?this.addRoundDash(L,M,f):this.addRegularDash(L,i==="square"?.5*M:0)}const x=this.nextRow+f;this.nextRow+=m;const w={tl:[x,f],br:[y,0]};return this.positions[s]=w,w}}De($g,"LineAtlas");const Xg=1*Aa;class Zg{constructor(t){const i={},s=[];for(const y in t){const x=t[y],w=i[y]={};for(const M in x.glyphs){const L=x.glyphs[+M];if(!L||L.bitmap.width===0||L.bitmap.height===0)continue;const O=L.metrics.localGlyph?Xg:1,B={x:0,y:0,w:L.bitmap.width+2*O,h:L.bitmap.height+2*O};s.push(B),w[M]=B}}const{w:u,h:f}=af(s),m=new pl({width:u||1,height:f||1});for(const y in t){const x=t[y];for(const w in x.glyphs){const M=x.glyphs[+w];if(!M||M.bitmap.width===0||M.bitmap.height===0)continue;const L=i[y][w],O=M.metrics.localGlyph?Xg:1;pl.copy(M.bitmap,m,{x:0,y:0},{x:L.x+O,y:L.y+O},M.bitmap)}}this.image=m,this.positions=i}}De(Zg,"GlyphAtlas");class I0{constructor(t){this.tileID=new as(t.tileID.overscaledZ,t.tileID.wrap,t.tileID.canonical.z,t.tileID.canonical.x,t.tileID.canonical.y),this.tileZoom=t.tileZoom,this.uid=t.uid,this.zoom=t.zoom,this.canonical=t.tileID.canonical,this.pixelRatio=t.pixelRatio,this.tileSize=t.tileSize,this.source=t.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=t.showCollisionBoxes,this.collectResourceTiming=!!t.collectResourceTiming,this.returnDependencies=!!t.returnDependencies,this.promoteId=t.promoteId,this.enableTerrain=!!t.enableTerrain,this.isSymbolTile=t.isSymbolTile,this.tileTransform=Ql(t.tileID.canonical,t.projection),this.projection=t.projection}parse(t,i,s,u,f){this.status="parsing",this.data=t,this.collisionBoxArray=new Si;const m=new Mg(Object.keys(t.layers).sort()),y=new jg(this.tileID,this.promoteId);y.bucketLayerIDs=[];const x={},w=new $g(256,256),M={featureIndex:y,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:w,availableImages:s},L=i.familiesBySource[this.source];for(const vt in L){const _t=t.layers[vt];if(!_t)continue;let Wt=!1,Gt=!1;for(const te of L[vt])te[0].type==="symbol"?Wt=!0:Gt=!0;if(this.isSymbolTile===!0&&!Wt||this.isSymbolTile===!1&&!Gt)continue;_t.version===1&&Dr(`Vector tile source "${this.source}" layer "${vt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const oe=m.encode(vt),ve=[];for(let te=0;te<_t.length;te++){const ce=_t.feature(te),he=y.getId(ce,vt);ve.push({feature:ce,id:he,index:te,sourceLayerIndex:oe})}for(const te of L[vt]){const ce=te[0];this.isSymbolTile!==void 0&&ce.type==="symbol"!==this.isSymbolTile||ce.minzoom&&this.zoom<Math.floor(ce.minzoom)||ce.maxzoom&&this.zoom>=ce.maxzoom||ce.visibility!=="none"&&(Tf(te,this.zoom,s),(x[ce.id]=ce.createBucket({index:y.bucketLayerIDs.length,layers:te,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:oe,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:s})).populate(ve,M,this.tileID.canonical,this.tileTransform),y.bucketLayerIDs.push(te.map(he=>he.id)))}}let O,B,F,q;w.trim();const K={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},at=()=>{if(O)return f(O);if(B&&F&&q){const vt=new Zg(B),_t=new tg(F,q);for(const Wt in x){const Gt=x[Wt];Gt instanceof Al?(Tf(Gt.layers,this.zoom,s),Kx(Gt,B,vt.positions,F,_t.iconPositions,this.showCollisionBoxes,s,this.tileID.canonical,this.tileZoom,this.projection)):Gt.hasPattern&&(Gt instanceof Ph||Gt instanceof Ih||Gt instanceof wc)&&(Tf(Gt.layers,this.zoom,s),Gt.addFeatures(M,this.tileID.canonical,_t.patternPositions,s,this.tileTransform))}this.status="done",f(null,{buckets:Ot(x).filter(Wt=>!Wt.isEmpty()),featureIndex:y,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:vt.image,lineAtlas:w,imageAtlas:_t,glyphMap:this.returnDependencies?B:null,iconMap:this.returnDependencies?F:null,glyphPositions:this.returnDependencies?vt.positions:null})}},mt=He(M.glyphDependencies,vt=>Object.keys(vt).map(Number));Object.keys(mt).length?u.send("getGlyphs",{uid:this.uid,stacks:mt},(vt,_t)=>{O||(O=vt,B=_t,at())},void 0,!1,K):B={};const lt=Object.keys(M.iconDependencies);lt.length?u.send("getImages",{icons:lt,source:this.source,tileID:this.tileID,type:"icons"},(vt,_t)=>{O||(O=vt,F=_t,at())},void 0,!1,K):F={};const dt=Object.keys(M.patternDependencies);dt.length?u.send("getImages",{icons:dt,source:this.source,tileID:this.tileID,type:"patterns"},(vt,_t)=>{O||(O=vt,q=_t,at())},void 0,!1,K):q={},at()}}function Tf(e,t,i){const s=new P(t);for(const u of e)u.recalculate(s,i)}class Wg{constructor(t){this.entries={},this.scheduler=t}request(t,i,s,u){const f=this.entries[t]=this.entries[t]||{callbacks:[]};if(f.result){const[m,y]=f.result;return this.scheduler?this.scheduler.add(()=>{u(m,y)},i):u(m,y),()=>{}}return f.callbacks.push(u),f.cancel||(f.cancel=s((m,y)=>{f.result=[m,y];for(const x of f.callbacks)this.scheduler?this.scheduler.add(()=>{x(m,y)},i):x(m,y);setTimeout(()=>delete this.entries[t],3e3)})),()=>{f.result||(f.callbacks=f.callbacks.filter(m=>m!==u),f.callbacks.length||(f.cancel(),delete this.entries[t]))}}}function Yg(e,t,i){const s=JSON.stringify(e.request);return e.data&&(this.deduped.entries[s]={result:[null,e.data]}),this.deduped.request(s,{type:"parseTile",isSymbolTile:e.isSymbolTile,zoom:e.tileZoom},u=>{const f=Di(e.request,(m,y,x,w)=>{m?u(m):y&&u(null,{vectorTile:i?void 0:new rf(new Rh(y)),rawData:y,cacheControl:x,expires:w})});return()=>{f.cancel(),u()}},t)}const Hg=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class If{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[i,s]=new Uint8Array(t,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");const u=s>>4;if(u!==1)throw new Error(`Got v${u} data when expected v1.`);const f=Hg[15&s];if(!f)throw new Error("Unrecognized array type.");const[m]=new Uint16Array(t,2,1),[y]=new Uint32Array(t,4,1);return new If(y,m,f,t)}constructor(t,i=64,s=Float64Array,u){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=s,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const f=Hg.indexOf(this.ArrayType),m=2*t*this.ArrayType.BYTES_PER_ELEMENT,y=t*this.IndexArrayType.BYTES_PER_ELEMENT,x=(8-y%8)%8;if(f<0)throw new Error(`Unexpected typed array class: ${s}.`);u&&u instanceof ArrayBuffer?(this.data=u,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+y+x,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+m+y+x),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+y+x,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+f]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=t)}add(t,i){const s=this._pos>>1;return this.ids[s]=s,this.coords[this._pos++]=t,this.coords[this._pos++]=i,s}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return Sf(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,i,s,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:f,coords:m,nodeSize:y}=this,x=[0,f.length-1,0],w=[];for(;x.length;){const M=x.pop()||0,L=x.pop()||0,O=x.pop()||0;if(L-O<=y){for(let K=O;K<=L;K++){const at=m[2*K],mt=m[2*K+1];at>=t&&at<=s&&mt>=i&&mt<=u&&w.push(f[K])}continue}const B=O+L>>1,F=m[2*B],q=m[2*B+1];F>=t&&F<=s&&q>=i&&q<=u&&w.push(f[B]),(M===0?t<=F:i<=q)&&(x.push(O),x.push(B-1),x.push(1-M)),(M===0?s>=F:u>=q)&&(x.push(B+1),x.push(L),x.push(1-M))}return w}within(t,i,s){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:u,coords:f,nodeSize:m}=this,y=[0,u.length-1,0],x=[],w=s*s;for(;y.length;){const M=y.pop()||0,L=y.pop()||0,O=y.pop()||0;if(L-O<=m){for(let K=O;K<=L;K++)Jg(f[2*K],f[2*K+1],t,i)<=w&&x.push(u[K]);continue}const B=O+L>>1,F=f[2*B],q=f[2*B+1];Jg(F,q,t,i)<=w&&x.push(u[B]),(M===0?t-s<=F:i-s<=q)&&(y.push(O),y.push(B-1),y.push(1-M)),(M===0?t+s>=F:i+s>=q)&&(y.push(B+1),y.push(L),y.push(1-M))}return x}}function Sf(e,t,i,s,u,f){if(u-s<=i)return;const m=s+u>>1;Kg(e,t,m,s,u,f),Sf(e,t,i,s,m-1,1-f),Sf(e,t,i,m+1,u,1-f)}function Kg(e,t,i,s,u,f){for(;u>s;){if(u-s>600){const w=u-s+1,M=i-s+1,L=Math.log(w),O=.5*Math.exp(2*L/3),B=.5*Math.sqrt(L*O*(w-O)/w)*(M-w/2<0?-1:1);Kg(e,t,i,Math.max(s,Math.floor(i-M*O/w+B)),Math.min(u,Math.floor(i+(w-M)*O/w+B)),f)}const m=t[2*i+f];let y=s,x=u;for(Nc(e,t,s,i),t[2*u+f]>m&&Nc(e,t,s,u);y<x;){for(Nc(e,t,y,x),y++,x--;t[2*y+f]<m;)y++;for(;t[2*x+f]>m;)x--}t[2*s+f]===m?Nc(e,t,s,x):(x++,Nc(e,t,x,u)),x<=i&&(s=x+1),i<=x&&(u=x-1)}}function Nc(e,t,i,s){Cf(e,i,s),Cf(t,2*i,2*s),Cf(t,2*i+1,2*s+1)}function Cf(e,t,i){const s=e[t];e[t]=e[i],e[i]=s}function Jg(e,t,i,s){const u=e-i,f=t-s;return u*u+f*f}a.ARRAY_TYPE=Ds,a.AUTH_ERR_MSG=et,a.Aabb=ss,a.Actor=class{constructor(e,t,i){this.target=e,this.parent=t,this.mapId=i,this.callbacks={},this.cancelCallbacks={},oi(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=ii()?e:G,this.scheduler=new y0}send(e,t,i,s,u=!1,f){const m=Math.round(1e18*Math.random()).toString(36).substring(0,10);i&&(i.metadata=f,this.callbacks[m]=i);const y=Z(this.globalScope)?void 0:[];return this.target.postMessage({id:m,type:e,hasCallback:!!i,targetMapId:s,mustQueue:u,sourceMapId:this.mapId,data:aa(t,y)},y),{cancel:()=>{i&&delete this.callbacks[m],this.target.postMessage({id:m,type:"<cancel>",targetMapId:s,sourceMapId:this.mapId})}}}receive(e){const t=e.data,i=t.id;if(i&&(!t.targetMapId||this.mapId===t.targetMapId))if(t.type==="<cancel>"){const s=this.cancelCallbacks[i];delete this.cancelCallbacks[i],s&&s.cancel()}else if(t.mustQueue||ii()){const s=this.callbacks[i];this.cancelCallbacks[i]=this.scheduler.add(()=>this.processTask(i,t),s&&s.metadata||{type:"message"})}else this.processTask(i,t)}processTask(e,t){if(t.type==="<response>"){const i=this.callbacks[e];delete this.callbacks[e],i&&(t.error?i(ol(t.error)):i(null,ol(t.data)))}else{const i=Z(this.globalScope)?void 0:[],s=t.hasCallback?(f,m)=>{delete this.cancelCallbacks[e],this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:f?aa(f):null,data:aa(m,i)},i)}:f=>{},u=ol(t.data);if(this.parent[t.type])this.parent[t.type](t.sourceMapId,u,s);else if(this.parent.getWorkerSource){const f=t.type.split(".");this.parent.getWorkerSource(t.sourceMapId,f[0],u.source)[f[1]](u,s)}else s(new Error(`Could not find function ${t.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},a.CanonicalTileID=Ah,a.Color=Yr,a.ColorMode=Wa,a.CullFaceMode=Pa,a.DEMData=Xh,a.DataConstantProperty=j,a.DedupedRequest=Wg,a.DepthMode=Au,a.EXTENT=ir,a.Elevation=class{isDataAvailableAtPoint(e){const t=this._source();if(this.isUsingMockSource()||!t||e.y<0||e.y>1)return!1;const i=t.getSource().maxzoom,s=1<<i,u=Math.floor(e.x),f=Math.floor((e.x-u)*s),m=Math.floor(e.y*s),y=this.findDEMTileFor(new as(i,u,i,f,m));return!(!y||!y.dem)}getAtPointOrZero(e,t=0){return this.getAtPoint(e,t)||0}getAtPoint(e,t,i=!0){if(this.isUsingMockSource())return null;t==null&&(t=null);const s=this._source();if(!s||e.y<0||e.y>1)return t;const u=s.getSource().maxzoom,f=1<<u,m=Math.floor(e.x),y=e.x-m,x=new as(u,m,u,Math.floor(y*f),Math.floor(e.y*f)),w=this.findDEMTileFor(x);if(!w||!w.dem)return t;const M=w.dem,L=1<<w.tileID.canonical.z,O=(y*L-w.tileID.canonical.x)*M.dim,B=(e.y*L-w.tileID.canonical.y)*M.dim,F=Math.floor(O),q=Math.floor(B);return(i?this.exaggeration():1)*Mr(Mr(M.get(F,q),M.get(F,q+1),B-q),Mr(M.get(F+1,q),M.get(F+1,q+1),B-q),O-F)}getAtTileOffset(e,t,i){const s=1<<e.canonical.z;return this.getAtPointOrZero(new mu(e.wrap+(e.canonical.x+t/ir)/s,(e.canonical.y+i/ir)/s))}getAtTileOffsetFunc(e,t,i,s){return u=>{const f=this.getAtTileOffset(e,u.x,u.y),m=s.upVector(e.canonical,u.x,u.y);return Xs(m,m,f*s.upVectorScale(e.canonical,t,i).metersToTile),m}}getForTilePoints(e,t,i,s){if(this.isUsingMockSource())return!1;const u=Zh.create(this,e,s);return!!u&&(t.forEach(f=>{f[2]=this.exaggeration()*u.getElevationAt(f[0],f[1],i)}),!0)}getMinMaxForTile(e){if(this.isUsingMockSource())return null;const t=this.findDEMTileFor(e);if(!t||!t.dem)return null;const i=t.dem.tree,s=t.tileID,u=1<<e.canonical.z-s.canonical.z;let f=e.canonical.x/u-s.canonical.x,m=e.canonical.y/u-s.canonical.y,y=0;for(let x=0;x<e.canonical.z-s.canonical.z&&!i.leaves[y];x++){f*=2,m*=2;const w=2*Math.floor(m)+Math.floor(f);y=i.childOffsets[y]+w,f%=1,m%=1}return{min:this.exaggeration()*i.minimums[y],max:this.exaggeration()*i.maximums[y]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(e,t,i){throw new Error("Pure virtual method called.")}pointCoordinate(e){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(e){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},a.ErrorEvent=un,a.EvaluationParameters=P,a.Event=Zn,a.Evented=Ks,a.FillExtrusionBucket=wc,a.Frustum=Rp,a.FrustumCorners=Dp,a.GLOBE_RADIUS=Ga,a.GLOBE_SCALE_MATCH_LATITUDE=45,a.GLOBE_ZOOM_THRESHOLD_MAX=Kd,a.GLOBE_ZOOM_THRESHOLD_MIN=Op,a.GlobeSharedBuffers=class{constructor(e){this._createGrid(e),this._createPoles(e)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const e of this._poleSegments)e.destroy();for(const e of this._gridSegments)e.withSkirts.destroy(),e.withoutSkirts.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const e of this._wireframeSegments)e.destroy()}}_fillGridMeshWithLods(e,t){const i=new ye,s=new Je,u=[],f=e+1+2,m=t[0]+1,y=t[0]+1+(1+t.length),x=(w,M,L)=>{let O=w===f-1?w-2:w===0?w:w-1;return O+=L?24575:0,[O,M]};for(let w=0;w<f;++w)i.emplaceBack(...x(w,0,!0));for(let w=0;w<m;++w)for(let M=0;M<f;++M)i.emplaceBack(...x(M,w,(M===0||M===f-1)&&!0));for(let w=0;w<t.length;++w){const M=t[w];for(let L=0;L<f;++L)i.emplaceBack(...x(L,M,!0))}for(let w=0;w<t.length;++w){const M=s.length,L=t[w]+1+2,O=new Je;for(let q=0;q<L-1;q++){const K=q===L-2,at=K?f*(y-t.length+w-q):f;for(let mt=0;mt<f-1;mt++){const lt=q*f+mt;q===0||K||mt===0||mt===f-2?(O.emplaceBack(lt+1,lt,lt+at),O.emplaceBack(lt+at,lt+at+1,lt+1)):(s.emplaceBack(lt+1,lt,lt+at),s.emplaceBack(lt+at,lt+at+1,lt+1))}}const B=Nn.simpleSegment(0,M,i.length,s.length-M);for(let q=0;q<O.uint16.length;q+=3)s.emplaceBack(O.uint16[q],O.uint16[q+1],O.uint16[q+2]);const F=Nn.simpleSegment(0,M,i.length,s.length-M);u.push({withoutSkirts:B,withSkirts:F})}return{vertices:i,indices:s,segments:u}}_createGrid(e){const t=this._fillGridMeshWithLods(Wl,pc);this._gridSegments=t.segments,this._gridBuffer=e.createVertexBuffer(t.vertices,hc.members),this._gridIndexBuffer=e.createIndexBuffer(t.indices,!0)}_createPoles(e){const t=new Je;for(let u=0;u<=Wl;u++)t.emplaceBack(0,u+1,u+2);this._poleIndexBuffer=e.createIndexBuffer(t,!0);const i=new Ii,s=new Ii;this._poleSegments=[];for(let u=0,f=0;u<Op;u++){const m=360/(1<<u);i.emplaceBack(0,-Ga,0,.5,0),s.emplaceBack(0,-Ga,0,.5,1);for(let y=0;y<=Wl;y++){const x=y/Wl,w=Mr(0,m,x),[M,L,O]=pu(yv,vv,w,Ga);i.emplaceBack(M,L,O,x,0),s.emplaceBack(M,L,O,x,1)}this._poleSegments.push(Nn.simpleSegment(f,0,66,64)),f+=66}this._poleNorthVertexBuffer=e.createVertexBuffer(i,Yd,!1),this._poleSouthVertexBuffer=e.createVertexBuffer(s,Yd,!1)}getGridBuffers(e,t){return[this._gridBuffer,this._gridIndexBuffer,t?this._gridSegments[e].withSkirts:this._gridSegments[e].withoutSkirts]}getPoleBuffers(e){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[e]]}getWirefameBuffers(e,t){if(!this._wireframeSegments){const i=new so,s=Wl,u=s+1+2,f=1;this._wireframeSegments=[];for(let m=0,y=0;m<pc.length;m++){const x=pc[m];for(let M=f;M<x+f;M++)for(let L=f;L<s+f;L++){const O=M*u+L;i.emplaceBack(O,O+1),i.emplaceBack(O,O+u),i.emplaceBack(O,O+u+1)}const w=x*s*3;this._wireframeSegments.push(Nn.simpleSegment(0,y,(x+1)*u,w)),y+=w}this._wireframeIndexBuffer=e.createIndexBuffer(i)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[t]]}},a.GlyphManager=Tu,a.ImagePosition=lf,a.KDBush=If,a.LivePerformanceUtils=ml,a.LngLat=Ci,a.LngLatBounds=Il,a.LocalGlyphMode=hf,a.MAX_MERCATOR_LATITUDE=Ao,a.MercatorCoordinate=mu,a.ONE_EM=vo,a.OverscaledTileID=as,a.PerformanceMarkers=Pn,a.Point=$t,a.Properties=pt,a.RGBAImage=Rs,a.Ray=Lp,a.RequestManager=class{constructor(e,t,i){this._transformRequestFn=e,this._customAccessToken=t,this._silenceAuthErrors=!!i,this._createSkuToken()}_createSkuToken(){const e=function(){let t="";for(let i=0;i<10;i++)t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Mt,t].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=e.token,this._skuTokenExpiresAt=e.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(e,t){return this._transformRequestFn&&this._transformRequestFn(e,t)||{url:e}}normalizeStyleURL(e,t){if(!Pt(e))return e;const i=Se(e);return i.path=`/styles/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||t)}normalizeGlyphsURL(e,t){if(!Pt(e))return e;const i=Se(e);return i.path=`/fonts/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||t)}normalizeSourceURL(e,t,i,s){if(!Pt(e))return e;const u=Se(e);return u.path=`/v4/${u.authority}.json`,u.params.push("secure"),i&&u.params.push(`language=${i}`),s&&u.params.push(`worldview=${s}`),this._makeAPIURL(u,this._customAccessToken||t)}normalizeSpriteURL(e,t,i,s){const u=Se(e);return Pt(e)?(u.path=`/styles/v1${u.path}/sprite${t}${i}`,this._makeAPIURL(u,this._customAccessToken||s)):(u.path+=`${t}${i}`,we(u))}normalizeTileURL(e,t,i){if(this._isSkuTokenExpired()&&this._createSkuToken(),e&&!Pt(e))return e;const s=Se(e);s.path=s.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${t||i&&s.authority!=="raster"&&i===512?"@2x":""}${At.supported?".webp":"$1"}`),s.authority==="raster"?s.path=`/${xt.RASTER_URL_PREFIX}${s.path}`:(s.path=s.path.replace(/^.+\/v4\//,"/"),s.path=`/${xt.TILE_URL_VERSION}${s.path}`);const u=this._customAccessToken||function(f){for(const m of f){const y=m.match(/^access_token=(.*)$/);if(y)return y[1]}return null}(s.params)||xt.ACCESS_TOKEN;return xt.REQUIRE_ACCESS_TOKEN&&u&&this._skuToken&&s.params.push(`sku=${this._skuToken}`),this._makeAPIURL(s,u)}canonicalizeTileURL(e,t){const i=Se(e);if(!i.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!i.path.match(/\.[\w]+$/))return e;let s="mapbox://";i.path.match(/^\/raster\/v1\//)?s+=`raster/${i.path.replace(`/${xt.RASTER_URL_PREFIX}/`,"")}`:s+=`tiles/${i.path.replace(`/${xt.TILE_URL_VERSION}/`,"")}`;let u=i.params;return t&&(u=u.filter(f=>!f.match(/^access_token=/))),u.length&&(s+=`?${u.join("&")}`),s}canonicalizeTileset(e,t){const i=!!t&&Pt(t),s=[];for(const u of e.tiles||[])Ut(u)?s.push(this.canonicalizeTileURL(u,i)):s.push(u);return s}_makeAPIURL(e,t){const i="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",s=Se(xt.API_URL);if(e.protocol=s.protocol,e.authority=s.authority,e.protocol==="http"){const u=e.params.indexOf("secure");u>=0&&e.params.splice(u,1)}if(s.path!=="/"&&(e.path=`${s.path}${e.path}`),!xt.REQUIRE_ACCESS_TOKEN)return we(e);if(t=t||xt.ACCESS_TOKEN,!this._silenceAuthErrors){if(!t)throw new Error(`An API access token is required to use Mapbox GL. ${i}`);if(t[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${i}`)}return e.params=e.params.filter(u=>u.indexOf("access_token")===-1),e.params.push(`access_token=${t||""}`),we(e)}},a.ResourceType=Fr,a.SegmentVector=Nn,a.SourceCache=tu,a.StencilMode=bf,a.StructArrayLayout1ui2=Ls,a.StructArrayLayout2f1f2i16=nr,a.StructArrayLayout2i4=ye,a.StructArrayLayout2ui4=so,a.StructArrayLayout3f12=kr,a.StructArrayLayout3ui6=Je,a.StructArrayLayout4i8=le,a.StructArrayLayout5f20=Ii,a.Texture=Rc,a.Tile=vf,a.Transitionable=V,a.Uniform1f=ph,a.Uniform1i=class extends ll{constructor(e){super(e),this.current=0}set(e,t,i){this.fetchUniformLocation(e,t)&&this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},a.Uniform2f=class extends ll{constructor(e){super(e),this.current=[0,0]}set(e,t,i){this.fetchUniformLocation(e,t)&&(i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1])))}},a.Uniform3f=class extends ll{constructor(e){super(e),this.current=[0,0,0]}set(e,t,i){this.fetchUniformLocation(e,t)&&(i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2])))}},a.Uniform4f=Dd,a.UniformColor=Rd,a.UniformMatrix2f=class extends ll{constructor(e){super(e),this.current=rv}set(e,t,i){if(this.fetchUniformLocation(e,t)){for(let s=0;s<4;s++)if(i[s]!==this.current[s]){this.current=i,this.gl.uniformMatrix2fv(this.location,!1,i);break}}}},a.UniformMatrix3f=class extends ll{constructor(e){super(e),this.current=ev}set(e,t,i){if(this.fetchUniformLocation(e,t)){for(let s=0;s<9;s++)if(i[s]!==this.current[s]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}}},a.UniformMatrix4f=class extends ll{constructor(e){super(e),this.current=tv}set(e,t,i){if(this.fetchUniformLocation(e,t)){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let s=1;s<16;s++)if(i[s]!==this.current[s]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}}},a.UnwrappedTileID=Fm,a.ValidationError=Le,a.VectorTileFeature=Ch,a.VectorTileWorkerSource=class extends Ks{constructor(e,t,i,s,u){super(),this.actor=e,this.layerIndex=t,this.availableImages=i,this.loadVectorData=u||Yg,this.loading={},this.loaded={},this.deduped=new Wg(e.scheduler),this.isSpriteLoaded=s,this.scheduler=e.scheduler}loadTile(e,t){const i=e.uid,s=e&&e.request,u=s&&s.collectResourceTiming,f=this.loading[i]=new I0(e);f.abort=this.loadVectorData(e,(m,y)=>{const x=!this.loading[i];if(delete this.loading[i],x||m||!y)return f.status="done",x||(this.loaded[i]=f),t(m);const w=y.rawData,M={};y.expires&&(M.expires=y.expires),y.cacheControl&&(M.cacheControl=y.cacheControl),f.vectorTile=y.vectorTile||new rf(new Rh(w));const L=()=>{f.parse(f.vectorTile,this.layerIndex,this.availableImages,this.actor,(O,B)=>{if(O||!B)return t(O);const F={};if(u){const q=Ri(s);q.length>0&&(F.resourceTiming=JSON.parse(JSON.stringify(q)))}t(null,ur({rawTileData:w.slice(0)},B,M,F))})};this.isSpriteLoaded?L():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(L,{type:"parseTile",isSymbolTile:e.isSymbolTile,zoom:e.tileZoom}):L()}),this.loaded=this.loaded||{},this.loaded[i]=f})}reloadTile(e,t){const i=this.loaded,s=e.uid,u=this;if(i&&i[s]){const f=i[s];f.showCollisionBoxes=e.showCollisionBoxes,f.enableTerrain=!!e.enableTerrain,f.projection=e.projection,f.tileTransform=Ql(e.tileID.canonical,e.projection);const m=(y,x)=>{const w=f.reloadCallback;w&&(delete f.reloadCallback,f.parse(f.vectorTile,u.layerIndex,this.availableImages,u.actor,w)),t(y,x)};f.status==="parsing"?f.reloadCallback=m:f.status==="done"&&(f.vectorTile?f.parse(f.vectorTile,this.layerIndex,this.availableImages,this.actor,m):m())}}abortTile(e,t){const i=e.uid,s=this.loading[i];s&&(s.abort&&s.abort(),delete this.loading[i]),t()}removeTile(e,t){const i=this.loaded,s=e.uid;i&&i[s]&&delete i[s],t()}},a.WritingMode=Ws,a.ZoomDependentExpression=Fo,a.add=cl,a.addDynamicAttributes=jh,a.adjoint=function(e,t){var i=t[0],s=t[1],u=t[2],f=t[3],m=t[4],y=t[5],x=t[6],w=t[7],M=t[8];return e[0]=m*M-y*w,e[1]=u*w-s*M,e[2]=s*y-u*m,e[3]=y*x-f*M,e[4]=i*M-u*x,e[5]=u*f-i*y,e[6]=f*w-m*x,e[7]=s*x-i*w,e[8]=i*m-s*f,e},a.asyncAll=tr,a.bezier=Ne,a.bindAll=oi,a.boundsAttributes=Lg,a.bufferConvexPolygon=function(e,t){const i=[];for(let s=0;s<e.length;s++){const u=Pe(s-1,-1,e.length-1),f=Pe(s+1,-1,e.length-1),m=e[s],y=e[f],x=e[u].sub(m).unit(),w=y.sub(m).unit(),M=w.angleWithSep(x.x,x.y),L=x.add(w).unit().mult(-1*t/Math.sin(M/2));i.push(m.add(L))}return i},a.cacheEntryPossiblyAdded=function(e){Sr++,Sr>pe&&(e.getActor().send("enforceCacheSizeLimit",Jt),Sr=0)},a.calculateGlobeLabelMatrix=function(e,t){const{x:i,y:s}=e.point,u=rm(i,s,e.worldSize/e._pixelsPerMercatorPixel,0,0);return $l(u,u,kp(ja(t)))},a.calculateGlobeMatrix=function(e){const{x:t,y:i}=e.point,{lng:s,lat:u}=e._center;return rm(t,i,e.worldSize,s,u)},a.calculateGlobeMercatorMatrix=function(e){const t=e.pixelsPerMeter,i=t/Ca(1,e.center.lat),s=Ia(new Float64Array(16));return oc(s,s,[e.point.x,e.point.y,0]),Xl(s,s,[i,i,t]),Float32Array.from(s)},a.circumferenceAtLatitude=Fp,a.clamp=Ye,a.clearTileCache=function(e){if(!rr())return;const t=G.caches.delete(Dt);e&&t.catch(e).then(()=>e())},a.clipLine=fg,a.clone=function(e){var t=new Ds(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},a.clone$1=jr,a.collisionCircleLayout=Ex,a.config=xt,a.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},a.create=function(){var e=new Ds(16);return Ds!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e},a.create$1=zd,a.createExpression=ia,a.createLayout=Nt,a.createStyleLayer=function(e){return e.type==="custom"?new d0(e):new g0[e.type](e)},a.cross=Pp,a.degToRad=Kt,a.distance=function(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1],t[2]-e[2])},a.div=function(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e[2]=t[2]/i[2],e},a.dot=ua,a.earthRadius=mc,a.ease=Tr,a.easeCubicInOut=_i,a.ecefToLatLng=function([e,t,i]){const s=Math.hypot(e,t,i),u=Math.atan2(e,i),f=.5*Math.PI-Math.acos(-t/s);return new Ci(ae(u),ae(f))},a.emitValidationErrors=Re,a.endsWith=Br,a.enforceCacheSizeLimit=function(e){Me(),kt&&kt.then(t=>{t.keys().then(i=>{for(let s=0;s<i.length-e;s++)t.delete(i[s])})})},a.evaluateSizeForFeature=Lh,a.evaluateSizeForZoom=xu,a.evaluateVariableOffset=yg,a.evented=g,a.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},a.exactEquals$1=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},a.exported=ai,a.exported$1=At,a.extend=ur,a.extend$1=Lo,a.fillExtrusionHeightLift=zm,a.filterObject=qe,a.fromMat4=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},a.fromQuat=function(e,t){var i=t[0],s=t[1],u=t[2],f=t[3],m=i+i,y=s+s,x=u+u,w=i*m,M=s*m,L=s*y,O=u*m,B=u*y,F=u*x,q=f*m,K=f*y,at=f*x;return e[0]=1-L-F,e[1]=M+at,e[2]=O-K,e[3]=0,e[4]=M-at,e[5]=1-w-F,e[6]=B+q,e[7]=0,e[8]=O+K,e[9]=B-q,e[10]=1-w-L,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},a.fromRotation=function(e,t){var i=Math.sin(t),s=Math.cos(t);return e[0]=s,e[1]=i,e[2]=0,e[3]=-i,e[4]=s,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},a.fromScaling=Bd,a.furthestTileCorner=function(e){const t=Math.round((e+45+360)%360/90)%4;return wt[t]},a.getAABBPointSquareDist=function(e,t,i){let s=0;for(let u=0;u<2;++u){const f=i?i[u]:0;e[u]>f&&(s+=(e[u]-f)*(e[u]-f)),t[u]<f&&(s+=(f-t[u])*(f-t[u]))}return s},a.getAnchorAlignment=cf,a.getAnchorJustification=ff,a.getBounds=function(e){let t=1/0,i=1/0,s=-1/0,u=-1/0;for(const f of e)t=Math.min(t,f.x),i=Math.min(i,f.y),s=Math.max(s,f.x),u=Math.max(u,f.y);return{min:new $t(t,i),max:new $t(s,u)}},a.getColumn=ft,a.getDefaultExportFromCjs=gt,a.getGridMatrix=function(e,t,i,s){const u=t.getNorth(),f=t.getSouth(),m=t.getWest(),y=t.getEast(),x=1<<e.z,w=y-m,M=u-f,L=w/Wl,O=-M/pc[i],B=[0,L,0,O,0,0,u,m,0];if(e.z>0){const F=180/s;kd(B,B,[F/w+1,0,0,0,F/M+1,0,-.5*F/L,.5*F/O,1])}return B[2]=x,B[5]=e.x,B[8]=e.y,B},a.getImage=ut,a.getJSON=function(e,t){return yi(ur(e,{type:"json"}),t)},a.getLatitudinalLod=function(e){const t=Ao-5;e=Ye(e,-t,t)/t*90;const i=Math.pow(Math.abs(Math.sin(Kt(e))),3);return Math.round(i*(pc.length-1))},a.getMapSessionAPI=Kr,a.getPerformanceMeasurement=Ri,a.getProjection=Sg,a.getRTLTextPluginStatus=v,a.getReferrer=$r,a.getTilePoint=function(e,{x:t,y:i},s=0){return new $t(((t-s)*e.scale-e.x)*ir,(i*e.scale-e.y)*ir)},a.getTileVec3=function(e,t,i=0){return hu(((t.x-i)*e.scale-e.x)*ir,(t.y*e.scale-e.y)*ir,sm(t.z,t.y))},a.getVideo=function(e,t){const i=G.document.createElement("video");i.muted=!0,i.onloadstart=function(){t(null,i)};for(let s=0;s<e.length;s++){const u=G.document.createElement("source");sn(e[s])||(i.crossOrigin="Anonymous"),u.src=e[s],i.appendChild(u)}return{cancel:()=>{}}},a.globeCenterToScreenPoint=function(e){const t=[0,0,0],i=Ia(new Float64Array(16));return $l(i,e.pixelMatrix,e.globeMatrix),Mn(t,t,i),new $t(t[0],t[1])},a.globeDenormalizeECEF=kp,a.globeECEFOrigin=function(e,t){const i=[0,0,0];return Mn(i,i,dc(ja(t.canonical))),Mn(i,i,e),i},a.globeMetersToEcef=mh,a.globeNormalizeECEF=dc,a.globePixelsToTileUnits=function(e,t){return ir/(512*Math.pow(2,e))*_h(ja(t))},a.globePoleMatrixForTile=function(e,t,i){const s=Ia(new Float64Array(16)),u=(t/(1<<e)-.5)*Math.PI*2;return dh(s,i.globeMatrix,u),Float32Array.from(s)},a.globeTileBounds=ja,a.globeTiltAtLngLat=im,a.globeToMercatorTransition=du,a.globeUseCustomAntiAliasing=function(e,t,i){const s=du(i.zoom),u=e.style.map._antialias,f=!!t.extStandardDerivatives,m=t.extStandardDerivativesForceOff||e.terrain&&e.terrain.exaggeration()>0;return s===0&&!u&&!m&&f},a.identity=Ia,a.identity$1=Xd,a.invert=Sp,a.isFullscreen=function(){return!!G.document.fullscreenElement||!!G.document.webkitFullscreenElement},a.isLngLatBehindGlobe=Bp,a.isMapAuthenticated=function(e){return ln.has(e)},a.isMapboxURL=Pt,a.isSafariWithAntialiasingBug=function(e){const t=e.navigator?e.navigator.userAgent:null;return!!Z(e)&&t&&(t.match("Version/15.4")||t.match("Version/15.5")||t.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},a.latFromMercatorY=Mo,a.latLngToECEF=fu,a.len=hv,a.length=sc,a.length$1=function(e){return Math.hypot(e[0],e[1],e[2],e[3])},a.lngFromMercatorX=Zs,a.loadVectorTile=Yg,a.makeRequest=yi,a.mapValue=function(e,t,i,s,u){return Ye((e-t)/(i-t)*(u-s)+s,s,u)},a.mercatorScale=am,a.mercatorXfromLng=qa,a.mercatorYfromLat=$a,a.mercatorZfromAltitude=Ca,a.mul=uv,a.mul$1=cv,a.multiply=$l,a.multiply$1=kd,a.multiply$2=Vd,a.nextPowerOfTwo=Zr,a.normalize=os,a.normalize$1=pv,a.normalize$2=qd,a.number=Mr,a.ortho=function(e,t,i,s,u,f,m){var y=1/(t-i),x=1/(s-u),w=1/(f-m);return e[0]=-2*y,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*x,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*w,e[11]=0,e[12]=(t+i)*y,e[13]=(u+s)*x,e[14]=(m+f)*w,e[15]=1,e},a.pbf=Xm,a.perspective=function(e,t,i,s,u){var f,m=1/Math.tan(t/2);return e[0]=m/i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=m,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,u!=null&&u!==1/0?(e[10]=(u+s)*(f=1/(s-u)),e[14]=2*u*s*f):(e[10]=-1,e[14]=-2*s),e},a.pick=function(e,t){const i={};for(let s=0;s<t.length;s++){const u=t[s];u in e&&(i[u]=e[u])}return i},a.plugin=S,a.pointGeometry=de,a.polesInViewport=function(e){const t=Ia(new Float64Array(16));$l(t,e.pixelMatrix,e.globeMatrix);const i=[0,ca,0],s=[0,ha,0];return Mn(i,i,t),Mn(s,s,t),[i[0]>0&&i[0]<=e.width&&i[1]>0&&i[1]<=e.height&&!Bp(e,new Ci(e.center.lat,90)),s[0]>0&&s[0]<=e.width&&s[1]>0&&s[1]<=e.height&&!Bp(e,new Ci(e.center.lat,-90))]},a.polygonContainsPoint=Kl,a.polygonIntersectsBox=dm,a.polygonIntersectsPolygon=cm,a.polygonizeBounds=function(e,t,i=0,s=!0){const u=new $t(i,i),f=e.sub(u),m=t.add(u),y=[f,new $t(m.x,f.y),m,new $t(f.x,m.y)];return s&&y.push(f.clone()),y},a.posAttributes=hc,a.postMapLoadEvent=sr,a.postPerformanceEvent=si,a.postTurnstileEvent=Ar,a.potpack=af,a.prevPowerOfTwo=function(e){return e<=1?1:Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},a.radToDeg=ae,a.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],a.registerForPluginStateChange=function(e){return e({pluginStatus:h,pluginURL:n}),g.on("pluginStateChange",e),e},a.removeAuthState=function(e){ln.delete(e)},a.renderColorRamp=Zp,a.resample=lm,a.rotateX=Cp,a.rotateX$1=Zd,a.rotateY=dh,a.rotateY$1=Wd,a.rotateZ=function(e,t,i){var s=Math.sin(i),u=Math.cos(i),f=t[0],m=t[1],y=t[2],x=t[3],w=t[4],M=t[5],L=t[6],O=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=f*u+w*s,e[1]=m*u+M*s,e[2]=y*u+L*s,e[3]=x*u+O*s,e[4]=w*u-f*s,e[5]=M*u-m*s,e[6]=L*u-y*s,e[7]=O*u-x*s,e},a.rotateZ$1=function(e,t,i){i*=.5;var s=t[0],u=t[1],f=t[2],m=t[3],y=Math.sin(i),x=Math.cos(i);return e[0]=s*x+u*y,e[1]=u*x-s*y,e[2]=f*x+m*y,e[3]=m*x-f*y,e},a.scale=Xl,a.scale$1=jd,a.scale$2=Xs,a.scaleAndAdd=uc,a.set=function(e,t,i,s){return e[0]=t,e[1]=i,e[2]=s,e},a.setCacheLimits=function(e,t){Jt=e,pe=t},a.setColumn=function(e,t,i){e[4*t+0]=i[0],e[4*t+1]=i[1],e[4*t+2]=i[2],e[4*t+3]=i[3]},a.setRTLTextPlugin=function(e,t,i=!1){if(h===tc||h===ec||h===rc)throw new Error("setRTLTextPlugin cannot be called multiple times.");n=ai.resolveURL(e),h=tc,wl=t,d(),i||I()},a.smoothstep=ti,a.spec=ie,a.squaredLength=function(e){var t=e[0],i=e[1],s=e[2];return t*t+i*i+s*s},a.storeAuthState=function(e,t){t?ln.add(e):ln.delete(e)},a.sub=Sa,a.subtract=Ap,a.symbolSize=Tx,a.tileAABB=function(e,t,i,s,u,f,m,y,x){if(x.name==="globe")return _v(e,t,new Ah(i,s,u));const w=Ql({z:i,x:s,y:u},x);return new ss([(f+w.x/w.scale)*t,t*(w.y/w.scale),m],[(f+w.x2/w.scale)*t,t*(w.y2/w.scale),y])},a.tileCornersToBounds=gh,a.tileTransform=Ql,a.transformMat3=function(e,t,i){var s=t[0],u=t[1],f=t[2];return e[0]=s*i[0]+u*i[3]+f*i[6],e[1]=s*i[1]+u*i[4]+f*i[7],e[2]=s*i[2]+u*i[5]+f*i[8],e},a.transformMat4=Mn,a.transformMat4$1=Zl,a.transformQuat=Gd,a.transitionTileAABBinECEF=Qd,a.translate=oc,a.transpose=function(e,t){if(e===t){var i=t[1],s=t[2],u=t[5];e[1]=t[3],e[2]=t[6],e[3]=i,e[5]=t[7],e[6]=s,e[7]=u}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e},a.triggerPluginCompletionEvent=l,a.uniqueId=Li,a.updateGlobeVertexNormal=function(e,t,i,s,u){const f=5*t+2;e.float32[f+0]=i,e.float32[f+1]=s,e.float32[f+2]=u},a.validateCustomStyleLayer=function(e){const t=[],i=e.id;return i===void 0&&t.push({message:`layers.${i}: missing required property "id"`}),e.render===void 0&&t.push({message:`layers.${i}: missing required method "render"`}),e.renderingMode&&e.renderingMode!=="2d"&&e.renderingMode!=="3d"&&t.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),t},a.validateFilter=e=>Ht(Ps(e)),a.validateFog=e=>Ht(_(e)),a.validateLayer=e=>Ht(Hi(e)),a.validateLight=e=>Ht(c(e)),a.validateSource=e=>Ht(r(e)),a.validateStyle=rt,a.validateTerrain=e=>Ht(p(e)),a.values=Ot,a.vectorTile=Sh,a.version=ot,a.warnOnce=Dr,a.window=G,a.wrap=Pe}),z(["./shared"],function(a){function G(ht){if(typeof ht=="number"||typeof ht=="boolean"||typeof ht=="string"||ht==null)return JSON.stringify(ht);if(Array.isArray(ht)){let W="[";for(const ut of ht)W+=`${G(ut)},`;return`${W}]`}let X="{";for(const W of Object.keys(ht).sort())X+=`${W}:${G(ht[W])},`;return`${X}}`}function ot(ht){let X="";for(const W of a.refProperties)X+=`/${G(ht[W])}`;return X}class Rt{constructor(X){this.keyCache={},X&&this.replace(X)}replace(X){this._layerConfigs={},this._layers={},this.update(X,[])}update(X,W){for(const et of X)this._layerConfigs[et.id]=et,(this._layers[et.id]=a.createStyleLayer(et)).compileFilter(),this.keyCache[et.id]&&delete this.keyCache[et.id];for(const et of W)delete this.keyCache[et],delete this._layerConfigs[et],delete this._layers[et];this.familiesBySource={};const ut=function(et,Pt){const Ut={};for(let Lt=0;Lt<et.length;Lt++){const jt=Pt&&Pt[et[Lt].id]||ot(et[Lt]);Pt&&(Pt[et[Lt].id]=jt);let ge=Ut[jt];ge||(ge=Ut[jt]=[]),ge.push(et[Lt])}const Tt=[];for(const Lt in Ut)Tt.push(Ut[Lt]);return Tt}(a.values(this._layerConfigs),this.keyCache);for(const et of ut){const Pt=et.map(Se=>this._layers[Se.id]),Ut=Pt[0];if(Ut.visibility==="none")continue;const Tt=Ut.source||"";let Lt=this.familiesBySource[Tt];Lt||(Lt=this.familiesBySource[Tt]={});const jt=Ut.sourceLayer||"_geojsonTileLayer";let ge=Lt[jt];ge||(ge=Lt[jt]=[]),ge.push(Pt)}}}class xt{loadTile(X,W){const{uid:ut,encoding:et,rawImageData:Pt,padding:Ut,buildQuadTree:Tt}=X,Lt=a.window.ImageBitmap&&Pt instanceof a.window.ImageBitmap?this.getImageData(Pt,Ut):Pt;W(null,new a.DEMData(ut,Lt,et,Ut<1,Tt))}getImageData(X,W){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(X.width,X.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=X.width,this.offscreenCanvas.height=X.height,this.offscreenCanvasContext.drawImage(X,0,0,X.width,X.height);const ut=this.offscreenCanvasContext.getImageData(-W,-W,X.width+2*W,X.height+2*W);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ut}}function At(ht,X){if(ht.length!==0){qt(ht[0],X);for(var W=1;W<ht.length;W++)qt(ht[W],!X)}}function qt(ht,X){for(var W=0,ut=0,et=0,Pt=ht.length,Ut=Pt-1;et<Pt;Ut=et++){var Tt=(ht[et][0]-ht[Ut][0])*(ht[Ut][1]+ht[et][1]),Lt=W+Tt;ut+=Math.abs(W)>=Math.abs(Tt)?W-Lt+Tt:Tt-Lt+W,W=Lt}W+ut>=0!=!!X&&ht.reverse()}var re=a.getDefaultExportFromCjs(function ht(X,W){var ut,et=X&&X.type;if(et==="FeatureCollection")for(ut=0;ut<X.features.length;ut++)ht(X.features[ut],W);else if(et==="GeometryCollection")for(ut=0;ut<X.geometries.length;ut++)ht(X.geometries[ut],W);else if(et==="Feature")ht(X.geometry,W);else if(et==="Polygon")At(X.coordinates,W);else if(et==="MultiPolygon")for(ut=0;ut<X.coordinates.length;ut++)At(X.coordinates[ut],W);return X});const ee=a.VectorTileFeature.prototype.toGeoJSON;var Oe={exports:{}},Ge=a.pointGeometry,Mt=a.vectorTile.VectorTileFeature,gt=Et;function Et(ht,X){this.options=X||{},this.features=ht,this.length=ht.length}function Ft(ht,X){this.id=typeof ht.id=="number"?ht.id:void 0,this.type=ht.type,this.rawGeometry=ht.type===1?[ht.geometry]:ht.geometry,this.properties=ht.tags,this.extent=X||4096}Et.prototype.feature=function(ht){return new Ft(this.features[ht],this.options.extent)},Ft.prototype.loadGeometry=function(){var ht=this.rawGeometry;this.geometry=[];for(var X=0;X<ht.length;X++){for(var W=ht[X],ut=[],et=0;et<W.length;et++)ut.push(new Ge(W[et][0],W[et][1]));this.geometry.push(ut)}return this.geometry},Ft.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ht=this.geometry,X=1/0,W=-1/0,ut=1/0,et=-1/0,Pt=0;Pt<ht.length;Pt++)for(var Ut=ht[Pt],Tt=0;Tt<Ut.length;Tt++){var Lt=Ut[Tt];X=Math.min(X,Lt.x),W=Math.max(W,Lt.x),ut=Math.min(ut,Lt.y),et=Math.max(et,Lt.y)}return[X,ut,W,et]},Ft.prototype.toGeoJSON=Mt.prototype.toGeoJSON;var Ie=a.pbf,de=gt;function xe(ht){var X=new Ie;return function(W,ut){for(var et in W.layers)ut.writeMessage(3,$t,W.layers[et])}(ht,X),X.finish()}function $t(ht,X){var W;X.writeVarintField(15,ht.version||1),X.writeStringField(1,ht.name||""),X.writeVarintField(5,ht.extent||4096);var ut={keys:[],values:[],keycache:{},valuecache:{}};for(W=0;W<ht.length;W++)ut.feature=ht.feature(W),X.writeMessage(2,yt,ut);var et=ut.keys;for(W=0;W<et.length;W++)X.writeStringField(3,et[W]);var Pt=ut.values;for(W=0;W<Pt.length;W++)X.writeMessage(4,_i,Pt[W])}function yt(ht,X){var W=ht.feature;W.id!==void 0&&X.writeVarintField(1,W.id),X.writeMessage(2,ue,ht),X.writeVarintField(3,W.type),X.writeMessage(4,wt,W)}function ue(ht,X){var W=ht.feature,ut=ht.keys,et=ht.values,Pt=ht.keycache,Ut=ht.valuecache;for(var Tt in W.properties){var Lt=W.properties[Tt],jt=Pt[Tt];if(Lt!==null){jt===void 0&&(ut.push(Tt),Pt[Tt]=jt=ut.length-1),X.writeVarint(jt);var ge=typeof Lt;ge!=="string"&&ge!=="boolean"&&ge!=="number"&&(Lt=JSON.stringify(Lt));var Se=ge+":"+Lt,we=Ut[Se];we===void 0&&(et.push(Lt),Ut[Se]=we=et.length-1),X.writeVarint(we)}}}function Kt(ht,X){return(X<<3)+(7&ht)}function ae(ht){return ht<<1^ht>>31}function wt(ht,X){for(var W=ht.loadGeometry(),ut=ht.type,et=0,Pt=0,Ut=W.length,Tt=0;Tt<Ut;Tt++){var Lt=W[Tt],jt=1;ut===1&&(jt=Lt.length),X.writeVarint(Kt(1,jt));for(var ge=ut===3?Lt.length-1:Lt.length,Se=0;Se<ge;Se++){Se===1&&ut!==1&&X.writeVarint(Kt(2,ge-1));var we=Lt[Se].x-et,dr=Lt[Se].y-Pt;X.writeVarint(ae(we)),X.writeVarint(ae(dr)),et+=we,Pt+=dr}ut===3&&X.writeVarint(Kt(7,1))}}function _i(ht,X){var W=typeof ht;W==="string"?X.writeStringField(1,ht):W==="boolean"?X.writeBooleanField(7,ht):W==="number"&&(ht%1!=0?X.writeDoubleField(3,ht):ht<0?X.writeSVarintField(6,ht):X.writeVarintField(5,ht))}Oe.exports=xe,Oe.exports.fromVectorTileJs=xe,Oe.exports.fromGeojsonVt=function(ht,X){X=X||{};var W={};for(var ut in ht)W[ut]=new de(ht[ut].features,X),W[ut].name=ut,W[ut].version=X.version,W[ut].extent=X.extent;return xe({layers:W})},Oe.exports.GeoJSONWrapper=de;var Ne=a.getDefaultExportFromCjs(Oe.exports);const Tr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ht=>ht},Ye=Math.fround||(ti=new Float32Array(1),ht=>(ti[0]=+ht,ti[0]));var ti;const Pe=3,tr=5,Ot=6;class ur{constructor(X){this.options=Object.assign(Object.create(Tr),X),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(X){const{log:W,minZoom:ut,maxZoom:et}=this.options;W&&console.time("total time");const Pt=`prepare ${X.length} points`;W&&console.time(Pt),this.points=X;const Ut=[];for(let Lt=0;Lt<X.length;Lt++){const jt=X[Lt];if(!jt.geometry)continue;const[ge,Se]=jt.geometry.coordinates,we=Ye(je(ge)),dr=Ye(Zr(Se));Ut.push(we,dr,1/0,Lt,-1,1),this.options.reduce&&Ut.push(0)}let Tt=this.trees[et+1]=this._createTree(Ut);W&&console.timeEnd(Pt);for(let Lt=et;Lt>=ut;Lt--){const jt=+Date.now();Tt=this.trees[Lt]=this._createTree(this._cluster(Tt,Lt)),W&&console.log("z%d: %d clusters in %dms",Lt,Tt.numItems,+Date.now()-jt)}return W&&console.timeEnd("total time"),this}getClusters(X,W){let ut=((X[0]+180)%360+360)%360-180;const et=Math.max(-90,Math.min(90,X[1]));let Pt=X[2]===180?180:((X[2]+180)%360+360)%360-180;const Ut=Math.max(-90,Math.min(90,X[3]));if(X[2]-X[0]>=360)ut=-180,Pt=180;else if(ut>Pt){const Se=this.getClusters([ut,et,180,Ut],W),we=this.getClusters([-180,et,Pt,Ut],W);return Se.concat(we)}const Tt=this.trees[this._limitZoom(W)],Lt=Tt.range(je(ut),Zr(Ut),je(Pt),Zr(et)),jt=Tt.data,ge=[];for(const Se of Lt){const we=this.stride*Se;ge.push(jt[we+tr]>1?pr(jt,we,this.clusterProps):this.points[jt[we+Pe]])}return ge}getChildren(X){const W=this._getOriginId(X),ut=this._getOriginZoom(X),et="No cluster with the specified id.",Pt=this.trees[ut];if(!Pt)throw new Error(et);const Ut=Pt.data;if(W*this.stride>=Ut.length)throw new Error(et);const Tt=this.options.radius/(this.options.extent*Math.pow(2,ut-1)),Lt=Pt.within(Ut[W*this.stride],Ut[W*this.stride+1],Tt),jt=[];for(const ge of Lt){const Se=ge*this.stride;Ut[Se+4]===X&&jt.push(Ut[Se+tr]>1?pr(Ut,Se,this.clusterProps):this.points[Ut[Se+Pe]])}if(jt.length===0)throw new Error(et);return jt}getLeaves(X,W,ut){const et=[];return this._appendLeaves(et,X,W=W||10,ut=ut||0,0),et}getTile(X,W,ut){const et=this.trees[this._limitZoom(X)],Pt=Math.pow(2,X),{extent:Ut,radius:Tt}=this.options,Lt=Tt/Ut,jt=(ut-Lt)/Pt,ge=(ut+1+Lt)/Pt,Se={features:[]};return this._addTileFeatures(et.range((W-Lt)/Pt,jt,(W+1+Lt)/Pt,ge),et.data,W,ut,Pt,Se),W===0&&this._addTileFeatures(et.range(1-Lt/Pt,jt,1,ge),et.data,Pt,ut,Pt,Se),W===Pt-1&&this._addTileFeatures(et.range(0,jt,Lt/Pt,ge),et.data,-1,ut,Pt,Se),Se.features.length?Se:null}getClusterExpansionZoom(X){let W=this._getOriginZoom(X)-1;for(;W<=this.options.maxZoom;){const ut=this.getChildren(X);if(W++,ut.length!==1)break;X=ut[0].properties.cluster_id}return W}_appendLeaves(X,W,ut,et,Pt){const Ut=this.getChildren(W);for(const Tt of Ut){const Lt=Tt.properties;if(Lt&&Lt.cluster?Pt+Lt.point_count<=et?Pt+=Lt.point_count:Pt=this._appendLeaves(X,Lt.cluster_id,ut,et,Pt):Pt<et?Pt++:X.push(Tt),X.length===ut)break}return Pt}_createTree(X){const W=new a.KDBush(X.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ut=0;ut<X.length;ut+=this.stride)W.add(X[ut],X[ut+1]);return W.finish(),W.data=X,W}_addTileFeatures(X,W,ut,et,Pt,Ut){for(const Tt of X){const Lt=Tt*this.stride,jt=W[Lt+tr]>1;let ge,Se,we;if(jt)ge=Li(W,Lt,this.clusterProps),Se=W[Lt],we=W[Lt+1];else{const or=this.points[W[Lt+Pe]];ge=or.properties;const[_r,Ar]=or.geometry.coordinates;Se=je(_r),we=Zr(Ar)}const dr={type:1,geometry:[[Math.round(this.options.extent*(Se*Pt-ut)),Math.round(this.options.extent*(we*Pt-et))]],tags:ge};let Cr;Cr=jt||this.options.generateId?W[Lt+Pe]:this.points[W[Lt+Pe]].id,Cr!==void 0&&(dr.id=Cr),Ut.features.push(dr)}}_limitZoom(X){return Math.max(this.options.minZoom,Math.min(Math.floor(+X),this.options.maxZoom+1))}_cluster(X,W){const{radius:ut,extent:et,reduce:Pt,minPoints:Ut}=this.options,Tt=ut/(et*Math.pow(2,W)),Lt=X.data,jt=[],ge=this.stride;for(let Se=0;Se<Lt.length;Se+=ge){if(Lt[Se+2]<=W)continue;Lt[Se+2]=W;const we=Lt[Se],dr=Lt[Se+1],Cr=X.within(Lt[Se],Lt[Se+1],Tt),or=Lt[Se+tr];let _r=or;for(const Ar of Cr){const ni=Ar*ge;Lt[ni+2]>W&&(_r+=Lt[ni+tr])}if(_r>or&&_r>=Ut){let Ar,ni=we*or,sr=dr*or,vi=-1;const si=((Se/ge|0)<<5)+(W+1)+this.points.length;for(const an of Cr){const Kr=an*ge;if(Lt[Kr+2]<=W)continue;Lt[Kr+2]=W;const ln=Lt[Kr+tr];ni+=Lt[Kr]*ln,sr+=Lt[Kr+1]*ln,Lt[Kr+4]=si,Pt&&(Ar||(Ar=this._map(Lt,Se,!0),vi=this.clusterProps.length,this.clusterProps.push(Ar)),Pt(Ar,this._map(Lt,Kr)))}Lt[Se+4]=si,jt.push(ni/_r,sr/_r,1/0,si,-1,_r),Pt&&jt.push(vi)}else{for(let Ar=0;Ar<ge;Ar++)jt.push(Lt[Se+Ar]);if(_r>1)for(const Ar of Cr){const ni=Ar*ge;if(!(Lt[ni+2]<=W)){Lt[ni+2]=W;for(let sr=0;sr<ge;sr++)jt.push(Lt[ni+sr])}}}}return jt}_getOriginId(X){return X-this.points.length>>5}_getOriginZoom(X){return(X-this.points.length)%32}_map(X,W,ut){if(X[W+tr]>1){const Ut=this.clusterProps[X[W+Ot]];return ut?Object.assign({},Ut):Ut}const et=this.points[X[W+Pe]].properties,Pt=this.options.map(et);return ut&&Pt===et?Object.assign({},Pt):Pt}}function pr(ht,X,W){return{type:"Feature",id:ht[X+Pe],properties:Li(ht,X,W),geometry:{type:"Point",coordinates:[(ut=ht[X],360*(ut-.5)),Tn(ht[X+1])]}};var ut}function Li(ht,X,W){const ut=ht[X+tr],et=ut>=1e4?`${Math.round(ut/1e3)}k`:ut>=1e3?Math.round(ut/100)/10+"k":ut,Pt=ht[X+Ot],Ut=Pt===-1?{}:Object.assign({},W[Pt]);return Object.assign(Ut,{cluster:!0,cluster_id:ht[X+Pe],point_count:ut,point_count_abbreviated:et})}function je(ht){return ht/360+.5}function Zr(ht){const X=Math.sin(ht*Math.PI/180),W=.5-.25*Math.log((1+X)/(1-X))/Math.PI;return W<0?0:W>1?1:W}function Tn(ht){const X=(180-360*ht)*Math.PI/180;return 360*Math.atan(Math.exp(X))/Math.PI-90}function oi(ht,X,W,ut){for(var et,Pt=ut,Ut=W-X>>1,Tt=W-X,Lt=ht[X],jt=ht[X+1],ge=ht[W],Se=ht[W+1],we=X+3;we<W;we+=3){var dr=Br(ht[we],ht[we+1],Lt,jt,ge,Se);if(dr>Pt)et=we,Pt=dr;else if(dr===Pt){var Cr=Math.abs(we-Ut);Cr<Tt&&(et=we,Tt=Cr)}}Pt>ut&&(et-X>3&&oi(ht,X,et,ut),ht[et+2]=Pt,W-et>3&&oi(ht,et,W,ut))}function Br(ht,X,W,ut,et,Pt){var Ut=et-W,Tt=Pt-ut;if(Ut!==0||Tt!==0){var Lt=((ht-W)*Ut+(X-ut)*Tt)/(Ut*Ut+Tt*Tt);Lt>1?(W=et,ut=Pt):Lt>0&&(W+=Ut*Lt,ut+=Tt*Lt)}return(Ut=ht-W)*Ut+(Tt=X-ut)*Tt}function He(ht,X,W,ut){var et={id:ht===void 0?null:ht,type:X,geometry:W,tags:ut,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Pt){var Ut=Pt.geometry,Tt=Pt.type;if(Tt==="Point"||Tt==="MultiPoint"||Tt==="LineString")qe(Pt,Ut);else if(Tt==="Polygon"||Tt==="MultiLineString")for(var Lt=0;Lt<Ut.length;Lt++)qe(Pt,Ut[Lt]);else if(Tt==="MultiPolygon")for(Lt=0;Lt<Ut.length;Lt++)for(var jt=0;jt<Ut[Lt].length;jt++)qe(Pt,Ut[Lt][jt])}(et),et}function qe(ht,X){for(var W=0;W<X.length;W+=3)ht.minX=Math.min(ht.minX,X[W]),ht.minY=Math.min(ht.minY,X[W+1]),ht.maxX=Math.max(ht.maxX,X[W]),ht.maxY=Math.max(ht.maxY,X[W+1])}function jr(ht,X,W,ut){if(X.geometry){var et=X.geometry.coordinates,Pt=X.geometry.type,Ut=Math.pow(W.tolerance/((1<<W.maxZoom)*W.extent),2),Tt=[],Lt=X.id;if(W.promoteId?Lt=X.properties[W.promoteId]:W.generateId&&(Lt=ut||0),Pt==="Point")pi(et,Tt);else if(Pt==="MultiPoint")for(var jt=0;jt<et.length;jt++)pi(et[jt],Tt);else if(Pt==="LineString")Dr(et,Tt,Ut,!1);else if(Pt==="MultiLineString"){if(W.lineMetrics){for(jt=0;jt<et.length;jt++)Dr(et[jt],Tt=[],Ut,!1),ht.push(He(Lt,"LineString",Tt,X.properties));return}Hr(et,Tt,Ut,!1)}else if(Pt==="Polygon")Hr(et,Tt,Ut,!0);else{if(Pt!=="MultiPolygon"){if(Pt==="GeometryCollection"){for(jt=0;jt<X.geometry.geometries.length;jt++)jr(ht,{id:Lt,geometry:X.geometry.geometries[jt],properties:X.properties},W,ut);return}throw new Error("Input data is not a valid GeoJSON object.")}for(jt=0;jt<et.length;jt++){var ge=[];Hr(et[jt],ge,Ut,!0),Tt.push(ge)}}ht.push(He(Lt,Pt,Tt,X.properties))}}function pi(ht,X){X.push(rn(ht[0])),X.push(ii(ht[1])),X.push(0)}function Dr(ht,X,W,ut){for(var et,Pt,Ut=0,Tt=0;Tt<ht.length;Tt++){var Lt=rn(ht[Tt][0]),jt=ii(ht[Tt][1]);X.push(Lt),X.push(jt),X.push(0),Tt>0&&(Ut+=ut?(et*jt-Lt*Pt)/2:Math.sqrt(Math.pow(Lt-et,2)+Math.pow(jt-Pt,2))),et=Lt,Pt=jt}var ge=X.length-3;X[2]=1,oi(X,0,ge,W),X[ge+2]=1,X.size=Math.abs(Ut),X.start=0,X.end=X.size}function Hr(ht,X,W,ut){for(var et=0;et<ht.length;et++){var Pt=[];Dr(ht[et],Pt,W,ut),X.push(Pt)}}function rn(ht){return ht/360+.5}function ii(ht){var X=Math.sin(ht*Math.PI/180),W=.5-.25*Math.log((1+X)/(1-X))/Math.PI;return W<0?0:W>1?1:W}function zt(ht,X,W,ut,et,Pt,Ut,Tt){if(ut/=X,Pt>=(W/=X)&&Ut<ut)return ht;if(Ut<W||Pt>=ut)return null;for(var Lt=[],jt=0;jt<ht.length;jt++){var ge=ht[jt],Se=ge.geometry,we=ge.type,dr=et===0?ge.minX:ge.minY,Cr=et===0?ge.maxX:ge.maxY;if(dr>=W&&Cr<ut)Lt.push(ge);else if(!(Cr<W||dr>=ut)){var or=[];if(we==="Point"||we==="MultiPoint")J(Se,or,W,ut,et);else if(we==="LineString")Z(Se,or,W,ut,et,!1,Tt.lineMetrics);else if(we==="MultiLineString")ft(Se,or,W,ut,et,!1);else if(we==="Polygon")ft(Se,or,W,ut,et,!0);else if(we==="MultiPolygon")for(var _r=0;_r<Se.length;_r++){var Ar=[];ft(Se[_r],Ar,W,ut,et,!0),Ar.length&&or.push(Ar)}if(or.length){if(Tt.lineMetrics&&we==="LineString"){for(_r=0;_r<or.length;_r++)Lt.push(He(ge.id,we,or[_r],ge.tags));continue}we!=="LineString"&&we!=="MultiLineString"||(or.length===1?(we="LineString",or=or[0]):we="MultiLineString"),we!=="Point"&&we!=="MultiPoint"||(we=or.length===3?"Point":"MultiPoint"),Lt.push(He(ge.id,we,or,ge.tags))}}}return Lt.length?Lt:null}function J(ht,X,W,ut,et){for(var Pt=0;Pt<ht.length;Pt+=3){var Ut=ht[Pt+et];Ut>=W&&Ut<=ut&&(X.push(ht[Pt]),X.push(ht[Pt+1]),X.push(ht[Pt+2]))}}function Z(ht,X,W,ut,et,Pt,Ut){for(var Tt,Lt,jt=H(ht),ge=et===0?Jt:pe,Se=ht.start,we=0;we<ht.length-3;we+=3){var dr=ht[we],Cr=ht[we+1],or=ht[we+2],_r=ht[we+3],Ar=ht[we+4],ni=et===0?dr:Cr,sr=et===0?_r:Ar,vi=!1;Ut&&(Tt=Math.sqrt(Math.pow(dr-_r,2)+Math.pow(Cr-Ar,2))),ni<W?sr>W&&(Lt=ge(jt,dr,Cr,_r,Ar,W),Ut&&(jt.start=Se+Tt*Lt)):ni>ut?sr<ut&&(Lt=ge(jt,dr,Cr,_r,Ar,ut),Ut&&(jt.start=Se+Tt*Lt)):Dt(jt,dr,Cr,or),sr<W&&ni>=W&&(Lt=ge(jt,dr,Cr,_r,Ar,W),vi=!0),sr>ut&&ni<=ut&&(Lt=ge(jt,dr,Cr,_r,Ar,ut),vi=!0),!Pt&&vi&&(Ut&&(jt.end=Se+Tt*Lt),X.push(jt),jt=H(ht)),Ut&&(Se+=Tt)}var si=ht.length-3;dr=ht[si],Cr=ht[si+1],or=ht[si+2],(ni=et===0?dr:Cr)>=W&&ni<=ut&&Dt(jt,dr,Cr,or),si=jt.length-3,Pt&&si>=3&&(jt[si]!==jt[0]||jt[si+1]!==jt[1])&&Dt(jt,jt[0],jt[1],jt[2]),jt.length&&X.push(jt)}function H(ht){var X=[];return X.size=ht.size,X.start=ht.start,X.end=ht.end,X}function ft(ht,X,W,ut,et,Pt){for(var Ut=0;Ut<ht.length;Ut++)Z(ht[Ut],X,W,ut,et,Pt,!1)}function Dt(ht,X,W,ut){ht.push(X),ht.push(W),ht.push(ut)}function Jt(ht,X,W,ut,et,Pt){var Ut=(Pt-X)/(ut-X);return ht.push(Pt),ht.push(W+(et-W)*Ut),ht.push(1),Ut}function pe(ht,X,W,ut,et,Pt){var Ut=(Pt-W)/(et-W);return ht.push(X+(ut-X)*Ut),ht.push(Pt),ht.push(1),Ut}function kt(ht,X){for(var W=[],ut=0;ut<ht.length;ut++){var et,Pt=ht[ut],Ut=Pt.type;if(Ut==="Point"||Ut==="MultiPoint"||Ut==="LineString")et=Ze(Pt.geometry,X);else if(Ut==="MultiLineString"||Ut==="Polygon"){et=[];for(var Tt=0;Tt<Pt.geometry.length;Tt++)et.push(Ze(Pt.geometry[Tt],X))}else if(Ut==="MultiPolygon")for(et=[],Tt=0;Tt<Pt.geometry.length;Tt++){for(var Lt=[],jt=0;jt<Pt.geometry[Tt].length;jt++)Lt.push(Ze(Pt.geometry[Tt][jt],X));et.push(Lt)}W.push(He(Pt.id,Ut,et,Pt.tags))}return W}function Ze(ht,X){var W=[];W.size=ht.size,ht.start!==void 0&&(W.start=ht.start,W.end=ht.end);for(var ut=0;ut<ht.length;ut+=3)W.push(ht[ut]+X,ht[ut+1],ht[ut+2]);return W}function rr(ht,X){if(ht.transformed)return ht;var W,ut,et,Pt=1<<ht.z,Ut=ht.x,Tt=ht.y;for(W=0;W<ht.features.length;W++){var Lt=ht.features[W],jt=Lt.geometry,ge=Lt.type;if(Lt.geometry=[],ge===1)for(ut=0;ut<jt.length;ut+=2)Lt.geometry.push(Me(jt[ut],jt[ut+1],X,Pt,Ut,Tt));else for(ut=0;ut<jt.length;ut++){var Se=[];for(et=0;et<jt[ut].length;et+=2)Se.push(Me(jt[ut][et],jt[ut][et+1],X,Pt,Ut,Tt));Lt.geometry.push(Se)}}return ht.transformed=!0,ht}function Me(ht,X,W,ut,et,Pt){return[Math.round(W*(ht*ut-et)),Math.round(W*(X*ut-Pt))]}function fr(ht,X,W,ut,et){for(var Pt=X===et.maxZoom?0:et.tolerance/((1<<X)*et.extent),Ut={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:W,y:ut,z:X,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Tt=0;Tt<ht.length;Tt++){Ut.numFeatures++,Sr(Ut,ht[Tt],Pt,et);var Lt=ht[Tt].minX,jt=ht[Tt].minY,ge=ht[Tt].maxX,Se=ht[Tt].maxY;Lt<Ut.minX&&(Ut.minX=Lt),jt<Ut.minY&&(Ut.minY=jt),ge>Ut.maxX&&(Ut.maxX=ge),Se>Ut.maxY&&(Ut.maxY=Se)}return Ut}function Sr(ht,X,W,ut){var et=X.geometry,Pt=X.type,Ut=[];if(Pt==="Point"||Pt==="MultiPoint")for(var Tt=0;Tt<et.length;Tt+=3)Ut.push(et[Tt]),Ut.push(et[Tt+1]),ht.numPoints++,ht.numSimplified++;else if(Pt==="LineString")Fr(Ut,et,ht,W,!1,!1);else if(Pt==="MultiLineString"||Pt==="Polygon")for(Tt=0;Tt<et.length;Tt++)Fr(Ut,et[Tt],ht,W,Pt==="Polygon",Tt===0);else if(Pt==="MultiPolygon")for(var Lt=0;Lt<et.length;Lt++){var jt=et[Lt];for(Tt=0;Tt<jt.length;Tt++)Fr(Ut,jt[Tt],ht,W,!0,Tt===0)}if(Ut.length){var ge=X.tags||null;if(Pt==="LineString"&&ut.lineMetrics){for(var Se in ge={},X.tags)ge[Se]=X.tags[Se];ge.mapbox_clip_start=et.start/et.size,ge.mapbox_clip_end=et.end/et.size}var we={geometry:Ut,type:Pt==="Polygon"||Pt==="MultiPolygon"?3:Pt==="LineString"||Pt==="MultiLineString"?2:1,tags:ge};X.id!==null&&(we.id=X.id),ht.features.push(we)}}function Fr(ht,X,W,ut,et,Pt){var Ut=ut*ut;if(ut>0&&X.size<(et?Ut:ut))W.numPoints+=X.length/3;else{for(var Tt=[],Lt=0;Lt<X.length;Lt+=3)(ut===0||X[Lt+2]>Ut)&&(W.numSimplified++,Tt.push(X[Lt]),Tt.push(X[Lt+1])),W.numPoints++;et&&function(jt,ge){for(var Se=0,we=0,dr=jt.length,Cr=dr-2;we<dr;Cr=we,we+=2)Se+=(jt[we]-jt[Cr])*(jt[we+1]+jt[Cr+1]);if(Se>0===ge)for(we=0,dr=jt.length;we<dr/2;we+=2){var or=jt[we],_r=jt[we+1];jt[we]=jt[dr-2-we],jt[we+1]=jt[dr-1-we],jt[dr-2-we]=or,jt[dr-1-we]=_r}}(Tt,Pt),ht.push(Tt)}}function gr(ht,X){var W=(X=this.options=function(et,Pt){for(var Ut in Pt)et[Ut]=Pt[Ut];return et}(Object.create(this.options),X)).debug;if(W&&console.time("preprocess data"),X.maxZoom<0||X.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(X.promoteId&&X.generateId)throw new Error("promoteId and generateId cannot be used together.");var ut=function(et,Pt){var Ut=[];if(et.type==="FeatureCollection")for(var Tt=0;Tt<et.features.length;Tt++)jr(Ut,et.features[Tt],Pt,Tt);else jr(Ut,et.type==="Feature"?et:{geometry:et},Pt);return Ut}(ht,X);this.tiles={},this.tileCoords=[],W&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",X.indexMaxZoom,X.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ut=function(et,Pt){var Ut=Pt.buffer/Pt.extent,Tt=et,Lt=zt(et,1,-1-Ut,Ut,0,-1,2,Pt),jt=zt(et,1,1-Ut,2+Ut,0,-1,2,Pt);return(Lt||jt)&&(Tt=zt(et,1,-Ut,1+Ut,0,-1,2,Pt)||[],Lt&&(Tt=kt(Lt,1).concat(Tt)),jt&&(Tt=Tt.concat(kt(jt,-1)))),Tt}(ut,X),ut.length&&this.splitTile(ut,0,0,0),W&&(ut.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function $r(ht,X,W){return 32*((1<<ht)*W+X)+ht}function yi(ht,X){const W=ht.tileID.canonical;if(!this._geoJSONIndex)return X(null,null);const ut=this._geoJSONIndex.getTile(W.z,W.x,W.y);if(!ut)return X(null,null);const et=new class{constructor(Ut){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=a.EXTENT,this.length=Ut.length,this._features=Ut}feature(Ut){return new class{constructor(Tt){this._feature=Tt,this.extent=a.EXTENT,this.type=Tt.type,this.properties=Tt.tags,"id"in Tt&&!isNaN(Tt.id)&&(this.id=parseInt(Tt.id,10))}loadGeometry(){if(this._feature.type===1){const Tt=[];for(const Lt of this._feature.geometry)Tt.push([new a.Point(Lt[0],Lt[1])]);return Tt}{const Tt=[];for(const Lt of this._feature.geometry){const jt=[];for(const ge of Lt)jt.push(new a.Point(ge[0],ge[1]));Tt.push(jt)}return Tt}}toGeoJSON(Tt,Lt,jt){return ee.call(this,Tt,Lt,jt)}}(this._features[Ut])}}(ut.features);let Pt=Ne(et);Pt.byteOffset===0&&Pt.byteLength===Pt.buffer.byteLength||(Pt=new Uint8Array(Pt)),X(null,{vectorTile:et,rawData:Pt.buffer})}gr.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},gr.prototype.splitTile=function(ht,X,W,ut,et,Pt,Ut){for(var Tt=[ht,X,W,ut],Lt=this.options,jt=Lt.debug;Tt.length;){ut=Tt.pop(),W=Tt.pop(),X=Tt.pop(),ht=Tt.pop();var ge=1<<X,Se=$r(X,W,ut),we=this.tiles[Se];if(!we&&(jt>1&&console.time("creation"),we=this.tiles[Se]=fr(ht,X,W,ut,Lt),this.tileCoords.push({z:X,x:W,y:ut}),jt)){jt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",X,W,ut,we.numFeatures,we.numPoints,we.numSimplified),console.timeEnd("creation"));var dr="z"+X;this.stats[dr]=(this.stats[dr]||0)+1,this.total++}if(we.source=ht,et){if(X===Lt.maxZoom||X===et)continue;var Cr=1<<et-X;if(W!==Math.floor(Pt/Cr)||ut!==Math.floor(Ut/Cr))continue}else if(X===Lt.indexMaxZoom||we.numPoints<=Lt.indexMaxPoints)continue;if(we.source=null,ht.length!==0){jt>1&&console.time("clipping");var or,_r,Ar,ni,sr,vi,si=.5*Lt.buffer/Lt.extent,an=.5-si,Kr=.5+si,ln=1+si;or=_r=Ar=ni=null,sr=zt(ht,ge,W-si,W+Kr,0,we.minX,we.maxX,Lt),vi=zt(ht,ge,W+an,W+ln,0,we.minX,we.maxX,Lt),ht=null,sr&&(or=zt(sr,ge,ut-si,ut+Kr,1,we.minY,we.maxY,Lt),_r=zt(sr,ge,ut+an,ut+ln,1,we.minY,we.maxY,Lt),sr=null),vi&&(Ar=zt(vi,ge,ut-si,ut+Kr,1,we.minY,we.maxY,Lt),ni=zt(vi,ge,ut+an,ut+ln,1,we.minY,we.maxY,Lt),vi=null),jt>1&&console.timeEnd("clipping"),Tt.push(or||[],X+1,2*W,2*ut),Tt.push(_r||[],X+1,2*W,2*ut+1),Tt.push(Ar||[],X+1,2*W+1,2*ut),Tt.push(ni||[],X+1,2*W+1,2*ut+1)}}},gr.prototype.getTile=function(ht,X,W){var ut=this.options,et=ut.extent,Pt=ut.debug;if(ht<0||ht>24)return null;var Ut=1<<ht,Tt=$r(ht,X=(X%Ut+Ut)%Ut,W);if(this.tiles[Tt])return rr(this.tiles[Tt],et);Pt>1&&console.log("drilling down to z%d-%d-%d",ht,X,W);for(var Lt,jt=ht,ge=X,Se=W;!Lt&&jt>0;)jt--,ge=Math.floor(ge/2),Se=Math.floor(Se/2),Lt=this.tiles[$r(jt,ge,Se)];return Lt&&Lt.source?(Pt>1&&console.log("found parent tile z%d-%d-%d",jt,ge,Se),Pt>1&&console.time("drilling down"),this.splitTile(Lt.source,jt,ge,Se,ht,X,W),Pt>1&&console.timeEnd("drilling down"),this.tiles[Tt]?rr(this.tiles[Tt],et):null):null};class Di extends a.VectorTileWorkerSource{constructor(X,W,ut,et,Pt){super(X,W,ut,et,yi),Pt&&(this.loadGeoJSON=Pt)}loadData(X,W){const ut=X&&X.request,et=ut&&ut.collectResourceTiming;this.loadGeoJSON(X,(Pt,Ut)=>{if(Pt||!Ut)return W(Pt);if(typeof Ut!="object")return W(new Error(`Input data given to '${X.source}' is not a valid GeoJSON object.`));{re(Ut,!0);try{if(X.filter){const Lt=a.createExpression(X.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Lt.result==="error")throw new Error(Lt.value.map(ge=>`${ge.key}: ${ge.message}`).join(", "));Ut={type:"FeatureCollection",features:Ut.features.filter(ge=>Lt.value.evaluate({zoom:0},ge))}}this._geoJSONIndex=X.cluster?new ur(function({superclusterOptions:Lt,clusterProperties:jt}){if(!jt||!Lt)return Lt;const ge={},Se={},we={accumulated:null,zoom:0},dr={properties:null},Cr=Object.keys(jt);for(const or of Cr){const[_r,Ar]=jt[or],ni=a.createExpression(Ar),sr=a.createExpression(typeof _r=="string"?[_r,["accumulated"],["get",or]]:_r);ge[or]=ni.value,Se[or]=sr.value}return Lt.map=or=>{dr.properties=or;const _r={};for(const Ar of Cr)_r[Ar]=ge[Ar].evaluate(we,dr);return _r},Lt.reduce=(or,_r)=>{dr.properties=_r;for(const Ar of Cr)we.accumulated=or[Ar],or[Ar]=Se[Ar].evaluate(we,dr)},Lt}(X)).load(Ut.features):function(Lt,jt){return new gr(Lt,jt)}(Ut,X.geojsonVtOptions)}catch(Lt){return W(Lt)}this.loaded={};const Tt={};if(et){const Lt=a.getPerformanceMeasurement(ut);Lt&&(Tt.resourceTiming={},Tt.resourceTiming[X.source]=JSON.parse(JSON.stringify(Lt)))}W(null,Tt)}})}reloadTile(X,W){const ut=this.loaded;return ut&&ut[X.uid]?super.reloadTile(X,W):this.loadTile(X,W)}loadGeoJSON(X,W){if(X.request)a.getJSON(X.request,W);else{if(typeof X.data!="string")return W(new Error(`Input data given to '${X.source}' is not a valid GeoJSON object.`));try{return W(null,JSON.parse(X.data))}catch{return W(new Error(`Input data given to '${X.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(X,W){try{W(null,this._geoJSONIndex.getClusterExpansionZoom(X.clusterId))}catch(ut){W(ut)}}getClusterChildren(X,W){try{W(null,this._geoJSONIndex.getChildren(X.clusterId))}catch(ut){W(ut)}}getClusterLeaves(X,W){try{W(null,this._geoJSONIndex.getLeaves(X.clusterId,X.limit,X.offset))}catch(ut){W(ut)}}}class sn{constructor(X){this.self=X,this.actor=new a.Actor(X,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=a.getProjection({name:"mercator"}),this.workerSourceTypes={vector:a.VectorTileWorkerSource,geojson:Di},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(W,ut)=>{if(this.workerSourceTypes[W])throw new Error(`Worker source with name "${W}" already registered.`);this.workerSourceTypes[W]=ut},this.self.registerRTLTextPlugin=W=>{if(a.plugin.isParsed())throw new Error("RTL text plugin already registered.");a.plugin.applyArabicShaping=W.applyArabicShaping,a.plugin.processBidirectionalText=W.processBidirectionalText,a.plugin.processStyledBidirectionalText=W.processStyledBidirectionalText}}clearCaches(X,W,ut){delete this.layerIndexes[X],delete this.availableImages[X],delete this.workerSources[X],delete this.demWorkerSources[X],ut()}checkIfReady(X,W,ut){ut()}setReferrer(X,W){this.referrer=W}spriteLoaded(X,W){this.isSpriteLoaded[X]=W;for(const ut in this.workerSources[X]){const et=this.workerSources[X][ut];for(const Pt in et)et[Pt]instanceof a.VectorTileWorkerSource&&(et[Pt].isSpriteLoaded=W,et[Pt].fire(new a.Event("isSpriteLoaded")))}}setImages(X,W,ut){this.availableImages[X]=W;for(const et in this.workerSources[X]){const Pt=this.workerSources[X][et];for(const Ut in Pt)Pt[Ut].availableImages=W}ut()}enableTerrain(X,W,ut){this.terrain=W,ut()}setProjection(X,W){this.projections[X]=a.getProjection(W)}setLayers(X,W,ut){this.getLayerIndex(X).replace(W),ut()}updateLayers(X,W,ut){this.getLayerIndex(X).update(W.layers,W.removedIds),ut()}loadTile(X,W,ut){const et=this.enableTerrain?a.extend({enableTerrain:this.terrain},W):W;et.projection=this.projections[X]||this.defaultProjection,this.getWorkerSource(X,W.type,W.source).loadTile(et,ut)}loadDEMTile(X,W,ut){const et=this.enableTerrain?a.extend({buildQuadTree:this.terrain},W):W;this.getDEMWorkerSource(X,W.source).loadTile(et,ut)}reloadTile(X,W,ut){const et=this.enableTerrain?a.extend({enableTerrain:this.terrain},W):W;et.projection=this.projections[X]||this.defaultProjection,this.getWorkerSource(X,W.type,W.source).reloadTile(et,ut)}abortTile(X,W,ut){this.getWorkerSource(X,W.type,W.source).abortTile(W,ut)}removeTile(X,W,ut){this.getWorkerSource(X,W.type,W.source).removeTile(W,ut)}removeSource(X,W,ut){if(!this.workerSources[X]||!this.workerSources[X][W.type]||!this.workerSources[X][W.type][W.source])return;const et=this.workerSources[X][W.type][W.source];delete this.workerSources[X][W.type][W.source],et.removeSource!==void 0?et.removeSource(W,ut):ut()}loadWorkerSource(X,W,ut){try{this.self.importScripts(W.url),ut()}catch(et){ut(et.toString())}}syncRTLPluginState(X,W,ut){try{a.plugin.setState(W);const et=a.plugin.getPluginURL();if(a.plugin.isLoaded()&&!a.plugin.isParsed()&&et!=null){this.self.importScripts(et);const Pt=a.plugin.isParsed();ut(Pt?void 0:new Error(`RTL Text Plugin failed to import scripts from ${et}`),Pt)}}catch(et){ut(et.toString())}}getAvailableImages(X){let W=this.availableImages[X];return W||(W=[]),W}getLayerIndex(X){let W=this.layerIndexes[X];return W||(W=this.layerIndexes[X]=new Rt),W}getWorkerSource(X,W,ut){if(this.workerSources[X]||(this.workerSources[X]={}),this.workerSources[X][W]||(this.workerSources[X][W]={}),!this.workerSources[X][W][ut]){const et={send:(Pt,Ut,Tt,Lt,jt,ge)=>{this.actor.send(Pt,Ut,Tt,X,jt,ge)},scheduler:this.actor.scheduler};this.workerSources[X][W][ut]=new this.workerSourceTypes[W](et,this.getLayerIndex(X),this.getAvailableImages(X),this.isSpriteLoaded[X])}return this.workerSources[X][W][ut]}getDEMWorkerSource(X,W){return this.demWorkerSources[X]||(this.demWorkerSources[X]={}),this.demWorkerSources[X][W]||(this.demWorkerSources[X][W]=new xt),this.demWorkerSources[X][W]}enforceCacheSizeLimit(X,W){a.enforceCacheSizeLimit(W)}getWorkerPerformanceMetrics(X,W,ut){ut(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new sn(self)),sn}),z(["./shared"],function(a){function G(h,n){if(Array.isArray(h)){if(!Array.isArray(n)||h.length!==n.length)return!1;for(let l=0;l<h.length;l++)if(!G(h[l],n[l]))return!1;return!0}if(typeof h=="object"&&h!==null&&n!==null){if(typeof n!="object"||Object.keys(h).length!==Object.keys(n).length)return!1;for(const l in h)if(!G(h[l],n[l]))return!1;return!0}return h===n}var ot=Rt;function Rt(h){return!function(n){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var d,g,v=new Blob([""],{type:"text/javascript"}),I=URL.createObjectURL(v);try{g=new Worker(I),d=!0}catch{d=!1}return g&&g.terminate(),URL.revokeObjectURL(I),d}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var d=document.createElement("canvas");d.width=d.height=1;var g=d.getContext("2d");if(!g)return!1;var v=g.getImageData(0,0,1,1);return v&&v.width===d.width}()?(xt[l=n&&n.failIfMajorPerformanceCaveat]===void 0&&(xt[l]=function(d){var g,v=function(I){var S=document.createElement("canvas"),P=Object.create(Rt.webGLContextAttributes);return P.failIfMajorPerformanceCaveat=I,S.getContext("webgl",P)||S.getContext("experimental-webgl",P)}(d);if(!v)return!1;try{g=v.createShader(v.VERTEX_SHADER)}catch{return!1}return!(!g||v.isContextLost())&&(v.shaderSource(g,"void main() {}"),v.compileShader(g),v.getShaderParameter(g,v.COMPILE_STATUS)===!0)}(l)),xt[l]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var l}(h)}var xt={};function At(h,n,l){const d=a.window.document.createElement(h);return n!==void 0&&(d.className=n),l&&l.appendChild(d),d}function qt(h,n,l){const d=a.window.document.createElementNS("http://www.w3.org/2000/svg",h);for(const g of Object.keys(n))d.setAttributeNS(null,g,n[g]);return l&&l.appendChild(d),d}Rt.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const re=a.window.document&&a.window.document.documentElement.style,ee=re&&re.userSelect!==void 0?"userSelect":"WebkitUserSelect";let Oe;function Ge(){re&&ee&&(Oe=re[ee],re[ee]="none")}function Mt(){re&&ee&&(re[ee]=Oe)}function gt(h){h.preventDefault(),h.stopPropagation(),a.window.removeEventListener("click",gt,!0)}function Et(){a.window.addEventListener("click",gt,!0),a.window.setTimeout(()=>{a.window.removeEventListener("click",gt,!0)},0)}function Ft(h,n){const l=h.getBoundingClientRect();return xe(h,l,n)}function Ie(h,n){const l=h.getBoundingClientRect(),d=[];for(let g=0;g<n.length;g++)d.push(xe(h,l,n[g]));return d}function de(h){return a.window.InstallTrigger!==void 0&&h.button===2&&h.ctrlKey&&a.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:h.button}function xe(h,n,l){const d=h.offsetWidth===n.width?1:h.offsetWidth/n.width;return new a.Point((l.clientX-n.left)*d,(l.clientY-n.top)*d)}function $t(h,n){var l=n[0],d=n[1],g=n[2],v=n[3],I=l*v-g*d;return I?(h[0]=v*(I=1/I),h[1]=-d*I,h[2]=-g*I,h[3]=l*I,h):null}function yt(h){const{userImage:n}=h;return!!(n&&n.render&&n.render())&&(h.data.replace(new Uint8Array(n.data.buffer)),!0)}class ue extends a.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new a.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(n){if(this.loaded!==n&&(this.loaded=n,n)){for(const{ids:l,callback:d}of this.requestors)this._notify(l,d);this.requestors=[]}}hasImage(n){return!!this.getImage(n)}getImage(n){return this.images[n]}addImage(n,l){this._validate(n,l)&&(this.images[n]=l)}_validate(n,l){let d=!0;return this._validateStretch(l.stretchX,l.data&&l.data.width)||(this.fire(new a.ErrorEvent(new Error(`Image "${n}" has invalid "stretchX" value`))),d=!1),this._validateStretch(l.stretchY,l.data&&l.data.height)||(this.fire(new a.ErrorEvent(new Error(`Image "${n}" has invalid "stretchY" value`))),d=!1),this._validateContent(l.content,l)||(this.fire(new a.ErrorEvent(new Error(`Image "${n}" has invalid "content" value`))),d=!1),d}_validateStretch(n,l){if(!n)return!0;let d=0;for(const g of n){if(g[0]<d||g[1]<g[0]||l<g[1])return!1;d=g[1]}return!0}_validateContent(n,l){return!(n&&(n.length!==4||n[0]<0||l.data.width<n[0]||n[1]<0||l.data.height<n[1]||n[2]<0||l.data.width<n[2]||n[3]<0||l.data.height<n[3]||n[2]<n[0]||n[3]<n[1]))}updateImage(n,l){l.version=this.images[n].version+1,this.images[n]=l,this.updatedImages[n]=!0}removeImage(n){const l=this.images[n];delete this.images[n],delete this.patterns[n],l.userImage&&l.userImage.onRemove&&l.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(n,l){let d=!0;if(!this.isLoaded())for(const g of n)this.images[g]||(d=!1);this.isLoaded()||d?this._notify(n,l):this.requestors.push({ids:n,callback:l})}_notify(n,l){const d={};for(const g of n){this.images[g]||this.fire(new a.Event("styleimagemissing",{id:g}));const v=this.images[g];v?d[g]={data:v.data.clone(),pixelRatio:v.pixelRatio,sdf:v.sdf,version:v.version,stretchX:v.stretchX,stretchY:v.stretchY,content:v.content,hasRenderCallback:!!(v.userImage&&v.userImage.render)}:a.warnOnce(`Image "${g}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}l(null,d)}getPixelSize(){const{width:n,height:l}=this.atlasImage;return{width:n,height:l}}getPattern(n){const l=this.patterns[n],d=this.getImage(n);if(!d)return null;if(l&&l.position.version===d.version)return l.position;if(l)l.position.version=d.version;else{const g={w:d.data.width+2,h:d.data.height+2,x:0,y:0},v=new a.ImagePosition(g,d);this.patterns[n]={bin:g,position:v}}return this._updatePatternAtlas(),this.patterns[n].position}bind(n){const l=n.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new a.Texture(n,this.atlasImage,l.RGBA),this.atlasTexture&&this.atlasTexture.bind(l.LINEAR,l.CLAMP_TO_EDGE)}_updatePatternAtlas(){const n=[];for(const v in this.patterns)n.push(this.patterns[v].bin);const{w:l,h:d}=a.potpack(n),g=this.atlasImage;g.resize({width:l||1,height:d||1});for(const v in this.patterns){const{bin:I}=this.patterns[v],S=I.x+1,P=I.y+1,k=this.images[v].data,N=k.width,V=k.height;a.RGBAImage.copy(k,g,{x:0,y:0},{x:S,y:P},{width:N,height:V}),a.RGBAImage.copy(k,g,{x:0,y:V-1},{x:S,y:P-1},{width:N,height:1}),a.RGBAImage.copy(k,g,{x:0,y:0},{x:S,y:P+V},{width:N,height:1}),a.RGBAImage.copy(k,g,{x:N-1,y:0},{x:S-1,y:P},{width:1,height:V}),a.RGBAImage.copy(k,g,{x:0,y:0},{x:S+N,y:P},{width:1,height:V})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(n){for(const l of n){if(this.callbackDispatchedThisFrame[l])continue;this.callbackDispatchedThisFrame[l]=!0;const d=this.images[l];yt(d)&&this.updateImage(l,d)}}}const Kt=new a.Properties({anchor:new a.DataConstantProperty(a.spec.light.anchor),position:new class{constructor(){this.specification=a.spec.light.position}possiblyEvaluate(h,n){return function([l,d,g]){const v=a.degToRad(d+90),I=a.degToRad(g);return{x:l*Math.cos(v)*Math.sin(I),y:l*Math.sin(v)*Math.sin(I),z:l*Math.cos(I),azimuthal:d,polar:g}}(h.expression.evaluate(n))}interpolate(h,n,l){return{x:a.number(h.x,n.x,l),y:a.number(h.y,n.y,l),z:a.number(h.z,n.z,l),azimuthal:a.number(h.azimuthal,n.azimuthal,l),polar:a.number(h.polar,n.polar,l)}}},color:new a.DataConstantProperty(a.spec.light.color),intensity:new a.DataConstantProperty(a.spec.light.intensity)});class ae extends a.Evented{constructor(n){super(),this._transitionable=new a.Transitionable(Kt),this.setLight(n),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(n,l={}){if(!this._validate(a.validateLight,n,l))for(const d in n){const g=n[d];a.endsWith(d,"-transition")?this._transitionable.setTransition(d.slice(0,-11),g):this._transitionable.setValue(d,g)}}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,l,d){return(!d||d.validate!==!1)&&a.emitValidationErrors(this,n.call(a.validateStyle,a.extend({value:l,style:{glyphs:!0,sprite:!0},styleSpec:a.spec})))}}const wt=new a.Properties({source:new a.DataConstantProperty(a.spec.terrain.source),exaggeration:new a.DataConstantProperty(a.spec.terrain.exaggeration)});let _i=class extends a.Evented{constructor(h,n){super(),this._transitionable=new a.Transitionable(wt),this.set(h),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=n}get(){return this._transitionable.serialize()}set(h){for(const n in h){const l=h[n];a.endsWith(n,"-transition")?this._transitionable.setTransition(n.slice(0,-11),l):this._transitionable.setValue(n,l)}}updateTransitions(h){this._transitioning=this._transitionable.transitioned(h,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(h){this.properties=this._transitioning.possiblyEvaluate(h)}};function Ne(h,n,l,d){const g=a.smoothstep(45,65,l),[v,I]=Tr(h,d),S=a.length(n);let P=1-Math.min(1,Math.exp((S-v)/(I-v)*-6));return P*=P*P,P=Math.min(1,1.00747*P),P*g*h.alpha}function Tr(h,n){const l=.5/Math.tan(.5*n);return[h.range[0]+l,h.range[1]+l]}const Ye=new a.Properties({range:new a.DataConstantProperty(a.spec.fog.range),color:new a.DataConstantProperty(a.spec.fog.color),"high-color":new a.DataConstantProperty(a.spec.fog["high-color"]),"space-color":new a.DataConstantProperty(a.spec.fog["space-color"]),"horizon-blend":new a.DataConstantProperty(a.spec.fog["horizon-blend"]),"star-intensity":new a.DataConstantProperty(a.spec.fog["star-intensity"])});class ti extends a.Evented{constructor(n,l){super(),this._transitionable=new a.Transitionable(Ye),this.set(n),this._transitioning=this._transitionable.untransitioned(),this._transform=l}get state(){const n=this._transform,l=n.projection.name==="globe",d=a.globeToMercatorTransition(n.zoom),g=this.properties.get("range"),v=[.5,3];return{range:l?[a.number(v[0],g[0],d),a.number(v[1],g[1],d)]:g,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(n,l={}){if(!this._validate(a.validateFog,n,l)){for(const d of Object.keys(a.spec.fog))n&&n[d]===void 0&&(n[d]=a.spec.fog[d].default);for(const d in n){const g=n[d];a.endsWith(d,"-transition")?this._transitionable.setTransition(d.slice(0,-11),g):this._transitionable.setValue(d,g)}}}getOpacity(n){if(!this._transform.projection.supportsFog)return 0;const l=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:a.smoothstep(45,65,n))*l.a}getOpacityAtLatLng(n,l){return this._transform.projection.supportsFog?function(d,g,v){const I=a.MercatorCoordinate.fromLngLat(g),S=v.elevation?v.elevation.getAtPointOrZero(I):0,P=[I.x,I.y,S];return a.transformMat4(P,P,v.mercatorFogMatrix),Ne(d,P,v.pitch,v._fov)}(this.state,n,l):0}getFovAdjustedRange(n){return this._transform.projection.supportsFog?Tr(this.state,n):[0,1]}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,l,d){return(!d||d.validate!==!1)&&a.emitValidationErrors(this,n.call(a.validateStyle,a.extend({value:l,style:{glyphs:!0,sprite:!0},styleSpec:a.spec})))}}class Pe{constructor(n,l){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=a.uniqueId();const d=this.workerPool.acquire(this.id);for(let g=0;g<d.length;g++){const v=new Pe.Actor(d[g],l,this.id);v.name=`Worker ${g}`,this.actors.push(v)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(n,l,d){a.asyncAll(this.actors,(g,v)=>{g.send(n,l,v)},d=d||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(n=>{n.remove()}),this.actors=[],this.workerPool.release(this.id)}}function tr(h,n,l){return n*(a.EXTENT/(h.tileSize*Math.pow(2,l-h.tileID.overscaledZ)))}Pe.Actor=a.Actor;class Ot{constructor(n,l,d,g){this.screenBounds=n,this.cameraPoint=l,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=d,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,g)}static createFromScreenPoints(n,l){let d,g;if(n instanceof a.Point||typeof n[0]=="number"){const v=a.Point.convert(n);d=[v],g=l.isPointAboveHorizon(v)}else{const v=a.Point.convert(n[0]),I=a.Point.convert(n[1]);d=[v,I],g=a.polygonizeBounds(v,I).every(S=>l.isPointAboveHorizon(S))}return new Ot(d,l.getCameraPoint(),g,l)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(n){return a.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],n)}bufferedCameraGeometry(n){const l=this.screenBounds[0],d=this.screenBounds.length===1?this.screenBounds[0].add(new a.Point(1,1)):this.screenBounds[1],g=a.polygonizeBounds(l,d,0,!1);return this.cameraPoint.y>d.y&&(this.cameraPoint.x>l.x&&this.cameraPoint.x<d.x?g.splice(3,0,this.cameraPoint):this.cameraPoint.x>=d.x?g[2]=this.cameraPoint:this.cameraPoint.x<=l.x&&(g[3]=this.cameraPoint)),a.bufferConvexPolygon(g,n)}bufferedCameraGeometryGlobe(n){const l=this.screenBounds[0],d=this.screenBounds.length===1?this.screenBounds[0].add(new a.Point(1,1)):this.screenBounds[1],g=a.polygonizeBounds(l,d,n),v=this.cameraPoint.clone();switch(3*((v.y>l.y)+(v.y>d.y))+((v.x>l.x)+(v.x>d.x))){case 0:g[0]=v,g[4]=v.clone();break;case 1:g.splice(1,0,v);break;case 2:g[1]=v;break;case 3:g.splice(4,0,v);break;case 5:g.splice(2,0,v);break;case 6:g[3]=v;break;case 7:g.splice(3,0,v);break;case 8:g[2]=v}return g}containsTile(n,l,d,g=0){const v=n.queryPadding/l._pixelsPerMercatorPixel+1,I=d?this._bufferedCameraMercator(v,l):this._bufferedScreenMercator(v,l);let S=n.tileID.wrap+(I.unwrapped?g:0);const P=I.polygon.map(st=>a.getTilePoint(n.tileTransform,st,S));if(!a.polygonIntersectsBox(P,0,0,a.EXTENT,a.EXTENT))return;S=n.tileID.wrap+(this.screenGeometryMercator.unwrapped?g:0);const k=this.screenGeometryMercator.polygon.map(st=>a.getTileVec3(n.tileTransform,st,S)),N=k.map(st=>new a.Point(st[0],st[1])),V=l.getFreeCameraOptions().position||new a.MercatorCoordinate(0,0,0),Y=a.getTileVec3(n.tileTransform,V,S),tt=k.map(st=>{const j=a.sub(st,st,Y);return a.normalize(j,j),new a.Ray(Y,j)}),nt=tr(n,1,l.zoom)*l._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:N,tilespaceRays:tt,bufferedTilespaceGeometry:P,bufferedTilespaceBounds:(it=a.getBounds(P),it.min.x=a.clamp(it.min.x,0,a.EXTENT),it.min.y=a.clamp(it.min.y,0,a.EXTENT),it.max.x=a.clamp(it.max.x,0,a.EXTENT),it.max.y=a.clamp(it.max.y,0,a.EXTENT),it),tile:n,tileID:n.tileID,pixelToTileUnitsFactor:nt};var it}_bufferedScreenMercator(n,l){const d=Li(n);if(this._screenRaycastCache[d])return this._screenRaycastCache[d];{let g;return g=l.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(n),l):{polygon:this.bufferedScreenGeometry(n).map(v=>l.pointCoordinate3D(v)),unwrapped:!0},this._screenRaycastCache[d]=g,g}}_bufferedCameraMercator(n,l){const d=Li(n);if(this._cameraRaycastCache[d])return this._cameraRaycastCache[d];{let g;return g=l.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(n),l):{polygon:this.bufferedCameraGeometry(n).map(v=>l.pointCoordinate3D(v)),unwrapped:!0},this._cameraRaycastCache[d]=g,g}}_projectAndResample(n,l){const d=function(v,I){const S=a.multiply([],I.pixelMatrix,I.globeMatrix),P=[0,-a.GLOBE_RADIUS,0,1],k=[0,a.GLOBE_RADIUS,0,1],N=[0,0,0,1];a.transformMat4$1(P,P,S),a.transformMat4$1(k,k,S),a.transformMat4$1(N,N,S);const V=new a.Point(P[0]/P[3],P[1]/P[3]),Y=new a.Point(k[0]/k[3],k[1]/k[3]),tt=a.polygonContainsPoint(v,V)&&P[3]<N[3],nt=a.polygonContainsPoint(v,Y)&&k[3]<N[3];if(!tt&&!nt)return null;const it=function(St,Bt,Nt){for(let Zt=1;Zt<St.length;Zt++){const ye=pr(Bt.pointCoordinate3D(St[Zt-1]).x),Vt=pr(Bt.pointCoordinate3D(St[Zt]).x);if(Nt<0){if(ye<Vt)return{idx:Zt,t:-ye/(Vt-1-ye)}}else if(Vt<ye)return{idx:Zt,t:(1-ye)/(Vt+1-ye)}}return null}(v,I,tt?-1:1);if(!it)return null;const{idx:st,t:j}=it;let Q=st>1?ur(v.slice(0,st),I):[],ct=st<v.length?ur(v.slice(st),I):[];Q=Q.map(St=>new a.Point(pr(St.x),St.y)),ct=ct.map(St=>new a.Point(pr(St.x),St.y));const pt=[...Q];pt.length===0&&pt.push(ct[ct.length-1]);const It=a.number(pt[pt.length-1].y,(ct.length===0?Q[0]:ct[0]).y,j);let Ct;return Ct=tt?[new a.Point(0,It),new a.Point(0,0),new a.Point(1,0),new a.Point(1,It)]:[new a.Point(1,It),new a.Point(1,1),new a.Point(0,1),new a.Point(0,It)],pt.push(...Ct),ct.length===0?pt.push(Q[0]):pt.push(...ct),{polygon:pt.map(St=>new a.MercatorCoordinate(St.x,St.y)),unwrapped:!1}}(n,l);if(d)return d;const g=function(v,I){let S=!1,P=-1/0,k=0;for(let V=0;V<v.length-1;V++)v[V].x>P&&(P=v[V].x,k=V);for(let V=0;V<v.length-1;V++){const Y=(k+V)%(v.length-1),tt=v[Y],nt=v[Y+1];Math.abs(tt.x-nt.x)>.5&&(tt.x<nt.x?(tt.x+=1,Y===0&&(v[v.length-1].x+=1)):(nt.x+=1,Y+1===v.length-1&&(v[0].x+=1)),S=!0)}const N=a.mercatorXfromLng(I.center.lng);return S&&N<Math.abs(N-1)&&v.forEach(V=>{V.x-=1}),{polygon:v,unwrapped:S}}(ur(n,l).map(v=>new a.Point(pr(v.x),v.y)),l);return{polygon:g.polygon.map(v=>new a.MercatorCoordinate(v.x,v.y)),unwrapped:g.unwrapped}}}function ur(h,n){return a.resample(h,l=>{const d=n.pointCoordinate3D(l);l.x=d.x,l.y=d.y},1/256)}function pr(h){return h<0?1+h%1:h%1}function Li(h){return 100*h|0}function je(h,n,l,d,g){const v=function(I,S){if(I)return g(I);if(S){h.url&&S.tiles&&h.tiles&&delete h.tiles;const P=a.pick(a.extend(S,h),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);S.vector_layers&&(P.vectorLayers=S.vector_layers,P.vectorLayerIds=P.vectorLayers.map(k=>k.id)),P.tiles=n.canonicalizeTileset(P,h.url),g(null,P)}};return h.url?a.getJSON(n.transformRequest(n.normalizeSourceURL(h.url,null,l,d),a.ResourceType.Source),v):a.exported.frame(()=>v(null,h))}class Zr{constructor(n,l,d){this.bounds=a.LngLatBounds.convert(this.validateBounds(n)),this.minzoom=l||0,this.maxzoom=d||24}validateBounds(n){return Array.isArray(n)&&n.length===4?[Math.max(-180,n[0]),Math.max(-90,n[1]),Math.min(180,n[2]),Math.min(90,n[3])]:[-180,-90,180,90]}contains(n){const l=Math.pow(2,n.z),d=Math.floor(a.mercatorXfromLng(this.bounds.getWest())*l),g=Math.floor(a.mercatorYfromLat(this.bounds.getNorth())*l),v=Math.ceil(a.mercatorXfromLng(this.bounds.getEast())*l),I=Math.ceil(a.mercatorYfromLat(this.bounds.getSouth())*l);return n.x>=d&&n.x<v&&n.y>=g&&n.y<I}}class Tn{constructor(n,l,d){this.context=n;const g=n.gl;this.buffer=g.createBuffer(),this.dynamicDraw=!!d,this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),g.bufferData(g.ELEMENT_ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||l.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){const l=this.context.gl;this.context.unbindVAO(),this.bind(),l.bufferSubData(l.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const oi={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Br{constructor(n,l,d,g){this.length=l.length,this.attributes=d,this.itemSize=l.bytesPerElement,this.dynamicDraw=g,this.context=n;const v=n.gl;this.buffer=v.createBuffer(),n.bindVertexBuffer.set(this.buffer),v.bufferData(v.ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||l.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(n){const l=this.context.gl;this.bind(),l.bufferSubData(l.ARRAY_BUFFER,0,n.arrayBuffer)}enableAttributes(n,l){for(let d=0;d<this.attributes.length;d++){const g=l.attributes[this.attributes[d].name];g!==void 0&&n.enableVertexAttribArray(g)}}setVertexAttribPointers(n,l,d){for(let g=0;g<this.attributes.length;g++){const v=this.attributes[g],I=l.attributes[v.name];I!==void 0&&n.vertexAttribPointer(I,v.components,n[oi[v.type]],!1,this.itemSize,v.offset+this.itemSize*(d||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class He{constructor(n){this.gl=n.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(n){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class qe extends He{getDefault(){return a.Color.transparent}set(n){const l=this.current;(n.r!==l.r||n.g!==l.g||n.b!==l.b||n.a!==l.a||this.dirty)&&(this.gl.clearColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class jr extends He{getDefault(){return 1}set(n){(n!==this.current||this.dirty)&&(this.gl.clearDepth(n),this.current=n,this.dirty=!1)}}class pi extends He{getDefault(){return 0}set(n){(n!==this.current||this.dirty)&&(this.gl.clearStencil(n),this.current=n,this.dirty=!1)}}class Dr extends He{getDefault(){return[!0,!0,!0,!0]}set(n){const l=this.current;(n[0]!==l[0]||n[1]!==l[1]||n[2]!==l[2]||n[3]!==l[3]||this.dirty)&&(this.gl.colorMask(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class Hr extends He{getDefault(){return!0}set(n){(n!==this.current||this.dirty)&&(this.gl.depthMask(n),this.current=n,this.dirty=!1)}}class rn extends He{getDefault(){return 255}set(n){(n!==this.current||this.dirty)&&(this.gl.stencilMask(n),this.current=n,this.dirty=!1)}}class ii extends He{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(n){const l=this.current;(n.func!==l.func||n.ref!==l.ref||n.mask!==l.mask||this.dirty)&&(this.gl.stencilFunc(n.func,n.ref,n.mask),this.current=n,this.dirty=!1)}}class zt extends He{getDefault(){const n=this.gl;return[n.KEEP,n.KEEP,n.KEEP]}set(n){const l=this.current;(n[0]!==l[0]||n[1]!==l[1]||n[2]!==l[2]||this.dirty)&&(this.gl.stencilOp(n[0],n[1],n[2]),this.current=n,this.dirty=!1)}}class J extends He{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;n?l.enable(l.STENCIL_TEST):l.disable(l.STENCIL_TEST),this.current=n,this.dirty=!1}}class Z extends He{getDefault(){return[0,1]}set(n){const l=this.current;(n[0]!==l[0]||n[1]!==l[1]||this.dirty)&&(this.gl.depthRange(n[0],n[1]),this.current=n,this.dirty=!1)}}class H extends He{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;n?l.enable(l.DEPTH_TEST):l.disable(l.DEPTH_TEST),this.current=n,this.dirty=!1}}class ft extends He{getDefault(){return this.gl.LESS}set(n){(n!==this.current||this.dirty)&&(this.gl.depthFunc(n),this.current=n,this.dirty=!1)}}class Dt extends He{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;n?l.enable(l.BLEND):l.disable(l.BLEND),this.current=n,this.dirty=!1}}class Jt extends He{getDefault(){const n=this.gl;return[n.ONE,n.ZERO]}set(n){const l=this.current;(n[0]!==l[0]||n[1]!==l[1]||this.dirty)&&(this.gl.blendFunc(n[0],n[1]),this.current=n,this.dirty=!1)}}class pe extends He{getDefault(){return a.Color.transparent}set(n){const l=this.current;(n.r!==l.r||n.g!==l.g||n.b!==l.b||n.a!==l.a||this.dirty)&&(this.gl.blendColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class kt extends He{getDefault(){return this.gl.FUNC_ADD}set(n){(n!==this.current||this.dirty)&&(this.gl.blendEquation(n),this.current=n,this.dirty=!1)}}class Ze extends He{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;n?l.enable(l.CULL_FACE):l.disable(l.CULL_FACE),this.current=n,this.dirty=!1}}class rr extends He{getDefault(){return this.gl.BACK}set(n){(n!==this.current||this.dirty)&&(this.gl.cullFace(n),this.current=n,this.dirty=!1)}}class Me extends He{getDefault(){return this.gl.CCW}set(n){(n!==this.current||this.dirty)&&(this.gl.frontFace(n),this.current=n,this.dirty=!1)}}let fr,Sr=class extends He{getDefault(){return null}set(h){(h!==this.current||this.dirty)&&(this.gl.useProgram(h),this.current=h,this.dirty=!1)}};class Fr extends He{getDefault(){return this.gl.TEXTURE0}set(n){(n!==this.current||this.dirty)&&(this.gl.activeTexture(n),this.current=n,this.dirty=!1)}}class gr extends He{getDefault(){const n=this.gl;return[0,0,n.drawingBufferWidth,n.drawingBufferHeight]}set(n){const l=this.current;(n[0]!==l[0]||n[1]!==l[1]||n[2]!==l[2]||n[3]!==l[3]||this.dirty)&&(this.gl.viewport(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class $r extends He{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;l.bindFramebuffer(l.FRAMEBUFFER,n),this.current=n,this.dirty=!1}}class yi extends He{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;l.bindRenderbuffer(l.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class Di extends He{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;l.bindTexture(l.TEXTURE_2D,n),this.current=n,this.dirty=!1}}class sn extends He{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;l.bindBuffer(l.ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class ht extends He{getDefault(){return null}set(n){const l=this.gl;l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class X extends He{constructor(n){super(n),this.vao=n.extVertexArrayObject}getDefault(){return null}set(n){this.vao&&(n!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(n),this.current=n,this.dirty=!1)}}class W extends He{getDefault(){return 4}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_ALIGNMENT,n),this.current=n,this.dirty=!1}}class ut extends He{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n),this.current=n,this.dirty=!1}}class et extends He{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,n),this.current=n,this.dirty=!1}}class Pt extends He{constructor(n,l){super(n),this.context=n,this.parent=l}getDefault(){return null}}class Ut extends Pt{setDirty(){this.dirty=!0}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class Tt extends Pt{attachment(){return this.gl.DEPTH_ATTACHMENT}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferRenderbuffer(l.FRAMEBUFFER,this.attachment(),l.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class Lt extends Tt{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class jt{constructor(n,l,d,g){this.context=n,this.width=l,this.height=d;const v=this.framebuffer=n.gl.createFramebuffer();this.colorAttachment=new Ut(n,v),g&&(this.depthAttachment=new Tt(n,v))}destroy(){const n=this.context.gl,l=this.colorAttachment.get();if(l&&n.deleteTexture(l),this.depthAttachment){const d=this.depthAttachment.get();d&&n.deleteRenderbuffer(d)}n.deleteFramebuffer(this.framebuffer)}}class ge{constructor(n,l=!1){if(this.gl=n,this.isWebGL2=l,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),l){const d=n;this.extVertexArrayObject={createVertexArrayOES:d.createVertexArray.bind(n),deleteVertexArrayOES:d.deleteVertexArray.bind(n),bindVertexArrayOES:d.bindVertexArray.bind(n)}}this.clearColor=new qe(this),this.clearDepth=new jr(this),this.clearStencil=new pi(this),this.colorMask=new Dr(this),this.depthMask=new Hr(this),this.stencilMask=new rn(this),this.stencilFunc=new ii(this),this.stencilOp=new zt(this),this.stencilTest=new J(this),this.depthRange=new Z(this),this.depthTest=new H(this),this.depthFunc=new ft(this),this.blend=new Dt(this),this.blendFunc=new Jt(this),this.blendColor=new pe(this),this.blendEquation=new kt(this),this.cullFace=new Ze(this),this.cullFaceSide=new rr(this),this.frontFace=new Me(this),this.program=new Sr(this),this.activeTexture=new Fr(this),this.viewport=new gr(this),this.bindFramebuffer=new $r(this),this.bindRenderbuffer=new yi(this),this.bindTexture=new Di(this),this.bindVertexBuffer=new sn(this),this.bindElementBuffer=new ht(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new X(this),this.pixelStoreUnpack=new W(this),this.pixelStoreUnpackPremultiplyAlpha=new ut(this),this.pixelStoreUnpackFlipY=new et(this),this.extTextureFilterAnisotropic=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=n.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=n.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=n.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=n.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),l||(this.extTextureHalfFloat=n.getExtension("OES_texture_half_float")),(l||this.extTextureHalfFloat&&n.getExtension("OES_texture_half_float_linear"))&&(this.extRenderToTextureHalfFloat=n.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=l||n.getExtension("OES_standard_derivatives"),this.extTimerQuery=n.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(n,l){return new Tn(this,n,l)}createVertexBuffer(n,l,d){return new Br(this,n,l,d)}createRenderbuffer(n,l,d){const g=this.gl,v=g.createRenderbuffer();return this.bindRenderbuffer.set(v),g.renderbufferStorage(g.RENDERBUFFER,n,l,d),this.bindRenderbuffer.set(null),v}createFramebuffer(n,l,d){return new jt(this,n,l,d)}clear({color:n,depth:l,stencil:d}){const g=this.gl;let v=0;n&&(v|=g.COLOR_BUFFER_BIT,this.clearColor.set(n),this.colorMask.set([!0,!0,!0,!0])),l!==void 0&&(v|=g.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(l),this.depthMask.set(!0)),d!==void 0&&(v|=g.STENCIL_BUFFER_BIT,this.clearStencil.set(d),this.stencilMask.set(255)),g.clear(v)}setCullFace(n){n.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(n.mode),this.frontFace.set(n.frontFace))}setDepthMode(n){n.func!==this.gl.ALWAYS||n.mask?(this.depthTest.set(!0),this.depthFunc.set(n.func),this.depthMask.set(n.mask),this.depthRange.set(n.range)):this.depthTest.set(!1)}setStencilMode(n){n.test.func!==this.gl.ALWAYS||n.mask?(this.stencilTest.set(!0),this.stencilMask.set(n.mask),this.stencilOp.set([n.fail,n.depthFail,n.pass]),this.stencilFunc.set({func:n.test.func,ref:n.ref,mask:n.test.mask})):this.stencilTest.set(!1)}setColorMode(n){G(n.blendFunction,a.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(n.blendFunction),this.blendColor.set(n.blendColor)),this.colorMask.set(n.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class Se extends a.Evented{constructor(n,l,d,g){if(super(),this.id=n,this.dispatcher=d,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,a.extend(this,a.pick(l,["url","scheme","tileSize","promoteId"])),this._options=a.extend({type:"vector"},l),this._collectResourceTiming=l.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(g),this._tileWorkers={},this._deduped=new a.DedupedRequest}load(n){this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"}));const l=Array.isArray(this.map._language)?this.map._language.join():this.map._language,d=this.map._worldview;this._tileJSONRequest=je(this._options,this.map._requestManager,l,d,(g,v)=>{this._tileJSONRequest=null,this._loaded=!0,g?(l&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${l}`),d&&d.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${d}`),this.fire(new a.ErrorEvent(g))):v&&(a.extend(this,v),v.bounds&&(this.tileBounds=new Zr(v.bounds,this.minzoom,this.maxzoom)),a.postTurnstileEvent(v.tiles,this.map._requestManager._customAccessToken),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"}))),n&&n(g)})}loaded(){return this._loaded}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}onAdd(n){this.map=n,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(n){return this._options.tiles=n,this.reload(),this}setUrl(n){return this.url=n,this._options.url=n,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return a.extend({},this._options)}loadTile(n,l){const d=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme)),g={request:this.map._requestManager.transformRequest(d,a.ResourceType.Tile),data:void 0,uid:n.uid,tileID:n.tileID,tileZoom:n.tileZoom,zoom:n.tileID.overscaledZ,tileSize:this.tileSize*n.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:a.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:n.isSymbolTile};if(g.request.collectResourceTiming=this._collectResourceTiming,n.actor&&n.state!=="expired")n.state==="loading"?n.reloadCallback=l:n.request=n.actor.send("reloadTile",g,v.bind(this));else if(n.actor=this._tileWorkers[d]=this._tileWorkers[d]||this.dispatcher.getActor(),this.dispatcher.ready)n.request=n.actor.send("loadTile",g,v.bind(this),void 0,!0);else{const I=a.loadVectorTile.call({deduped:this._deduped},g,(S,P)=>{S||!P?v.call(this,S):(g.data={cacheControl:P.cacheControl,expires:P.expires,rawData:P.rawData.slice(0)},n.actor&&n.actor.send("loadTile",g,v.bind(this),void 0,!0))},!0);n.request={cancel:I}}function v(I,S){return delete n.request,n.aborted?l(null):I&&I.status!==404?l(I):(S&&S.resourceTiming&&(n.resourceTiming=S.resourceTiming),this.map._refreshExpiredTiles&&S&&n.setExpiryData(S),n.loadVectorData(S,this.map.painter),a.cacheEntryPossiblyAdded(this.dispatcher),l(null),void(n.reloadCallback&&(this.loadTile(n,n.reloadCallback),n.reloadCallback=null)))}}abortTile(n){n.request&&(n.request.cancel(),delete n.request),n.actor&&n.actor.send("abortTile",{uid:n.uid,type:this.type,source:this.id})}unloadTile(n){n.unloadVectorData(),n.actor&&n.actor.send("removeTile",{uid:n.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class we extends a.Evented{constructor(n,l,d,g){super(),this.id=n,this.dispatcher=d,this.setEventedParent(g),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=a.extend({type:"raster"},l),a.extend(this,a.pick(l,["url","scheme","tileSize"]))}load(n){this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=je(this._options,this.map._requestManager,null,null,(l,d)=>{this._tileJSONRequest=null,this._loaded=!0,l?this.fire(new a.ErrorEvent(l)):d&&(a.extend(this,d),d.bounds&&(this.tileBounds=new Zr(d.bounds,this.minzoom,this.maxzoom)),a.postTurnstileEvent(d.tiles),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"}))),n&&n(l)})}loaded(){return this._loaded}onAdd(n){this.map=n,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(n){return this._options.tiles=n,this.reload(),this}setUrl(n){return this.url=n,this._options.url=n,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return a.extend({},this._options)}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}loadTile(n,l){const d=a.exported.devicePixelRatio>=2,g=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),d,this.tileSize);n.request=a.getImage(this.map._requestManager.transformRequest(g,a.ResourceType.Tile),(v,I,S,P)=>(delete n.request,n.aborted?(n.state="unloaded",l(null)):v?(n.state="errored",l(v)):I?(this.map._refreshExpiredTiles&&n.setExpiryData({cacheControl:S,expires:P}),n.setTexture(I,this.map.painter),n.state="loaded",a.cacheEntryPossiblyAdded(this.dispatcher),void l(null)):l(null)))}static loadTileData(n,l,d){n.setTexture(l,d)}static unloadTileData(n,l){n.texture&&l.saveTileTexture(n.texture)}abortTile(n,l){n.request&&(n.request.cancel(),delete n.request),l()}unloadTile(n,l){n.texture&&this.map.painter.saveTileTexture(n.texture),l()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function dr(h,n,l,d,g,v,I,S){const P=[h,l,g,n,d,v,1,1,1],k=[I,S,1],N=a.adjoint([],P),[V,Y,tt]=a.transformMat3(k,k,a.transpose(N,N));return a.multiply$1(P,[V,0,0,0,Y,0,0,0,tt],P)}class Cr extends a.Evented{constructor(n,l,d,g){super(),this.id=n,this.dispatcher=d,this.coordinates=l.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(g),this.options=l,this._dirty=!1}load(n,l){this._loaded=l||!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=a.getImage(this.map._requestManager.transformRequest(this.url,a.ResourceType.Image),(d,g)=>{if(this._imageRequest=null,this._loaded=!0,d)this.fire(new a.ErrorEvent(d));else if(g){const{HTMLImageElement:v}=a.window;this.image=g instanceof v?a.exported.getImageData(g):g,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,n&&(this.coordinates=n),this._finishLoading()}})}loaded(){return this._loaded}updateImage(n){return this.image&&n.url?(this._imageRequest&&n.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=n.url,this.load(n.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(n){this.map=n,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(n){this.coordinates=n,this._boundsArray=void 0;const l=n.map(a.MercatorCoordinate.fromLngLat);return this.tileID=function(d){let g=1/0,v=1/0,I=-1/0,S=-1/0;for(const V of d)g=Math.min(g,V.x),v=Math.min(v,V.y),I=Math.max(I,V.x),S=Math.max(S,V.y);const P=Math.max(I-g,S-v),k=Math.max(0,Math.floor(-Math.log(P)/Math.LN2)),N=Math.pow(2,k);return new a.CanonicalTileID(k,Math.floor((g+I)/2*N),Math.floor((v+S)/2*N))}(l),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(n){for(const P in this.tiles){const k=this.tiles[P];k.state!=="loaded"&&(k.state="loaded",k.texture=this.texture)}if(this._boundsArray)return;const l=a.tileTransform(this.tileID,this.map.transform.projection),[d,g,v,I]=this.coordinates.map(P=>{const k=l.projection.project(P[0],P[1]);return a.getTilePoint(l,k)._round()});this.perspectiveTransform=function(P,k,N,V,Y,tt,nt,it,st,j){const Q=dr(0,0,P,0,0,k,P,k),ct=dr(N,V,Y,tt,nt,it,st,j);return a.multiply$1(ct,a.adjoint(Q,Q),ct),[ct[6]/ct[8]*P/a.EXTENT,ct[7]/ct[8]*k/a.EXTENT]}(this.width,this.height,d.x,d.y,g.x,g.y,I.x,I.y,v.x,v.y);const S=this._boundsArray=new a.StructArrayLayout4i8;S.emplaceBack(d.x,d.y,0,0),S.emplaceBack(g.x,g.y,a.EXTENT,0),S.emplaceBack(I.x,I.y,0,a.EXTENT),S.emplaceBack(v.x,v.y,a.EXTENT,a.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=n.createVertexBuffer(S,a.boundsAttributes.members),this.boundsSegments=a.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const n=this.map.painter.context,l=n.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new a.Texture(n,this.image,l.RGBA),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(n)}loadTile(n,l){this.tileID&&this.tileID.equals(n.tileID.canonical)?(this.tiles[String(n.tileID.wrap)]=n,n.buckets={},l(null)):(n.state="errored",l(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const or={vector:Se,raster:we,"raster-dem":class extends we{constructor(h,n,l,d){super(h,n,l,d),this.type="raster-dem",this.maxzoom=22,this._options=a.extend({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox"}loadTile(h,n){const l=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function d(g,v){g&&(h.state="errored",n(g)),v&&(h.dem=v,h.dem.onDeserialize(),h.needsHillshadePrepare=!0,h.needsDEMTextureUpload=!0,h.state="loaded",n(null))}h.request=a.getImage(this.map._requestManager.transformRequest(l,a.ResourceType.Tile),function(g,v,I,S){if(delete h.request,h.aborted)h.state="unloaded",n(null);else if(g)h.state="errored",n(g);else if(v){this.map._refreshExpiredTiles&&h.setExpiryData({cacheControl:I,expires:S});const P=a.window.ImageBitmap&&v instanceof a.window.ImageBitmap&&(fr==null&&(fr=a.window.OffscreenCanvas&&new a.window.OffscreenCanvas(1,1).getContext("2d")&&typeof a.window.createImageBitmap=="function"),fr),k=1-(v.width-a.prevPowerOfTwo(v.width))/2;k<1||h.neighboringTiles||(h.neighboringTiles=this._getNeighboringTiles(h.tileID));const N=P?v:a.exported.getImageData(v,k),V={uid:h.uid,coord:h.tileID,source:this.id,rawImageData:N,encoding:this.encoding,padding:k};h.actor&&h.state!=="expired"||(h.actor=this.dispatcher.getActor(),h.actor.send("loadDEMTile",V,d.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(h){const n=h.canonical,l=Math.pow(2,n.z),d=(n.x-1+l)%l,g=n.x===0?h.wrap-1:h.wrap,v=(n.x+1+l)%l,I=n.x+1===l?h.wrap+1:h.wrap,S={};return S[new a.OverscaledTileID(h.overscaledZ,g,n.z,d,n.y).key]={backfilled:!1},S[new a.OverscaledTileID(h.overscaledZ,I,n.z,v,n.y).key]={backfilled:!1},n.y>0&&(S[new a.OverscaledTileID(h.overscaledZ,g,n.z,d,n.y-1).key]={backfilled:!1},S[new a.OverscaledTileID(h.overscaledZ,h.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},S[new a.OverscaledTileID(h.overscaledZ,I,n.z,v,n.y-1).key]={backfilled:!1}),n.y+1<l&&(S[new a.OverscaledTileID(h.overscaledZ,g,n.z,d,n.y+1).key]={backfilled:!1},S[new a.OverscaledTileID(h.overscaledZ,h.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},S[new a.OverscaledTileID(h.overscaledZ,I,n.z,v,n.y+1).key]={backfilled:!1}),S}unloadTile(h){h.demTexture&&this.map.painter.saveTileTexture(h.demTexture),h.fbo&&(h.fbo.destroy(),delete h.fbo),h.dem&&delete h.dem,delete h.neighboringTiles,h.state="unloaded"}},geojson:class extends a.Evented{constructor(h,n,l,d){super(),this.id=h,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=l.getActor(),this.setEventedParent(d),this._data=n.data,this._options=a.extend({},n),this._collectResourceTiming=n.collectResourceTiming,n.maxzoom!==void 0&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;const g=a.EXTENT/this.tileSize;this.workerOptions=a.extend({source:this.id,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(n.buffer!==void 0?n.buffer:128)*g,tolerance:(n.tolerance!==void 0?n.tolerance:.375)*g,extent:a.EXTENT,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:n.clusterMaxZoom!==void 0?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:a.EXTENT,radius:(n.clusterRadius!==void 0?n.clusterRadius:50)*g,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter},n.workerOptions)}onAdd(h){this.map=h,this.setData(this._data)}setData(h){return this._data=h,this._updateWorkerData(),this}getClusterExpansionZoom(h,n){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:h,source:this.id},n),this}getClusterChildren(h,n){return this.actor.send("geojson.getClusterChildren",{clusterId:h,source:this.id},n),this}getClusterLeaves(h,n,l,d){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:h,limit:n,offset:l},d),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new a.Event("dataloading",{dataType:"source"})),this._loaded=!1;const h=a.extend({},this.workerOptions),n=this._data;typeof n=="string"?(h.request=this.map._requestManager.transformRequest(a.exported.resolveURL(n),a.ResourceType.Source),h.request.collectResourceTiming=this._collectResourceTiming):h.data=JSON.stringify(n),this._pendingLoad=this.actor.send(`${this.type}.loadData`,h,(l,d)=>{if(this._loaded=!0,this._pendingLoad=null,l)this.fire(new a.ErrorEvent(l));else{const g={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&d&&d.resourceTiming&&d.resourceTiming[this.id]&&(g.resourceTiming=d.resourceTiming[this.id]),this.fire(new a.Event("data",g)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(h,n){const l=h.actor?"reloadTile":"loadTile";h.actor=this.actor,h.request=this.actor.send(l,{type:this.type,uid:h.uid,tileID:h.tileID,tileZoom:h.tileZoom,zoom:h.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:a.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(d,g)=>(delete h.request,h.unloadVectorData(),h.aborted?n(null):d?n(d):(h.loadVectorData(g,this.map.painter,l==="reloadTile"),n(null))),void 0,l==="loadTile")}abortTile(h){h.request&&(h.request.cancel(),delete h.request),h.aborted=!0}unloadTile(h){h.unloadVectorData(),this.actor.send("removeTile",{uid:h.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return a.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Cr{constructor(h,n,l,d){super(h,n,l,d),this.roundZoom=!0,this.type="video",this.options=n}load(){this._loaded=!1;const h=this.options;this.urls=[];for(const n of h.urls)this.urls.push(this.map._requestManager.transformRequest(n,a.ResourceType.Source).url);a.getVideo(this.urls,(n,l)=>{this._loaded=!0,n?this.fire(new a.ErrorEvent(n)):l&&(this.video=l,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(h){if(this.video){const n=this.video.seekable;h<n.start(0)||h>n.end(0)?this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=h}}getVideo(){return this.video}onAdd(h){this.map||(this.map=h,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const h=this.map.painter.context,n=h.gl;this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new a.Texture(h,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(h)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Cr,canvas:class extends Cr{constructor(h,n,l,d){super(h,n,l,d),n.coordinates?Array.isArray(n.coordinates)&&n.coordinates.length===4&&!n.coordinates.some(g=>!Array.isArray(g)||g.length!==2||g.some(v=>typeof v!="number"))||this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${h}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${h}`,null,'missing required property "coordinates"'))),n.animate&&typeof n.animate!="boolean"&&this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${h}`,null,'optional "animate" property must be a boolean value'))),n.canvas?typeof n.canvas=="string"||n.canvas instanceof a.window.HTMLCanvasElement||this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${h}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${h}`,null,'missing required property "canvas"'))),this.options=n,this.animate=n.animate===void 0||n.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof a.window.HTMLCanvasElement?this.options.canvas:a.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(h){this.map=h,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let h=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,h=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,h=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const n=this.map.painter.context;this.texture?(h||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new a.Texture(n,this.canvas,n.gl.RGBA,{premultiply:!0}),this._prepareData(n)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const h of[this.canvas.width,this.canvas.height])if(isNaN(h)||h<=0)return!0;return!1}},custom:class extends a.Evented{constructor(h,n,l,d){super(),this.id=h,this.type="custom",this._dataType="raster",this._dispatcher=l,this._implementation=n,this.setEventedParent(d),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new a.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new a.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Zr(this._implementation.bounds,this.minzoom,this.maxzoom)),n.update=this._update.bind(this),n.clearTiles=this._clearTiles.bind(this),n.coveringTiles=this._coveringTiles.bind(this),a.extend(this,a.pick(n,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return a.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(h){this._map=h,this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(h),this.load()}onRemove(h){this._implementation.onRemove&&this._implementation.onRemove(h)}hasTile(h){if(this._implementation.hasTile){const{x:n,y:l,z:d}=h.canonical;return this._implementation.hasTile({x:n,y:l,z:d})}return!this.tileBounds||this.tileBounds.contains(h.canonical)}loadTile(h,n){const{x:l,y:d,z:g}=h.tileID.canonical,v=new a.window.AbortController;h.request=Promise.resolve(this._implementation.loadTile({x:l,y:d,z:g},{signal:v.signal})).then(function(I){return delete h.request,h.aborted?(h.state="unloaded",n(null)):I===void 0?(h.state="errored",n(null)):I===null?(this.loadTileData(h,{width:this.tileSize,height:this.tileSize,data:null}),h.state="loaded",n(null)):function(S){return S instanceof a.window.ImageData||S instanceof a.window.HTMLCanvasElement||S instanceof a.window.ImageBitmap||S instanceof a.window.HTMLImageElement}(I)?(this.loadTileData(h,I),h.state="loaded",void n(null)):(h.state="errored",n(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}.bind(this)).catch(I=>{I.code!==20&&(h.state="errored",n(I))}),h.request.cancel=()=>v.abort()}loadTileData(h,n){we.loadTileData(h,n,this._map.painter)}unloadTileData(h){we.unloadTileData(h,this._map.painter)}unloadTile(h,n){if(this.unloadTileData(h),this._implementation.unloadTile){const{x:l,y:d,z:g}=h.tileID.canonical;this._implementation.unloadTile({x:l,y:d,z:g})}n()}abortTile(h,n){h.request&&h.request.cancel&&(h.request.cancel(),delete h.request),n()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(h=>({x:h.canonical.x,y:h.canonical.y,z:h.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"}))}}},_r=function(h,n,l,d){const g=new or[n.type](h,n,l,d);if(g.id!==h)throw new Error(`Expected Source id to be ${h} instead of ${g.id}`);return a.bindAll(["load","abort","unload","serialize","prepare"],g),g};function Ar(h,n){const l=a.identity([]);return a.scale(l,l,[.5*h.width,.5*-h.height,1]),a.translate(l,l,[1,-1,0]),a.multiply(l,l,h.calculateProjMatrix(n.toUnwrapped())),Float32Array.from(l)}function ni(h,n,l,d,g,v,I,S=!1){const P=h.tilesIn(d,I,S);P.sort(vi);const k=[];for(const V of P)k.push({wrappedTileID:V.tile.tileID.wrapped().key,queryResults:V.tile.queryRenderedFeatures(n,l,h._state,V,g,v,Ar(h.transform,V.tile.tileID),S)});const N=function(V){const Y={},tt={};for(const nt of V){const it=nt.queryResults,st=nt.wrappedTileID,j=tt[st]=tt[st]||{};for(const Q in it){const ct=it[Q],pt=j[Q]=j[Q]||{},It=Y[Q]=Y[Q]||[];for(const Ct of ct)pt[Ct.featureIndex]||(pt[Ct.featureIndex]=!0,It.push(Ct))}}return Y}(k);for(const V in N)N[V].forEach(Y=>{const tt=Y.feature,nt=tt.layer;nt&&nt.type!=="background"&&nt.type!=="sky"&&(tt.source=nt.source,nt["source-layer"]&&(tt.sourceLayer=nt["source-layer"]),tt.state=tt.id!==void 0?h.getFeatureState(nt["source-layer"],tt.id):{})});return N}function sr(h,n){const l=h.getRenderableIds().map(v=>h.getTileByID(v)),d=[],g={};for(let v=0;v<l.length;v++){const I=l[v],S=I.tileID.canonical.key;g[S]||(g[S]=!0,I.querySourceFeatures(d,n))}return d}function vi(h,n){const l=h.tileID,d=n.tileID;return l.overscaledZ-d.overscaledZ||l.canonical.y-d.canonical.y||l.wrap-d.wrap||l.canonical.x-d.canonical.x}function si(){return wl.workerClass!=null?new wl.workerClass:new a.window.Worker(wl.workerUrl)}const an="mapboxgl_preloaded_worker_pool";class Kr{constructor(){this.active={}}acquire(n){if(!this.workers)for(this.workers=[];this.workers.length<Kr.workerCount;)this.workers.push(new si);return this.active[n]=!0,this.workers.slice()}release(n){delete this.active[n],this.numActive()===0&&(this.workers.forEach(l=>{l.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[an]}numActive(){return Object.keys(this.active).length}}let ln;function Pn(){return ln||(ln=new Kr),ln}function ml(h,n){const l={};for(const d in h)d!=="ref"&&(l[d]=h[d]);return a.refProperties.forEach(d=>{d in n&&(l[d]=n[d])}),l}function co(h){h=h.slice();const n=Object.create(null);for(let l=0;l<h.length;l++)n[h[l].id]=h[l];for(let l=0;l<h.length;l++)"ref"in h[l]&&(h[l]=ml(h[l],n[h[l].ref]));return h}Kr.workerCount=2;const Wr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Ri(h,n,l){l.push({command:Wr.addSource,args:[h,n[h]]})}function fi(h,n,l){n.push({command:Wr.removeSource,args:[h]}),l[h]=!0}function fa(h,n,l,d){fi(h,l,d),Ri(h,n,l)}function Ln(h,n,l){let d;for(d in h[l])if(h[l].hasOwnProperty(d)&&d!=="data"&&!G(h[l][d],n[l][d]))return!1;for(d in n[l])if(n[l].hasOwnProperty(d)&&d!=="data"&&!G(h[l][d],n[l][d]))return!1;return!0}function Gn(h,n,l,d,g,v){let I;for(I in n=n||{},h=h||{})h.hasOwnProperty(I)&&(G(h[I],n[I])||l.push({command:v,args:[d,I,n[I],g]}));for(I in n)n.hasOwnProperty(I)&&!h.hasOwnProperty(I)&&(G(h[I],n[I])||l.push({command:v,args:[d,I,n[I],g]}))}function ai(h){return h.id}function Hs(h,n){return h[n.id]=n,h}class Po{constructor(n,l){this.reset(n,l)}reset(n,l){this.points=n||[],this._distances=[0];for(let d=1;d<this.points.length;d++)this._distances[d]=this._distances[d-1]+this.points[d].dist(this.points[d-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(l||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(n){if(this.points.length===1)return this.points[0];n=a.clamp(n,0,1);let l=1,d=this._distances[l];const g=n*this.paddedLength+this.padding;for(;d<g&&l<this._distances.length;)d=this._distances[++l];const v=l-1,I=this._distances[v],S=d-I,P=S>0?(g-I)/S:0;return this.points[v].mult(1-P).add(this.points[l].mult(P))}}class Zn{constructor(n,l,d){const g=this.boxCells=[],v=this.circleCells=[];this.xCellCount=Math.ceil(n/d),this.yCellCount=Math.ceil(l/d);for(let I=0;I<this.xCellCount*this.yCellCount;I++)g.push([]),v.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=n,this.height=l,this.xScale=this.xCellCount/n,this.yScale=this.yCellCount/l,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(n,l,d,g,v){this._forEachCell(l,d,g,v,this._insertBoxCell,this.boxUid++),this.boxKeys.push(n),this.bboxes.push(l),this.bboxes.push(d),this.bboxes.push(g),this.bboxes.push(v)}insertCircle(n,l,d,g){this._forEachCell(l-g,d-g,l+g,d+g,this._insertCircleCell,this.circleUid++),this.circleKeys.push(n),this.circles.push(l),this.circles.push(d),this.circles.push(g)}_insertBoxCell(n,l,d,g,v,I){this.boxCells[v].push(I)}_insertCircleCell(n,l,d,g,v,I){this.circleCells[v].push(I)}_query(n,l,d,g,v,I){if(d<0||n>this.width||g<0||l>this.height)return!v&&[];const S=[];if(n<=0&&l<=0&&this.width<=d&&this.height<=g){if(v)return!0;for(let P=0;P<this.boxKeys.length;P++)S.push({key:this.boxKeys[P],x1:this.bboxes[4*P],y1:this.bboxes[4*P+1],x2:this.bboxes[4*P+2],y2:this.bboxes[4*P+3]});for(let P=0;P<this.circleKeys.length;P++){const k=this.circles[3*P],N=this.circles[3*P+1],V=this.circles[3*P+2];S.push({key:this.circleKeys[P],x1:k-V,y1:N-V,x2:k+V,y2:N+V})}return I?S.filter(I):S}return this._forEachCell(n,l,d,g,this._queryCell,S,{hitTest:v,seenUids:{box:{},circle:{}}},I),v?S.length>0:S}_queryCircle(n,l,d,g,v){const I=n-d,S=n+d,P=l-d,k=l+d;if(S<0||I>this.width||k<0||P>this.height)return!g&&[];const N=[];return this._forEachCell(I,P,S,k,this._queryCellCircle,N,{hitTest:g,circle:{x:n,y:l,radius:d},seenUids:{box:{},circle:{}}},v),g?N.length>0:N}query(n,l,d,g,v){return this._query(n,l,d,g,!1,v)}hitTest(n,l,d,g,v){return this._query(n,l,d,g,!0,v)}hitTestCircle(n,l,d,g){return this._queryCircle(n,l,d,!0,g)}_queryCell(n,l,d,g,v,I,S,P){const k=S.seenUids,N=this.boxCells[v];if(N!==null){const Y=this.bboxes;for(const tt of N)if(!k.box[tt]){k.box[tt]=!0;const nt=4*tt;if(n<=Y[nt+2]&&l<=Y[nt+3]&&d>=Y[nt+0]&&g>=Y[nt+1]&&(!P||P(this.boxKeys[tt]))){if(S.hitTest)return I.push(!0),!0;I.push({key:this.boxKeys[tt],x1:Y[nt],y1:Y[nt+1],x2:Y[nt+2],y2:Y[nt+3]})}}}const V=this.circleCells[v];if(V!==null){const Y=this.circles;for(const tt of V)if(!k.circle[tt]){k.circle[tt]=!0;const nt=3*tt;if(this._circleAndRectCollide(Y[nt],Y[nt+1],Y[nt+2],n,l,d,g)&&(!P||P(this.circleKeys[tt]))){if(S.hitTest)return I.push(!0),!0;{const it=Y[nt],st=Y[nt+1],j=Y[nt+2];I.push({key:this.circleKeys[tt],x1:it-j,y1:st-j,x2:it+j,y2:st+j})}}}}}_queryCellCircle(n,l,d,g,v,I,S,P){const k=S.circle,N=S.seenUids,V=this.boxCells[v];if(V!==null){const tt=this.bboxes;for(const nt of V)if(!N.box[nt]){N.box[nt]=!0;const it=4*nt;if(this._circleAndRectCollide(k.x,k.y,k.radius,tt[it+0],tt[it+1],tt[it+2],tt[it+3])&&(!P||P(this.boxKeys[nt])))return I.push(!0),!0}}const Y=this.circleCells[v];if(Y!==null){const tt=this.circles;for(const nt of Y)if(!N.circle[nt]){N.circle[nt]=!0;const it=3*nt;if(this._circlesCollide(tt[it],tt[it+1],tt[it+2],k.x,k.y,k.radius)&&(!P||P(this.circleKeys[nt])))return I.push(!0),!0}}}_forEachCell(n,l,d,g,v,I,S,P){const k=this._convertToXCellCoord(n),N=this._convertToYCellCoord(l),V=this._convertToXCellCoord(d),Y=this._convertToYCellCoord(g);for(let tt=k;tt<=V;tt++)for(let nt=N;nt<=Y;nt++)if(v.call(this,n,l,d,g,this.xCellCount*nt+tt,I,S,P))return}_convertToXCellCoord(n){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(n*this.xScale)))}_convertToYCellCoord(n){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(n*this.yScale)))}_circlesCollide(n,l,d,g,v,I){const S=g-n,P=v-l,k=d+I;return k*k>S*S+P*P}_circleAndRectCollide(n,l,d,g,v,I,S){const P=(I-g)/2,k=Math.abs(n-(g+P));if(k>P+d)return!1;const N=(S-v)/2,V=Math.abs(l-(v+N));if(V>N+d)return!1;if(k<=P||V<=N)return!0;const Y=k-P,tt=V-N;return Y*Y+tt*tt<=d*d}}const un={unknown:0,flipRequired:1,flipNotRequired:2},Ks=Math.tan(85*Math.PI/180);function ie(h,n,l,d,g,v,I){const S=a.create();if(l)if(v.name==="globe"){const P=a.calculateGlobeLabelMatrix(g,n);a.multiply(S,S,P)}else{const P=$t([],I);S[0]=P[0],S[1]=P[1],S[4]=P[2],S[5]=P[3],d||a.rotateZ(S,S,g.angle)}else a.multiply(S,g.labelPlaneMatrix,h);return S}function Lo(h,n,l,d,g,v,I){const S=ie(h,n,l,d,g,v,I);return v.name==="globe"&&l||(S[2]=S[6]=S[10]=S[14]=0),S}function Xi(h,n,l,d,g,v,I){if(l){if(v.name==="globe"){const S=ie(h,n,l,d,g,v,I);return a.invert(S,S),a.multiply(S,h,S),S}{const S=a.clone(h),P=a.identity([]);return P[0]=I[0],P[1]=I[1],P[4]=I[2],P[5]=I[3],a.multiply(S,S,P),d||a.rotateZ(S,S,-g.angle),S}}return g.glCoordMatrix}function Rr(h,n,l,d){const g=[h,n,l,1];l?a.transformMat4$1(g,g,d):Pr(g,g,d);const v=g[3];return g[0]/=v,g[1]/=v,g[2]/=v,g}function zl(h,n){return Math.min(.5+h/n*.5,1.5)}function In(h,n){const l=h[0]/h[3],d=h[1]/h[3];return l>=-n[0]&&l<=n[0]&&d>=-n[1]&&d<=n[1]}function Ka(h,n,l,d,g,v,I,S,P,k){const N=l.transform,V=d?h.textSizeData:h.iconSizeData,Y=a.evaluateSizeForZoom(V,l.transform.zoom),tt=N.projection.name==="globe",nt=[256/l.width*2+1,256/l.height*2+1],it=d?h.text.dynamicLayoutVertexArray:h.icon.dynamicLayoutVertexArray;it.clear();let st=null;tt&&(st=d?h.text.globeExtVertexArray:h.icon.globeExtVertexArray);const j=h.lineVertexArray,Q=d?h.text.placedSymbolArray:h.icon.placedSymbolArray,ct=l.transform.width/l.transform.height;let pt,It=!1;for(let Ct=0;Ct<Q.length;Ct++){const St=Q.get(Ct),{numGlyphs:Bt,writingMode:Nt}=St;if(Nt!==a.WritingMode.vertical||It||pt===a.WritingMode.horizontal||(It=!0),pt=Nt,(St.hidden||Nt===a.WritingMode.vertical)&&!It){jo(Bt,it);continue}It=!1;const Zt=new a.Point(St.tileAnchorX,St.tileAnchorY);let{x:ye,y:Vt,z:le}=N.projection.projectTilePoint(Zt.x,Zt.y,k.canonical);if(P){const[mr,$e,nr]=P(Zt);ye+=mr,Vt+=$e,le+=nr}const Qt=[ye,Vt,le,1];if(a.transformMat4$1(Qt,Qt,n),!In(Qt,nt)){jo(Bt,it);continue}const _e=zl(l.transform.cameraToCenterDistance,Qt[3]),Xt=a.evaluateSizeForFeature(V,Y,St),se=I?Xt/_e:Xt*_e,be=Rr(ye,Vt,le,g);if(be[3]<=0){jo(Bt,it);continue}let fe={};const Ee=I?null:P,Qe=ke(St,se,!1,S,n,g,v,h.glyphOffsetArray,j,it,st,be,Zt,fe,ct,Ee,N.projection,k,I);It=Qe.useVertical,Ee&&Qe.needsFlipping&&(fe={}),(Qe.notEnoughRoom||It||Qe.needsFlipping&&ke(St,se,!0,S,n,g,v,h.glyphOffsetArray,j,it,st,be,Zt,fe,ct,Ee,N.projection,k,I).notEnoughRoom)&&jo(Bt,it)}d?(h.text.dynamicLayoutVertexBuffer.updateData(it),st&&h.text.globeExtVertexBuffer.updateData(st)):(h.icon.dynamicLayoutVertexBuffer.updateData(it),st&&h.icon.globeExtVertexBuffer.updateData(st))}function kl(h,n,l,d,g,v,I,S,P,k,N,V,Y,tt,nt,it){const{lineStartIndex:st,glyphStartIndex:j,segment:Q}=S,ct=j+S.numGlyphs,pt=st+S.lineLength,It=n.getoffsetX(j),Ct=n.getoffsetX(ct-1),St=lr(h*It,l,d,g,v,I,Q,st,pt,P,k,N,V,Y,!0,tt,nt,it);if(!St)return null;const Bt=lr(h*Ct,l,d,g,v,I,Q,st,pt,P,k,N,V,Y,!0,tt,nt,it);return Bt?{first:St,last:Bt}:null}function Or(h,n,l,d){return h===a.WritingMode.horizontal&&Math.abs(d)>Math.abs(l)?{useVertical:!0}:h===a.WritingMode.vertical?d>0?{needsFlipping:!0}:null:n!==un.unknown&&function(g,v){return g===0||Math.abs(v/g)>Ks}(l,d)?n===un.flipRequired?{needsFlipping:!0}:null:l<0?{needsFlipping:!0}:null}function ke(h,n,l,d,g,v,I,S,P,k,N,V,Y,tt,nt,it,st,j,Q){const ct=n/24,pt=h.lineOffsetX*ct,It=h.lineOffsetY*ct,{lineStartIndex:Ct,glyphStartIndex:St,numGlyphs:Bt,segment:Nt,writingMode:Zt,flipState:ye}=h,Vt=Ct+h.lineLength,le=Qt=>{if(N){const[be,fe,Ee]=Qt.up,Qe=k.length;a.updateGlobeVertexNormal(N,Qe+0,be,fe,Ee),a.updateGlobeVertexNormal(N,Qe+1,be,fe,Ee),a.updateGlobeVertexNormal(N,Qe+2,be,fe,Ee),a.updateGlobeVertexNormal(N,Qe+3,be,fe,Ee)}const[_e,Xt,se]=Qt.point;a.addDynamicAttributes(k,_e,Xt,se,Qt.angle)};if(Bt>1){const Qt=kl(ct,S,pt,It,l,V,Y,h,P,v,tt,it,!1,st,j,Q);if(!Qt)return{notEnoughRoom:!0};if(d&&!l){let[_e,Xt,se]=Qt.first.point,[be,fe,Ee]=Qt.last.point;[_e,Xt]=Rr(_e,Xt,se,I),[be,fe]=Rr(be,fe,Ee,I);const Qe=Or(Zt,ye,(be-_e)*nt,fe-Xt);if(h.flipState=Qe&&Qe.needsFlipping?un.flipRequired:un.flipNotRequired,Qe)return Qe}le(Qt.first);for(let _e=St+1;_e<St+Bt-1;_e++){const Xt=lr(ct*S.getoffsetX(_e),pt,It,l,V,Y,Nt,Ct,Vt,P,v,tt,it,!1,!1,st,j,Q);if(!Xt)return k.length-=4*(_e-St),{notEnoughRoom:!0};le(Xt)}le(Qt.last)}else{if(d&&!l){const _e=Rr(Y.x,Y.y,0,g),Xt=Ct+Nt+1,se=new a.Point(P.getx(Xt),P.gety(Xt)),be=Rr(se.x,se.y,0,g),fe=be[3]>0?be:Ir(Y,se,_e,1,g,void 0,st,j.canonical),Ee=Or(Zt,ye,(fe[0]-_e[0])*nt,fe[1]-_e[1]);if(h.flipState=Ee&&Ee.needsFlipping?un.flipRequired:un.flipNotRequired,Ee)return Ee}const Qt=lr(ct*S.getoffsetX(St),pt,It,l,V,Y,Nt,Ct,Vt,P,v,tt,it,!1,!1,st,j,Q);if(!Qt)return{notEnoughRoom:!0};le(Qt)}return{}}function hr(h,n,l,d,g){const{x:v,y:I,z:S}=d.projectTilePoint(h.x,h.y,n);if(!g)return Rr(v,I,S,l);const[P,k,N]=g(h);return Rr(v+P,I+k,S+N,l)}function Ir(h,n,l,d,g,v,I,S){const P=hr(h.sub(n)._unit()._add(h),S,g,I,v);return a.sub(P,l,P),a.normalize(P,P),a.scaleAndAdd(P,l,P,d)}function lr(h,n,l,d,g,v,I,S,P,k,N,V,Y,tt,nt,it,st,j){const Q=d?h-n:h+n;let ct=Q>0?1:-1,pt=0;d&&(ct*=-1,pt=Math.PI),ct<0&&(pt+=Math.PI);let It=S+I+(ct>0?0:1)|0,Ct=g,St=g,Bt=0,Nt=0;const Zt=Math.abs(Q),ye=[],Vt=[];let le=v,Qt=le;const _e=()=>Ir(Qt,le,St,Zt-Bt+1,N,Y,it,st.canonical);for(;Bt+Nt<=Zt;){if(It+=ct,It<S||It>=P)return null;if(St=Ct,Qt=le,ye.push(St),tt&&Vt.push(Qt),le=new a.Point(k.getx(It),k.gety(It)),Ct=V[It],!Ct){const nr=hr(le,st.canonical,N,it,Y);Ct=nr[3]>0?V[It]=nr:_e()}Bt+=Nt,Nt=a.distance(St,Ct)}nt&&Y&&(V[It]&&(Ct=_e(),Nt=a.distance(St,Ct)),V[It]=Ct);const Xt=(Zt-Bt)/Nt,se=le.sub(Qt)._mult(Xt)._add(Qt),be=a.sub([],Ct,St),fe=a.scaleAndAdd([],St,be,Xt);let Ee=[0,0,1],Qe=be[0],mr=be[1];if(j&&(Ee=it.upVector(st.canonical,se.x,se.y),Ee[0]!==0||Ee[1]!==0||Ee[2]!==1)){const nr=[Ee[2],0,-Ee[0]],Gr=a.cross([],Ee,nr);a.normalize(nr,nr),a.normalize(Gr,Gr),Qe=a.dot(be,nr),mr=a.dot(be,Gr)}if(l){const nr=a.cross([],Ee,be);a.normalize(nr,nr),a.scaleAndAdd(fe,fe,nr,l*ct)}const $e=pt+Math.atan2(mr,Qe);return ye.push(fe),tt&&Vt.push(se),{point:fe,angle:$e,path:ye,tilePath:Vt,up:Ee}}function jo(h,n){const l=n.length,d=l+4*h;n.resize(d),n.float32.fill(-1/0,4*l,4*d)}function Pr(h,n,l){const d=n[0],g=n[1];return h[0]=l[0]*d+l[4]*g+l[12],h[1]=l[1]*d+l[5]*g+l[13],h[3]=l[3]*d+l[7]*g+l[15],h}const Qn=100;class to{constructor(n,l,d=new Zn(n.width+200,n.height+200,25),g=new Zn(n.width+200,n.height+200,25)){this.transform=n,this.grid=d,this.ignoredGrid=g,this.pitchfactor=Math.cos(n._pitch)*n.cameraToCenterDistance,this.screenRightBoundary=n.width+Qn,this.screenBottomBoundary=n.height+Qn,this.gridRightBoundary=n.width+200,this.gridBottomBoundary=n.height+200,this.fogState=l}placeCollisionBox(n,l,d,g,v,I,S,P){let k=d.projectedAnchorX,N=d.projectedAnchorY,V=d.projectedAnchorZ;const Y=d.elevation,tt=d.tileID,nt=n.getProjection();if(Y&&tt){const[Ct,St,Bt]=nt.upVector(tt.canonical,d.tileAnchorX,d.tileAnchorY),Nt=nt.upVectorScale(tt.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;k+=Ct*Y*Nt,N+=St*Y*Nt,V+=Bt*Y*Nt}const it=this.projectAndGetPerspectiveRatio(S,k,N,V,d.tileID,nt.name==="globe"||!!Y||this.transform.pitch>0,nt),st=I*it.perspectiveRatio,j=(d.x1*l+g.x-d.padding)*st+it.point.x,Q=(d.y1*l+g.y-d.padding)*st+it.point.y,ct=(d.x2*l+g.x+d.padding)*st+it.point.x,pt=(d.y2*l+g.y+d.padding)*st+it.point.y,It=it.perspectiveRatio<=.55||it.occluded;return!this.isInsideGrid(j,Q,ct,pt)||!v&&this.grid.hitTest(j,Q,ct,pt,P)||It?{box:[],offscreen:!1,occluded:it.occluded}:{box:[j,Q,ct,pt],offscreen:this.isOffscreen(j,Q,ct,pt),occluded:!1}}placeCollisionCircles(n,l,d,g,v,I,S,P,k,N,V,Y,tt,nt,it){const st=[],j=this.transform.elevation,Q=n.getProjection(),ct=j?j.getAtTileOffsetFunc(it,this.transform.center.lat,this.transform.worldSize,Q):null,pt=new a.Point(d.tileAnchorX,d.tileAnchorY);let{x:It,y:Ct,z:St}=Q.projectTilePoint(pt.x,pt.y,it.canonical);if(ct){const[se,be,fe]=ct(pt);It+=se,Ct+=be,St+=fe}const Bt=Q.name==="globe",Nt=this.projectAndGetPerspectiveRatio(S,It,Ct,St,it,Bt||!!j||this.transform.pitch>0,Q),{perspectiveRatio:Zt}=Nt,ye=(V?I/Zt:I*Zt)/a.ONE_EM,Vt=Rr(It,Ct,St,P),le=Nt.signedDistanceFromCamera>0?kl(ye,v,d.lineOffsetX*ye,d.lineOffsetY*ye,!1,Vt,pt,d,g,P,{},j&&!V?ct:null,V&&!!j,Q,it,V):null;let Qt=!1,_e=!1,Xt=!0;if(le&&!Nt.occluded){const se=.5*tt*Zt+nt,be=new a.Point(-100,-100),fe=new a.Point(this.screenRightBoundary,this.screenBottomBoundary),Ee=new Po,{first:Qe,last:mr}=le,$e=Qe.path.length;let nr=[];for(let Je=$e-1;Je>=1;Je--)nr.push(Qe.path[Je]);for(let Je=1;Je<mr.path.length;Je++)nr.push(mr.path[Je]);const Gr=2.5*se;k&&(nr=nr.map(([Je,hi,Ei],Ti)=>(ct&&!Bt&&(Ei=ct(Ti<$e-1?Qe.tilePath[$e-1-Ti]:mr.tilePath[Ti-$e+2])[2]),Rr(Je,hi,Ei,k))),nr.some(Je=>Je[3]<=0)&&(nr=[]));let kr=[];if(nr.length>0){let Je=1/0,hi=-1/0,Ei=1/0,Ti=-1/0;for(const Ii of nr)Je=Math.min(Je,Ii[0]),Ei=Math.min(Ei,Ii[1]),hi=Math.max(hi,Ii[0]),Ti=Math.max(Ti,Ii[1]);hi>=be.x&&Je<=fe.x&&Ti>=be.y&&Ei<=fe.y&&(kr=[nr.map(Ii=>new a.Point(Ii[0],Ii[1]))],(Je<be.x||hi>fe.x||Ei<be.y||Ti>fe.y)&&(kr=a.clipLine(kr,be.x,be.y,fe.x,fe.y)))}for(const Je of kr){Ee.reset(Je,.25*se);let hi=0;hi=Ee.length<=.5*se?1:Math.ceil(Ee.paddedLength/Gr)+1;for(let Ei=0;Ei<hi;Ei++){const Ti=Ei/Math.max(hi-1,1),Ii=Ee.lerp(Ti),Co=Ii.x+Qn,so=Ii.y+Qn;st.push(Co,so,se,0);const Ls=Co-se,la=so-se,en=Co+se,Si=so+se;if(Xt=Xt&&this.isOffscreen(Ls,la,en,Si),_e=_e||this.isInsideGrid(Ls,la,en,Si),!l&&this.grid.hitTestCircle(Co,so,se,Y)&&(Qt=!0,!N))return{circles:[],offscreen:!1,collisionDetected:Qt,occluded:!1}}}}return{circles:!N&&Qt||!_e?[]:st,offscreen:Xt,collisionDetected:Qt,occluded:Nt.occluded}}queryRenderedSymbols(n){if(n.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const l=[];let d=1/0,g=1/0,v=-1/0,I=-1/0;for(const N of n){const V=new a.Point(N.x+Qn,N.y+Qn);d=Math.min(d,V.x),g=Math.min(g,V.y),v=Math.max(v,V.x),I=Math.max(I,V.y),l.push(V)}const S=this.grid.query(d,g,v,I).concat(this.ignoredGrid.query(d,g,v,I)),P={},k={};for(const N of S){const V=N.key;if(P[V.bucketInstanceId]===void 0&&(P[V.bucketInstanceId]={}),P[V.bucketInstanceId][V.featureIndex])continue;const Y=[new a.Point(N.x1,N.y1),new a.Point(N.x2,N.y1),new a.Point(N.x2,N.y2),new a.Point(N.x1,N.y2)];a.polygonIntersectsPolygon(l,Y)&&(P[V.bucketInstanceId][V.featureIndex]=!0,k[V.bucketInstanceId]===void 0&&(k[V.bucketInstanceId]=[]),k[V.bucketInstanceId].push(V.featureIndex))}return k}insertCollisionBox(n,l,d,g,v){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:d,featureIndex:g,collisionGroupID:v},n[0],n[1],n[2],n[3])}insertCollisionCircles(n,l,d,g,v){const I=l?this.ignoredGrid:this.grid,S={bucketInstanceId:d,featureIndex:g,collisionGroupID:v};for(let P=0;P<n.length;P+=4)I.insertCircle(S,n[P],n[P+1],n[P+2])}projectAndGetPerspectiveRatio(n,l,d,g,v,I,S){const P=[l,d,g,1];let k=!1;g||this.transform.pitch>0?(a.transformMat4$1(P,P,n),this.fogState&&v&&S.name!=="globe"&&(k=function(Y,tt,nt,it,st,j){const Q=j.calculateFogTileMatrix(st),ct=[tt,nt,it];return a.transformMat4(ct,ct,Q),Ne(Y,ct,j.pitch,j._fov)}(this.fogState,l,d,g,v.toUnwrapped(),this.transform)>.9)):Pr(P,P,n);const N=P[3];return{point:new a.Point((P[0]/N+1)/2*this.transform.width+Qn,(-P[1]/N+1)/2*this.transform.height+Qn),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(S)/N*.5,1.5),signedDistanceFromCamera:N,occluded:I&&P[2]>N||k}}isOffscreen(n,l,d,g){return d<Qn||n>=this.screenRightBoundary||g<Qn||l>this.screenBottomBoundary}isInsideGrid(n,l,d,g){return d>=0&&n<this.gridRightBoundary&&g>=0&&l<this.gridBottomBoundary}getViewportMatrix(){const n=a.identity([]);return a.translate(n,n,[-100,-100,0]),n}}function eo(h,n,l){const d=n.createTileMatrix(h,h.worldSize,l.toUnwrapped());return a.multiply(new Float32Array(16),h.projMatrix,d)}function bo(h,n,l){if(n.projection.name===l.projection.name)return h.projMatrix;const d=l.clone();return d.setProjection(n.projection),eo(d,n.getProjection(),h)}function Oi(h,n,l){return n.name===l.projection.name?h.projMatrix:eo(l,n,h)}class Ae{constructor(n,l,d,g){this.opacity=n?Math.max(0,Math.min(1,n.opacity+(n.placed?l:-l))):g&&d?1:0,this.placed=d}isHidden(){return this.opacity===0&&!this.placed}}class qo{constructor(n,l,d,g,v,I=!1){this.text=new Ae(n?n.text:null,l,d,v),this.icon=new Ae(n?n.icon:null,l,g,v),this.clipped=I}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ro{constructor(n,l,d,g=!1){this.text=n,this.icon=l,this.skipFade=d,this.clipped=g}}class wo{constructor(){this.invProjMatrix=a.create(),this.viewportMatrix=a.create(),this.circles=[]}}class Da{constructor(n,l,d,g,v){this.bucketInstanceId=n,this.featureIndex=l,this.sourceLayerIndex=d,this.bucketIndex=g,this.tileID=v}}class Dn{constructor(n){this.crossSourceCollisions=n,this.maxGroupID=0,this.collisionGroups={}}get(n){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[n]){const l=++this.maxGroupID;this.collisionGroups[n]={ID:l,predicate:d=>d.collisionGroupID===l}}return this.collisionGroups[n]}}function Jr(h,n,l,d,g){const{horizontalAlign:v,verticalAlign:I}=a.getAnchorAlignment(h),S=-(v-.5)*n,P=-(I-.5)*l,k=a.evaluateVariableOffset(h,d);return new a.Point(S+k[0]*g,P+k[1]*g)}function qr(h,n,l,d,g){const v=new a.Point(h,n);return l&&v._rotate(d?g:-g),v}class Ni{constructor(n,l,d,g,v){this.transform=n.clone(),this.projection=n.projection.name,this.collisionIndex=new to(this.transform,v),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=l,this.retainedQueryData={},this.collisionGroups=new Dn(d),this.collisionCircleArrays={},this.prevPlacement=g,g&&(g.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(n,l,d,g){const v=d.getBucket(l),I=d.latestFeatureIndex;if(!v||!I||l.id!==v.layerIds[0])return;const S=v.layers[0].layout,P=d.collisionBoxArray,k=Math.pow(2,this.transform.zoom-d.tileID.overscaledZ),N=d.tileSize/a.EXTENT,V=d.tileID.toUnwrapped();this.transform.setProjection(v.projection);const Y=(tt=d.tileID,nt=v.getProjection(),it=this.transform,nt.name===this.projection?it.calculateProjMatrix(tt.toUnwrapped()):eo(it,nt,tt));var tt,nt,it;const st=S.get("text-pitch-alignment")==="map",j=S.get("text-rotation-alignment")==="map";l.compileFilter();const Q=l.dynamicFilter(),ct=l.dynamicFilterNeedsFeature(),pt=this.transform.calculatePixelsToTileUnitsMatrix(d),It=Lo(Y,d.tileID.canonical,st,j,this.transform,v.getProjection(),pt);let Ct=null;if(st){const Nt=Xi(Y,d.tileID.canonical,st,j,this.transform,v.getProjection(),pt);Ct=a.multiply([],this.transform.labelPlaneMatrix,Nt)}let St=null;Q&&d.latestFeatureIndex&&(St={unwrappedTileID:V,dynamicFilter:Q,dynamicFilterNeedsFeature:ct,featureIndex:d.latestFeatureIndex}),this.retainedQueryData[v.bucketInstanceId]=new Da(v.bucketInstanceId,I,v.sourceLayerIndex,v.index,d.tileID);const Bt={bucket:v,layout:S,posMatrix:Y,textLabelPlaneMatrix:It,labelToScreenMatrix:Ct,clippingData:St,scale:k,textPixelRatio:N,holdingForFade:d.holdingForFade(),collisionBoxArray:P,partiallyEvaluatedTextSize:a.evaluateSizeForZoom(v.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:a.evaluateSizeForZoom(v.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(v.sourceID)};if(g)for(const Nt of v.sortKeyRanges){const{sortKey:Zt,symbolInstanceStart:ye,symbolInstanceEnd:Vt}=Nt;n.push({sortKey:Zt,symbolInstanceStart:ye,symbolInstanceEnd:Vt,parameters:Bt})}else n.push({symbolInstanceStart:0,symbolInstanceEnd:v.symbolInstances.length,parameters:Bt})}attemptAnchorPlacement(n,l,d,g,v,I,S,P,k,N,V,Y,tt,nt,it,st,j,Q){const{textOffset0:ct,textOffset1:pt,crossTileID:It}=Y,Ct=[ct,pt],St=Jr(n,d,g,Ct,v),Bt=this.collisionIndex.placeCollisionBox(nt,v,l,qr(St.x,St.y,I,S,this.transform.angle),V,P,k,N.predicate);if(st){const Nt=nt.getSymbolInstanceIconSize(Q,this.transform.zoom,Y.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(nt,Nt,st,qr(St.x,St.y,I,S,this.transform.angle),V,P,k,N.predicate).box.length===0)return}if(Bt.box.length>0){let Nt;return this.prevPlacement&&this.prevPlacement.variableOffsets[It]&&this.prevPlacement.placements[It]&&this.prevPlacement.placements[It].text&&(Nt=this.prevPlacement.variableOffsets[It].anchor),this.variableOffsets[It]={textOffset:Ct,width:d,height:g,anchor:n,textScale:v,prevAnchor:Nt},this.markUsedJustification(nt,n,Y,it),nt.allowVerticalPlacement&&(this.markUsedOrientation(nt,it,Y),this.placedOrientations[It]=it),{shift:St,placedGlyphBoxes:Bt}}}placeLayerBucketPart(n,l,d,g){const{bucket:v,layout:I,posMatrix:S,textLabelPlaneMatrix:P,labelToScreenMatrix:k,clippingData:N,textPixelRatio:V,holdingForFade:Y,collisionBoxArray:tt,partiallyEvaluatedTextSize:nt,partiallyEvaluatedIconSize:it,collisionGroup:st}=n.parameters,j=I.get("text-optional"),Q=I.get("icon-optional"),ct=I.get("text-allow-overlap"),pt=I.get("icon-allow-overlap"),It=I.get("text-rotation-alignment")==="map",Ct=I.get("text-pitch-alignment")==="map",St=I.get("icon-text-fit")!=="none",Bt=I.get("symbol-z-order")==="viewport-y";this.transform.setProjection(v.projection);let Nt=ct&&(pt||!v.hasIconData()||Q),Zt=pt&&(ct||!v.hasTextData()||j);!v.collisionArrays&&tt&&v.deserializeCollisionBoxes(tt),d&&g&&v.updateCollisionDebugBuffers(this.transform.zoom,tt);const ye=(Vt,le,Qt)=>{const{crossTileID:_e,numVerticalGlyphVertices:Xt}=Vt;if(N){const en={zoom:this.transform.zoom,pitch:this.transform.pitch};let Si=null;if(N.dynamicFilterNeedsFeature){const ei=this.retainedQueryData[v.bucketInstanceId];Si=N.featureIndex.loadFeature({featureIndex:Vt.featureIndex,bucketIndex:ei.bucketIndex,sourceLayerIndex:ei.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,N.dynamicFilter)(en,Si,this.retainedQueryData[v.bucketInstanceId].tileID.canonical,new a.Point(Vt.tileAnchorX,Vt.tileAnchorY),this.transform.calculateDistanceTileData(N.unwrappedTileID)))return this.placements[_e]=new ro(!1,!1,!1,!0),void l.add(_e)}if(l.has(_e))return;if(Y)return void(this.placements[_e]=new ro(!1,!1,!1));let se=!1,be=!1,fe=!0,Ee=!1,Qe=!1,mr=null,$e={box:null,offscreen:null,occluded:null},nr={box:null,offscreen:null,occluded:null},Gr=null,kr=null,Je=null,hi=0,Ei=0,Ti=0;Qt.textFeatureIndex?hi=Qt.textFeatureIndex:Vt.useRuntimeCollisionCircles&&(hi=Vt.featureIndex),Qt.verticalTextFeatureIndex&&(Ei=Qt.verticalTextFeatureIndex);const Ii=en=>{en.tileID=this.retainedQueryData[v.bucketInstanceId].tileID;const Si=this.transform.elevation;(Si||en.elevation)&&(en.elevation=Si?Si.getAtTileOffset(en.tileID,en.tileAnchorX,en.tileAnchorY):0)},Co=Qt.textBox;if(Co){Ii(Co);const en=ei=>{let On=a.WritingMode.horizontal;if(v.allowVerticalPlacement&&!ei&&this.prevPlacement){const Go=this.prevPlacement.placedOrientations[_e];Go&&(this.placedOrientations[_e]=Go,On=Go,this.markUsedOrientation(v,On,Vt))}return On},Si=(ei,On)=>{if(v.allowVerticalPlacement&&Xt>0&&Qt.verticalTextBox){for(const Go of v.writingModes)if(Go===a.WritingMode.vertical?($e=On(),nr=$e):$e=ei(),$e&&$e.box&&$e.box.length)break}else $e=ei()};if(I.get("text-variable-anchor")){let ei=I.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[_e]){const Ki=this.prevPlacement.variableOffsets[_e];ei.indexOf(Ki.anchor)>0&&(ei=ei.filter(ns=>ns!==Ki.anchor),ei.unshift(Ki.anchor))}const On=(Ki,ns,lu)=>{const sl=v.getSymbolInstanceTextSize(nt,Vt,this.transform.zoom,le),Gl=(Ki.x2-Ki.x1)*sl+2*Ki.padding,wa=(Ki.y2-Ki.y1)*sl+2*Ki.padding,Va=St&&!pt?ns:null;Va&&Ii(Va);let al={box:[],offscreen:!1,occluded:!1};const uu=ct?2*ei.length:ei.length;for(let jl=0;jl<uu;++jl){const ic=this.attemptAnchorPlacement(ei[jl%ei.length],Ki,Gl,wa,sl,It,Ct,V,S,st,jl>=ei.length,Vt,le,v,lu,Va,nt,it);if(ic&&(al=ic.placedGlyphBoxes,al&&al.box&&al.box.length)){se=!0,mr=ic.shift;break}}return al};Si(()=>On(Co,Qt.iconBox,a.WritingMode.horizontal),()=>{const Ki=Qt.verticalTextBox;return Ki&&Ii(Ki),v.allowVerticalPlacement&&!($e&&$e.box&&$e.box.length)&&Xt>0&&Ki?On(Ki,Qt.verticalIconBox,a.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),$e&&(se=$e.box,fe=$e.offscreen,Ee=$e.occluded);const Go=en(!(!$e||!$e.box));if(!se&&this.prevPlacement){const Ki=this.prevPlacement.variableOffsets[_e];Ki&&(this.variableOffsets[_e]=Ki,this.markUsedJustification(v,Ki.anchor,Vt,Go))}}else{const ei=(On,Go)=>{const Ki=v.getSymbolInstanceTextSize(nt,Vt,this.transform.zoom,le),ns=this.collisionIndex.placeCollisionBox(v,Ki,On,new a.Point(0,0),ct,V,S,st.predicate);return ns&&ns.box&&ns.box.length&&(this.markUsedOrientation(v,Go,Vt),this.placedOrientations[_e]=Go),ns};Si(()=>ei(Co,a.WritingMode.horizontal),()=>{const On=Qt.verticalTextBox;return v.allowVerticalPlacement&&Xt>0&&On?(Ii(On),ei(On,a.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),en(!!($e&&$e.box&&$e.box.length))}}if(Gr=$e,se=Gr&&Gr.box&&Gr.box.length>0,fe=Gr&&Gr.offscreen,Ee=Gr&&Gr.occluded,Vt.useRuntimeCollisionCircles){const en=v.text.placedSymbolArray.get(Vt.centerJustifiedTextSymbolIndex>=0?Vt.centerJustifiedTextSymbolIndex:Vt.verticalPlacedTextSymbolIndex),Si=a.evaluateSizeForFeature(v.textSizeData,nt,en),ei=I.get("text-padding");kr=this.collisionIndex.placeCollisionCircles(v,ct,en,v.lineVertexArray,v.glyphOffsetArray,Si,S,P,k,d,Ct,st.predicate,Vt.collisionCircleDiameter*Si/a.ONE_EM,ei,this.retainedQueryData[v.bucketInstanceId].tileID),se=ct||kr.circles.length>0&&!kr.collisionDetected,fe=fe&&kr.offscreen,Ee=kr.occluded}if(Qt.iconFeatureIndex&&(Ti=Qt.iconFeatureIndex),Qt.iconBox){const en=Si=>{Ii(Si);const ei=St&&mr?qr(mr.x,mr.y,It,Ct,this.transform.angle):new a.Point(0,0),On=v.getSymbolInstanceIconSize(it,this.transform.zoom,Vt.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(v,On,Si,ei,pt,V,S,st.predicate)};nr&&nr.box&&nr.box.length&&Qt.verticalIconBox?(Je=en(Qt.verticalIconBox),be=Je.box.length>0):(Je=en(Qt.iconBox),be=Je.box.length>0),fe=fe&&Je.offscreen,Qe=Je.occluded}const so=j||Vt.numHorizontalGlyphVertices===0&&Xt===0,Ls=Q||Vt.numIconVertices===0;if(so||Ls?Ls?so||(be=be&&se):se=be&&se:be=se=be&&se,se&&Gr&&Gr.box&&this.collisionIndex.insertCollisionBox(Gr.box,I.get("text-ignore-placement"),v.bucketInstanceId,nr&&nr.box&&Ei?Ei:hi,st.ID),be&&Je&&this.collisionIndex.insertCollisionBox(Je.box,I.get("icon-ignore-placement"),v.bucketInstanceId,Ti,st.ID),kr&&(se&&this.collisionIndex.insertCollisionCircles(kr.circles,I.get("text-ignore-placement"),v.bucketInstanceId,hi,st.ID),d)){const en=v.bucketInstanceId;let Si=this.collisionCircleArrays[en];Si===void 0&&(Si=this.collisionCircleArrays[en]=new wo);for(let ei=0;ei<kr.circles.length;ei+=4)Si.circles.push(kr.circles[ei+0]),Si.circles.push(kr.circles[ei+1]),Si.circles.push(kr.circles[ei+2]),Si.circles.push(kr.collisionDetected?1:0)}const la=v.projection.name!=="globe";Nt=Nt&&(la||!Ee),Zt=Zt&&(la||!Qe),this.placements[_e]=new ro(se||Nt,be||Zt,fe||v.justReloaded),l.add(_e)};if(Bt){const Vt=v.getSortedSymbolIndexes(this.transform.angle);for(let le=Vt.length-1;le>=0;--le){const Qt=Vt[le];ye(v.symbolInstances.get(Qt),Qt,v.collisionArrays[Qt])}}else for(let Vt=n.symbolInstanceStart;Vt<n.symbolInstanceEnd;Vt++)ye(v.symbolInstances.get(Vt),Vt,v.collisionArrays[Vt]);if(d&&v.bucketInstanceId in this.collisionCircleArrays){const Vt=this.collisionCircleArrays[v.bucketInstanceId];a.invert(Vt.invProjMatrix,S),Vt.viewportMatrix=this.collisionIndex.getViewportMatrix()}v.justReloaded=!1}markUsedJustification(n,l,d,g){const{leftJustifiedTextSymbolIndex:v,centerJustifiedTextSymbolIndex:I,rightJustifiedTextSymbolIndex:S,verticalPlacedTextSymbolIndex:P,crossTileID:k}=d,N=a.getAnchorJustification(l),V=g===a.WritingMode.vertical?P:N==="left"?v:N==="center"?I:N==="right"?S:-1;v>=0&&(n.text.placedSymbolArray.get(v).crossTileID=V>=0&&v!==V?0:k),I>=0&&(n.text.placedSymbolArray.get(I).crossTileID=V>=0&&I!==V?0:k),S>=0&&(n.text.placedSymbolArray.get(S).crossTileID=V>=0&&S!==V?0:k),P>=0&&(n.text.placedSymbolArray.get(P).crossTileID=V>=0&&P!==V?0:k)}markUsedOrientation(n,l,d){const g=l===a.WritingMode.horizontal||l===a.WritingMode.horizontalOnly?l:0,v=l===a.WritingMode.vertical?l:0,{leftJustifiedTextSymbolIndex:I,centerJustifiedTextSymbolIndex:S,rightJustifiedTextSymbolIndex:P,verticalPlacedTextSymbolIndex:k}=d,N=n.text.placedSymbolArray;I>=0&&(N.get(I).placedOrientation=g),S>=0&&(N.get(S).placedOrientation=g),P>=0&&(N.get(P).placedOrientation=g),k>=0&&(N.get(k).placedOrientation=v)}commit(n){this.commitTime=n,this.zoomAtLastRecencyCheck=this.transform.zoom;const l=this.prevPlacement;let d=!1;this.prevZoomAdjustment=l?l.zoomAdjustment(this.transform.zoom):0;const g=l?l.symbolFadeChange(n):1,v=l?l.opacities:{},I=l?l.variableOffsets:{},S=l?l.placedOrientations:{};for(const P in this.placements){const k=this.placements[P],N=v[P];N?(this.opacities[P]=new qo(N,g,k.text,k.icon,null,k.clipped),d=d||k.text!==N.text.placed||k.icon!==N.icon.placed):(this.opacities[P]=new qo(null,g,k.text,k.icon,k.skipFade,k.clipped),d=d||k.text||k.icon)}for(const P in v){const k=v[P];if(!this.opacities[P]){const N=new qo(k,g,!1,!1);N.isHidden()||(this.opacities[P]=N,d=d||k.text.placed||k.icon.placed)}}for(const P in I)this.variableOffsets[P]||!this.opacities[P]||this.opacities[P].isHidden()||(this.variableOffsets[P]=I[P]);for(const P in S)this.placedOrientations[P]||!this.opacities[P]||this.opacities[P].isHidden()||(this.placedOrientations[P]=S[P]);d?this.lastPlacementChangeTime=n:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=l?l.lastPlacementChangeTime:n)}updateLayerOpacities(n,l){const d=new Set;for(const g of l){const v=g.getBucket(n);v&&g.latestFeatureIndex&&n.id===v.layerIds[0]&&this.updateBucketOpacities(v,d,g.collisionBoxArray)}}updateBucketOpacities(n,l,d){n.hasTextData()&&n.text.opacityVertexArray.clear(),n.hasIconData()&&n.icon.opacityVertexArray.clear(),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexArray.clear(),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexArray.clear();const g=n.layers[0].layout,v=!!n.layers[0].dynamicFilter(),I=new qo(null,0,!1,!1,!0),S=g.get("text-allow-overlap"),P=g.get("icon-allow-overlap"),k=g.get("text-variable-anchor"),N=g.get("text-rotation-alignment")==="map",V=g.get("text-pitch-alignment")==="map",Y=g.get("icon-text-fit")!=="none",tt=new qo(null,0,S&&(P||!n.hasIconData()||g.get("icon-optional")),P&&(S||!n.hasTextData()||g.get("text-optional")),!0);!n.collisionArrays&&d&&(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData())&&n.deserializeCollisionBoxes(d);const nt=(st,j,Q)=>{for(let ct=0;ct<j/4;ct++)st.opacityVertexArray.emplaceBack(Q)};let it=0;for(let st=0;st<n.symbolInstances.length;st++){const j=n.symbolInstances.get(st),{numHorizontalGlyphVertices:Q,numVerticalGlyphVertices:ct,crossTileID:pt,numIconVertices:It}=j,Ct=l.has(pt);let St=this.opacities[pt];Ct?St=I:St||(St=tt,this.opacities[pt]=St),l.add(pt);const Bt=Q>0||ct>0,Nt=It>0,Zt=this.placedOrientations[pt],ye=Zt===a.WritingMode.vertical,Vt=Zt===a.WritingMode.horizontal||Zt===a.WritingMode.horizontalOnly;if(!Bt&&!Nt||St.isHidden()||it++,Bt){const le=da(St.text);nt(n.text,Q,ye?xi:le),nt(n.text,ct,Vt?xi:le);const Qt=St.text.isHidden(),{leftJustifiedTextSymbolIndex:_e,centerJustifiedTextSymbolIndex:Xt,rightJustifiedTextSymbolIndex:se,verticalPlacedTextSymbolIndex:be}=j,fe=n.text.placedSymbolArray,Ee=Qt||ye?1:0;_e>=0&&(fe.get(_e).hidden=Ee),Xt>=0&&(fe.get(Xt).hidden=Ee),se>=0&&(fe.get(se).hidden=Ee),be>=0&&(fe.get(be).hidden=Qt||Vt?1:0);const Qe=this.variableOffsets[pt];Qe&&this.markUsedJustification(n,Qe.anchor,j,Zt);const mr=this.placedOrientations[pt];mr&&(this.markUsedJustification(n,"left",j,mr),this.markUsedOrientation(n,mr,j))}if(Nt){const le=da(St.icon),{placedIconSymbolIndex:Qt,verticalPlacedIconSymbolIndex:_e}=j,Xt=n.icon.placedSymbolArray,se=St.icon.isHidden()?1:0;Qt>=0&&(nt(n.icon,It,ye?xi:le),Xt.get(Qt).hidden=se),_e>=0&&(nt(n.icon,j.numVerticalIconVertices,Vt?xi:le),Xt.get(_e).hidden=se)}if(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData()){const le=n.collisionArrays[st];if(le){let Qt=new a.Point(0,0),_e=!0;if(le.textBox||le.verticalTextBox){if(k){const se=this.variableOffsets[pt];se?(Qt=Jr(se.anchor,se.width,se.height,se.textOffset,se.textScale),N&&Qt._rotate(V?this.transform.angle:-this.transform.angle)):_e=!1}v&&(_e=!St.clipped),le.textBox&&Ra(n.textCollisionBox.collisionVertexArray,St.text.placed,!_e||ye,Qt.x,Qt.y),le.verticalTextBox&&Ra(n.textCollisionBox.collisionVertexArray,St.text.placed,!_e||Vt,Qt.x,Qt.y)}const Xt=_e&&!!(!Vt&&le.verticalIconBox);le.iconBox&&Ra(n.iconCollisionBox.collisionVertexArray,St.icon.placed,Xt,Y?Qt.x:0,Y?Qt.y:0),le.verticalIconBox&&Ra(n.iconCollisionBox.collisionVertexArray,St.icon.placed,!Xt,Y?Qt.x:0,Y?Qt.y:0)}}}if(n.fullyClipped=it===0,n.sortFeatures(this.transform.angle),this.retainedQueryData[n.bucketInstanceId]&&(this.retainedQueryData[n.bucketInstanceId].featureSortOrder=n.featureSortOrder),n.hasTextData()&&n.text.opacityVertexBuffer&&n.text.opacityVertexBuffer.updateData(n.text.opacityVertexArray),n.hasIconData()&&n.icon.opacityVertexBuffer&&n.icon.opacityVertexBuffer.updateData(n.icon.opacityVertexArray),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexBuffer&&n.iconCollisionBox.collisionVertexBuffer.updateData(n.iconCollisionBox.collisionVertexArray),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexBuffer&&n.textCollisionBox.collisionVertexBuffer.updateData(n.textCollisionBox.collisionVertexArray),n.bucketInstanceId in this.collisionCircleArrays){const st=this.collisionCircleArrays[n.bucketInstanceId];n.placementInvProjMatrix=st.invProjMatrix,n.placementViewportMatrix=st.viewportMatrix,n.collisionCircleArray=st.circles,delete this.collisionCircleArrays[n.bucketInstanceId]}}symbolFadeChange(n){return this.fadeDuration===0?1:(n-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(n){return Math.max(0,(this.transform.zoom-n)/1.5)}hasTransitions(n){return this.stale||n-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(n,l){const d=this.zoomAtLastRecencyCheck===l?1-this.zoomAdjustment(l):1;return this.zoomAtLastRecencyCheck=l,this.commitTime+this.fadeDuration*d>n}setStale(){this.stale=!0}}function Ra(h,n,l,d,g){h.emplaceBack(n?1:0,l?1:0,d||0,g||0),h.emplaceBack(n?1:0,l?1:0,d||0,g||0),h.emplaceBack(n?1:0,l?1:0,d||0,g||0),h.emplaceBack(n?1:0,l?1:0,d||0,g||0)}const Eo=Math.pow(2,25),Yr=Math.pow(2,24),Oa=Math.pow(2,17),To=Math.pow(2,16),br=Math.pow(2,9),io=Math.pow(2,8),Sn=Math.pow(2,1);function da(h){if(h.opacity===0&&!h.placed)return 0;if(h.opacity===1&&h.placed)return 4294967295;const n=h.placed?1:0,l=Math.floor(127*h.opacity);return l*Eo+n*Yr+l*Oa+n*To+l*br+n*io+l*Sn+n}const xi=0;class li{constructor(n){this._sortAcrossTiles=n.layout.get("symbol-z-order")!=="viewport-y"&&n.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(n,l,d,g,v){const I=this._bucketParts;for(;this._currentTileIndex<n.length;)if(l.getBucketParts(I,g,n[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,v())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,I.sort((S,P)=>S.sortKey-P.sortKey));this._currentPartIndex<I.length;){const S=I[this._currentPartIndex];if(l.placeLayerBucketPart(S,this._seenCrossTileIDs,d,S.symbolInstanceStart===0),this._currentPartIndex++,v())return!0}return!1}}class jn{constructor(n,l,d,g,v,I,S,P){this.placement=new Ni(n,v,I,S,P),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=d,this._showCollisionBoxes=g,this._done=!1}isDone(){return this._done}continuePlacement(n,l,d){const g=a.exported.now(),v=()=>{const I=a.exported.now()-g;return!this._forceFullPlacement&&I>2};for(;this._currentPlacementIndex>=0;){const I=l[n[this._currentPlacementIndex]],S=this.placement.collisionIndex.transform.zoom;if(I.type==="symbol"&&(!I.minzoom||I.minzoom<=S)&&(!I.maxzoom||I.maxzoom>S)){if(this._inProgressLayer||(this._inProgressLayer=new li(I)),this._inProgressLayer.continuePlacement(d[I.source],this.placement,this._showCollisionBoxes,I,v))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(n){return this.placement.commit(n),this.placement}}const $o=512/a.EXTENT/2;class mi{constructor(n,l,d){this.tileID=n,this.bucketInstanceId=d,this.index=new a.KDBush(l.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const g=n.canonical.x*a.EXTENT,v=n.canonical.y*a.EXTENT;for(let I=0;I<l.length;I++){const{key:S,crossTileID:P,tileAnchorX:k,tileAnchorY:N}=l.get(I),V=Math.floor((g+k)*$o),Y=Math.floor((v+N)*$o);this.index.add(V,Y),this.keys.push(S),this.crossTileIDs.push(P)}this.index.finish()}findMatches(n,l,d){const g=this.tileID.canonical.z<l.canonical.z?1:Math.pow(2,this.tileID.canonical.z-l.canonical.z),v=$o/Math.pow(2,l.canonical.z-this.tileID.canonical.z),I=l.canonical.x*a.EXTENT,S=l.canonical.y*a.EXTENT;for(let P=0;P<n.length;P++){const k=n.get(P);if(k.crossTileID)continue;const{key:N,tileAnchorX:V,tileAnchorY:Y}=k,tt=Math.floor((I+V)*v),nt=Math.floor((S+Y)*v),it=this.index.range(tt-g,nt-g,tt+g,nt+g);for(const st of it){const j=this.crossTileIDs[st];if(this.keys[st]===N&&!d.has(j)){d.add(j),k.crossTileID=j;break}}}}}class Xo{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class ps{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(n){const l=Math.round((n-this.lng)/360);if(l!==0)for(const d in this.indexes){const g=this.indexes[d],v={};for(const I in g){const S=g[I];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+l),v[S.tileID.key]=S}this.indexes[d]=v}this.lng=n}addBucket(n,l,d){if(this.indexes[n.overscaledZ]&&this.indexes[n.overscaledZ][n.key]){if(this.indexes[n.overscaledZ][n.key].bucketInstanceId===l.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(n.overscaledZ,this.indexes[n.overscaledZ][n.key])}for(let v=0;v<l.symbolInstances.length;v++)l.symbolInstances.get(v).crossTileID=0;this.usedCrossTileIDs[n.overscaledZ]||(this.usedCrossTileIDs[n.overscaledZ]=new Set);const g=this.usedCrossTileIDs[n.overscaledZ];for(const v in this.indexes){const I=this.indexes[v];if(Number(v)>n.overscaledZ)for(const S in I){const P=I[S];P.tileID.isChildOf(n)&&P.findMatches(l.symbolInstances,n,g)}else{const S=I[n.scaledTo(Number(v)).key];S&&S.findMatches(l.symbolInstances,n,g)}}for(let v=0;v<l.symbolInstances.length;v++){const I=l.symbolInstances.get(v);I.crossTileID||(I.crossTileID=d.generate(),g.add(I.crossTileID))}return this.indexes[n.overscaledZ]===void 0&&(this.indexes[n.overscaledZ]={}),this.indexes[n.overscaledZ][n.key]=new mi(n,l.symbolInstances,l.bucketInstanceId),!0}removeBucketCrossTileIDs(n,l){for(const d of l.crossTileIDs)this.usedCrossTileIDs[n].delete(d)}removeStaleBuckets(n){let l=!1;for(const d in this.indexes){const g=this.indexes[d];for(const v in g)n[g[v].bucketInstanceId]||(this.removeBucketCrossTileIDs(d,g[v]),delete g[v],l=!0)}return l}}class ho{constructor(){this.layerIndexes={},this.crossTileIDs=new Xo,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(n,l,d,g){let v=this.layerIndexes[n.id];v===void 0&&(v=this.layerIndexes[n.id]=new ps);let I=!1;const S={};g.name!=="globe"&&v.handleWrapJump(d);for(const P of l){const k=P.getBucket(n);k&&n.id===k.layerIds[0]&&(k.bucketInstanceId||(k.bucketInstanceId=++this.maxBucketInstanceId),v.addBucket(P.tileID,k,this.crossTileIDs)&&(I=!0),S[k.bucketInstanceId]=!0)}return v.removeStaleBuckets(S)&&(I=!0),I}pruneUnusedLayers(n){const l={};n.forEach(d=>{l[d]=!0});for(const d in this.layerIndexes)l[d]||delete this.layerIndexes[d]}}const di=(h,n)=>a.emitValidationErrors(h,n&&n.filter(l=>l.identifier!=="source.canvas")),Ja=a.pick(Wr,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),Do=a.pick(Wr,["setCenter","setZoom","setBearing","setPitch"]),ji={version:8,layers:[],sources:{}},qi={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Ro extends a.Evented{constructor(n,l={}){super(),this.map=n,this.dispatcher=new Pe(Pn(),this),this.imageManager=new ue,this.imageManager.setEventedParent(this),this.glyphManager=new a.GlyphManager(n._requestManager,l.localFontFamily?a.LocalGlyphMode.all:l.localIdeographFontFamily?a.LocalGlyphMode.ideographs:a.LocalGlyphMode.none,l.localFontFamily||l.localIdeographFontFamily),this.crossTileSymbolIndex=new ho,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",a.getReferrer());const d=this;this._rtlTextPluginCallback=Ro.registerForPluginStateChange(g=>{d.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:g.pluginStatus,pluginURL:g.pluginURL},(v,I)=>{if(a.triggerPluginCompletionEvent(v),I&&I.every(S=>S))for(const S in d._sourceCaches){const P=d._sourceCaches[S],k=P.getSource().type;k!=="vector"&&k!=="geojson"||P.reload()}})}),this.on("data",g=>{if(g.dataType!=="source"||g.sourceDataType!=="metadata")return;const v=this.getSource(g.sourceId);if(v&&v.vectorLayerIds)for(const I in this._layers){const S=this._layers[I];S.source===v.id&&this._validateLayer(S)}})}loadURL(n,l={}){this.fire(new a.Event("dataloading",{dataType:"style"}));const d=typeof l.validate=="boolean"?l.validate:!a.isMapboxURL(n);n=this.map._requestManager.normalizeStyleURL(n,l.accessToken);const g=this.map._requestManager.transformRequest(n,a.ResourceType.Style);this._request=a.getJSON(g,(v,I)=>{this._request=null,v?this.fire(new a.ErrorEvent(v)):I&&this._load(I,d)})}loadJSON(n,l={}){this.fire(new a.Event("dataloading",{dataType:"style"})),this._request=a.exported.frame(()=>{this._request=null,this._load(n,l.validate!==!1)})}loadEmpty(){this.fire(new a.Event("dataloading",{dataType:"style"})),this._load(ji,!1)}_updateLayerCount(n,l){const d=l?1:-1;n.is3D()&&(this._num3DLayers+=d),n.type==="circle"&&(this._numCircleLayers+=d),n.type==="symbol"&&(this._numSymbolLayers+=d)}_load(n,l){if(l&&di(this,a.validateStyle(n)))return;this._loaded=!0,this.stylesheet=a.clone$1(n),this._updateMapProjection();for(const g in n.sources)this.addSource(g,n.sources[g],{validate:!1});this._changed=!1,n.sprite?this._loadSprite(n.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(n.glyphs);const d=co(this.stylesheet.layers);this._order=d.map(g=>g.id),this._layers={},this._serializedLayers={};for(const g of d){const v=a.createStyleLayer(g);v.setEventedParent(this,{layer:{id:v.id}}),this._layers[v.id]=v,this._serializedLayers[v.id]=v.serialize(),this._updateLayerCount(v,!0)}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new ae(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new a.Event("data",{dataType:"style"})),this.fire(new a.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}setProjection(n){n?this.stylesheet.projection=n:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(n){this._spriteRequest=function(l,d,g){let v,I,S;const P=a.exported.devicePixelRatio>1?"@2x":"";let k=a.getJSON(d.transformRequest(d.normalizeSpriteURL(l,P,".json"),a.ResourceType.SpriteJSON),(Y,tt)=>{k=null,S||(S=Y,v=tt,V())}),N=a.getImage(d.transformRequest(d.normalizeSpriteURL(l,P,".png"),a.ResourceType.SpriteImage),(Y,tt)=>{N=null,S||(S=Y,I=tt,V())});function V(){if(S)g(S);else if(v&&I){const Y=a.exported.getImageData(I),tt={};for(const nt in v){const{width:it,height:st,x:j,y:Q,sdf:ct,pixelRatio:pt,stretchX:It,stretchY:Ct,content:St}=v[nt],Bt=new a.RGBAImage({width:it,height:st});a.RGBAImage.copy(Y,Bt,{x:j,y:Q},{x:0,y:0},{width:it,height:st}),tt[nt]={data:Bt,pixelRatio:pt,sdf:ct,stretchX:It,stretchY:Ct,content:St}}g(null,tt)}}return{cancel(){k&&(k.cancel(),k=null),N&&(N.cancel(),N=null)}}}(n,this.map._requestManager,(l,d)=>{if(this._spriteRequest=null,l)this.fire(new a.ErrorEvent(l));else if(d)for(const g in d)this.imageManager.addImage(g,d[g]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new a.Event("data",{dataType:"style"}))})}_validateLayer(n){const l=this.getSource(n.source);if(!l)return;const d=n.sourceLayer;d&&(l.type==="geojson"||l.vectorLayerIds&&l.vectorLayerIds.indexOf(d)===-1)&&this.fire(new a.ErrorEvent(new Error(`Source layer "${d}" does not exist on source "${l.id}" as specified by style layer "${n.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const n in this._sourceCaches)if(!this._sourceCaches[n].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(n){const l=[];for(const d of n){const g=this._layers[d];g.type!=="custom"&&l.push(g.serialize())}return l}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const n in this._sourceCaches)if(this._sourceCaches[n].hasTransition())return!0;for(const n in this._layers)if(this._layers[n].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(n){return!!this.terrain&&(typeof n.isLayerDraped=="function"?n.isLayerDraped():qi[n.type])}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(n){if(!this._loaded)return;const l=this._changed;if(this._changed){const g=Object.keys(this._updatedLayers),v=Object.keys(this._removedLayers);(g.length||v.length)&&this._updateWorkerLayers(g,v);for(const I in this._updatedSources){const S=this._updatedSources[I];S==="reload"?this._reloadSource(I):S==="clear"&&this._clearSource(I)}this._updateTilesForChangedImages();for(const I in this._updatedPaintProps)this._layers[I].updateTransitions(n);this.light.updateTransitions(n),this.fog&&this.fog.updateTransitions(n),this._resetUpdates()}const d={};for(const g in this._sourceCaches){const v=this._sourceCaches[g];d[g]=v.used,v.used=!1}for(const g of this._order){const v=this._layers[g];if(v.recalculate(n,this._availableImages),!v.isHidden(n.zoom)){const S=this._getLayerSourceCache(v);S&&(S.used=!0)}const I=this.map.painter;if(I){const S=v.getProgramIds();if(!S)continue;const P=v.getProgramConfiguration(n.zoom);for(const k of S)I.useProgram(k,P)}}for(const g in d){const v=this._sourceCaches[g];d[g]!==v.used&&v.getSource().fire(new a.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:v.getSource().id}))}this.light.recalculate(n),this.terrain&&this.terrain.recalculate(n),this.fog&&this.fog.recalculate(n),this.z=n.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),l&&this.fire(new a.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const n=Object.keys(this._changedImages);if(n.length){for(const l in this._sourceCaches)this._sourceCaches[l].reloadTilesForDependencies(["icons","patterns"],n);this._changedImages={}}}_updateWorkerLayers(n,l){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(n),removedIds:l})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(n){if(this._checkLoaded(),di(this,a.validateStyle(n)))return!1;(n=a.clone$1(n)).layers=co(n.layers);const l=function(g,v){if(!g)return[{command:Wr.setStyle,args:[v]}];let I=[];try{if(!G(g.version,v.version))return[{command:Wr.setStyle,args:[v]}];G(g.center,v.center)||I.push({command:Wr.setCenter,args:[v.center]}),G(g.zoom,v.zoom)||I.push({command:Wr.setZoom,args:[v.zoom]}),G(g.bearing,v.bearing)||I.push({command:Wr.setBearing,args:[v.bearing]}),G(g.pitch,v.pitch)||I.push({command:Wr.setPitch,args:[v.pitch]}),G(g.sprite,v.sprite)||I.push({command:Wr.setSprite,args:[v.sprite]}),G(g.glyphs,v.glyphs)||I.push({command:Wr.setGlyphs,args:[v.glyphs]}),G(g.transition,v.transition)||I.push({command:Wr.setTransition,args:[v.transition]}),G(g.light,v.light)||I.push({command:Wr.setLight,args:[v.light]}),G(g.fog,v.fog)||I.push({command:Wr.setFog,args:[v.fog]}),G(g.projection,v.projection)||I.push({command:Wr.setProjection,args:[v.projection]});const S={},P=[];(function(V,Y,tt,nt){let it;for(it in Y=Y||{},V=V||{})V.hasOwnProperty(it)&&(Y.hasOwnProperty(it)||fi(it,tt,nt));for(it in Y){if(!Y.hasOwnProperty(it))continue;const st=Y[it];V.hasOwnProperty(it)?G(V[it],st)||(V[it].type==="geojson"&&st.type==="geojson"&&Ln(V,Y,it)?tt.push({command:Wr.setGeoJSONSourceData,args:[it,st.data]}):fa(it,Y,tt,nt)):Ri(it,Y,tt)}})(g.sources,v.sources,P,S);const k=[];g.layers&&g.layers.forEach(V=>{V.source&&S[V.source]?I.push({command:Wr.removeLayer,args:[V.id]}):k.push(V)});let N=g.terrain;N&&S[N.source]&&(I.push({command:Wr.setTerrain,args:[void 0]}),N=void 0),I=I.concat(P),G(N,v.terrain)||I.push({command:Wr.setTerrain,args:[v.terrain]}),function(V,Y,tt){Y=Y||[];const nt=(V=V||[]).map(ai),it=Y.map(ai),st=V.reduce(Hs,{}),j=Y.reduce(Hs,{}),Q=nt.slice(),ct=Object.create(null);let pt,It,Ct,St,Bt,Nt,Zt;for(pt=0,It=0;pt<nt.length;pt++)Ct=nt[pt],j.hasOwnProperty(Ct)?It++:(tt.push({command:Wr.removeLayer,args:[Ct]}),Q.splice(Q.indexOf(Ct,It),1));for(pt=0,It=0;pt<it.length;pt++)Ct=it[it.length-1-pt],Q[Q.length-1-pt]!==Ct&&(st.hasOwnProperty(Ct)?(tt.push({command:Wr.removeLayer,args:[Ct]}),Q.splice(Q.lastIndexOf(Ct,Q.length-It),1)):It++,Nt=Q[Q.length-pt],tt.push({command:Wr.addLayer,args:[j[Ct],Nt]}),Q.splice(Q.length-pt,0,Ct),ct[Ct]=!0);for(pt=0;pt<it.length;pt++)if(Ct=it[pt],St=st[Ct],Bt=j[Ct],!ct[Ct]&&!G(St,Bt))if(G(St.source,Bt.source)&&G(St["source-layer"],Bt["source-layer"])&&G(St.type,Bt.type)){for(Zt in Gn(St.layout,Bt.layout,tt,Ct,null,Wr.setLayoutProperty),Gn(St.paint,Bt.paint,tt,Ct,null,Wr.setPaintProperty),G(St.filter,Bt.filter)||tt.push({command:Wr.setFilter,args:[Ct,Bt.filter]}),G(St.minzoom,Bt.minzoom)&&G(St.maxzoom,Bt.maxzoom)||tt.push({command:Wr.setLayerZoomRange,args:[Ct,Bt.minzoom,Bt.maxzoom]}),St)St.hasOwnProperty(Zt)&&Zt!=="layout"&&Zt!=="paint"&&Zt!=="filter"&&Zt!=="metadata"&&Zt!=="minzoom"&&Zt!=="maxzoom"&&(Zt.indexOf("paint.")===0?Gn(St[Zt],Bt[Zt],tt,Ct,Zt.slice(6),Wr.setPaintProperty):G(St[Zt],Bt[Zt])||tt.push({command:Wr.setLayerProperty,args:[Ct,Zt,Bt[Zt]]}));for(Zt in Bt)Bt.hasOwnProperty(Zt)&&!St.hasOwnProperty(Zt)&&Zt!=="layout"&&Zt!=="paint"&&Zt!=="filter"&&Zt!=="metadata"&&Zt!=="minzoom"&&Zt!=="maxzoom"&&(Zt.indexOf("paint.")===0?Gn(St[Zt],Bt[Zt],tt,Ct,Zt.slice(6),Wr.setPaintProperty):G(St[Zt],Bt[Zt])||tt.push({command:Wr.setLayerProperty,args:[Ct,Zt,Bt[Zt]]}))}else tt.push({command:Wr.removeLayer,args:[Ct]}),Nt=Q[Q.lastIndexOf(Ct)+1],tt.push({command:Wr.addLayer,args:[Bt,Nt]})}(k,v.layers,I)}catch(S){console.warn("Unable to compute style diff:",S),I=[{command:Wr.setStyle,args:[v]}]}return I}(this.serialize(),n).filter(g=>!(g.command in Do));if(l.length===0)return!1;const d=l.filter(g=>!(g.command in Ja));if(d.length>0)throw new Error(`Unimplemented: ${d.map(g=>g.command).join(", ")}.`);return l.forEach(g=>{g.command!=="setTransition"&&g.command!=="setProjection"&&this[g.command].apply(this,g.args)}),this.stylesheet=n,this._updateMapProjection(),!0}addImage(n,l){return this.getImage(n)?this.fire(new a.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(n,l),this._afterImageUpdated(n),this)}updateImage(n,l){this.imageManager.updateImage(n,l)}getImage(n){return this.imageManager.getImage(n)}removeImage(n){return this.getImage(n)?(this.imageManager.removeImage(n),this._afterImageUpdated(n),this):this.fire(new a.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(n){this._availableImages=this.imageManager.listImages(),this._changedImages[n]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new a.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(n,l,d={}){if(this._checkLoaded(),this.getSource(n)!==void 0)throw new Error("There is already a source with this ID");if(!l.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(l).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(l.type)>=0&&this._validate(a.validateSource,`sources.${n}`,l,null,d))return;this.map&&this.map._collectResourceTiming&&(l.collectResourceTiming=!0);const g=_r(n,l,this.dispatcher,this);g.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(n),source:g.serialize(),sourceId:n}));const v=I=>{const S=(I?"symbol:":"other:")+n,P=this._sourceCaches[S]=new a.SourceCache(S,g,I);(I?this._symbolSourceCaches:this._otherSourceCaches)[n]=P,P.style=this,P.onAdd(this.map)};v(!1),l.type!=="vector"&&l.type!=="geojson"||v(!0),g.onAdd&&g.onAdd(this.map),this._changed=!0}removeSource(n){this._checkLoaded();const l=this.getSource(n);if(!l)throw new Error("There is no source with this ID");for(const g in this._layers)if(this._layers[g].source===n)return this.fire(new a.ErrorEvent(new Error(`Source "${n}" cannot be removed while layer "${g}" is using it.`)));if(this.terrain&&this.terrain.get().source===n)return this.fire(new a.ErrorEvent(new Error(`Source "${n}" cannot be removed while terrain is using it.`)));const d=this._getSourceCaches(n);for(const g of d)delete this._sourceCaches[g.id],delete this._updatedSources[g.id],g.fire(new a.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:g.getSource().id})),g.setEventedParent(null),g.clearTiles();return delete this._otherSourceCaches[n],delete this._symbolSourceCaches[n],l.setEventedParent(null),l.onRemove&&l.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(n,l){this._checkLoaded(),this.getSource(n).setData(l),this._changed=!0}getSource(n){const l=this._getSourceCache(n);return l&&l.getSource()}_getSources(){const n=[];for(const l in this._otherSourceCaches){const d=this._getSourceCache(l);d&&n.push(d.getSource())}return n}addLayer(n,l,d={}){this._checkLoaded();const g=n.id;if(this.getLayer(g))return void this.fire(new a.ErrorEvent(new Error(`Layer with id "${g}" already exists on this map`)));let v;if(n.type==="custom"){if(di(this,a.validateCustomStyleLayer(n)))return;v=a.createStyleLayer(n)}else{if(typeof n.source=="object"&&(this.addSource(g,n.source),n=a.clone$1(n),n=a.extend(n,{source:g})),this._validate(a.validateLayer,`layers.${g}`,n,{arrayIndex:-1},d))return;v=a.createStyleLayer(n),this._validateLayer(v),v.setEventedParent(this,{layer:{id:g}}),this._serializedLayers[v.id]=v.serialize(),this._updateLayerCount(v,!0)}const I=l?this._order.indexOf(l):this._order.length;if(l&&I===-1)return void this.fire(new a.ErrorEvent(new Error(`Layer with id "${l}" does not exist on this map.`)));this._order.splice(I,0,g),this._layerOrderChanged=!0,this._layers[g]=v;const S=this._getLayerSourceCache(v);if(this._removedLayers[g]&&v.source&&S&&v.type!=="custom"){const P=this._removedLayers[g];delete this._removedLayers[g],P.type!==v.type?this._updatedSources[v.source]="clear":(this._updatedSources[v.source]="reload",S.pause())}this._updateLayer(v),v.onAdd&&v.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(n,l){if(this._checkLoaded(),this._changed=!0,!this._layers[n])return void this.fire(new a.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be moved.`)));if(n===l)return;const d=this._order.indexOf(n);this._order.splice(d,1);const g=l?this._order.indexOf(l):this._order.length;l&&g===-1?this.fire(new a.ErrorEvent(new Error(`Layer with id "${l}" does not exist on this map.`))):(this._order.splice(g,0,n),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(n){this._checkLoaded();const l=this._layers[n];if(!l)return void this.fire(new a.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be removed.`)));l.setEventedParent(null),this._updateLayerCount(l,!1);const d=this._order.indexOf(n);this._order.splice(d,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[n]=l,delete this._layers[n],delete this._serializedLayers[n],delete this._updatedLayers[n],delete this._updatedPaintProps[n],l.onRemove&&l.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(n){return this._layers[n]}hasLayer(n){return n in this._layers}hasLayerType(n){for(const l in this._layers)if(this._layers[l].type===n)return!0;return!1}setLayerZoomRange(n,l,d){this._checkLoaded();const g=this.getLayer(n);g?g.minzoom===l&&g.maxzoom===d||(l!=null&&(g.minzoom=l),d!=null&&(g.maxzoom=d),this._updateLayer(g)):this.fire(new a.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(n,l,d={}){this._checkLoaded();const g=this.getLayer(n);if(g){if(!G(g.filter,l))return l==null?(g.filter=void 0,void this._updateLayer(g)):void(this._validate(a.validateFilter,`layers.${g.id}.filter`,l,{layerType:g.type},d)||(g.filter=a.clone$1(l),this._updateLayer(g)))}else this.fire(new a.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be filtered.`)))}getFilter(n){const l=this.getLayer(n);return l&&a.clone$1(l.filter)}setLayoutProperty(n,l,d,g={}){this._checkLoaded();const v=this.getLayer(n);v?G(v.getLayoutProperty(l),d)||(v.setLayoutProperty(l,d,g),this._updateLayer(v)):this.fire(new a.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(n,l){const d=this.getLayer(n);if(d)return d.getLayoutProperty(l);this.fire(new a.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style.`)))}setPaintProperty(n,l,d,g={}){this._checkLoaded();const v=this.getLayer(n);v?G(v.getPaintProperty(l),d)||(v.setPaintProperty(l,d,g)&&this._updateLayer(v),this._changed=!0,this._updatedPaintProps[n]=!0):this.fire(new a.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(n,l){const d=this.getLayer(n);return d&&d.getPaintProperty(l)}setFeatureState(n,l){this._checkLoaded();const d=n.source,g=n.sourceLayer,v=this.getSource(d);if(!v)return void this.fire(new a.ErrorEvent(new Error(`The source '${d}' does not exist in the map's style.`)));const I=v.type;if(I==="geojson"&&g)return void this.fire(new a.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(I==="vector"&&!g)return void this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));n.id===void 0&&this.fire(new a.ErrorEvent(new Error("The feature id parameter must be provided.")));const S=this._getSourceCaches(d);for(const P of S)P.setFeatureState(g,n.id,l)}removeFeatureState(n,l){this._checkLoaded();const d=n.source,g=this.getSource(d);if(!g)return void this.fire(new a.ErrorEvent(new Error(`The source '${d}' does not exist in the map's style.`)));const v=g.type,I=v==="vector"?n.sourceLayer:void 0;if(v==="vector"&&!I)return void this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(l&&typeof n.id!="string"&&typeof n.id!="number")return void this.fire(new a.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const S=this._getSourceCaches(d);for(const P of S)P.removeFeatureState(I,n.id,l)}getFeatureState(n){this._checkLoaded();const l=n.source,d=n.sourceLayer,g=this.getSource(l);if(g){if(g.type!=="vector"||d)return n.id===void 0&&this.fire(new a.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(l)[0].getFeatureState(d,n.id);this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new a.ErrorEvent(new Error(`The source '${l}' does not exist in the map's style.`)))}getTransition(){return a.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const n={};for(const l in this._sourceCaches){const d=this._sourceCaches[l].getSource();n[d.id]||(n[d.id]=d.serialize())}return a.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:n,layers:this._serializeLayers(this._order)},l=>l!==void 0)}_updateLayer(n){this._updatedLayers[n.id]=!0;const l=this._getLayerSourceCache(n);n.source&&!this._updatedSources[n.source]&&l&&l.getSource().type!=="raster"&&(this._updatedSources[n.source]="reload",l.pause()),this._changed=!0,n.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(n){const l=I=>this._layers[I].type==="fill-extrusion",d={},g=[];for(let I=this._order.length-1;I>=0;I--){const S=this._order[I];if(l(S)){d[S]=I;for(const P of n){const k=P[S];if(k)for(const N of k)g.push(N)}}}g.sort((I,S)=>S.intersectionZ-I.intersectionZ);const v=[];for(let I=this._order.length-1;I>=0;I--){const S=this._order[I];if(l(S))for(let P=g.length-1;P>=0;P--){const k=g[P].feature;if(d[k.layer.id]<I)break;v.push(k),g.pop()}else for(const P of n){const k=P[S];if(k)for(const N of k)v.push(N.feature)}}return v}queryRenderedFeatures(n,l,d){l&&l.filter&&this._validate(a.validateFilter,"queryRenderedFeatures.filter",l.filter,null,l);const g={};if(l&&l.layers){if(!Array.isArray(l.layers))return this.fire(new a.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const P of l.layers){const k=this._layers[P];if(!k)return this.fire(new a.ErrorEvent(new Error(`The layer '${P}' does not exist in the map's style and cannot be queried for features.`))),[];g[k.source]=!0}}const v=[];l.availableImages=this._availableImages;const I=l&&l.layers?l.layers.some(P=>{const k=this.getLayer(P);return k&&k.is3D()}):this.has3DLayers(),S=Ot.createFromScreenPoints(n,d);for(const P in this._sourceCaches){const k=this._sourceCaches[P].getSource().id;l.layers&&!g[k]||v.push(ni(this._sourceCaches[P],this._layers,this._serializedLayers,S,l,d,I,!!this.map._showQueryGeometry))}return this.placement&&v.push(function(P,k,N,V,Y,tt,nt){const it={},st=tt.queryRenderedSymbols(V),j=[];for(const Q of Object.keys(st).map(Number))j.push(nt[Q]);j.sort(vi);for(const Q of j){const ct=Q.featureIndex.lookupSymbolFeatures(st[Q.bucketInstanceId],k,Q.bucketIndex,Q.sourceLayerIndex,Y.filter,Y.layers,Y.availableImages,P);for(const pt in ct){const It=it[pt]=it[pt]||[],Ct=ct[pt];Ct.sort((St,Bt)=>{const Nt=Q.featureSortOrder;if(Nt){const Zt=Nt.indexOf(St.featureIndex);return Nt.indexOf(Bt.featureIndex)-Zt}return Bt.featureIndex-St.featureIndex});for(const St of Ct)It.push(St)}}for(const Q in it)it[Q].forEach(ct=>{const pt=ct.feature,It=N(P[Q]);if(!It)return;const Ct=It.getFeatureState(pt.layer["source-layer"],pt.id);pt.source=pt.layer.source,pt.layer["source-layer"]&&(pt.sourceLayer=pt.layer["source-layer"]),pt.state=Ct});return it}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),S.screenGeometry,l,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(v)}querySourceFeatures(n,l){l&&l.filter&&this._validate(a.validateFilter,"querySourceFeatures.filter",l.filter,null,l);const d=this._getSourceCaches(n);let g=[];for(const v of d)g=g.concat(sr(v,l));return g}addSourceType(n,l,d){return Ro.getSourceType(n)?d(new Error(`A source type called "${n}" already exists.`)):(Ro.setSourceType(n,l),l.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:n,url:l.workerSourceURL},d):d(null,null))}getLight(){return this.light.getLight()}setLight(n,l={}){this._checkLoaded();const d=this.light.getLight();let g=!1;for(const I in n)if(!G(n[I],d[I])){g=!0;break}if(!g)return;const v=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(n,l),this.light.updateTransitions(v)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(n,l=1){if(this._checkLoaded(),!n)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let d=n;if(l===1){if(typeof d.source=="object"){const g="terrain-dem-src";this.addSource(g,d.source),d=a.clone$1(d),d=a.extend(d,{source:g})}if(this._validate(a.validateTerrain,"terrain",d))return}if(!this.terrain||this.terrain&&l!==this.terrain.drapeRenderMode){if(!d)return;this._createTerrain(d,l)}else{const g=this.terrain,v=g.get();for(const I of Object.keys(a.spec.terrain))!d.hasOwnProperty(I)&&a.spec.terrain[I].default&&(d[I]=a.spec.terrain[I].default);for(const I in d)if(!G(d[I],v[I])){g.set(d),this.stylesheet.terrain=d;const S=this._setTransitionParameters({duration:0});g.updateTransitions(S);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(n){const l=this.fog=new ti(n,this.map.transform);this.stylesheet.fog=n;const d=this._setTransitionParameters({duration:0});l.updateTransitions(d)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const n of this.map._markers)n._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(n){if(this._checkLoaded(),!n)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const l=this.fog,d=l.get();Object.keys(n).length===0&&l.set(n);for(const g in n)if(!G(n[g],d[g])){l.set(n),this.stylesheet.fog=n;const v=this._setTransitionParameters({duration:0});l.updateTransitions(v);break}}else this._createFog(n);this._markersNeedUpdate=!0}_setTransitionParameters(n){return{now:a.exported.now(),transition:a.extend(n,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const n=this._order.filter(d=>this.isLayerDraped(this._layers[d])),l=this._order.filter(d=>!this.isLayerDraped(this._layers[d]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...n),this._drapedFirstOrder.push(...l)}_createTerrain(n,l){const d=this.terrain=new _i(n,l);this.stylesheet.terrain=n,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const g=this._setTransitionParameters({duration:0});d.updateTransitions(g)}_force3DLayerUpdate(){for(const n in this._layers){const l=this._layers[n];l.type==="fill-extrusion"&&this._updateLayer(l)}}_forceSymbolLayerUpdate(){for(const n in this._layers){const l=this._layers[n];l.type==="symbol"&&this._updateLayer(l)}}_validate(n,l,d,g,v={}){return(!v||v.validate!==!1)&&di(this,n.call(a.validateStyle,a.extend({key:l,style:this.serialize(),value:d,styleSpec:a.spec},g)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),a.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const n in this._layers)this._layers[n].setEventedParent(null);for(const n in this._sourceCaches)this._sourceCaches[n].clearTiles(),this._sourceCaches[n].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(n){const l=this._getSourceCaches(n);for(const d of l)d.clearTiles()}_reloadSource(n){const l=this._getSourceCaches(n);for(const d of l)d.resume(),d.reload()}_reloadSources(){for(const n of this._getSources())n.reload&&n.reload()}_updateSources(n){for(const l in this._sourceCaches)this._sourceCaches[l].update(n)}_generateCollisionBoxes(){for(const n in this._sourceCaches){const l=this._sourceCaches[n];l.resume(),l.reload()}}_updatePlacement(n,l,d,g,v=!1){let I=!1,S=!1;const P={};for(const k of this._order){const N=this._layers[k];if(N.type!=="symbol")continue;if(!P[N.source]){const Y=this._getLayerSourceCache(N);if(!Y)continue;P[N.source]=Y.getRenderableIds(!0).map(tt=>Y.getTileByID(tt)).sort((tt,nt)=>nt.tileID.overscaledZ-tt.tileID.overscaledZ||(tt.tileID.isLessThan(nt.tileID)?-1:1))}const V=this.crossTileSymbolIndex.addLayer(N,P[N.source],n.center.lng,n.projection);I=I||V}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),v=v||this._layerOrderChanged||d===0,this._layerOrderChanged&&this.fire(new a.Event("neworder")),(v||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(a.exported.now(),n.zoom))&&(this.pauseablePlacement=new jn(n,this._order,v,l,d,g,this.placement,this.fog&&n.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,P),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(a.exported.now()),S=!0),I&&this.pauseablePlacement.placement.setStale()),S||I)for(const k of this._order){const N=this._layers[k];N.type==="symbol"&&this.placement.updateLayerOpacities(N,P[N.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(a.exported.now())}_releaseSymbolFadeTiles(){for(const n in this._sourceCaches)this._sourceCaches[n].releaseSymbolFadeTiles()}getImages(n,l,d){this.imageManager.getImages(l.icons,d),this._updateTilesForChangedImages();const g=v=>{v&&v.setDependencies(l.tileID.key,l.type,l.icons)};g(this._otherSourceCaches[l.source]),g(this._symbolSourceCaches[l.source])}getGlyphs(n,l,d){this.glyphManager.getGlyphs(l.stacks,d)}getResource(n,l,d){return a.makeRequest(l,d)}_getSourceCache(n){return this._otherSourceCaches[n]}_getLayerSourceCache(n){return n.type==="symbol"?this._symbolSourceCaches[n.source]:this._otherSourceCaches[n.source]}_getSourceCaches(n){const l=[];return this._otherSourceCaches[n]&&l.push(this._otherSourceCaches[n]),this._symbolSourceCaches[n]&&l.push(this._symbolSourceCaches[n]),l}_isSourceCacheLoaded(n){const l=this._getSourceCaches(n);return l.length===0?(this.fire(new a.ErrorEvent(new Error(`There is no source with ID '${n}'`))),!1):l.every(d=>d.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Ro.getSourceType=function(h){return or[h]},Ro.setSourceType=function(h,n){or[h]=n},Ro.registerForPluginStateChange=a.registerForPluginStateChange;var Bl=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#define HALF_PI PI/2.0
#define QUARTER_PI PI/4.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0`,Zo="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",bs=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,Na=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Zi=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`;let Wo={},nn={};const fs=[];ma(Bl,fs),ma(bs,fs),ma(Na,fs),ma(Zi,fs),Wo=Xr("",bs),nn=Xr(Zi,Na);const Yo=Xr(`
#if __VERSION__ >=300
#define varying in
#define gl_FragColor glFragColor
#define texture2D texture
#define textureCube texture
out vec4 glFragColor;
#endif
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}`,`
#if __VERSION__ >=300
#define attribute in
#define varying out
#define texture2D texture
#endif
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),Js=Bl,zi=`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`;var Ke={background:Xr(`uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
varying vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform vec4 u_color;varying vec4 v_color;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(u_color);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Xr(`uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:Xr(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Xr("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Xr(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Xr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Xr("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Xr("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Xr("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:Xr(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:Xr(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Xr(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Xr(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Xr(`varying vec4 v_color;
#ifdef RENDER_SHADOWS
varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
vec3 normal=v_normal;
#endif
float z;vec4 color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);
#else
color=v_color;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;
#endif
#ifdef RENDER_SHADOWS
#ifdef ZERO_ROOF_RADIUS
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#endif
color.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
v_normal=normal;
#endif
base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
v_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(color,NdotL);
#else
v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_color*=u_opacity;
#ifdef ZERO_ROOF_RADIUS
v_roof_color=vec4(0.0,0.0,0.0,1.0);
#ifdef LIGHTING_3D_MODE
v_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));
#else
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:Xr(`uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
varying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,v_NdotL)*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos;varying vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_NdotL=NdotL;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:Xr(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Xr(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
gl_FragColor=apply_lighting(gl_FragColor);
#endif
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Xr(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
uniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture2D(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trimmed=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
#ifdef RENDER_LINE_BORDER
float edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);
#ifdef RENDER_LINE_BORDER_AUTO
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}
#else
out_color.rgb=mix(u_border_color.rgb*u_border_color.a*trimmed,out_color.rgb,smoothAlpha);
#endif
}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
attribute highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:Xr(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
color=apply_lighting(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:Xr(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:Xr(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:Xr(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:Xr(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:Xr(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef RENDER_SHADOWS
color.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
const float wireframeOffset=0.00015;void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=wireframeOffset;
#endif
v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;
#endif
}`),terrainDepth:Xr(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:Xr(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Zo),skyboxGradient:Xr(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Zo),skyboxCapture:Xr(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Xr(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);
#else
color=texture2D(u_image0,v_pos0);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
attribute vec3 a_globe_pos;attribute vec2 a_uv;
#else
attribute vec2 a_pos;
#endif
varying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Xr(`uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:
(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:
uv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}`,`attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`)};function ma(h,n){const l=h.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let d of l)if(d=d.trim(),d[0]==="#"&&d.includes("if")&&!d.includes("endif")){d=d.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const g=d.split(" ");for(const v of g)n.includes(v)||n.push(v)}}function Xr(h,n){const l=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,d=n.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),g={},v=[...fs];return ma(h,v),ma(n,v),{fragmentSource:h=h.replace(l,(I,S,P,k,N)=>(g[N]=!0,S==="define"?`
#ifndef HAS_UNIFORM_u_${N}
varying ${P} ${k} ${N};
#else
uniform ${P} ${k} u_${N};
#endif
`:`
#ifdef HAS_UNIFORM_u_${N}
    ${P} ${k} ${N} = u_${N};
#endif
`)),vertexSource:n=n.replace(l,(I,S,P,k,N)=>{const V=k==="float"?"vec2":"vec4",Y=N.match(/color/)?"color":V;return g[N]?S==="define"?`
#ifndef HAS_UNIFORM_u_${N}
uniform lowp float u_${N}_t;
attribute ${P} ${V} a_${N};
varying ${P} ${k} ${N};
#else
uniform ${P} ${k} u_${N};
#endif
`:Y==="vec4"?`
#ifndef HAS_UNIFORM_u_${N}
    ${N} = a_${N};
#else
    ${P} ${k} ${N} = u_${N};
#endif
`:`
#ifndef HAS_UNIFORM_u_${N}
    ${N} = unpack_mix_${Y}(a_${N}, u_${N}_t);
#else
    ${P} ${k} ${N} = u_${N};
#endif
`:S==="define"?`
#ifndef HAS_UNIFORM_u_${N}
uniform lowp float u_${N}_t;
attribute ${P} ${V} a_${N};
#else
uniform ${P} ${k} u_${N};
#endif
`:Y==="vec4"?`
#ifndef HAS_UNIFORM_u_${N}
    ${P} ${k} ${N} = a_${N};
#else
    ${P} ${k} ${N} = u_${N};
#endif
`:`
#ifndef HAS_UNIFORM_u_${N}
    ${P} ${k} ${N} = unpack_mix_${Y}(a_${N}, u_${N}_t);
#else
    ${P} ${k} ${N} = u_${N};
#endif
`}),staticAttributes:d,usedDefines:v}}class no{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(n,l,d,g,v,I,S){this.context=n;let P=this.boundPaintVertexBuffers.length!==g.length;for(let N=0;!P&&N<g.length;N++)this.boundPaintVertexBuffers[N]!==g[N]&&(P=!0);let k=this.boundDynamicVertexBuffers.length!==S.length;for(let N=0;!k&&N<S.length;N++)this.boundDynamicVertexBuffers[N]!==S[N]&&(k=!0);if(!n.extVertexArrayObject||!this.vao||this.boundProgram!==l||this.boundLayoutVertexBuffer!==d||P||k||this.boundIndexBuffer!==v||this.boundVertexOffset!==I)this.freshBind(l,d,g,v,I,S);else{n.bindVertexArrayOES.set(this.vao);for(const N of S)N&&N.bind();v&&v.dynamicDraw&&v.bind()}}freshBind(n,l,d,g,v,I){let S;const P=n.numAttributes,k=this.context,N=k.gl;if(k.extVertexArrayObject)this.vao&&this.destroy(),this.vao=k.extVertexArrayObject.createVertexArrayOES(),k.bindVertexArrayOES.set(this.vao),S=0,this.boundProgram=n,this.boundLayoutVertexBuffer=l,this.boundPaintVertexBuffers=d,this.boundIndexBuffer=g,this.boundVertexOffset=v,this.boundDynamicVertexBuffers=I;else{S=k.currentNumAttributes||0;for(let V=P;V<S;V++)N.disableVertexAttribArray(V)}l.enableAttributes(N,n),l.bind(),l.setVertexAttribPointers(N,n,v);for(const V of d)V.enableAttributes(N,n),V.bind(),V.setVertexAttribPointers(N,n,v);for(const V of I)V&&(V.enableAttributes(N,n),V.bind(),V.setVertexAttribPointers(N,n,v));g&&g.bind(),k.currentNumAttributes=P}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Io(h,n){const l=Math.pow(2,n.canonical.z),d=n.canonical.y;return[new a.MercatorCoordinate(0,d/l).toLngLat().lat,new a.MercatorCoordinate(0,(d+1)/l).toLngLat().lat]}function zs(h,n,l,d,g,v,I){const S=h.context,P=S.gl,k=l.fbo;if(!k)return;h.prepareDrawTile();const N=h.useProgram("hillshade");S.activeTexture.set(P.TEXTURE0),P.bindTexture(P.TEXTURE_2D,k.colorAttachment.get());const V=((it,st,j,Q)=>{const ct=j.paint.get("hillshade-shadow-color"),pt=j.paint.get("hillshade-highlight-color"),It=j.paint.get("hillshade-accent-color");let Ct=j.paint.get("hillshade-illumination-direction")*(Math.PI/180);j.paint.get("hillshade-illumination-anchor")==="viewport"&&(Ct-=it.transform.angle);const St=!it.options.moving;return{u_matrix:Q||it.transform.calculateProjMatrix(st.tileID.toUnwrapped(),St),u_image:0,u_latrange:Io(0,st.tileID),u_light:[j.paint.get("hillshade-exaggeration"),Ct],u_shadow:ct,u_highlight:pt,u_accent:It}})(h,l,d,h.terrain?n.projMatrix:null);h.prepareDrawProgram(S,N,n.toUnwrapped());const{tileBoundsBuffer:Y,tileBoundsIndexBuffer:tt,tileBoundsSegments:nt}=h.getTileBoundsBuffers(l);N.draw(S,P.TRIANGLES,g,v,I,a.CullFaceMode.disabled,V,d.id,Y,tt,nt)}function ga(h,n,l){if(!n.needsDEMTextureUpload)return;const d=h.context,g=d.gl;d.pixelStoreUnpackPremultiplyAlpha.set(!1),n.demTexture=n.demTexture||h.getTileTexture(l.stride);const v=l.getPixels();n.demTexture?n.demTexture.update(v,{premultiply:!1}):n.demTexture=new a.Texture(d,v,g.RGBA,{premultiply:!1}),n.needsDEMTextureUpload=!1}function gl(h,n,l,d,g,v){const I=h.context,S=I.gl;if(!n.dem)return;const P=n.dem;if(I.activeTexture.set(S.TEXTURE1),ga(h,n,P),!n.demTexture)return;n.demTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE);const k=P.dim;I.activeTexture.set(S.TEXTURE0);let N=n.fbo;if(!N){const nt=new a.Texture(I,{width:k,height:k,data:null},S.RGBA);nt.bind(S.LINEAR,S.CLAMP_TO_EDGE),N=n.fbo=I.createFramebuffer(k,k,!0),N.colorAttachment.set(nt.texture)}I.bindFramebuffer.set(N.framebuffer),I.viewport.set([0,0,k,k]);const{tileBoundsBuffer:V,tileBoundsIndexBuffer:Y,tileBoundsSegments:tt}=h.getMercatorTileBoundsBuffers();h.useProgram("hillshadePrepare").draw(I,S.TRIANGLES,d,g,v,a.CullFaceMode.disabled,((nt,it)=>{const st=it.stride,j=a.create();return a.ortho(j,0,a.EXTENT,-a.EXTENT,0,0,1),a.translate(j,j,[0,-a.EXTENT,0]),{u_matrix:j,u_image:1,u_dimension:[st,st],u_zoom:nt.overscaledZ,u_unpack:it.unpackVector}})(n.tileID,P),l.id,V,Y,tt),n.needsHillshadePrepare=!1}const _l=h=>({u_matrix:new a.UniformMatrix4f(h),u_image0:new a.Uniform1i(h),u_skirt_height:new a.Uniform1f(h)}),Nr=(h,n)=>({u_matrix:h,u_image0:0,u_skirt_height:n}),Oo=(h,n,l,d,g,v,I,S,P,k,N,V,Y,tt,nt)=>({u_proj_matrix:Float32Array.from(h),u_globe_matrix:n,u_normalize_matrix:Float32Array.from(d),u_merc_matrix:l,u_zoom_transition:g,u_merc_center:v,u_image0:0,u_frustum_tl:I,u_frustum_tr:S,u_frustum_br:P,u_frustum_bl:k,u_globe_pos:N,u_globe_radius:V,u_viewport:Y,u_grid_matrix:nt?Float32Array.from(nt):new Float32Array(9),u_skirt_height:tt});function ui(h,n){return h!=null&&n!=null&&!(!h.hasData()||!n.hasData())&&h.demTexture!=null&&n.demTexture!=null&&h.tileID.key!==n.tileID.key}const No=new class{constructor(){this.operations={}}newMorphing(h,n,l,d,g){if(h in this.operations){const v=this.operations[h];v.to.tileID.key!==l.tileID.key&&(v.queued=l)}else this.operations[h]={startTime:d,phase:0,duration:g,from:n,to:l,queued:null}}getMorphValuesForProxy(h){if(!(h in this.operations))return null;const n=this.operations[h];return{from:n.from,to:n.to,phase:n.phase}}update(h){for(const n in this.operations){const l=this.operations[n];for(l.phase=(h-l.startTime)/l.duration;l.phase>=1||!this._validOp(l);)if(!this._nextOp(l,h)){delete this.operations[n];break}}}_nextOp(h,n){return!!h.queued&&(h.from=h.to,h.to=h.queued,h.queued=null,h.phase=0,h.startTime=n,!0)}_validOp(h){return h.from.hasData()&&h.to.hasData()}},dn={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function Qa(h){return 6*Math.pow(1.5,22-h)}function zr(h,n){const l=1<<h.z;return!n&&(h.x===0||h.x===l-1)||h.y===0||h.y===l-1}const ds=h=>({u_matrix:h});function ci(h,n,l,d,g){if(g>0){const v=a.exported.now(),I=(v-h.timeAdded)/g,S=n?(v-n.timeAdded)/g:-1,P=l.getSource(),k=d.coveringZoomLevel({tileSize:P.tileSize,roundZoom:P.roundZoom}),N=!n||Math.abs(n.tileID.overscaledZ-k)>Math.abs(h.tileID.overscaledZ-k),V=N&&h.refreshedUponExpiration?1:a.clamp(N?I:1-S,0,1);return h.refreshedUponExpiration&&I>=1&&(h.refreshedUponExpiration=!1),n?{opacity:1,mix:1-V}:{opacity:V,mix:0}}return{opacity:1,mix:0}}class _a extends a.SourceCache{constructor(n){const l={type:"raster-dem",maxzoom:n.transform.maxZoom},d=new Pe(Pn(),null),g=_r("mock-dem",l,d,n.style);super("mock-dem",g,!1),g.setEventedParent(this),this._sourceLoaded=!0}_loadTile(n,l){n.state="loaded",l(null)}}class Cn extends a.SourceCache{constructor(n){const l=_r("proxy",{type:"geojson",maxzoom:n.transform.maxZoom},new Pe(Pn(),null),n.style);super("proxy",l,!1),l.setEventedParent(this),this.map=this.getSource().map=n,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(n,l,d){if(n.freezeTileCoverage)return;this.transform=n;const g=n.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((v,I)=>{if(v[I.key]="",!this._tiles[I.key]){const S=new a.Tile(I,this._source.tileSize*I.overscaleFactor(),n.tileZoom);S.state="loaded",this._tiles[I.key]=S}return v},{});for(const v in this._tiles)v in g||(this.freeFBO(v),this._tiles[v].unloadVectorData(),delete this._tiles[v])}freeFBO(n){const l=this.proxyCachedFBO[n];if(l!==void 0){const d=Object.values(l);this.renderCachePool.push(...d),delete this.proxyCachedFBO[n]}}deallocRenderCache(){this.renderCache.forEach(n=>n.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class ws extends a.OverscaledTileID{constructor(n,l,d){super(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,n.canonical.y),this.proxyTileKey=l,this.projMatrix=d}}class yl extends a.Elevation{constructor(n,l){super(),this.painter=n,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[d,g,v]=function(P){const k=new a.StructArrayLayout2i4,N=new a.StructArrayLayout3ui6,V=131;k.reserve(17161),N.reserve(33800);const Y=a.EXTENT/128,tt=a.EXTENT+Y/2,nt=tt+Y;for(let st=-Y;st<nt;st+=Y)for(let j=-Y;j<nt;j+=Y){const Q=j<0||j>tt||st<0||st>tt?24575:0,ct=a.clamp(Math.round(j),0,a.EXTENT),pt=a.clamp(Math.round(st),0,a.EXTENT);k.emplaceBack(ct+Q,pt)}const it=(st,j)=>{const Q=j*V+st;N.emplaceBack(Q+1,Q,Q+V),N.emplaceBack(Q+V,Q+V+1,Q+1)};for(let st=1;st<129;st++)for(let j=1;j<129;j++)it(j,st);return[0,129].forEach(st=>{for(let j=0;j<130;j++)it(j,st),it(st,j)}),[k,N,32768]}(),I=n.context;this.gridBuffer=I.createVertexBuffer(d,a.posAttributes.members),this.gridIndexBuffer=I.createIndexBuffer(g),this.gridSegments=a.SegmentVector.simpleSegment(0,0,d.length,g.length),this.gridNoSkirtSegments=a.SegmentVector.simpleSegment(0,0,d.length,v),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Cn(l.map),this.orthoMatrix=a.create(),a.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,a.EXTENT,0,a.EXTENT,0,1);const S=I.gl;this._overlapStencilMode=new a.StencilMode({func:S.GEQUAL,mask:255},0,255,S.KEEP,S.KEEP,S.REPLACE),this._previousZoom=n.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=l,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new _a(l.map)}set style(n){n.on("data",this._onStyleDataEvent.bind(this)),n.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=n,this._checkRenderCacheEfficiency(),this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(n,l,d){if(n&&n.terrain){this._style!==n&&(this.style=n),this.enabled=!0;const g=n.terrain.properties;this.sourceCache=n.terrain.drapeRenderMode===0?this._mockSourceCache:n._getSourceCache(g.get("source")),this._exaggeration=g.get("exaggeration");const v=()=>{this.sourceCache.used&&a.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const I=this.getScaledDemTileSize();this.sourceCache.update(l,I,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,v(),this._initializing=!0),v(),l.updateElevation(!0,d),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(l),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(n){this._findCoveringTileCache[n]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const n=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||n.efficiency!==100&&a.warnOnce(`Terrain render cache efficiency is not optimal (${n.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${n.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(n){n.coord&&n.dataType==="source"?this._clearRenderCacheForTile(n.sourceCacheId,n.coord):n.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const n in this._style._sourceCaches)this._style._sourceCaches[n].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(n=>n.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const n=2*this.proxySourceCache.getSource().tileSize;return[n,n]}set useVertexMorphing(n){this._useVertexMorphing=n}updateTileBinding(n){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const l=this.proxySourceCache,d=this.painter.transform;this._initializing&&(this._initializing=d._centerAltitude===0&&this.getAtPointOrZero(a.MercatorCoordinate.fromLngLat(d.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const g=this.proxyCoords=l.getIds().map(P=>{const k=l.getTileByID(P).tileID;return k.projMatrix=d.calculateProjMatrix(k.toUnwrapped()),k});(function(P,k){const N=k.transform.pointCoordinate(k.transform.getCameraPoint()),V=new a.Point(N.x,N.y);P.sort((Y,tt)=>{if(tt.overscaledZ-Y.overscaledZ)return tt.overscaledZ-Y.overscaledZ;const nt=new a.Point(Y.canonical.x+(1<<Y.canonical.z)*Y.wrap,Y.canonical.y),it=new a.Point(tt.canonical.x+(1<<tt.canonical.z)*tt.wrap,tt.canonical.y),st=V.mult(1<<Y.canonical.z);return st.x-=.5,st.y-=.5,st.distSqr(nt)-st.distSqr(it)})})(g,this.painter),this._previousZoom=d.zoom;const v=this.proxyToSource||{};this.proxyToSource={},g.forEach(P=>{this.proxyToSource[P.key]={}}),this.terrainTileForTile={};const I=this._style._sourceCaches;for(const P in I){const k=I[P];if(!k.used||(k!==this.sourceCache&&this.resetTileLookupCache(k.id),this._setupProxiedCoordsForOrtho(k,n[P],v),k.usedForTerrain))continue;const N=n[P];k.getSource().reparseOverscaled&&this._assignTerrainTiles(N)}this.proxiedCoords[l.id]=g.map(P=>new ws(P,P.key,this.orthoMatrix)),this._assignTerrainTiles(g),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(v),this.renderingToTexture=!1,this._updateTimestamp=a.exported.now();const S={};this._visibleDemTiles=[];for(const P of this.proxyCoords){const k=this.terrainTileForTile[P.key];if(!k)continue;const N=k.tileID.key;N in S||(this._visibleDemTiles.push(k),S[N]=N)}}_assignTerrainTiles(n){this._initializing||n.forEach(l=>{if(this.terrainTileForTile[l.key])return;const d=this._findTileCoveringTileID(l,this.sourceCache);d&&(this.terrainTileForTile[l.key]=d)})}_prepareDEMTextures(){const n=this.painter.context,l=n.gl;for(const d in this.terrainTileForTile){const g=this.terrainTileForTile[d],v=g.dem;!v||g.demTexture&&!g.needsDEMTextureUpload||(n.activeTexture.set(l.TEXTURE1),ga(this.painter,g,v))}}_prepareDemTileUniforms(n,l,d,g){if(!l||l.demTexture==null)return!1;const v=n.tileID.canonical,I=Math.pow(2,l.tileID.canonical.z-v.z),S=g||"";return d[`u_dem_tl${S}`]=[v.x*I%1,v.y*I%1],d[`u_dem_scale${S}`]=I,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const n=this.painter.context,l=n.gl;if(!this._emptyDepthBufferTexture){const d=new a.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new a.Texture(n,d,l.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let n=0;const l=this._visibleDemTiles.reduce((d,g)=>{if(!g.dem)return d;const v=g.dem.tree.minimums[0];return v>0&&n++,d+v},0);return n?l/n:0}_updateEmptyDEMTexture(){const n=this.painter.context,l=n.gl;n.activeTexture.set(l.TEXTURE2);const d=this._getLoadedAreaMinimum(),g=new a.RGBAImage({width:1,height:1},new Uint8Array(a.DEMData.pack(d,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let v=this._emptyDEMTexture;return v?v.update(g,{premultiply:!1}):v=this._emptyDEMTexture=new a.Texture(n,g,l.RGBA,{premultiply:!1}),v}setupElevationDraw(n,l,d){const g=this.painter.context,v=g.gl,I=(S=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:a.DEMData.getUnpackVector(S),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var S;I.u_dem_size=this.sourceCache.getSource().tileSize,I.u_exaggeration=this.exaggeration();let P=null,k=null,N=1;if(d&&d.morphing&&this._useVertexMorphing){const V=d.morphing.srcDemTile,Y=d.morphing.dstDemTile;N=d.morphing.phase,V&&Y&&(this._prepareDemTileUniforms(n,V,I,"_prev")&&(k=V),this._prepareDemTileUniforms(n,Y,I)&&(P=Y))}if(k&&P?(g.activeTexture.set(v.TEXTURE2),P.demTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE,v.NEAREST),g.activeTexture.set(v.TEXTURE4),k.demTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE,v.NEAREST),I.u_dem_lerp=N):(P=this.terrainTileForTile[n.tileID.key],g.activeTexture.set(v.TEXTURE2),(this._prepareDemTileUniforms(n,P,I)?P.demTexture:this.emptyDEMTexture).bind(v.NEAREST,v.CLAMP_TO_EDGE)),g.activeTexture.set(v.TEXTURE3),d&&d.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE),this._depthFBO&&(I.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE),I.u_depth_size_inv=[1,1]),d&&d.useMeterToDem&&P){const V=(1<<P.tileID.canonical.z)*a.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;I.u_meter_to_dem=V}if(d&&d.labelPlaneMatrixInv&&(I.u_label_plane_matrix_inv=d.labelPlaneMatrixInv),l.setTerrainUniformValues(g,I),this.painter.transform.projection.name==="globe"){const V=this.globeUniformValues(this.painter.transform,n.tileID.canonical,d&&d.useDenormalizedUpVectorScale);l.setGlobeUniformValues(g,V)}}globeUniformValues(n,l,d){const g=n.projection;return{u_tile_tl_up:g.upVector(l,0,0),u_tile_tr_up:g.upVector(l,a.EXTENT,0),u_tile_br_up:g.upVector(l,a.EXTENT,a.EXTENT),u_tile_bl_up:g.upVector(l,0,a.EXTENT),u_tile_up_scale:d?a.globeMetersToEcef(1):g.upVectorScale(l,n.center.lat,n.worldSize).metersToTile}}renderToBackBuffer(n){const l=this.painter,d=this.painter.context;n.length!==0&&(d.bindFramebuffer.set(null),d.viewport.set([0,0,l.width,l.height]),l.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(g,v,I,S,P){if(g.transform.projection.name==="globe")(function(k,N,V,Y,tt){const nt=k.context,it=nt.gl;let st,j;const Q=k.options.showTerrainWireframe?2:0,ct=k.transform,pt=a.globeUseCustomAntiAliasing(k,nt,ct),It=(_e,Xt)=>{if(j===_e)return;const se=[dn[_e],"PROJECTION_GLOBE_VIEW"];pt&&se.push("CUSTOM_ANTIALIASING"),Xt&&se.push(dn[Q]),st=k.useProgram("globeRaster",null,se),j=_e},Ct=k.colorModeForRenderPass(),St=new a.DepthMode(it.LEQUAL,a.DepthMode.ReadWrite,k.depthRangeFor3D);No.update(tt);const Bt=a.calculateGlobeMercatorMatrix(ct),Nt=[a.mercatorXfromLng(ct.center.lng),a.mercatorYfromLat(ct.center.lat)],Zt=Q?[!1,!0]:[!1],ye=k.globeSharedBuffers,Vt=[ct.width*a.exported.devicePixelRatio,ct.height*a.exported.devicePixelRatio],le=Float32Array.from(ct.globeMatrix),Qt={useDenormalizedUpVectorScale:!0};if(Zt.forEach(_e=>{const Xt=k.transform,se=Qa(Xt.zoom)*N.exaggeration();j=-1;const be=_e?it.LINES:it.TRIANGLES;for(const fe of Y){const Ee=V.getTile(fe),Qe=a.StencilMode.disabled,mr=N.prevTerrainTileForTile[fe.key],$e=N.terrainTileForTile[fe.key];ui(mr,$e)&&No.newMorphing(fe.key,mr,$e,tt,250),nt.activeTexture.set(it.TEXTURE0),Ee.texture.bind(it.LINEAR,it.CLAMP_TO_EDGE);const nr=No.getMorphValuesForProxy(fe.key),Gr=nr?1:0;nr&&a.extend$1(Qt,{morphing:{srcDemTile:nr.from,dstDemTile:nr.to,phase:a.easeCubicInOut(nr.phase)}});const kr=a.tileCornersToBounds(fe.canonical),Je=a.getLatitudinalLod(kr.getCenter().lat),hi=a.getGridMatrix(fe.canonical,kr,Je,Xt.worldSize/Xt._pixelsPerMercatorPixel),Ei=a.globeNormalizeECEF(a.globeTileBounds(fe.canonical)),Ti=Oo(Xt.projMatrix,le,Bt,Ei,a.globeToMercatorTransition(Xt.zoom),Nt,Xt.frustumCorners.TL,Xt.frustumCorners.TR,Xt.frustumCorners.BR,Xt.frustumCorners.BL,Xt.globeCenterInViewSpace,Xt.globeRadius,Vt,se,hi);if(It(Gr,_e),N.setupElevationDraw(Ee,st,Qt),k.prepareDrawProgram(nt,st,fe.toUnwrapped()),ye){const[Ii,Co,so]=_e?ye.getWirefameBuffers(k.context,Je):ye.getGridBuffers(Je,se!==0);st.draw(nt,be,St,Qe,Ct,a.CullFaceMode.backCCW,Ti,"globe_raster",Ii,Co,so)}}}),ye){const _e=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];pt&&_e.push("CUSTOM_ANTIALIASING"),st=k.useProgram("globeRaster",null,_e);for(const Xt of Y){const{x:se,y:be,z:fe}=Xt.canonical,Ee=be===0,Qe=be===(1<<fe)-1,[mr,$e,nr,Gr]=ye.getPoleBuffers(fe);if(Gr&&(Ee||Qe)){const kr=V.getTile(Xt);nt.activeTexture.set(it.TEXTURE0),kr.texture.bind(it.LINEAR,it.CLAMP_TO_EDGE);let Je=a.globePoleMatrixForTile(fe,se,ct);const hi=a.globeNormalizeECEF(a.globeTileBounds(Xt.canonical)),Ei=(Ti,Ii)=>Ti.draw(nt,it.TRIANGLES,St,a.StencilMode.disabled,Ct,a.CullFaceMode.disabled,Oo(ct.projMatrix,Je,Je,hi,0,Nt,ct.frustumCorners.TL,ct.frustumCorners.TR,ct.frustumCorners.BR,ct.frustumCorners.BL,ct.globeCenterInViewSpace,ct.globeRadius,Vt,0),"globe_pole_raster",Ii,nr,Gr);N.setupElevationDraw(kr,st,Qt),k.prepareDrawProgram(nt,st,Xt.toUnwrapped()),Ee&&Ei(st,mr),Qe&&(Je=a.scale(a.create(),Je,[1,-1,1]),Ei(st,$e))}}}})(g,v,I,S,P);else{const k=g.context,N=k.gl;let V,Y;const tt=g.options.showTerrainWireframe?2:0,nt=(ct,pt)=>{if(Y===ct)return;const It=[dn[ct]];pt&&It.push(dn[tt]),V=g.useProgram("terrainRaster",null,It),Y=ct},it=g.colorModeForRenderPass(),st=new a.DepthMode(N.LEQUAL,a.DepthMode.ReadWrite,g.depthRangeFor3D);No.update(P);const j=g.transform,Q=Qa(j.zoom)*v.exaggeration();(tt?[!1,!0]:[!1]).forEach(ct=>{Y=-1;const pt=ct?N.LINES:N.TRIANGLES,[It,Ct]=ct?v.getWirefameBuffer():[v.gridIndexBuffer,v.gridSegments];for(const St of S){const Bt=I.getTile(St),Nt=a.StencilMode.disabled,Zt=v.prevTerrainTileForTile[St.key],ye=v.terrainTileForTile[St.key];ui(Zt,ye)&&No.newMorphing(St.key,Zt,ye,P,250),k.activeTexture.set(N.TEXTURE0),Bt.texture.bind(N.LINEAR,N.CLAMP_TO_EDGE,N.LINEAR_MIPMAP_NEAREST);const Vt=No.getMorphValuesForProxy(St.key),le=Vt?1:0;let Qt;Vt&&(Qt={morphing:{srcDemTile:Vt.from,dstDemTile:Vt.to,phase:a.easeCubicInOut(Vt.phase)}});const _e=Nr(St.projMatrix,zr(St.canonical,j.renderWorldCopies)?Q/10:Q);nt(le,ct),v.setupElevationDraw(Bt,V,Qt),g.prepareDrawProgram(k,V,St.toUnwrapped()),V.draw(k,pt,st,Nt,it,a.CullFaceMode.backCCW,_e,"terrain_raster",v.gridBuffer,It,Ct)}})}}(l,this,this.proxySourceCache,n,this._updateTimestamp),this.renderingToTexture=!0,l.gpuTimingDeferredRenderEnd(),n.splice(0,n.length))}renderBatch(n){if(this._drapedRenderBatches.length===0)return n+1;this.renderingToTexture=!0;const l=this.painter,d=this.painter.context,g=this.proxySourceCache,v=this.proxiedCoords[g.id],I=this._drapedRenderBatches.shift(),S=[],P=l.style.order;let k=0;for(const N of v){const V=g.getTileByID(N.proxyTileKey),Y=g.proxyCachedFBO[N.key]?g.proxyCachedFBO[N.key][n]:void 0,tt=Y!==void 0?g.renderCache[Y]:this.pool[k++],nt=Y!==void 0;if(V.texture=tt.tex,nt&&!tt.dirty){S.push(V.tileID);continue}let it;d.bindFramebuffer.set(tt.fb.framebuffer),this.renderedToTile=!1,tt.dirty&&(d.clear({color:a.Color.transparent,stencil:0}),tt.dirty=!1);for(let st=I.start;st<=I.end;++st){const j=l.style._layers[P[st]];if(j.isHidden(l.transform.zoom))continue;const Q=l.style._getLayerSourceCache(j),ct=Q?this.proxyToSource[N.key][Q.id]:[N];if(!ct)continue;const pt=ct;d.viewport.set([0,0,tt.fb.width,tt.fb.height]),it!==(Q?Q.id:null)&&(this._setupStencil(tt,ct,j,Q),it=Q?Q.id:null),l.renderLayer(l,Q,j,pt)}this.renderedToTile?(tt.dirty=!0,S.push(V.tileID)):nt||--k,k===5&&(k=0,this.renderToBackBuffer(S))}return this.renderToBackBuffer(S),this.renderingToTexture=!1,d.bindFramebuffer.set(null),d.viewport.set([0,0,l.width,l.height]),I.end+1}postRender(){}renderCacheEfficiency(n){const l=n.order.length;if(l===0)return{efficiency:100};let d,g=0,v=0,I=!1;for(let S=0;S<l;++S){const P=n._layers[n.order[S]];this._style.isLayerDraped(P)?(I&&++g,++v):I||(I=!0,d=P.id)}return v===0?{efficiency:100}:{efficiency:100*(1-g/v),firstUndrapedLayer:d}}getMinElevationBelowMSL(){let n=0;return this._visibleDemTiles.filter(l=>l.dem).forEach(l=>{n=Math.min(n,l.dem.tree.minimums[0])}),n===0?n:(n-30)*this._exaggeration}raycast(n,l,d){if(!this._visibleDemTiles)return null;const g=this._visibleDemTiles.filter(v=>v.dem).map(v=>{const I=v.tileID,S=1<<I.overscaledZ,{x:P,y:k}=I.canonical,N=P/S,V=(P+1)/S,Y=k/S,tt=(k+1)/S;return{minx:N,miny:Y,maxx:V,maxy:tt,t:v.dem.tree.raycastRoot(N,Y,V,tt,n,l,d),tile:v}});g.sort((v,I)=>(v.t!==null?v.t:Number.MAX_VALUE)-(I.t!==null?I.t:Number.MAX_VALUE));for(const v of g){if(v.t==null)return null;const I=v.tile.dem.tree.raycast(v.minx,v.miny,v.maxx,v.maxy,n,l,d);if(I!=null)return I}return null}_createFBO(){const n=this.painter.context,l=n.gl,d=this.drapeBufferSize;n.activeTexture.set(l.TEXTURE0);const g=new a.Texture(n,{width:d[0],height:d[1],data:null},l.RGBA);g.bind(l.LINEAR,l.CLAMP_TO_EDGE);const v=n.createFramebuffer(d[0],d[1],!1);return v.colorAttachment.set(g.texture),v.depthAttachment=new Lt(n,v.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=n.createRenderbuffer(n.gl.DEPTH_STENCIL,d[0],d[1]),this._stencilRef=0,v.depthAttachment.set(this._sharedDepthStencil),n.clear({stencil:0})):v.depthAttachment.set(this._sharedDepthStencil),n.extTextureFilterAnisotropic&&!n.extTextureFilterAnisotropicForceOff&&l.texParameterf(l.TEXTURE_2D,n.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,n.extTextureFilterAnisotropicMax),{fb:v,tex:g,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const n in this._style._sourceCaches)if(this._style._sourceCaches[n].hasTransition())return!0;return this._style.order.some(n=>{const l=this._style._layers[n],d=l.isHidden(this.painter.transform.zoom);return l.type==="custom"?!d&&l.shouldRedrape():!d&&l.hasTransition()})}_clearLineLayersFromRenderCache(){let n=!1;for(const d of this._style._getSources())if(d instanceof Se){n=!0;break}if(!n)return;const l={};for(let d=0;d<this._style.order.length;++d){const g=this._style._layers[this._style.order[d]],v=this._style._getLayerSourceCache(g);if(v&&!l[v.id]&&!g.isHidden(this.painter.transform.zoom)&&g.type==="line"&&g.widthExpression()instanceof a.ZoomDependentExpression){l[v.id]=!0;for(const I of this.proxyCoords){const S=this.proxyToSource[I.key][v.id];if(S)for(const P of S)this._clearRenderCacheForTile(v.id,P)}}}}_clearRasterLayersFromRenderCache(){let n=!1;for(const d in this._style._sourceCaches)if(this._style._sourceCaches[d]._source instanceof we){n=!0;break}if(!n)return;const l={};for(let d=0;d<this._style.order.length;++d){const g=this._style._layers[this._style.order[d]],v=this._style._getLayerSourceCache(g);if(!v||l[v.id]||g.isHidden(this.painter.transform.zoom)||g.type!=="raster")continue;const I=g.paint.get("raster-fade-duration");for(const S of this.proxyCoords){const P=this.proxyToSource[S.key][v.id];if(P)for(const k of P){const N=ci(v.getTile(k),v.findLoadedParent(k,0),v,this.painter.transform,I);(N.opacity!==1||N.mix!==0)&&this._clearRenderCacheForTile(v.id,k)}}}}_setupDrapedRenderBatches(){const n=this._style.order,l=n.length;if(l===0)return;const d=[];let g,v=0,I=this._style._layers[n[v]];for(;!this._style.isLayerDraped(I)&&I.isHidden(this.painter.transform.zoom)&&++v<l;)I=this._style._layers[n[v]];for(;v<l;++v){const S=this._style._layers[n[v]];S.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(S)?g===void 0&&(g=v):g!==void 0&&(d.push({start:g,end:v-1}),g=void 0))}g!==void 0&&d.push({start:g,end:v-1}),this._drapedRenderBatches=d}_setupRenderCache(n){const l=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,l.renderCache.length>l.renderCachePool.length){const I=Object.values(l.proxyCachedFBO);l.proxyCachedFBO={};for(let S=0;S<I.length;++S){const P=Object.values(I[S]);l.renderCachePool.push(...P)}}return}this._clearRasterLayersFromRenderCache();const d=this.proxyCoords,g=this._tilesDirty;for(let I=d.length-1;I>=0;I--){const S=d[I];if(l.getTileByID(S.key),l.proxyCachedFBO[S.key]!==void 0){const P=n[S.key],k=this.proxyToSource[S.key];let N=0;for(const V in k){const Y=k[V],tt=P[V];if(!tt||tt.length!==Y.length||Y.some((nt,it)=>nt!==tt[it]||g[V]&&g[V].hasOwnProperty(nt.key))){N=-1;break}++N}for(const V in l.proxyCachedFBO[S.key])l.renderCache[l.proxyCachedFBO[S.key][V]].dirty=N<0||N!==Object.values(P).length}}const v=[...this._drapedRenderBatches];v.sort((I,S)=>S.end-S.start-(I.end-I.start));for(const I of v)for(const S of d){if(l.proxyCachedFBO[S.key])continue;let P=l.renderCachePool.pop();P===void 0&&l.renderCache.length<50&&(P=l.renderCache.length,l.renderCache.push(this._createFBO())),P!==void 0&&(l.proxyCachedFBO[S.key]={},l.proxyCachedFBO[S.key][I.start]=P,l.renderCache[P].dirty=!0)}this._tilesDirty={}}_setupStencil(n,l,d,g){if(!g||!this._sourceTilesOverlap[g.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const v=this.painter.context,I=v.gl;if(l.length<=1)return void(this._overlapStencilType=!1);let S;if(d.isTileClipped())S=l.length,this._overlapStencilMode.test={func:I.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(l[0].overscaledZ>l[l.length-1].overscaledZ))return void(this._overlapStencilType=!1);S=1,this._overlapStencilMode.test={func:I.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+S>255&&(v.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=S,this._overlapStencilMode.ref=this._stencilRef,d.isTileClipped()&&this._renderTileClippingMasks(l,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(n){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[n.key]),this._overlapStencilMode):a.StencilMode.disabled}_renderTileClippingMasks(n,l){const d=this.painter,g=this.painter.context,v=g.gl;d._tileClippingMaskIDs={},g.setColorMode(a.ColorMode.disabled),g.setDepthMode(a.DepthMode.disabled);const I=d.useProgram("clippingMask");for(const S of n){const P=d._tileClippingMaskIDs[S.key]=--l;I.draw(g,v.TRIANGLES,a.DepthMode.disabled,new a.StencilMode({func:v.ALWAYS,mask:0},P,255,v.KEEP,v.KEEP,v.REPLACE),a.ColorMode.disabled,a.CullFaceMode.disabled,ds(S.projMatrix),"$clipping",d.tileExtentBuffer,d.quadTriangleIndexBuffer,d.tileExtentSegments)}}pointCoordinate(n){const l=this.painter.transform;if(n.x<0||n.x>l.width||n.y<0||n.y>l.height)return null;const d=[n.x,n.y,1,1];a.transformMat4$1(d,d,l.pixelMatrixInverse),a.scale$1(d,d,1/d[3]),d[0]/=l.worldSize,d[1]/=l.worldSize;const g=l._camera.position,v=a.mercatorZfromAltitude(1,l.center.lat),I=[g[0],g[1],g[2]/v,0],S=a.subtract([],d.slice(0,3),I);a.normalize(S,S);const P=this.raycast(I,S,this._exaggeration);return P!==null&&P?(a.scaleAndAdd(I,I,S,P),I[3]=I[2],I[2]*=v,I):null}drawDepth(){const n=this.painter,l=n.context,d=this.proxySourceCache,g=Math.ceil(n.width),v=Math.ceil(n.height);if(!this._depthFBO||this._depthFBO.width===g&&this._depthFBO.height===v||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const I=l.gl,S=l.createFramebuffer(g,v,!0);l.activeTexture.set(I.TEXTURE0);const P=new a.Texture(l,{width:g,height:v,data:null},I.RGBA);P.bind(I.NEAREST,I.CLAMP_TO_EDGE),S.colorAttachment.set(P.texture);const k=l.createRenderbuffer(l.gl.DEPTH_COMPONENT16,g,v);S.depthAttachment.set(k),this._depthFBO=S,this._depthTexture=P}l.bindFramebuffer.set(this._depthFBO.framebuffer),l.viewport.set([0,0,g,v]),function(I,S,P,k){if(I.transform.projection.name==="globe")return;const N=I.context,V=N.gl;N.clear({depth:1});const Y=I.useProgram("terrainDepth"),tt=new a.DepthMode(V.LESS,a.DepthMode.ReadWrite,I.depthRangeFor3D);for(const nt of k){const it=P.getTile(nt),st=Nr(nt.projMatrix,0);S.setupElevationDraw(it,Y),Y.draw(N,V.TRIANGLES,tt,a.StencilMode.disabled,a.ColorMode.unblended,a.CullFaceMode.backCCW,st,"terrain_depth",S.gridBuffer,S.gridIndexBuffer,S.gridNoSkirtSegments)}}(n,this,d,this.proxyCoords)}_setupProxiedCoordsForOrtho(n,l,d){if(n.getSource()instanceof Cr)return this._setupProxiedCoordsForImageSource(n,l,d);this._findCoveringTileCache[n.id]=this._findCoveringTileCache[n.id]||{};const g=this.proxiedCoords[n.id]=[],v=this.proxyCoords;for(let S=0;S<v.length;S++){const P=v[S],k=this._findTileCoveringTileID(P,n);if(k){const N=this._createProxiedId(P,k,d[P.key]&&d[P.key][n.id]);g.push(N),this.proxyToSource[P.key][n.id]=[N]}}let I=!1;for(let S=0;S<l.length;S++){const P=n.getTile(l[S]);if(!P||!P.hasData())continue;const k=this._findTileCoveringTileID(P.tileID,this.proxySourceCache);if(k&&k.tileID.canonical.z!==P.tileID.canonical.z){const N=this.proxyToSource[k.tileID.key][n.id],V=this._createProxiedId(k.tileID,P,d[k.tileID.key]&&d[k.tileID.key][n.id]);N?N.splice(N.length-1,0,V):this.proxyToSource[k.tileID.key][n.id]=[V],g.push(V),I=!0}}this._sourceTilesOverlap[n.id]=I}_setupProxiedCoordsForImageSource(n,l,d){if(!n.getSource().loaded())return;const g=this.proxiedCoords[n.id]=[],v=this.proxyCoords,I=n.getSource(),S=new a.Point(I.tileID.x,I.tileID.y)._div(1<<I.tileID.z),P=I.coordinates.map(a.MercatorCoordinate.fromLngLat).reduce((N,V)=>(N.min.x=Math.min(N.min.x,V.x-S.x),N.min.y=Math.min(N.min.y,V.y-S.y),N.max.x=Math.max(N.max.x,V.x-S.x),N.max.y=Math.max(N.max.y,V.y-S.y),N),{min:new a.Point(Number.MAX_VALUE,Number.MAX_VALUE),max:new a.Point(-Number.MAX_VALUE,-Number.MAX_VALUE)}),k=(N,V)=>{const Y=N.wrap+N.canonical.x/(1<<N.canonical.z),tt=N.canonical.y/(1<<N.canonical.z),nt=a.EXTENT/(1<<N.canonical.z),it=V.wrap+V.canonical.x/(1<<V.canonical.z),st=V.canonical.y/(1<<V.canonical.z);return Y+nt<it+P.min.x||Y>it+P.max.x||tt+nt<st+P.min.y||tt>st+P.max.y};for(let N=0;N<v.length;N++){const V=v[N];for(let Y=0;Y<l.length;Y++){const tt=n.getTile(l[Y]);if(!tt||!tt.hasData()||k(V,tt.tileID))continue;const nt=this._createProxiedId(V,tt,d[V.key]&&d[V.key][n.id]),it=this.proxyToSource[V.key][n.id];it?it.push(nt):this.proxyToSource[V.key][n.id]=[nt],g.push(nt)}}}_createProxiedId(n,l,d){let g=this.orthoMatrix;if(d){const v=d.find(I=>I.key===l.tileID.key);if(v)return v}if(l.tileID.key!==n.key){const v=n.canonical.z-l.tileID.canonical.z;let I,S,P;g=a.create();const k=l.tileID.wrap-n.wrap<<n.overscaledZ;v>0?(I=a.EXTENT>>v,S=I*((l.tileID.canonical.x<<v)-n.canonical.x+k),P=I*((l.tileID.canonical.y<<v)-n.canonical.y)):(I=a.EXTENT<<-v,S=a.EXTENT*(l.tileID.canonical.x-(n.canonical.x+k<<-v)),P=a.EXTENT*(l.tileID.canonical.y-(n.canonical.y<<-v))),a.ortho(g,0,I,0,I,0,1),a.translate(g,g,[S,P,0])}return new ws(l.tileID,n.key,g)}_findTileCoveringTileID(n,l){let d=l.getTile(n);if(d&&d.hasData())return d;const g=this._findCoveringTileCache[l.id],v=g[n.key];if(d=v?l.getTileByID(v):null,d&&d.hasData()||v===null)return d;let I=d?d.tileID:n,S=I.overscaledZ;const P=l.getSource().minzoom,k=[];if(!v){const V=l.getSource().maxzoom;if(n.canonical.z>=V){const Y=n.canonical.z-V;l.getSource().reparseOverscaled?(S=Math.max(n.canonical.z+2,l.transform.tileZoom),I=new a.OverscaledTileID(S,n.wrap,V,n.canonical.x>>Y,n.canonical.y>>Y)):Y!==0&&(S=V,I=new a.OverscaledTileID(S,n.wrap,V,n.canonical.x>>Y,n.canonical.y>>Y))}I.key!==n.key&&(k.push(I.key),d=l.getTile(I))}const N=V=>{k.forEach(Y=>{g[Y]=V}),k.length=0};for(S-=1;S>=P&&(!d||!d.hasData());S--){d&&N(d.tileID.key);const V=I.calculateScaledKey(S);if(d=l.getTileByID(V),d&&d.hasData())break;const Y=g[V];if(Y===null)break;Y===void 0?k.push(V):d=l.getTileByID(Y)}return N(d?d.tileID.key:null),d&&d.hasData()?d:null}findDEMTileFor(n){return this.enabled?this._findTileCoveringTileID(n,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(n,l){let d=this._tilesDirty[n];d||(d=this._tilesDirty[n]={}),d[l.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const n=function(l){let d=0;const g=new a.StructArrayLayout2ui4,v=131;for(let I=1;I<129;I++){for(let S=1;S<129;S++)d=I*v+S,g.emplaceBack(d,d+1),g.emplaceBack(d,d+v),g.emplaceBack(d+1,d+v),I===128&&g.emplaceBack(d+v,d+v+1);g.emplaceBack(d+1,d+1+v)}return g}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(n),this.wireframeSegments=a.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,n.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class Mr{static cacheKey(n,l,d,g){let v=`${l}${g?g.cacheKey:""}`;for(const I of d)n.usedDefines.includes(I)&&(v+=`/${I}`);return v}constructor(n,l,d,g,v,I){const S=n.gl;this.program=S.createProgram();const P=function(j){const Q=[];for(let ct=0;ct<j.length;ct++){if(j[ct]===null)continue;const pt=j[ct].split(" ");Q.push(pt.pop())}return Q}(d.staticAttributes),k=g?g.getBinderAttributes():[],N=P.concat(k);let V=g?g.defines():[];V=V.concat(I.map(j=>`#define ${j}`));const Y=n.isWebGL2?`#version 300 es
`:"",tt=Y+V.concat(n.extStandardDerivatives&&Y.length===0?`#extension GL_OES_standard_derivatives : enable
`.concat(zi):zi,zi,Js,Yo.fragmentSource,nn.fragmentSource,d.fragmentSource).join(`
`),nt=Y+V.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,Js,Yo.vertexSource,nn.vertexSource,Wo.vertexSource,d.vertexSource).join(`
`),it=S.createShader(S.FRAGMENT_SHADER);if(S.isContextLost())return void(this.failedToCreate=!0);S.shaderSource(it,tt),S.compileShader(it),S.attachShader(this.program,it);const st=S.createShader(S.VERTEX_SHADER);if(S.isContextLost())this.failedToCreate=!0;else{S.shaderSource(st,nt),S.compileShader(st),S.attachShader(this.program,st),this.attributes={},this.numAttributes=N.length;for(let j=0;j<this.numAttributes;j++)N[j]&&(S.bindAttribLocation(this.program,j,N[j]),this.attributes[N[j]]=j);S.linkProgram(this.program),S.deleteShader(st),S.deleteShader(it),this.fixedUniforms=v(n),this.binderUniforms=g?g.getUniforms(n):[],I.includes("TERRAIN")&&(this.terrainUniforms=(j=>({u_dem:new a.Uniform1i(j),u_dem_prev:new a.Uniform1i(j),u_dem_unpack:new a.Uniform4f(j),u_dem_tl:new a.Uniform2f(j),u_dem_scale:new a.Uniform1f(j),u_dem_tl_prev:new a.Uniform2f(j),u_dem_scale_prev:new a.Uniform1f(j),u_dem_size:new a.Uniform1f(j),u_dem_lerp:new a.Uniform1f(j),u_exaggeration:new a.Uniform1f(j),u_depth:new a.Uniform1i(j),u_depth_size_inv:new a.Uniform2f(j),u_meter_to_dem:new a.Uniform1f(j),u_label_plane_matrix_inv:new a.UniformMatrix4f(j)}))(n)),I.includes("GLOBE")&&(this.globeUniforms=(j=>({u_tile_tl_up:new a.Uniform3f(j),u_tile_tr_up:new a.Uniform3f(j),u_tile_br_up:new a.Uniform3f(j),u_tile_bl_up:new a.Uniform3f(j),u_tile_up_scale:new a.Uniform1f(j)}))(n)),I.includes("FOG")&&(this.fogUniforms=(j=>({u_fog_matrix:new a.UniformMatrix4f(j),u_fog_range:new a.Uniform2f(j),u_fog_color:new a.Uniform4f(j),u_fog_horizon_blend:new a.Uniform1f(j),u_fog_temporal_offset:new a.Uniform1f(j),u_frustum_tl:new a.Uniform3f(j),u_frustum_tr:new a.Uniform3f(j),u_frustum_br:new a.Uniform3f(j),u_frustum_bl:new a.Uniform3f(j),u_globe_pos:new a.Uniform3f(j),u_globe_radius:new a.Uniform1f(j),u_globe_transition:new a.Uniform1f(j),u_is_globe:new a.Uniform1i(j),u_viewport:new a.Uniform2f(j)}))(n))}}setTerrainUniformValues(n,l){if(!this.terrainUniforms)return;const d=this.terrainUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const g in l)d[g]&&d[g].set(this.program,g,l[g])}}setGlobeUniformValues(n,l){if(!this.globeUniforms)return;const d=this.globeUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const g in l)d[g]&&d[g].set(this.program,g,l[g])}}setFogUniformValues(n,l){if(!this.fogUniforms)return;const d=this.fogUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const g in l)d[g].set(this.program,g,l[g])}}draw(n,l,d,g,v,I,S,P,k,N,V,Y,tt,nt,it){const st=n.gl;if(this.failedToCreate)return;n.program.set(this.program),n.setDepthMode(d),n.setStencilMode(g),n.setColorMode(v),n.setCullFace(I);for(const Q of Object.keys(this.fixedUniforms))this.fixedUniforms[Q].set(this.program,Q,S[Q]);nt&&nt.setUniforms(this.program,n,this.binderUniforms,Y,{zoom:tt});const j={[st.LINES]:2,[st.TRIANGLES]:3,[st.LINE_STRIP]:1}[l];for(const Q of V.get()){const ct=Q.vaos||(Q.vaos={});(ct[P]||(ct[P]=new no)).bind(n,this,k,nt?nt.getPaintVertexBuffers():[],N,Q.vertexOffset,it||[]),st.drawElements(l,Q.primitiveLength*j,st.UNSIGNED_SHORT,Q.primitiveOffset*j*2)}}}function Ur(h,n){const l=Math.pow(2,n.tileID.overscaledZ),d=n.tileSize*Math.pow(2,h.transform.tileZoom)/l,g=d*(n.tileID.canonical.x+n.tileID.wrap*l),v=d*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture.size,u_tile_units_to_pixels:1/tr(n,1,h.transform.tileZoom),u_pixel_coord_upper:[g>>16,v>>16],u_pixel_coord_lower:[65535&g,65535&v]}}const po=a.create(),Qs=(h,n,l,d,g,v,I,S,P,k,N)=>{const V=n.style.light,Y=V.properties.get("position"),tt=[Y.x,Y.y,Y.z],nt=a.create$1();V.properties.get("anchor")==="viewport"&&(a.fromRotation(nt,-n.transform.angle),a.transformMat3(tt,tt,nt));const it=V.properties.get("color"),st=n.transform,j={u_matrix:h,u_lightpos:tt,u_lightintensity:V.properties.get("intensity"),u_lightcolor:[it.r,it.g,it.b],u_vertical_gradient:+l,u_opacity:d,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:po,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:g,u_edge_radius:v};return st.projection.name==="globe"&&(j.u_tile_id=[I.canonical.x,I.canonical.y,1<<I.canonical.z],j.u_zoom_transition=P,j.u_inv_rot_matrix=N,j.u_merc_center=k,j.u_up_dir=st.projection.upVector(new a.CanonicalTileID(0,0,0),k[0]*a.EXTENT,k[1]*a.EXTENT),j.u_height_lift=S),j},Ho=(h,n,l,d,g,v,I,S,P,k,N,V)=>{const Y=Qs(h,n,l,d,g,v,I,P,k,N,V),tt={u_height_factor:-Math.pow(2,I.overscaledZ)/S.tileSize/8};return a.extend(Y,Ur(n,S),tt)},mn=h=>({u_matrix:h}),gn=(h,n,l)=>a.extend(mn(h),Ur(n,l)),Ku=(h,n)=>({u_matrix:h,u_world:n}),ou=(h,n,l,d)=>a.extend(gn(h,n,l),{u_world:d}),ks=a.create(),fo=(h,n,l,d,g,v)=>{const I=h.transform,S=I.projection.name==="globe";let P;if(v.paint.get("circle-pitch-alignment")==="map")if(S){const N=a.globePixelsToTileUnits(I.zoom,n.canonical)*I._pixelsPerMercatorPixel;P=Float32Array.from([N,0,0,N])}else P=I.calculatePixelsToTileUnitsMatrix(l);else P=new Float32Array([I.pixelsToGLUnits[0],0,0,I.pixelsToGLUnits[1]]);const k={u_camera_to_center_distance:I.cameraToCenterDistance,u_matrix:h.translatePosMatrix(n.projMatrix,l,v.paint.get("circle-translate"),v.paint.get("circle-translate-anchor")),u_device_pixel_ratio:a.exported.devicePixelRatio,u_extrude_scale:P,u_inv_rot_matrix:ks,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(S){k.u_inv_rot_matrix=d,k.u_merc_center=g,k.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],k.u_zoom_transition=a.globeToMercatorTransition(I.zoom);const N=g[0]*a.EXTENT,V=g[1]*a.EXTENT;k.u_up_dir=I.projection.upVector(new a.CanonicalTileID(0,0,0),N,V)}return k},Es=h=>{const n=[];return h.paint.get("circle-pitch-alignment")==="map"&&n.push("PITCH_WITH_MAP"),h.paint.get("circle-pitch-scale")==="map"&&n.push("SCALE_WITH_MAP"),n},Wn=(h,n,l,d)=>{const g=a.EXTENT/l.tileSize;return{u_matrix:h,u_camera_to_center_distance:n.getCameraToCenterDistance(d),u_extrude_scale:[n.pixelsToGLUnits[0]/g,n.pixelsToGLUnits[1]/g]}},mo=(h,n,l=1)=>({u_matrix:h,u_color:n,u_overlay:0,u_overlay_scale:l}),Ko=a.create(),Bs=(h,n,l,d,g,v,I)=>{const S=h.transform,P=S.projection.name==="globe",k=P?a.globePixelsToTileUnits(S.zoom,n.canonical)*S._pixelsPerMercatorPixel:tr(l,1,v),N={u_matrix:n.projMatrix,u_extrude_scale:k,u_intensity:I,u_inv_rot_matrix:Ko,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(P){N.u_inv_rot_matrix=d,N.u_merc_center=g,N.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],N.u_zoom_transition=a.globeToMercatorTransition(S.zoom);const V=g[0]*a.EXTENT,Y=g[1]*a.EXTENT;N.u_up_dir=S.projection.upVector(new a.CanonicalTileID(0,0,0),V,Y)}return N},Ts=(h,n,l,d,g,v,I)=>{const S=h.transform,P=S.calculatePixelsToTileUnitsMatrix(n);return{u_matrix:za(h,n,l,d),u_pixels_to_tile_units:P,u_device_pixel_ratio:v,u_units_to_pixels:[1/S.pixelsToGLUnits[0],1/S.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:g,u_texsize:cn(l)?n.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:ya(n,h.transform),u_alpha_discard_threshold:0,u_trim_offset:I}},Ji=(h,n,l,d,g)=>{const v=h.transform;return{u_matrix:za(h,n,l,d),u_texsize:n.imageAtlasTexture.size,u_pixels_to_tile_units:v.calculatePixelsToTileUnitsMatrix(n),u_device_pixel_ratio:g,u_image:0,u_tile_units_to_pixels:ya(n,v),u_units_to_pixels:[1/v.pixelsToGLUnits[0],1/v.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function ya(h,n){return 1/tr(h,1,n.tileZoom)}function za(h,n,l,d){return h.translatePosMatrix(d||n.tileID.projMatrix,n,l.paint.get("line-translate"),l.paint.get("line-translate-anchor"))}function cn(h){const n=h.paint.get("line-dasharray").value;return n.value||n.kind!=="constant"}const ms=(h,n,l,d,g,v)=>{return{u_matrix:h,u_tl_parent:n,u_scale_parent:l,u_fade_t:d.mix,u_opacity:d.opacity*g.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:g.paint.get("raster-brightness-min"),u_brightness_high:g.paint.get("raster-brightness-max"),u_saturation_factor:(S=g.paint.get("raster-saturation"),S>0?1-1/(1.001-S):-S),u_contrast_factor:(I=g.paint.get("raster-contrast"),I>0?1/(1-I):1+I),u_spin_weights:_n(g.paint.get("raster-hue-rotate")),u_perspective_transform:v};var I,S};function _n(h){h*=Math.PI/180;const n=Math.sin(h),l=Math.cos(h);return[(2*l+1)/3,(-Math.sqrt(3)*n-l+1)/3,(Math.sqrt(3)*n-l+1)/3]}const tl=a.create(),Rn=(h,n,l,d,g,v,I,S,P,k,N,V,Y,tt,nt,it)=>{const st=g.transform,j={u_is_size_zoom_constant:+(h==="constant"||h==="source"),u_is_size_feature_constant:+(h==="constant"||h==="camera"),u_size_t:n?n.uSizeT:0,u_size:n?n.uSize:0,u_camera_to_center_distance:st.cameraToCenterDistance,u_rotate_symbol:+l,u_aspect_ratio:st.width/st.height,u_fade_change:g.options.fadeDuration?g.symbolFadeChange:1,u_matrix:v,u_label_plane_matrix:I,u_coord_matrix:S,u_is_text:+P,u_pitch_with_map:+d,u_texsize:k,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:tl,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:tl,u_up_vector:[0,-1,0]};return it.name==="globe"&&(j.u_tile_id=[N.canonical.x,N.canonical.y,1<<N.canonical.z],j.u_zoom_transition=V,j.u_inv_rot_matrix=tt,j.u_merc_center=Y,j.u_camera_forward=st._camera.forward(),j.u_ecef_origin=a.globeECEFOrigin(st.globeMatrix,N.toUnwrapped()),j.u_tile_matrix=Float32Array.from(st.globeMatrix),j.u_up_vector=nt),j},el=(h,n,l,d,g,v,I,S,P,k,N,V,Y,tt,nt,it,st)=>a.extend(Rn(h,n,l,d,g,v,I,S,P,k,V,Y,tt,nt,it,st),{u_gamma_scale:d?g.transform.cameraToCenterDistance*Math.cos(g.terrain?0:g.transform._pitch):1,u_device_pixel_ratio:a.exported.devicePixelRatio,u_is_halo:+N}),ka=(h,n,l,d,g,v,I,S,P,k,N,V,Y,tt,nt,it)=>a.extend(el(h,n,l,d,g,v,I,S,!0,P,!0,N,V,Y,tt,nt,it),{u_texsize_icon:k,u_texture_icon:1}),ta=(h,n,l)=>({u_matrix:h,u_opacity:n,u_color:l}),su=(h,n,l,d,g)=>a.extend(function(v,I,S){const P=I.imageManager.getPattern(v.toString()),{width:k,height:N}=I.imageManager.getPixelSize(),V=Math.pow(2,S.tileID.overscaledZ),Y=S.tileSize*Math.pow(2,I.transform.tileZoom)/V,tt=Y*(S.tileID.canonical.x+S.tileID.wrap*V),nt=Y*S.tileID.canonical.y;return{u_image:0,u_pattern_tl:P.tl,u_pattern_br:P.br,u_texsize:[k,N],u_pattern_size:P.displaySize,u_tile_units_to_pixels:1/tr(S,1,I.transform.tileZoom),u_pixel_coord_upper:[tt>>16,nt>>16],u_pixel_coord_lower:[65535&tt,65535&nt]}}(d,l,g),{u_matrix:h,u_opacity:n}),vl={fillExtrusion:h=>({u_matrix:new a.UniformMatrix4f(h),u_lightpos:new a.Uniform3f(h),u_lightintensity:new a.Uniform1f(h),u_lightcolor:new a.Uniform3f(h),u_vertical_gradient:new a.Uniform1f(h),u_opacity:new a.Uniform1f(h),u_edge_radius:new a.Uniform1f(h),u_ao:new a.Uniform2f(h),u_tile_id:new a.Uniform3f(h),u_zoom_transition:new a.Uniform1f(h),u_inv_rot_matrix:new a.UniformMatrix4f(h),u_merc_center:new a.Uniform2f(h),u_up_dir:new a.Uniform3f(h),u_height_lift:new a.Uniform1f(h)}),fillExtrusionPattern:h=>({u_matrix:new a.UniformMatrix4f(h),u_lightpos:new a.Uniform3f(h),u_lightintensity:new a.Uniform1f(h),u_lightcolor:new a.Uniform3f(h),u_vertical_gradient:new a.Uniform1f(h),u_height_factor:new a.Uniform1f(h),u_edge_radius:new a.Uniform1f(h),u_ao:new a.Uniform2f(h),u_tile_id:new a.Uniform3f(h),u_zoom_transition:new a.Uniform1f(h),u_inv_rot_matrix:new a.UniformMatrix4f(h),u_merc_center:new a.Uniform2f(h),u_up_dir:new a.Uniform3f(h),u_height_lift:new a.Uniform1f(h),u_image:new a.Uniform1i(h),u_texsize:new a.Uniform2f(h),u_pixel_coord_upper:new a.Uniform2f(h),u_pixel_coord_lower:new a.Uniform2f(h),u_tile_units_to_pixels:new a.Uniform1f(h),u_opacity:new a.Uniform1f(h)}),fill:h=>({u_matrix:new a.UniformMatrix4f(h)}),fillPattern:h=>({u_matrix:new a.UniformMatrix4f(h),u_image:new a.Uniform1i(h),u_texsize:new a.Uniform2f(h),u_pixel_coord_upper:new a.Uniform2f(h),u_pixel_coord_lower:new a.Uniform2f(h),u_tile_units_to_pixels:new a.Uniform1f(h)}),fillOutline:h=>({u_matrix:new a.UniformMatrix4f(h),u_world:new a.Uniform2f(h)}),fillOutlinePattern:h=>({u_matrix:new a.UniformMatrix4f(h),u_world:new a.Uniform2f(h),u_image:new a.Uniform1i(h),u_texsize:new a.Uniform2f(h),u_pixel_coord_upper:new a.Uniform2f(h),u_pixel_coord_lower:new a.Uniform2f(h),u_tile_units_to_pixels:new a.Uniform1f(h)}),circle:h=>({u_camera_to_center_distance:new a.Uniform1f(h),u_extrude_scale:new a.UniformMatrix2f(h),u_device_pixel_ratio:new a.Uniform1f(h),u_matrix:new a.UniformMatrix4f(h),u_inv_rot_matrix:new a.UniformMatrix4f(h),u_merc_center:new a.Uniform2f(h),u_tile_id:new a.Uniform3f(h),u_zoom_transition:new a.Uniform1f(h),u_up_dir:new a.Uniform3f(h)}),collisionBox:h=>({u_matrix:new a.UniformMatrix4f(h),u_camera_to_center_distance:new a.Uniform1f(h),u_extrude_scale:new a.Uniform2f(h)}),collisionCircle:h=>({u_matrix:new a.UniformMatrix4f(h),u_inv_matrix:new a.UniformMatrix4f(h),u_camera_to_center_distance:new a.Uniform1f(h),u_viewport_size:new a.Uniform2f(h)}),debug:h=>({u_color:new a.UniformColor(h),u_matrix:new a.UniformMatrix4f(h),u_overlay:new a.Uniform1i(h),u_overlay_scale:new a.Uniform1f(h)}),clippingMask:h=>({u_matrix:new a.UniformMatrix4f(h)}),heatmap:h=>({u_extrude_scale:new a.Uniform1f(h),u_intensity:new a.Uniform1f(h),u_matrix:new a.UniformMatrix4f(h),u_inv_rot_matrix:new a.UniformMatrix4f(h),u_merc_center:new a.Uniform2f(h),u_tile_id:new a.Uniform3f(h),u_zoom_transition:new a.Uniform1f(h),u_up_dir:new a.Uniform3f(h)}),heatmapTexture:h=>({u_image:new a.Uniform1i(h),u_color_ramp:new a.Uniform1i(h),u_opacity:new a.Uniform1f(h)}),hillshade:h=>({u_matrix:new a.UniformMatrix4f(h),u_image:new a.Uniform1i(h),u_latrange:new a.Uniform2f(h),u_light:new a.Uniform2f(h),u_shadow:new a.UniformColor(h),u_highlight:new a.UniformColor(h),u_accent:new a.UniformColor(h)}),hillshadePrepare:h=>({u_matrix:new a.UniformMatrix4f(h),u_image:new a.Uniform1i(h),u_dimension:new a.Uniform2f(h),u_zoom:new a.Uniform1f(h),u_unpack:new a.Uniform4f(h)}),line:h=>({u_matrix:new a.UniformMatrix4f(h),u_pixels_to_tile_units:new a.UniformMatrix2f(h),u_device_pixel_ratio:new a.Uniform1f(h),u_units_to_pixels:new a.Uniform2f(h),u_dash_image:new a.Uniform1i(h),u_gradient_image:new a.Uniform1i(h),u_image_height:new a.Uniform1f(h),u_texsize:new a.Uniform2f(h),u_tile_units_to_pixels:new a.Uniform1f(h),u_alpha_discard_threshold:new a.Uniform1f(h),u_trim_offset:new a.Uniform2f(h)}),linePattern:h=>({u_matrix:new a.UniformMatrix4f(h),u_texsize:new a.Uniform2f(h),u_pixels_to_tile_units:new a.UniformMatrix2f(h),u_device_pixel_ratio:new a.Uniform1f(h),u_image:new a.Uniform1i(h),u_units_to_pixels:new a.Uniform2f(h),u_tile_units_to_pixels:new a.Uniform1f(h),u_alpha_discard_threshold:new a.Uniform1f(h)}),raster:h=>({u_matrix:new a.UniformMatrix4f(h),u_tl_parent:new a.Uniform2f(h),u_scale_parent:new a.Uniform1f(h),u_fade_t:new a.Uniform1f(h),u_opacity:new a.Uniform1f(h),u_image0:new a.Uniform1i(h),u_image1:new a.Uniform1i(h),u_brightness_low:new a.Uniform1f(h),u_brightness_high:new a.Uniform1f(h),u_saturation_factor:new a.Uniform1f(h),u_contrast_factor:new a.Uniform1f(h),u_spin_weights:new a.Uniform3f(h),u_perspective_transform:new a.Uniform2f(h)}),symbolIcon:h=>({u_is_size_zoom_constant:new a.Uniform1i(h),u_is_size_feature_constant:new a.Uniform1i(h),u_size_t:new a.Uniform1f(h),u_size:new a.Uniform1f(h),u_camera_to_center_distance:new a.Uniform1f(h),u_rotate_symbol:new a.Uniform1i(h),u_aspect_ratio:new a.Uniform1f(h),u_fade_change:new a.Uniform1f(h),u_matrix:new a.UniformMatrix4f(h),u_label_plane_matrix:new a.UniformMatrix4f(h),u_coord_matrix:new a.UniformMatrix4f(h),u_is_text:new a.Uniform1i(h),u_pitch_with_map:new a.Uniform1i(h),u_texsize:new a.Uniform2f(h),u_tile_id:new a.Uniform3f(h),u_zoom_transition:new a.Uniform1f(h),u_inv_rot_matrix:new a.UniformMatrix4f(h),u_merc_center:new a.Uniform2f(h),u_camera_forward:new a.Uniform3f(h),u_tile_matrix:new a.UniformMatrix4f(h),u_up_vector:new a.Uniform3f(h),u_ecef_origin:new a.Uniform3f(h),u_texture:new a.Uniform1i(h)}),symbolSDF:h=>({u_is_size_zoom_constant:new a.Uniform1i(h),u_is_size_feature_constant:new a.Uniform1i(h),u_size_t:new a.Uniform1f(h),u_size:new a.Uniform1f(h),u_camera_to_center_distance:new a.Uniform1f(h),u_rotate_symbol:new a.Uniform1i(h),u_aspect_ratio:new a.Uniform1f(h),u_fade_change:new a.Uniform1f(h),u_matrix:new a.UniformMatrix4f(h),u_label_plane_matrix:new a.UniformMatrix4f(h),u_coord_matrix:new a.UniformMatrix4f(h),u_is_text:new a.Uniform1i(h),u_pitch_with_map:new a.Uniform1i(h),u_texsize:new a.Uniform2f(h),u_texture:new a.Uniform1i(h),u_gamma_scale:new a.Uniform1f(h),u_device_pixel_ratio:new a.Uniform1f(h),u_tile_id:new a.Uniform3f(h),u_zoom_transition:new a.Uniform1f(h),u_inv_rot_matrix:new a.UniformMatrix4f(h),u_merc_center:new a.Uniform2f(h),u_camera_forward:new a.Uniform3f(h),u_tile_matrix:new a.UniformMatrix4f(h),u_up_vector:new a.Uniform3f(h),u_ecef_origin:new a.Uniform3f(h),u_is_halo:new a.Uniform1i(h)}),symbolTextAndIcon:h=>({u_is_size_zoom_constant:new a.Uniform1i(h),u_is_size_feature_constant:new a.Uniform1i(h),u_size_t:new a.Uniform1f(h),u_size:new a.Uniform1f(h),u_camera_to_center_distance:new a.Uniform1f(h),u_rotate_symbol:new a.Uniform1i(h),u_aspect_ratio:new a.Uniform1f(h),u_fade_change:new a.Uniform1f(h),u_matrix:new a.UniformMatrix4f(h),u_label_plane_matrix:new a.UniformMatrix4f(h),u_coord_matrix:new a.UniformMatrix4f(h),u_is_text:new a.Uniform1i(h),u_pitch_with_map:new a.Uniform1i(h),u_texsize:new a.Uniform2f(h),u_texsize_icon:new a.Uniform2f(h),u_texture:new a.Uniform1i(h),u_texture_icon:new a.Uniform1i(h),u_gamma_scale:new a.Uniform1f(h),u_device_pixel_ratio:new a.Uniform1f(h),u_is_halo:new a.Uniform1i(h)}),background:h=>({u_matrix:new a.UniformMatrix4f(h),u_opacity:new a.Uniform1f(h),u_color:new a.UniformColor(h)}),backgroundPattern:h=>({u_matrix:new a.UniformMatrix4f(h),u_opacity:new a.Uniform1f(h),u_image:new a.Uniform1i(h),u_pattern_tl:new a.Uniform2f(h),u_pattern_br:new a.Uniform2f(h),u_texsize:new a.Uniform2f(h),u_pattern_size:new a.Uniform2f(h),u_pixel_coord_upper:new a.Uniform2f(h),u_pixel_coord_lower:new a.Uniform2f(h),u_tile_units_to_pixels:new a.Uniform1f(h)}),terrainRaster:_l,terrainDepth:_l,skybox:h=>({u_matrix:new a.UniformMatrix4f(h),u_sun_direction:new a.Uniform3f(h),u_cubemap:new a.Uniform1i(h),u_opacity:new a.Uniform1f(h),u_temporal_offset:new a.Uniform1f(h)}),skyboxGradient:h=>({u_matrix:new a.UniformMatrix4f(h),u_color_ramp:new a.Uniform1i(h),u_center_direction:new a.Uniform3f(h),u_radius:new a.Uniform1f(h),u_opacity:new a.Uniform1f(h),u_temporal_offset:new a.Uniform1f(h)}),skyboxCapture:h=>({u_matrix_3f:new a.UniformMatrix3f(h),u_sun_direction:new a.Uniform3f(h),u_sun_intensity:new a.Uniform1f(h),u_color_tint_r:new a.Uniform4f(h),u_color_tint_m:new a.Uniform4f(h),u_luminance:new a.Uniform1f(h)}),globeRaster:h=>({u_proj_matrix:new a.UniformMatrix4f(h),u_globe_matrix:new a.UniformMatrix4f(h),u_normalize_matrix:new a.UniformMatrix4f(h),u_merc_matrix:new a.UniformMatrix4f(h),u_zoom_transition:new a.Uniform1f(h),u_merc_center:new a.Uniform2f(h),u_image0:new a.Uniform1i(h),u_grid_matrix:new a.UniformMatrix3f(h),u_skirt_height:new a.Uniform1f(h),u_frustum_tl:new a.Uniform3f(h),u_frustum_tr:new a.Uniform3f(h),u_frustum_br:new a.Uniform3f(h),u_frustum_bl:new a.Uniform3f(h),u_globe_pos:new a.Uniform3f(h),u_globe_radius:new a.Uniform1f(h),u_viewport:new a.Uniform2f(h)}),globeAtmosphere:h=>({u_frustum_tl:new a.Uniform3f(h),u_frustum_tr:new a.Uniform3f(h),u_frustum_br:new a.Uniform3f(h),u_frustum_bl:new a.Uniform3f(h),u_horizon:new a.Uniform1f(h),u_transition:new a.Uniform1f(h),u_fadeout_range:new a.Uniform1f(h),u_color:new a.Uniform4f(h),u_high_color:new a.Uniform4f(h),u_space_color:new a.Uniform4f(h),u_star_intensity:new a.Uniform1f(h),u_star_density:new a.Uniform1f(h),u_star_size:new a.Uniform1f(h),u_temporal_offset:new a.Uniform1f(h),u_horizon_angle:new a.Uniform1f(h),u_rotation_matrix:new a.UniformMatrix4f(h)})};let Is;function go(h,n,l,d,g,v,I){const S=h.context,P=S.gl,k=h.transform,N=h.useProgram("collisionBox"),V=[];let Y=0,tt=0;for(let pt=0;pt<d.length;pt++){const It=d[pt],Ct=n.getTile(It),St=Ct.getBucket(l);if(!St)continue;const Bt=bo(It,St,k);let Nt=Bt;g[0]===0&&g[1]===0||(Nt=h.translatePosMatrix(Bt,Ct,g,v));const Zt=I?St.textCollisionBox:St.iconCollisionBox,ye=St.collisionCircleArray;if(ye.length>0){const Vt=a.create(),le=Nt;a.mul(Vt,St.placementInvProjMatrix,k.glCoordMatrix),a.mul(Vt,Vt,St.placementViewportMatrix),V.push({circleArray:ye,circleOffset:tt,transform:le,invTransform:Vt,projection:St.getProjection()}),Y+=ye.length/4,tt=Y}Zt&&(h.terrain&&h.terrain.setupElevationDraw(Ct,N),N.draw(S,P.LINES,a.DepthMode.disabled,a.StencilMode.disabled,h.colorModeForRenderPass(),a.CullFaceMode.disabled,Wn(Nt,k,Ct,St.getProjection()),l.id,Zt.layoutVertexBuffer,Zt.indexBuffer,Zt.segments,null,k.zoom,null,[Zt.collisionVertexBuffer,Zt.collisionVertexBufferExt]))}if(!I||!V.length)return;const nt=h.useProgram("collisionCircle"),it=new a.StructArrayLayout2f1f2i16;it.resize(4*Y),it._trim();let st=0;for(const pt of V)for(let It=0;It<pt.circleArray.length/4;It++){const Ct=4*It,St=pt.circleArray[Ct+0],Bt=pt.circleArray[Ct+1],Nt=pt.circleArray[Ct+2],Zt=pt.circleArray[Ct+3];it.emplace(st++,St,Bt,Nt,Zt,0),it.emplace(st++,St,Bt,Nt,Zt,1),it.emplace(st++,St,Bt,Nt,Zt,2),it.emplace(st++,St,Bt,Nt,Zt,3)}(!Is||Is.length<2*Y)&&(Is=function(pt){const It=2*pt,Ct=new a.StructArrayLayout3ui6;Ct.resize(It),Ct._trim();for(let St=0;St<It;St++){const Bt=6*St;Ct.uint16[Bt+0]=4*St+0,Ct.uint16[Bt+1]=4*St+1,Ct.uint16[Bt+2]=4*St+2,Ct.uint16[Bt+3]=4*St+2,Ct.uint16[Bt+4]=4*St+3,Ct.uint16[Bt+5]=4*St+0}return Ct}(Y));const j=S.createIndexBuffer(Is,!0),Q=S.createVertexBuffer(it,a.collisionCircleLayout.members,!0);for(const pt of V){const It={u_matrix:pt.transform,u_inv_matrix:pt.invTransform,u_camera_to_center_distance:(ct=k).getCameraToCenterDistance(pt.projection),u_viewport_size:[ct.width,ct.height]};nt.draw(S,P.TRIANGLES,a.DepthMode.disabled,a.StencilMode.disabled,h.colorModeForRenderPass(),a.CullFaceMode.disabled,It,l.id,Q,j,a.SegmentVector.simpleSegment(0,2*pt.circleOffset,pt.circleArray.length,pt.circleArray.length/2),null,k.zoom)}var ct;Q.destroy(),j.destroy()}const yn=a.create();function ea({width:h,height:n,anchor:l,textOffset:d,textScale:g},v){const{horizontalAlign:I,verticalAlign:S}=a.getAnchorAlignment(l),P=-(I-.5)*h,k=-(S-.5)*n,N=a.evaluateVariableOffset(l,d);return new a.Point((P/g+N[0])*v,(k/g+N[1])*v)}function qn(h,n,l,d,g,v,I,S,P,k,N){const V=h.text.placedSymbolArray,Y=h.text.dynamicLayoutVertexArray,tt=h.icon.dynamicLayoutVertexArray,nt={},it=h.getProjection(),st=Oi(S,it,v),j=v.elevation,Q=it.upVectorScale(S.canonical,v.center.lat,v.worldSize).metersToTile;Y.clear();for(let ct=0;ct<V.length;ct++){const pt=V.get(ct),{tileAnchorX:It,tileAnchorY:Ct,numGlyphs:St}=pt,Bt=pt.hidden||!pt.crossTileID||h.allowVerticalPlacement&&!pt.placedOrientation?null:d[pt.crossTileID];if(Bt){let Nt=0,Zt=0,ye=0;if(j){const Ee=j?j.getAtTileOffset(S,It,Ct):0,[Qe,mr,$e]=it.upVector(S.canonical,It,Ct);Nt=Ee*Qe*Q,Zt=Ee*mr*Q,ye=Ee*$e*Q}let[Vt,le,Qt,_e]=Rr(pt.projectedAnchorX+Nt,pt.projectedAnchorY+Zt,pt.projectedAnchorZ+ye,l?st:I);const Xt=zl(v.getCameraToCenterDistance(it),_e);let se=g.evaluateSizeForFeature(h.textSizeData,k,pt)*Xt/a.ONE_EM;l&&(se*=h.tilePixelRatio/P);const be=ea(Bt,se);l?({x:Vt,y:le,z:Qt}=it.projectTilePoint(It+be.x,Ct+be.y,S.canonical),[Vt,le,Qt]=Rr(Vt+Nt,le+Zt,Qt+ye,I)):(n&&be._rotate(-v.angle),Vt+=be.x,le+=be.y,Qt=0);const fe=h.allowVerticalPlacement&&pt.placedOrientation===a.WritingMode.vertical?Math.PI/2:0;for(let Ee=0;Ee<St;Ee++)a.addDynamicAttributes(Y,Vt,le,Qt,fe);N&&pt.associatedIconIndex>=0&&(nt[pt.associatedIconIndex]={x:Vt,y:le,z:Qt,angle:fe})}else jo(St,Y)}if(N){tt.clear();const ct=h.icon.placedSymbolArray;for(let pt=0;pt<ct.length;pt++){const It=ct.get(pt),{numGlyphs:Ct}=It,St=nt[pt];if(It.hidden||!St)jo(Ct,tt);else{const{x:Bt,y:Nt,z:Zt,angle:ye}=St;for(let Vt=0;Vt<Ct;Vt++)a.addDynamicAttributes(tt,Bt,Nt,Zt,ye)}}h.icon.dynamicLayoutVertexBuffer.updateData(tt)}h.text.dynamicLayoutVertexBuffer.updateData(Y)}function zo(h,n,l){return l.iconsInText&&n?"symbolTextAndIcon":h?"symbolSDF":"symbolIcon"}function Fs(h,n,l,d,g,v,I,S,P,k,N,V){const Y=h.context,tt=Y.gl,nt=h.transform,it=S==="map",st=P==="map",j=it&&l.layout.get("symbol-placement")!=="point",Q=it&&!st&&!j,ct=l.layout.get("symbol-sort-key").constantOr(1)!==void 0;let pt=!1;const It=h.depthModeForSublayer(0,a.DepthMode.ReadOnly),Ct=[a.mercatorXfromLng(nt.center.lng),a.mercatorYfromLat(nt.center.lat)],St=l.layout.get("text-variable-anchor"),Bt=nt.projection.name==="globe",Nt=[],Zt=[0,-1,0];let ye=Zt;!Bt&&!nt.mercatorFromTransition||it||(ye=function(Vt){const le=Vt._camera.getWorldToCamera(Vt.worldSize,1),Qt=a.multiply([],le,Vt.globeMatrix);a.invert(Qt,Qt);const _e=[0,0,0],Xt=[0,1,0,0];return a.transformMat4$1(Xt,Xt,Qt),_e[0]=Xt[0],_e[1]=Xt[1],_e[2]=Xt[2],a.normalize(_e,_e),_e}(nt));for(const Vt of d){const le=n.getTile(Vt),Qt=le.getBucket(l);if(!Qt||Qt.projection.name==="mercator"&&Bt)continue;const _e=g?Qt.text:Qt.icon;if(!_e||Qt.fullyClipped||!_e.segments.get().length)continue;const Xt=_e.programConfigurations.get(l.id),se=g||Qt.sdfIcons,be=g?Qt.textSizeData:Qt.iconSizeData,fe=st||nt.pitch!==0,Ee=a.evaluateSizeForZoom(be,nt.zoom);let Qe,mr,$e,nr,Gr=[0,0],kr=null;if(g)mr=le.glyphAtlasTexture,$e=tt.LINEAR,Qe=le.glyphAtlasTexture.size,Qt.iconsInText&&(Gr=le.imageAtlasTexture.size,kr=le.imageAtlasTexture,nr=fe||h.options.rotating||h.options.zooming||be.kind==="composite"||be.kind==="camera"?tt.LINEAR:tt.NEAREST);else{const wa=l.layout.get("icon-size").constantOr(0)!==1||Qt.iconsNeedLinear;mr=le.imageAtlasTexture,$e=se||h.options.rotating||h.options.zooming||wa||fe?tt.LINEAR:tt.NEAREST,Qe=le.imageAtlasTexture.size}const Je=Qt.projection.name==="globe",hi=Je?ye:Zt,Ei=Je?a.globeToMercatorTransition(nt.zoom):0,Ti=Oi(Vt,Qt.getProjection(),nt),Ii=nt.calculatePixelsToTileUnitsMatrix(le),Co=ie(Ti,le.tileID.canonical,st,it,nt,Qt.getProjection(),Ii),so=h.terrain&&st&&j?a.invert(a.create(),Co):yn,Ls=Xi(Ti,le.tileID.canonical,st,it,nt,Qt.getProjection(),Ii),la=St&&Qt.hasTextData(),en=l.layout.get("icon-text-fit")!=="none"&&la&&Qt.hasIconData();if(j){const wa=nt.elevation,Va=wa?wa.getAtTileOffsetFunc(Vt,nt.center.lat,nt.worldSize,Qt.getProjection()):null,al=Lo(Ti,le.tileID.canonical,st,it,nt,Qt.getProjection(),Ii);Ka(Qt,Ti,h,g,al,Ls,st,k,Va,Vt)}const Si=j||g&&St||en,ei=h.translatePosMatrix(Ti,le,v,I),On=Si?yn:Co,Go=h.translatePosMatrix(Ls,le,v,I,!0),Ki=Qt.getProjection().createInversionMatrix(nt,Vt.canonical),ns=[];h.terrainRenderModeElevated()&&st&&ns.push("PITCH_WITH_MAP_TERRAIN"),Je&&ns.push("PROJECTION_GLOBE_VIEW"),Si&&ns.push("PROJECTED_POS_ON_VIEWPORT");const lu=se&&l.paint.get(g?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let sl;sl=se?Qt.iconsInText?ka(be.kind,Ee,Q,st,h,ei,On,Go,Qe,Gr,Vt,Ei,Ct,Ki,hi,Qt.getProjection()):el(be.kind,Ee,Q,st,h,ei,On,Go,g,Qe,!0,Vt,Ei,Ct,Ki,hi,Qt.getProjection()):Rn(be.kind,Ee,Q,st,h,ei,On,Go,g,Qe,Vt,Ei,Ct,Ki,hi,Qt.getProjection());const Gl={program:h.useProgram(zo(se,g,Qt),Xt,ns),buffers:_e,uniformValues:sl,atlasTexture:mr,atlasTextureIcon:kr,atlasInterpolation:$e,atlasInterpolationIcon:nr,isSDF:se,hasHalo:lu,tile:le,labelPlaneMatrixInv:so};if(ct&&Qt.canOverlap){pt=!0;const wa=_e.segments.get();for(const Va of wa)Nt.push({segments:new a.SegmentVector([Va]),sortKey:Va.sortKey,state:Gl})}else Nt.push({segments:_e.segments,sortKey:0,state:Gl})}pt&&Nt.sort((Vt,le)=>Vt.sortKey-le.sortKey);for(const Vt of Nt){const le=Vt.state;if(h.terrain&&h.terrain.setupElevationDraw(le.tile,le.program,{useDepthForOcclusion:!Bt,labelPlaneMatrixInv:le.labelPlaneMatrixInv}),Y.activeTexture.set(tt.TEXTURE0),le.atlasTexture.bind(le.atlasInterpolation,tt.CLAMP_TO_EDGE),le.atlasTextureIcon&&(Y.activeTexture.set(tt.TEXTURE1),le.atlasTextureIcon&&le.atlasTextureIcon.bind(le.atlasInterpolationIcon,tt.CLAMP_TO_EDGE)),le.isSDF){const Qt=le.uniformValues;le.hasHalo&&(Qt.u_is_halo=1,va(le.buffers,Vt.segments,l,h,le.program,It,N,V,Qt)),Qt.u_is_halo=0}va(le.buffers,Vt.segments,l,h,le.program,It,N,V,le.uniformValues)}}function va(h,n,l,d,g,v,I,S,P){const k=d.context,N=[h.dynamicLayoutVertexBuffer,h.opacityVertexBuffer,h.globeExtVertexBuffer];g.draw(k,k.gl.TRIANGLES,v,I,S,a.CullFaceMode.disabled,P,l.id,h.layoutVertexBuffer,h.indexBuffer,n,l.paint,d.transform.zoom,h.programConfigurations.get(l.id),N)}function ra(h,n,l,d,g,v,I){const S=h.context.gl,P=l.paint.get("fill-pattern"),k=P&&P.constantOr(1);let N,V,Y,tt,nt;I?(V=k&&!l.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",N=S.LINES):(V=k?"fillPattern":"fill",N=S.TRIANGLES);for(const it of d){const st=n.getTile(it);if(k&&!st.patternsLoaded())continue;const j=st.getBucket(l);if(!j)continue;h.prepareDrawTile();const Q=j.programConfigurations.get(l.id),ct=h.useProgram(V,Q);k&&(h.context.activeTexture.set(S.TEXTURE0),st.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),Q.updatePaintBuffers());const pt=P.constantOr(null);if(pt&&st.imageAtlas){const Ct=st.imageAtlas.patternPositions[pt.toString()];Ct&&Q.setConstantPatternPositions(Ct)}const It=h.translatePosMatrix(it.projMatrix,st,l.paint.get("fill-translate"),l.paint.get("fill-translate-anchor"));if(I){tt=j.indexBuffer2,nt=j.segments2;const Ct=h.terrain&&h.terrain.renderingToTexture?h.terrain.drapeBufferSize:[S.drawingBufferWidth,S.drawingBufferHeight];Y=V==="fillOutlinePattern"&&k?ou(It,h,st,Ct):Ku(It,Ct)}else tt=j.indexBuffer,nt=j.segments,Y=k?gn(It,h,st):mn(It);h.prepareDrawProgram(h.context,ct,it.toUnwrapped()),ct.draw(h.context,N,g,h.stencilModeForClipping(it),v,a.CullFaceMode.disabled,Y,l.id,j.layoutVertexBuffer,tt,nt,l.paint,h.transform.zoom,Q)}}function Jo(h,n,l,d,g,v,I){const S=h.context,P=S.gl,k=h.transform,N=l.paint.get("fill-extrusion-pattern"),V=N.constantOr(1),Y=l.paint.get("fill-extrusion-opacity"),tt=[l.paint.get("fill-extrusion-ambient-occlusion-intensity"),l.paint.get("fill-extrusion-ambient-occlusion-radius")],nt=l.layout.get("fill-extrusion-edge-radius"),it=nt>0&&!l.paint.get("fill-extrusion-rounded-roof"),st=it?0:nt,j=k.projection.name==="globe"?a.fillExtrusionHeightLift():0,Q=k.projection.name==="globe",ct=Q?a.globeToMercatorTransition(k.zoom):0,pt=[a.mercatorXfromLng(k.center.lng),a.mercatorYfromLat(k.center.lat)],It=[];Q&&It.push("PROJECTION_GLOBE_VIEW"),tt[0]>0&&It.push("FAUX_AO"),it&&It.push("ZERO_ROOF_RADIUS");for(const Ct of d){const St=n.getTile(Ct),Bt=St.getBucket(l);if(!Bt||Bt.projection.name!==k.projection.name)continue;const Nt=Bt.programConfigurations.get(l.id),Zt=h.useProgram(V?"fillExtrusionPattern":"fillExtrusion",Nt,It);if(h.terrain){const se=h.terrain;if(h.style.terrainSetForDrapingOnly())se.setupElevationDraw(St,Zt,{useMeterToDem:!0});else{if(!Bt.enableTerrain)continue;if(se.setupElevationDraw(St,Zt,{useMeterToDem:!0}),gs(S,n,Ct,Bt,l,se),!Bt.centroidVertexBuffer){const be=Zt.attributes.a_centroid_pos;be!==void 0&&P.vertexAttrib2f(be,0,0)}}}V&&(h.context.activeTexture.set(P.TEXTURE0),St.imageAtlasTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),Nt.updatePaintBuffers());const ye=N.constantOr(null);if(ye&&St.imageAtlas){const se=St.imageAtlas.patternPositions[ye.toString()];se&&Nt.setConstantPatternPositions(se)}const Vt=h.translatePosMatrix(Ct.projMatrix,St,l.paint.get("fill-extrusion-translate"),l.paint.get("fill-extrusion-translate-anchor")),le=k.projection.createInversionMatrix(k,Ct.canonical),Qt=l.paint.get("fill-extrusion-vertical-gradient"),_e=V?Ho(Vt,h,Qt,Y,tt,st,Ct,St,j,ct,pt,le):Qs(Vt,h,Qt,Y,tt,st,Ct,j,ct,pt,le);h.prepareDrawProgram(S,Zt,Ct.toUnwrapped());const Xt=[];h.terrain&&Xt.push(Bt.centroidVertexBuffer),Q&&Xt.push(Bt.layoutVertexExtBuffer),Zt.draw(S,S.gl.TRIANGLES,g,v,I,a.CullFaceMode.backCCW,_e,l.id,Bt.layoutVertexBuffer,Bt.indexBuffer,Bt.segments,l.paint,h.transform.zoom,Nt,Xt)}}function gs(h,n,l,d,g,v){const I=[j=>{let Q=j.canonical.x-1,ct=j.wrap;return Q<0&&(Q=(1<<j.canonical.z)-1,ct--),new a.OverscaledTileID(j.overscaledZ,ct,j.canonical.z,Q,j.canonical.y)},j=>{let Q=j.canonical.x+1,ct=j.wrap;return Q===1<<j.canonical.z&&(Q=0,ct++),new a.OverscaledTileID(j.overscaledZ,ct,j.canonical.z,Q,j.canonical.y)},j=>new a.OverscaledTileID(j.overscaledZ,j.wrap,j.canonical.z,j.canonical.x,(j.canonical.y===0?1<<j.canonical.z:j.canonical.y)-1),j=>new a.OverscaledTileID(j.overscaledZ,j.wrap,j.canonical.z,j.canonical.x,j.canonical.y===(1<<j.canonical.z)-1?0:j.canonical.y+1)],S=j=>{const Q=n.getSource().minzoom,ct=It=>{const Ct=n.getTileByID(It);if(Ct&&Ct.hasData())return Ct.getBucket(g)},pt=[0,-1,1];for(const It of pt){if(j.overscaledZ+It<Q)continue;const Ct=ct(j.calculateScaledKey(j.overscaledZ+It));if(Ct)return Ct}},P=[0,0,0],k=(j,Q)=>(P[0]=Math.min(j.min.y,Q.min.y),P[1]=Math.max(j.max.y,Q.max.y),P[2]=a.EXTENT-Q.min.x>j.max.x?Q.min.x-a.EXTENT:j.max.x,P),N=(j,Q)=>(P[0]=Math.min(j.min.x,Q.min.x),P[1]=Math.max(j.max.x,Q.max.x),P[2]=a.EXTENT-Q.min.y>j.max.y?Q.min.y-a.EXTENT:j.max.y,P),V=[(j,Q)=>k(j,Q),(j,Q)=>k(Q,j),(j,Q)=>N(j,Q),(j,Q)=>N(Q,j)],Y=new a.Point(0,0);let tt,nt,it;const st=(j,Q,ct,pt,It)=>{const Ct=[[pt?ct:j,pt?j:ct,0],[pt?ct:Q,pt?Q:ct,0]],St=It<0?a.EXTENT+It:It,Bt=[pt?St:(j+Q)/2,pt?(j+Q)/2:St,0];return ct===0&&It<0||ct!==0&&It>0?v.getForTilePoints(it,[Bt],!0,nt):Ct.push(Bt),v.getForTilePoints(l,Ct,!0,tt),Math.max(Ct[0][2],Ct[1][2],Bt[2])/v.exaggeration()};for(let j=0;j<4;j++){const Q=(j<2?1:5)-j,ct=d.borders[j];if(ct.length===0)continue;const pt=it=I[j](l),It=S(pt);if(!(It&&It instanceof a.FillExtrusionBucket&&It.enableTerrain)||d.borderDoneWithNeighborZ[j]===It.canonical.z&&It.borderDoneWithNeighborZ[Q]===d.canonical.z||(nt=v.findDEMTileFor(pt),!nt||!nt.dem))continue;if(!tt){const Nt=v.findDEMTileFor(l);if(!Nt||!Nt.dem)return;tt=Nt}const Ct=It.borders[Q];let St=0;const Bt=It.borderDoneWithNeighborZ[Q]!==d.canonical.z;if(d.canonical.z===It.canonical.z){for(let Nt=0;Nt<ct.length;Nt++){const Zt=d.featuresOnBorder[ct[Nt]],ye=Zt.borders[j];let Vt;for(;St<Ct.length&&(Vt=It.featuresOnBorder[Ct[St]],!(Vt.borders[Q][1]>ye[0]+3));)Bt&&It.encodeCentroid(void 0,Vt,!1),St++;if(Vt&&St<Ct.length){const le=St;let Qt=0;for(;!(Vt.borders[Q][0]>ye[1]-3)&&(Qt++,++St!==Ct.length);)Vt=It.featuresOnBorder[Ct[St]];if(Vt=It.featuresOnBorder[Ct[le]],Zt.intersectsCount()>1||Vt.intersectsCount()>1||Qt!==1){Qt!==1&&(St=le),d.encodeCentroid(void 0,Zt,!1),Bt&&It.encodeCentroid(void 0,Vt,!1);continue}const _e=V[j](Zt,Vt),Xt=j%2?a.EXTENT-1:0;Y.x=st(_e[0],Math.min(a.EXTENT-1,_e[1]),Xt,j<2,_e[2]),Y.y=0,d.encodeCentroid(Y,Zt,!1),Bt&&It.encodeCentroid(Y,Vt,!1)}else d.encodeCentroid(void 0,Zt,!1)}d.borderDoneWithNeighborZ[j]=It.canonical.z,d.needsCentroidUpdate=!0,Bt&&(It.borderDoneWithNeighborZ[Q]=d.canonical.z,It.needsCentroidUpdate=!0)}else{for(const Nt of ct)d.encodeCentroid(void 0,d.featuresOnBorder[Nt],!1);if(Bt){for(const Nt of Ct)It.encodeCentroid(void 0,It.featuresOnBorder[Nt],!1);It.borderDoneWithNeighborZ[Q]=d.canonical.z,It.needsCentroidUpdate=!0}d.borderDoneWithNeighborZ[j]=It.canonical.z,d.needsCentroidUpdate=!0}}(d.needsCentroidUpdate||!d.centroidVertexBuffer&&d.centroidVertexArray.length!==0)&&d.uploadCentroid(h)}const Wi=new a.Color(1,0,0,1),ko=new a.Color(0,1,0,1),$n=new a.Color(0,0,1,1),au=new a.Color(1,0,1,1),Us=new a.Color(0,1,1,1);function xa(h,n,l){const d=h.context,g=h.transform,v=d.gl,I=g.projection.name==="globe",S=I?["PROJECTION_GLOBE_VIEW"]:null;let P=l.projMatrix;if(I&&a.globeToMercatorTransition(g.zoom)>0){const Zt=a.transitionTileAABBinECEF(l.canonical,g),ye=a.globeDenormalizeECEF(Zt);P=a.multiply(new Float32Array(16),g.globeMatrix,ye),a.multiply(P,g.projMatrix,P)}const k=h.useProgram("debug",null,S),N=n.getTileByID(l.key);h.terrain&&h.terrain.setupElevationDraw(N,k);const V=a.DepthMode.disabled,Y=a.StencilMode.disabled,tt=h.colorModeForRenderPass(),nt="$debug";d.activeTexture.set(v.TEXTURE0),h.emptyTexture.bind(v.LINEAR,v.CLAMP_TO_EDGE),I?N._makeGlobeTileDebugBuffers(h.context,g):N._makeDebugTileBoundsBuffers(h.context,g.projection);const it=N._tileDebugBuffer||h.debugBuffer,st=N._tileDebugIndexBuffer||h.debugIndexBuffer,j=N._tileDebugSegments||h.debugSegments;k.draw(d,v.LINE_STRIP,V,Y,tt,a.CullFaceMode.disabled,mo(P,a.Color.red),nt,it,st,j,null,null,null,[N._globeTileDebugBorderBuffer]);const Q=N.latestRawTileData,ct=Math.floor((Q&&Q.byteLength||0)/1024),pt=n.getTile(l).tileSize,It=512/Math.min(pt,512)*(l.overscaledZ/g.zoom)*.5;let Ct=l.canonical.toString();l.overscaledZ!==l.canonical.z&&(Ct+=` => ${l.overscaledZ}`),Ct+=` ${ct}kb`,function(Zt,ye){Zt.initDebugOverlayCanvas();const Vt=Zt.debugOverlayCanvas,le=Zt.context.gl,Qt=Zt.debugOverlayCanvas.getContext("2d");Qt.clearRect(0,0,Vt.width,Vt.height),Qt.shadowColor="white",Qt.shadowBlur=2,Qt.lineWidth=1.5,Qt.strokeStyle="white",Qt.textBaseline="top",Qt.font="bold 36px Open Sans, sans-serif",Qt.fillText(ye,5,5),Qt.strokeText(ye,5,5),Zt.debugOverlayTexture.update(Vt),Zt.debugOverlayTexture.bind(le.LINEAR,le.CLAMP_TO_EDGE)}(h,Ct);const St=N._tileDebugTextBuffer||h.debugBuffer,Bt=N._tileDebugTextIndexBuffer||h.quadTriangleIndexBuffer,Nt=N._tileDebugTextSegments||h.debugSegments;k.draw(d,v.TRIANGLES,V,Y,a.ColorMode.alphaBlended,a.CullFaceMode.disabled,mo(P,a.Color.transparent,It),nt,St,Bt,Nt,null,null,null,[N._globeTileDebugTextBuffer])}function vn(h,n,l,d){Yn(h,0,n+l/2,h.transform.width,l,d)}function hn(h,n,l,d){Yn(h,n-l/2,0,l,h.transform.height,d)}function Yn(h,n,l,d,g,v){const I=h.context,S=I.gl;S.enable(S.SCISSOR_TEST),S.scissor(n*a.exported.devicePixelRatio,l*a.exported.devicePixelRatio,d*a.exported.devicePixelRatio,g*a.exported.devicePixelRatio),I.clear({color:v}),S.disable(S.SCISSOR_TEST)}const _o=a.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:xl}=_o;function yo(h,n,l,d){h.emplaceBack(n,l,d)}class Qo{constructor(n){this.vertexArray=new a.StructArrayLayout3f12,this.indices=new a.StructArrayLayout3ui6,yo(this.vertexArray,-1,-1,1),yo(this.vertexArray,1,-1,1),yo(this.vertexArray,-1,1,1),yo(this.vertexArray,1,1,1),yo(this.vertexArray,-1,-1,-1),yo(this.vertexArray,1,-1,-1),yo(this.vertexArray,-1,1,-1),yo(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=n.createVertexBuffer(this.vertexArray,xl),this.indexBuffer=n.createIndexBuffer(this.indices),this.segment=a.SegmentVector.simpleSegment(0,0,36,12)}}function ki(h,n,l,d,g,v){const I=h.gl,S=n.paint.get("sky-atmosphere-color"),P=n.paint.get("sky-atmosphere-halo-color"),k=n.paint.get("sky-atmosphere-sun-intensity"),N=((V,Y,tt,nt,it)=>({u_matrix_3f:V,u_sun_direction:Y,u_sun_intensity:tt,u_color_tint_r:[nt.r,nt.g,nt.b,nt.a],u_color_tint_m:[it.r,it.g,it.b,it.a],u_luminance:5e-5}))(a.fromMat4(a.create$1(),d),g,k,S,P);I.framebufferTexture2D(I.FRAMEBUFFER,I.COLOR_ATTACHMENT0,I.TEXTURE_CUBE_MAP_POSITIVE_X+v,n.skyboxTexture,0),l.draw(h,I.TRIANGLES,a.DepthMode.disabled,a.StencilMode.disabled,a.ColorMode.unblended,a.CullFaceMode.frontCW,N,"skyboxCapture",n.skyboxGeometry.vertexBuffer,n.skyboxGeometry.indexBuffer,n.skyboxGeometry.segment)}const ba=a.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class xn{constructor(n){const l=new a.StructArrayLayout5f20;l.emplaceBack(-1,1,1,0,0),l.emplaceBack(1,1,1,1,0),l.emplaceBack(1,-1,1,1,1),l.emplaceBack(-1,-1,1,0,1);const d=new a.StructArrayLayout3ui6;d.emplaceBack(0,1,2),d.emplaceBack(2,3,0),this.vertexBuffer=n.createVertexBuffer(l,ba.members),this.indexBuffer=n.createIndexBuffer(d),this.segments=a.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Vs={symbol:function(h,n,l,d,g){if(h.renderPass!=="translucent")return;const v=a.StencilMode.disabled,I=h.colorModeForRenderPass();l.layout.get("text-variable-anchor")&&function(S,P,k,N,V,Y,tt){const nt=P.transform,it=V==="map",st=Y==="map";for(const j of S){const Q=N.getTile(j),ct=Q.getBucket(k);if(!ct||!ct.text||!ct.text.segments.get().length)continue;const pt=a.evaluateSizeForZoom(ct.textSizeData,nt.zoom),It=Oi(j,ct.getProjection(),nt),Ct=nt.calculatePixelsToTileUnitsMatrix(Q),St=ie(It,Q.tileID.canonical,st,it,nt,ct.getProjection(),Ct),Bt=k.layout.get("icon-text-fit")!=="none"&&ct.hasIconData();if(pt){const Nt=Math.pow(2,nt.zoom-Q.tileID.overscaledZ);qn(ct,it,st,tt,a.symbolSize,nt,St,j,Nt,pt,Bt)}}}(d,h,l,n,l.layout.get("text-rotation-alignment"),l.layout.get("text-pitch-alignment"),g),l.paint.get("icon-opacity").constantOr(1)!==0&&Fs(h,n,l,d,!1,l.paint.get("icon-translate"),l.paint.get("icon-translate-anchor"),l.layout.get("icon-rotation-alignment"),l.layout.get("icon-pitch-alignment"),l.layout.get("icon-keep-upright"),v,I),l.paint.get("text-opacity").constantOr(1)!==0&&Fs(h,n,l,d,!0,l.paint.get("text-translate"),l.paint.get("text-translate-anchor"),l.layout.get("text-rotation-alignment"),l.layout.get("text-pitch-alignment"),l.layout.get("text-keep-upright"),v,I),n.map.showCollisionBoxes&&(go(h,n,l,d,l.paint.get("text-translate"),l.paint.get("text-translate-anchor"),!0),go(h,n,l,d,l.paint.get("icon-translate"),l.paint.get("icon-translate-anchor"),!1))},circle:function(h,n,l,d){if(h.renderPass!=="translucent")return;const g=l.paint.get("circle-opacity"),v=l.paint.get("circle-stroke-width"),I=l.paint.get("circle-stroke-opacity"),S=l.layout.get("circle-sort-key").constantOr(1)!==void 0;if(g.constantOr(1)===0&&(v.constantOr(1)===0||I.constantOr(1)===0))return;const P=h.context,k=P.gl,N=h.transform,V=h.depthModeForSublayer(0,a.DepthMode.ReadOnly),Y=a.StencilMode.disabled,tt=h.colorModeForRenderPass(),nt=N.projection.name==="globe",it=[a.mercatorXfromLng(N.center.lng),a.mercatorYfromLat(N.center.lat)],st=[];for(let Q=0;Q<d.length;Q++){const ct=d[Q],pt=n.getTile(ct),It=pt.getBucket(l);if(!It||It.projection.name!==N.projection.name)continue;const Ct=It.programConfigurations.get(l.id),St=Es(l);nt&&St.push("PROJECTION_GLOBE_VIEW");const Bt=h.useProgram("circle",Ct,St),Nt=It.layoutVertexBuffer,Zt=It.globeExtVertexBuffer,ye=It.indexBuffer,Vt=N.projection.createInversionMatrix(N,ct.canonical),le={programConfiguration:Ct,program:Bt,layoutVertexBuffer:Nt,globeExtVertexBuffer:Zt,indexBuffer:ye,uniformValues:fo(h,ct,pt,Vt,it,l),tile:pt};if(S){const Qt=It.segments.get();for(const _e of Qt)st.push({segments:new a.SegmentVector([_e]),sortKey:_e.sortKey,state:le})}else st.push({segments:It.segments,sortKey:0,state:le})}S&&st.sort((Q,ct)=>Q.sortKey-ct.sortKey);const j={useDepthForOcclusion:!nt};for(const Q of st){const{programConfiguration:ct,program:pt,layoutVertexBuffer:It,globeExtVertexBuffer:Ct,indexBuffer:St,uniformValues:Bt,tile:Nt}=Q.state,Zt=Q.segments;h.terrain&&h.terrain.setupElevationDraw(Nt,pt,j),h.prepareDrawProgram(P,pt,Nt.tileID.toUnwrapped()),pt.draw(P,k.TRIANGLES,V,Y,tt,a.CullFaceMode.disabled,Bt,l.id,It,St,Zt,l.paint,N.zoom,ct,[Ct])}},heatmap:function(h,n,l,d){if(l.paint.get("heatmap-opacity")!==0)if(h.renderPass==="offscreen"){const g=h.context,v=g.gl,I=a.StencilMode.disabled,S=new a.ColorMode([v.ONE,v.ONE],a.Color.transparent,[!0,!0,!0,!0]);(function(tt,nt,it,st){const j=tt.gl,Q=nt.width*st,ct=nt.height*st;tt.activeTexture.set(j.TEXTURE1),tt.viewport.set([0,0,Q,ct]);let pt=it.heatmapFbo;if(!pt||pt&&(pt.width!==Q||pt.height!==ct)){pt&&pt.destroy();const It=j.createTexture();j.bindTexture(j.TEXTURE_2D,It),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_WRAP_S,j.CLAMP_TO_EDGE),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_WRAP_T,j.CLAMP_TO_EDGE),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_MIN_FILTER,j.LINEAR),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_MAG_FILTER,j.LINEAR),pt=it.heatmapFbo=tt.createFramebuffer(Q,ct,!1),function(Ct,St,Bt,Nt,Zt,ye){const Vt=Ct.gl;Vt.texImage2D(Vt.TEXTURE_2D,0,Ct.isWebGL2&&Ct.extRenderToTextureHalfFloat?Vt.RGBA16F:Vt.RGBA,Zt,ye,0,Vt.RGBA,Ct.extRenderToTextureHalfFloat?Ct.isWebGL2?Vt.HALF_FLOAT:Ct.extTextureHalfFloat.HALF_FLOAT_OES:Vt.UNSIGNED_BYTE,null),Nt.colorAttachment.set(Bt)}(tt,0,It,pt,Q,ct)}else j.bindTexture(j.TEXTURE_2D,pt.colorAttachment.get()),tt.bindFramebuffer.set(pt.framebuffer)})(g,h,l,h.transform.projection.name==="globe"?.5:.25),g.clear({color:a.Color.transparent});const P=h.transform,k=P.projection.name==="globe",N=k?["PROJECTION_GLOBE_VIEW"]:null,V=k?a.CullFaceMode.frontCCW:a.CullFaceMode.disabled,Y=[a.mercatorXfromLng(P.center.lng),a.mercatorYfromLat(P.center.lat)];for(let tt=0;tt<d.length;tt++){const nt=d[tt];if(n.hasRenderableParent(nt))continue;const it=n.getTile(nt),st=it.getBucket(l);if(!st||st.projection.name!==P.projection.name)continue;const j=st.programConfigurations.get(l.id),Q=h.useProgram("heatmap",j,N),{zoom:ct}=h.transform;h.terrain&&h.terrain.setupElevationDraw(it,Q),h.prepareDrawProgram(g,Q,nt.toUnwrapped());const pt=P.projection.createInversionMatrix(P,nt.canonical);Q.draw(g,v.TRIANGLES,a.DepthMode.disabled,I,S,V,Bs(h,nt,it,pt,Y,ct,l.paint.get("heatmap-intensity")),l.id,st.layoutVertexBuffer,st.indexBuffer,st.segments,l.paint,h.transform.zoom,j,k?[st.globeExtVertexBuffer]:null)}g.viewport.set([0,0,h.width,h.height])}else h.renderPass==="translucent"&&(h.context.setColorMode(h.colorModeForRenderPass()),function(g,v){const I=g.context,S=I.gl,P=v.heatmapFbo;if(!P)return;I.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,P.colorAttachment.get()),I.activeTexture.set(S.TEXTURE1);let k=v.colorRampTexture;k||(k=v.colorRampTexture=new a.Texture(I,v.colorRamp,S.RGBA)),k.bind(S.LINEAR,S.CLAMP_TO_EDGE),g.useProgram("heatmapTexture").draw(I,S.TRIANGLES,a.DepthMode.disabled,a.StencilMode.disabled,g.colorModeForRenderPass(),a.CullFaceMode.disabled,((N,V,Y,tt)=>({u_image:0,u_color_ramp:1,u_opacity:V.paint.get("heatmap-opacity")}))(0,v),v.id,g.viewportBuffer,g.quadTriangleIndexBuffer,g.viewportSegments,v.paint,g.transform.zoom)}(h,l))},line:function(h,n,l,d){if(h.renderPass!=="translucent")return;const g=l.paint.get("line-opacity"),v=l.paint.get("line-width");if(g.constantOr(1)===0||v.constantOr(1)===0)return;const I=h.depthModeForSublayer(0,a.DepthMode.ReadOnly),S=h.colorModeForRenderPass(),P=h.terrain&&h.terrain.renderingToTexture?1:a.exported.devicePixelRatio,k=l.paint.get("line-dasharray"),N=k.constantOr(1),V=l.layout.get("line-cap"),Y=l.paint.get("line-pattern"),tt=Y.constantOr(1),nt=l.paint.get("line-gradient"),it=tt?"linePattern":"line",st=h.context,j=st.gl,Q=(pt=>{const It=[];cn(pt)&&It.push("RENDER_LINE_DASH"),pt.paint.get("line-gradient")&&It.push("RENDER_LINE_GRADIENT");const Ct=pt.paint.get("line-trim-offset");Ct[0]===0&&Ct[1]===0||It.push("RENDER_LINE_TRIM_OFFSET");const St=pt.paint.get("line-pattern").constantOr(1),Bt=pt.paint.get("line-opacity").constantOr(1)!==1;return!St&&Bt&&It.push("RENDER_LINE_ALPHA_DISCARD"),It})(l);let ct=Q.includes("RENDER_LINE_ALPHA_DISCARD");h.terrain&&h.terrain.clipOrMaskOverlapStencilType()&&(ct=!1);for(const pt of d){const It=n.getTile(pt);if(tt&&!It.patternsLoaded())continue;const Ct=It.getBucket(l);if(!Ct)continue;h.prepareDrawTile();const St=Ct.programConfigurations.get(l.id),Bt=h.useProgram(it,St,Q),Nt=Y.constantOr(null);if(Nt&&It.imageAtlas){const se=It.imageAtlas.patternPositions[Nt.toString()];se&&St.setConstantPatternPositions(se)}const Zt=k.constantOr(null),ye=V.constantOr(null);if(!tt&&Zt&&ye&&It.lineAtlas){const se=It.lineAtlas.getDash(Zt,ye);se&&St.setConstantPatternPositions(se)}let[Vt,le]=l.paint.get("line-trim-offset");(ye==="round"||ye==="square")&&Vt!==le&&(Vt===0&&(Vt-=1),le===1&&(le+=1));const Qt=h.terrain?pt.projMatrix:null,_e=tt?Ji(h,It,l,Qt,P):Ts(h,It,l,Qt,Ct.lineClipsArray.length,P,[Vt,le]);if(nt){const se=Ct.gradients[l.id];let be=se.texture;if(l.gradientVersion!==se.version){let fe=256;if(l.stepInterpolant){const Ee=n.getSource().maxzoom,Qe=pt.canonical.z===Ee?Math.ceil(1<<h.transform.maxZoom-pt.canonical.z):1;fe=a.clamp(a.nextPowerOfTwo(Ct.maxLineLength/a.EXTENT*1024*Qe),256,st.maxTextureSize)}se.gradient=a.renderColorRamp({expression:l.gradientExpression(),evaluationKey:"lineProgress",resolution:fe,image:se.gradient||void 0,clips:Ct.lineClipsArray}),se.texture?se.texture.update(se.gradient):se.texture=new a.Texture(st,se.gradient,j.RGBA),se.version=l.gradientVersion,be=se.texture}st.activeTexture.set(j.TEXTURE1),be.bind(l.stepInterpolant?j.NEAREST:j.LINEAR,j.CLAMP_TO_EDGE)}N&&(st.activeTexture.set(j.TEXTURE0),It.lineAtlasTexture.bind(j.LINEAR,j.REPEAT),St.updatePaintBuffers()),tt&&(st.activeTexture.set(j.TEXTURE0),It.imageAtlasTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE),St.updatePaintBuffers()),h.prepareDrawProgram(st,Bt,pt.toUnwrapped());const Xt=se=>{Bt.draw(st,j.TRIANGLES,I,se,S,a.CullFaceMode.disabled,_e,l.id,Ct.layoutVertexBuffer,Ct.indexBuffer,Ct.segments,l.paint,h.transform.zoom,St,[Ct.layoutVertexBuffer2])};if(ct){const se=h.stencilModeForClipping(pt).ref;se===0&&h.terrain&&st.clear({stencil:0});const be={func:j.EQUAL,mask:255};_e.u_alpha_discard_threshold=.8,Xt(new a.StencilMode(be,se,255,j.KEEP,j.KEEP,j.INVERT)),_e.u_alpha_discard_threshold=0,Xt(new a.StencilMode(be,se,255,j.KEEP,j.KEEP,j.KEEP))}else Xt(h.stencilModeForClipping(pt))}ct&&(h.resetStencilClippingMasks(),h.terrain&&st.clear({stencil:0}))},fill:function(h,n,l,d){const g=l.paint.get("fill-color"),v=l.paint.get("fill-opacity");if(v.constantOr(1)===0)return;const I=h.colorModeForRenderPass(),S=l.paint.get("fill-pattern"),P=h.opaquePassEnabledForLayer()&&!S.constantOr(1)&&g.constantOr(a.Color.transparent).a===1&&v.constantOr(0)===1?"opaque":"translucent";if(h.renderPass===P){const k=h.depthModeForSublayer(1,h.renderPass==="opaque"?a.DepthMode.ReadWrite:a.DepthMode.ReadOnly);ra(h,n,l,d,k,I,!1)}if(h.renderPass==="translucent"&&l.paint.get("fill-antialias")){const k=h.depthModeForSublayer(l.getPaintProperty("fill-outline-color")?2:0,a.DepthMode.ReadOnly);ra(h,n,l,d,k,I,!0)}},"fill-extrusion":function(h,n,l,d){const g=l.paint.get("fill-extrusion-opacity");if(g!==0&&h.renderPass==="translucent"){const v=new a.DepthMode(h.context.gl.LEQUAL,a.DepthMode.ReadWrite,h.depthRangeFor3D);if(g!==1||l.paint.get("fill-extrusion-pattern").constantOr(1))Jo(h,n,l,d,v,a.StencilMode.disabled,a.ColorMode.disabled),Jo(h,n,l,d,v,h.stencilModeFor3D(),h.colorModeForRenderPass()),h.resetStencilClippingMasks();else{const I=h.colorModeForRenderPass();Jo(h,n,l,d,v,a.StencilMode.disabled,I)}}},hillshade:function(h,n,l,d){if(h.renderPass!=="offscreen"&&h.renderPass!=="translucent")return;const g=h.context,v=h.depthModeForSublayer(0,a.DepthMode.ReadOnly),I=h.colorModeForRenderPass(),S=h.terrain&&h.terrain.renderingToTexture,[P,k]=h.renderPass!=="translucent"||S?[{},d]:h.stencilConfigForOverlap(d);for(const N of k){const V=n.getTile(N);if(V.needsHillshadePrepare&&h.renderPass==="offscreen")gl(h,V,l,v,a.StencilMode.disabled,I);else if(h.renderPass==="translucent"){const Y=S&&h.terrain?h.terrain.stencilModeForRTTOverlap(N):P[N.overscaledZ];zs(h,N,V,l,v,Y,I)}}g.viewport.set([0,0,h.width,h.height]),h.resetStencilClippingMasks()},raster:function(h,n,l,d,g,v){if(h.renderPass!=="translucent"||l.paint.get("raster-opacity")===0||!d.length)return;const I=h.context,S=I.gl,P=n.getSource(),k=h.useProgram("raster"),N=h.colorModeForRenderPass(),V=h.terrain&&h.terrain.renderingToTexture,[Y,tt]=P instanceof Cr||V?[{},d]:h.stencilConfigForOverlap(d),nt=tt[tt.length-1].overscaledZ,it=!h.options.moving;for(const st of tt){const j=V?a.DepthMode.disabled:h.depthModeForSublayer(st.overscaledZ-nt,l.paint.get("raster-opacity")===1?a.DepthMode.ReadWrite:a.DepthMode.ReadOnly,S.LESS),Q=st.toUnwrapped(),ct=n.getTile(st);if(V&&(!ct||!ct.hasData()))continue;const pt=V?st.projMatrix:h.transform.calculateProjMatrix(Q,it),It=h.terrain&&V?h.terrain.stencilModeForRTTOverlap(st):Y[st.overscaledZ],Ct=v?0:l.paint.get("raster-fade-duration");ct.registerFadeDuration(Ct);const St=n.findLoadedParent(st,0),Bt=ci(ct,St,n,h.transform,Ct);let Nt,Zt;h.terrain&&h.terrain.prepareDrawTile();const ye=l.paint.get("raster-resampling")==="nearest"?S.NEAREST:S.LINEAR;I.activeTexture.set(S.TEXTURE0),ct.texture.bind(ye,S.CLAMP_TO_EDGE),I.activeTexture.set(S.TEXTURE1),St?(St.texture.bind(ye,S.CLAMP_TO_EDGE),Nt=Math.pow(2,St.tileID.overscaledZ-ct.tileID.overscaledZ),Zt=[ct.tileID.canonical.x*Nt%1,ct.tileID.canonical.y*Nt%1]):ct.texture.bind(ye,S.CLAMP_TO_EDGE),ct.texture.useMipmap&&I.extTextureFilterAnisotropic&&h.transform.pitch>20&&S.texParameterf(S.TEXTURE_2D,I.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,I.extTextureFilterAnisotropicMax);const Vt=ms(pt,Zt||[0,0],Nt||1,Bt,l,P instanceof Cr?P.perspectiveTransform:[0,0]);if(h.prepareDrawProgram(I,k,Q),P instanceof Cr)P.boundsBuffer&&P.boundsSegments&&k.draw(I,S.TRIANGLES,j,a.StencilMode.disabled,N,a.CullFaceMode.disabled,Vt,l.id,P.boundsBuffer,h.quadTriangleIndexBuffer,P.boundsSegments);else{const{tileBoundsBuffer:le,tileBoundsIndexBuffer:Qt,tileBoundsSegments:_e}=h.getTileBoundsBuffers(ct);k.draw(I,S.TRIANGLES,j,It,N,a.CullFaceMode.disabled,Vt,l.id,le,Qt,_e)}}h.resetStencilClippingMasks()},background:function(h,n,l,d){const g=l.paint.get("background-color"),v=l.paint.get("background-opacity");if(v===0)return;const I=h.context,S=I.gl,P=h.transform,k=P.tileSize,N=l.paint.get("background-pattern");if(h.isPatternMissing(N))return;const V=!N&&g.a===1&&v===1&&h.opaquePassEnabledForLayer()?"opaque":"translucent";if(h.renderPass!==V)return;const Y=a.StencilMode.disabled,tt=h.depthModeForSublayer(0,V==="opaque"?a.DepthMode.ReadWrite:a.DepthMode.ReadOnly),nt=h.colorModeForRenderPass(),it=h.useProgram(N?"backgroundPattern":"background");let st,j=d;j||(st=h.getBackgroundTiles(),j=Object.values(st).map(Q=>Q.tileID)),N&&(I.activeTexture.set(S.TEXTURE0),h.imageManager.bind(h.context));for(const Q of j){const ct=Q.toUnwrapped(),pt=d?Q.projMatrix:h.transform.calculateProjMatrix(ct);h.prepareDrawTile();const It=n?n.getTile(Q):st?st[Q.key]:new a.Tile(Q,k,P.zoom,h),Ct=N?su(pt,v,h,N,{tileID:Q,tileSize:k}):ta(pt,v,g);h.prepareDrawProgram(I,it,ct);const{tileBoundsBuffer:St,tileBoundsIndexBuffer:Bt,tileBoundsSegments:Nt}=h.getTileBoundsBuffers(It);it.draw(I,S.TRIANGLES,tt,Y,nt,a.CullFaceMode.disabled,Ct,l.id,St,Bt,Nt)}},sky:function(h,n,l){const d=h.transform,g=d.projection.name==="mercator"||d.projection.name==="globe"?1:a.smoothstep(7,8,d.zoom),v=l.paint.get("sky-opacity")*g;if(v===0)return;const I=h.context,S=l.paint.get("sky-type"),P=new a.DepthMode(I.gl.LEQUAL,a.DepthMode.ReadOnly,[0,1]),k=h.frameCounter/1e3%1;S==="atmosphere"?h.renderPass==="offscreen"?l.needsSkyboxCapture(h)&&(function(N,V,Y,tt){const nt=N.context,it=nt.gl;let st=V.skyboxFbo;if(!st){st=V.skyboxFbo=nt.createFramebuffer(32,32,!1),V.skyboxGeometry=new Qo(nt),V.skyboxTexture=nt.gl.createTexture(),it.bindTexture(it.TEXTURE_CUBE_MAP,V.skyboxTexture),it.texParameteri(it.TEXTURE_CUBE_MAP,it.TEXTURE_WRAP_S,it.CLAMP_TO_EDGE),it.texParameteri(it.TEXTURE_CUBE_MAP,it.TEXTURE_WRAP_T,it.CLAMP_TO_EDGE),it.texParameteri(it.TEXTURE_CUBE_MAP,it.TEXTURE_MIN_FILTER,it.LINEAR),it.texParameteri(it.TEXTURE_CUBE_MAP,it.TEXTURE_MAG_FILTER,it.LINEAR);for(let pt=0;pt<6;++pt)it.texImage2D(it.TEXTURE_CUBE_MAP_POSITIVE_X+pt,0,it.RGBA,32,32,0,it.RGBA,it.UNSIGNED_BYTE,null)}nt.bindFramebuffer.set(st.framebuffer),nt.viewport.set([0,0,32,32]);const j=V.getCenter(N,!0),Q=N.useProgram("skyboxCapture"),ct=new Float64Array(16);a.identity(ct),a.rotateY(ct,ct,.5*-Math.PI),ki(nt,V,Q,ct,j,0),a.identity(ct),a.rotateY(ct,ct,.5*Math.PI),ki(nt,V,Q,ct,j,1),a.identity(ct),a.rotateX(ct,ct,.5*-Math.PI),ki(nt,V,Q,ct,j,2),a.identity(ct),a.rotateX(ct,ct,.5*Math.PI),ki(nt,V,Q,ct,j,3),a.identity(ct),ki(nt,V,Q,ct,j,4),a.identity(ct),a.rotateY(ct,ct,Math.PI),ki(nt,V,Q,ct,j,5),nt.viewport.set([0,0,N.width,N.height])}(h,l),l.markSkyboxValid(h)):h.renderPass==="sky"&&function(N,V,Y,tt,nt){const it=N.context,st=it.gl,j=N.transform,Q=N.useProgram("skybox");it.activeTexture.set(st.TEXTURE0),st.bindTexture(st.TEXTURE_CUBE_MAP,V.skyboxTexture);const ct=((pt,It,Ct,St,Bt)=>({u_matrix:pt,u_sun_direction:It,u_cubemap:0,u_opacity:St,u_temporal_offset:Bt}))(j.skyboxMatrix,V.getCenter(N,!1),0,tt,nt);N.prepareDrawProgram(it,Q),Q.draw(it,st.TRIANGLES,Y,a.StencilMode.disabled,N.colorModeForRenderPass(),a.CullFaceMode.backCW,ct,"skybox",V.skyboxGeometry.vertexBuffer,V.skyboxGeometry.indexBuffer,V.skyboxGeometry.segment)}(h,l,P,v,k):S==="gradient"&&h.renderPass==="sky"&&function(N,V,Y,tt,nt){const it=N.context,st=it.gl,j=N.transform,Q=N.useProgram("skyboxGradient");V.skyboxGeometry||(V.skyboxGeometry=new Qo(it)),it.activeTexture.set(st.TEXTURE0);let ct=V.colorRampTexture;ct||(ct=V.colorRampTexture=new a.Texture(it,V.colorRamp,st.RGBA)),ct.bind(st.LINEAR,st.CLAMP_TO_EDGE);const pt=((It,Ct,St,Bt,Nt)=>({u_matrix:It,u_color_ramp:0,u_center_direction:Ct,u_radius:a.degToRad(St),u_opacity:Bt,u_temporal_offset:Nt}))(j.skyboxMatrix,V.getCenter(N,!1),V.paint.get("sky-gradient-radius"),tt,nt);N.prepareDrawProgram(it,Q),Q.draw(it,st.TRIANGLES,Y,a.StencilMode.disabled,N.colorModeForRenderPass(),a.CullFaceMode.backCW,pt,"skyboxGradient",V.skyboxGeometry.vertexBuffer,V.skyboxGeometry.indexBuffer,V.skyboxGeometry.segment)}(h,l,P,v,k)},debug:function(h,n,l){for(let d=0;d<l.length;d++)xa(h,n,l[d])},custom:function(h,n,l,d){const g=h.context,v=l.implementation;if(!h.transform.projection.unsupportedLayers||!h.transform.projection.unsupportedLayers.includes("custom")||h.terrain&&(h.terrain.renderingToTexture||h.renderPass==="offscreen")&&l.isLayerDraped()){if(h.renderPass==="offscreen"){const I=v.prerender;if(I){if(h.setCustomLayerDefaults(),g.setColorMode(h.colorModeForRenderPass()),h.transform.projection.name==="globe"){const S=h.transform.pointMerc;I.call(v,g.gl,h.transform.customLayerMatrix(),h.transform.getProjection(),h.transform.globeToMercatorMatrix(),a.globeToMercatorTransition(h.transform.zoom),[S.x,S.y],h.transform.pixelsPerMeterRatio)}else I.call(v,g.gl,h.transform.customLayerMatrix());g.setDirty(),h.setBaseState()}}else if(h.renderPass==="translucent"){if(h.terrain&&h.terrain.renderingToTexture){const S=v.renderToTile;if(S){const P=d[0].canonical,k=new a.MercatorCoordinate(P.x+d[0].wrap*(1<<P.z),P.y,P.z);g.setDepthMode(a.DepthMode.disabled),g.setStencilMode(a.StencilMode.disabled),g.setColorMode(h.colorModeForRenderPass()),h.setCustomLayerDefaults(),S.call(v,g.gl,k),g.setDirty(),h.setBaseState()}return}h.setCustomLayerDefaults(),g.setColorMode(h.colorModeForRenderPass()),g.setStencilMode(a.StencilMode.disabled);const I=v.renderingMode==="3d"?new a.DepthMode(h.context.gl.LEQUAL,a.DepthMode.ReadWrite,h.depthRangeFor3D):h.depthModeForSublayer(0,a.DepthMode.ReadOnly);if(g.setDepthMode(I),h.transform.projection.name==="globe"){const S=h.transform.pointMerc;v.render(g.gl,h.transform.customLayerMatrix(),h.transform.getProjection(),h.transform.globeToMercatorMatrix(),a.globeToMercatorTransition(h.transform.zoom),[S.x,S.y],h.transform.pixelsPerMeterRatio)}else v.render(g.gl,h.transform.customLayerMatrix());g.setDirty(),h.setBaseState(),g.bindFramebuffer.set(null)}}else a.warnOnce("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")}};class Hn{constructor(n,l,d=!1){this.context=new ge(n,d),this.transform=l,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=a.SourceCache.maxUnderzooming+a.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(n,l){const d=!!n&&!!n.terrain&&this.transform.projection.supportsTerrain;if(!(d||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new yl(this,n));const g=this._terrain;this.transform.elevation=d?g:null,g.update(n,this.transform,l)}_updateFog(n){const l=n.fog;if(!l||this.transform.projection.name==="globe"||l.getOpacity(this.transform.pitch)<1||l.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[d,g]=l.getFovAdjustedRange(this.transform._fov);if(d>g)return void(this.transform.fogCullDistSq=null);const v=d+.78*(g-d);this.transform.fogCullDistSq=v*v}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(n,l){if(this.width=n*a.exported.devicePixelRatio,this.height=l*a.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const d of this.style.order)this.style._layers[d].resize()}setup(){const n=this.context,l=new a.StructArrayLayout2i4;l.emplaceBack(0,0),l.emplaceBack(a.EXTENT,0),l.emplaceBack(0,a.EXTENT),l.emplaceBack(a.EXTENT,a.EXTENT),this.tileExtentBuffer=n.createVertexBuffer(l,a.posAttributes.members),this.tileExtentSegments=a.SegmentVector.simpleSegment(0,0,4,2);const d=new a.StructArrayLayout2i4;d.emplaceBack(0,0),d.emplaceBack(a.EXTENT,0),d.emplaceBack(0,a.EXTENT),d.emplaceBack(a.EXTENT,a.EXTENT),this.debugBuffer=n.createVertexBuffer(d,a.posAttributes.members),this.debugSegments=a.SegmentVector.simpleSegment(0,0,4,5);const g=new a.StructArrayLayout2i4;g.emplaceBack(-1,-1),g.emplaceBack(1,-1),g.emplaceBack(-1,1),g.emplaceBack(1,1),this.viewportBuffer=n.createVertexBuffer(g,a.posAttributes.members),this.viewportSegments=a.SegmentVector.simpleSegment(0,0,4,2);const v=new a.StructArrayLayout4i8;v.emplaceBack(0,0,0,0),v.emplaceBack(a.EXTENT,0,a.EXTENT,0),v.emplaceBack(0,a.EXTENT,0,a.EXTENT),v.emplaceBack(a.EXTENT,a.EXTENT,a.EXTENT,a.EXTENT),this.mercatorBoundsBuffer=n.createVertexBuffer(v,a.boundsAttributes.members),this.mercatorBoundsSegments=a.SegmentVector.simpleSegment(0,0,4,2);const I=new a.StructArrayLayout3ui6;I.emplaceBack(0,1,2),I.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=n.createIndexBuffer(I);const S=new a.StructArrayLayout1ui2;for(const k of[0,1,3,2,0])S.emplaceBack(k);this.debugIndexBuffer=n.createIndexBuffer(S),this.emptyTexture=new a.Texture(n,new a.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),n.gl.RGBA),this.identityMat=a.create();const P=this.context.gl;this.stencilClearMode=new a.StencilMode({func:P.ALWAYS,mask:0},0,255,P.ZERO,P.ZERO,P.ZERO),this.loadTimeStamps.push(a.window.performance.now()),this.atmosphereBuffer=new xn(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(n){return n._makeTileBoundsBuffers(this.context,this.transform.projection),n._tileBoundsBuffer?{tileBoundsBuffer:n._tileBoundsBuffer,tileBoundsIndexBuffer:n._tileBoundsIndexBuffer,tileBoundsSegments:n._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const n=this.context,l=n.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(n,l.TRIANGLES,a.DepthMode.disabled,this.stencilClearMode,a.ColorMode.disabled,a.CullFaceMode.disabled,ds(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(n,l,d){if(!l||this.currentStencilSource===l.id||!n.isTileClipped()||!d||d.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let S=!1;for(const P of d)if(this._tileClippingMaskIDs[P.key]===void 0){S=!0;break}if(!S)return}this.currentStencilSource=l.id;const g=this.context,v=g.gl;this.nextStencilID+d.length>256&&this.clearStencil(),g.setColorMode(a.ColorMode.disabled),g.setDepthMode(a.DepthMode.disabled);const I=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const S of d){const P=l.getTile(S),k=this._tileClippingMaskIDs[S.key]=this.nextStencilID++,{tileBoundsBuffer:N,tileBoundsIndexBuffer:V,tileBoundsSegments:Y}=this.getTileBoundsBuffers(P);I.draw(g,v.TRIANGLES,a.DepthMode.disabled,new a.StencilMode({func:v.ALWAYS,mask:0},k,255,v.KEEP,v.KEEP,v.REPLACE),a.ColorMode.disabled,a.CullFaceMode.disabled,ds(S.projMatrix),"$clipping",N,V,Y)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const n=this.nextStencilID++,l=this.context.gl;return new a.StencilMode({func:l.NOTEQUAL,mask:255},n,255,l.KEEP,l.KEEP,l.REPLACE)}stencilModeForClipping(n){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(n);const l=this.context.gl;return new a.StencilMode({func:l.EQUAL,mask:255},this._tileClippingMaskIDs[n.key],0,l.KEEP,l.KEEP,l.REPLACE)}stencilConfigForOverlap(n){const l=this.context.gl,d=n.sort((I,S)=>S.overscaledZ-I.overscaledZ),g=d[d.length-1].overscaledZ,v=d[0].overscaledZ-g+1;if(v>1){this.currentStencilSource=void 0,this.nextStencilID+v>256&&this.clearStencil();const I={};for(let S=0;S<v;S++)I[S+g]=new a.StencilMode({func:l.GEQUAL,mask:255},S+this.nextStencilID,255,l.KEEP,l.KEEP,l.REPLACE);return this.nextStencilID+=v,[I,d]}return[{[g]:a.StencilMode.disabled},d]}colorModeForRenderPass(){const n=this.context.gl;return this._showOverdrawInspector?new a.ColorMode([n.CONSTANT_COLOR,n.ONE],new a.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?a.ColorMode.unblended:a.ColorMode.alphaBlended}depthModeForSublayer(n,l,d){if(!this.opaquePassEnabledForLayer())return a.DepthMode.disabled;const g=1-((1+this.currentLayer)*this.numSublayers+n)*this.depthEpsilon;return new a.DepthMode(d||this.context.gl.LEQUAL,l,[g,g])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(n,l){this.style=n,this.options=l,this.imageManager=n.imageManager,this.glyphManager=n.glyphManager,this.symbolFadeChange=n.placement.symbolFadeChange(a.exported.now()),this.imageManager.beginFrame();const d=this.style.order,g=this.style._sourceCaches;for(const k in g){const N=g[k];N.used&&N.prepare(this.context)}const v={},I={},S={};for(const k in g){const N=g[k];v[k]=N.getVisibleCoordinates(),I[k]=v[k].slice().reverse(),S[k]=N.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let k=0;k<d.length;k++)if(this.style._layers[d[k]].is3D()){this.opaquePassCutoff=k;break}if(this.terrain&&(this.terrain.updateTileBinding(S),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new a.GlobeSharedBuffers(this.context)),!a.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const k of d){const N=this.style._layers[k],V=n._getLayerSourceCache(N);if(!N.hasOffscreenPass()||N.isHidden(this.transform.zoom))continue;const Y=V?I[V.id]:void 0;(N.type==="custom"||N.isSky()||Y&&Y.length)&&this.renderLayer(this,V,N,Y)}this.depthRangeFor3D=[0,1-(n.order.length+2)*this.numSublayers*this.depthEpsilon];const P=this.terrain;if(P&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&P.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:l.showOverdrawInspector?a.Color.black:a.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=l.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=d.length-1;this.currentLayer>=0;this.currentLayer--){const k=this.style._layers[d[this.currentLayer]],N=n._getLayerSourceCache(k);if(k.isSky())continue;const V=N?I[N.id]:void 0;this._renderTileClippingMasks(k,N,V),this.renderLayer(this,N,k,V)}if(this.style.fog&&this.transform.projection.supportsFog&&function(k,N){const V=k.context,Y=V.gl,tt=k.transform,nt=new a.DepthMode(Y.LEQUAL,a.DepthMode.ReadOnly,[0,1]),it=k.useProgram("globeAtmosphere",null,tt.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),st=a.globeToMercatorTransition(tt.zoom),j=N.properties.get("color").toArray01(),Q=N.properties.get("high-color").toArray01(),ct=N.properties.get("space-color").toArray01PremultipliedAlpha(),pt=a.identity$1([]);a.rotateY$1(pt,pt,-a.degToRad(tt._center.lng)),a.rotateX$1(pt,pt,a.degToRad(tt._center.lat)),a.rotateZ$1(pt,pt,tt.angle),a.rotateX$1(pt,pt,-tt._pitch);const It=a.fromQuat(new Float32Array(16),pt),Ct=a.mapValue(N.properties.get("star-intensity"),0,1,0,.25),St=5e-4,Bt=a.mapValue(N.properties.get("horizon-blend"),0,1,St,.25),Nt=a.globeUseCustomAntiAliasing(k,V,tt)&&Bt===St?tt.worldSize/(2*Math.PI*1.025)-1:tt.globeRadius,Zt=k.frameCounter/1e3%1,ye=a.length(tt.globeCenterInViewSpace),Vt=Math.sqrt(Math.pow(ye,2)-Math.pow(Nt,2)),le=Math.acos(Vt/ye),Qt=((Xt,se,be,fe,Ee,Qe,mr,$e,nr,Gr,kr,Je,hi,Ei)=>({u_frustum_tl:Xt,u_frustum_tr:se,u_frustum_br:be,u_frustum_bl:fe,u_horizon:Ee,u_transition:Qe,u_fadeout_range:mr,u_color:$e,u_high_color:nr,u_space_color:Gr,u_star_intensity:kr,u_star_size:5*a.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:Je,u_horizon_angle:hi,u_rotation_matrix:Ei}))(tt.frustumCorners.TL,tt.frustumCorners.TR,tt.frustumCorners.BR,tt.frustumCorners.BL,tt.frustumCorners.horizon,st,Bt,j,Q,ct,Ct,Zt,le,It);k.prepareDrawProgram(V,it);const _e=k.atmosphereBuffer;_e&&it.draw(V,Y.TRIANGLES,nt,a.StencilMode.disabled,a.ColorMode.alphaBlended,a.CullFaceMode.backCW,Qt,"skybox",_e.vertexBuffer,_e.indexBuffer,_e.segments)}(this,this.style.fog),this.renderPass="sky",(a.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<d.length;this.currentLayer++){const k=this.style._layers[d[this.currentLayer]],N=n._getLayerSourceCache(k);k.isSky()&&this.renderLayer(this,N,k,N?I[N.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<d.length;){const k=this.style._layers[d[this.currentLayer]],N=n._getLayerSourceCache(k);if(k.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(k)){if(k.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const V=N?(k.type==="symbol"?S:I)[N.id]:void 0;this._renderTileClippingMasks(k,N,N?v[N.id]:void 0),this.renderLayer(this,N,k,V),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let k=null;a.values(this.style._layers).forEach(N=>{const V=n._getLayerSourceCache(N);V&&!N.isHidden(this.transform.zoom)&&(!k||k.getSource().maxzoom<V.getSource().maxzoom)&&(k=V)}),k&&this.options.showTileBoundaries&&Vs.debug(this,k,k.getVisibleCoordinates())}this.options.showPadding&&function(k){const N=k.transform.padding;vn(k,k.transform.height-(N.top||0),3,Wi),vn(k,N.bottom||0,3,ko),hn(k,N.left||0,3,$n),hn(k,k.transform.width-(N.right||0),3,au);const V=k.transform.centerPoint;(function(Y,tt,nt,it){Yn(Y,tt-1,nt-10,2,20,it),Yn(Y,tt-10,nt-1,20,2,it)})(k,V.x,k.transform.height-V.y,Us)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(a.window.performance.now()),this.saveCanvasCopy())}renderLayer(n,l,d,g){d.isHidden(this.transform.zoom)||(d.type==="background"||d.type==="sky"||d.type==="custom"||g&&g.length)&&(this.id=d.id,this.gpuTimingStart(d),(!n.transform.projection.unsupportedLayers||!n.transform.projection.unsupportedLayers.includes(d.type)||n.terrain&&d.type==="custom")&&Vs[d.type](n,l,d,g,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(n){if(!this.options.gpuTiming)return;const l=this.context.extTimerQuery;let d=this.gpuTimers[n.id];d||(d=this.gpuTimers[n.id]={calls:0,cpuTime:0,query:l.createQueryEXT()}),d.calls++,l.beginQueryEXT(l.TIME_ELAPSED_EXT,d.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const n=this.context.extTimerQuery,l=n.createQueryEXT();this.deferredRenderGpuTimeQueries.push(l),n.beginQueryEXT(n.TIME_ELAPSED_EXT,l)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const n=this.context.extTimerQuery;n.endQueryEXT(n.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const n=this.context.extTimerQuery;n.endQueryEXT(n.TIME_ELAPSED_EXT)}collectGpuTimers(){const n=this.gpuTimers;return this.gpuTimers={},n}collectDeferredRenderGpuQueries(){const n=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],n}queryGpuTimers(n){const l={};for(const d in n){const g=n[d],v=this.context.extTimerQuery,I=v.getQueryObjectEXT(g.query,v.QUERY_RESULT_EXT)/1e6;v.deleteQueryEXT(g.query),l[d]=I}return l}queryGpuTimeDeferredRender(n){if(!this.options.gpuTimingDeferredRender)return 0;const l=this.context.extTimerQuery;let d=0;for(const g of n)d+=l.getQueryObjectEXT(g,l.QUERY_RESULT_EXT)/1e6,l.deleteQueryEXT(g);return d}translatePosMatrix(n,l,d,g,v){if(!d[0]&&!d[1])return n;const I=v?g==="map"?this.transform.angle:0:g==="viewport"?-this.transform.angle:0;if(I){const k=Math.sin(I),N=Math.cos(I);d=[d[0]*N-d[1]*k,d[0]*k+d[1]*N]}const S=[v?d[0]:tr(l,d[0],this.transform.zoom),v?d[1]:tr(l,d[1],this.transform.zoom),0],P=new Float32Array(16);return a.translate(P,n,S),P}saveTileTexture(n){const l=this._tileTextures[n.size[0]];l?l.push(n):this._tileTextures[n.size[0]]=[n]}getTileTexture(n){const l=this._tileTextures[n];return l&&l.length>0?l.pop():null}isPatternMissing(n){return n===null||n!==void 0&&!this.imageManager.getPattern(n.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const n=this.terrain&&this.terrain.renderingToTexture,l=this.terrain&&this.terrain.exaggeration()===0,d=this.style&&this.style.fog,g=[];return this.terrainRenderModeElevated()&&g.push("TERRAIN"),this.transform.projection.name==="globe"&&g.push("GLOBE"),l&&g.push("ZERO_EXAGGERATION"),d&&!n&&d.getOpacity(this.transform.pitch)!==0&&g.push("FOG"),n&&g.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&g.push("OVERDRAW_INSPECTOR"),g}useProgram(n,l,d){this.cache=this.cache||{};const g=d||[],v=this.currentGlobalDefines().concat(g),I=Mr.cacheKey(Ke[n],n,v,l);return this.cache[I]||(this.cache[I]=new Mr(this.context,n,Ke[n],l,vl[n],v)),this.cache[I]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const n=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(n.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=a.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new a.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(n,l,d){if(this.terrain&&this.terrain.renderingToTexture)return;const g=this.style.fog;if(g){const v=g.getOpacity(this.transform.pitch),I=((S,P,k,N,V,Y,tt,nt,it,st,j)=>{const Q=S.transform,ct=P.properties.get("color").toArray01();ct[3]=N;const pt=S.frameCounter/1e3%1;return{u_fog_matrix:k?Q.calculateFogTileMatrix(k):S.identityMat,u_fog_range:P.getFovAdjustedRange(Q._fov),u_fog_color:ct,u_fog_horizon_blend:P.properties.get("horizon-blend"),u_fog_temporal_offset:pt,u_frustum_tl:V,u_frustum_tr:Y,u_frustum_br:tt,u_frustum_bl:nt,u_globe_pos:it,u_globe_radius:st,u_viewport:j,u_globe_transition:a.globeToMercatorTransition(Q.zoom),u_is_globe:+(Q.projection.name==="globe")}})(this,g,d,v,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*a.exported.devicePixelRatio,this.transform.height*a.exported.devicePixelRatio]);l.setFogUniformValues(n,I)}}setTileLoadedFlag(n){this.tileLoaded=n}saveCanvasCopy(){const n=this.canvasCopy();n&&(this.frameCopies.push(n),this.tileLoaded=!1)}canvasCopy(){const n=this.context.gl,l=n.createTexture();return n.bindTexture(n.TEXTURE_2D,l),n.copyTexImage2D(n.TEXTURE_2D,0,n.RGBA,0,0,n.drawingBufferWidth,n.drawingBufferHeight,0),l}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const n=this.style&&this.style.fog;return!!n&&n.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const n=this._backgroundTiles,l=this._backgroundTiles={},d=this.transform.coveringTiles({tileSize:512});for(const g of d)l[g.key]=n[g.key]||new a.Tile(g,512,this.transform.tileZoom,this);return l}clearBackgroundTiles(){this._backgroundTiles={}}}class Qi{constructor(n=0,l=0,d=0,g=0){if(isNaN(n)||n<0||isNaN(l)||l<0||isNaN(d)||d<0||isNaN(g)||g<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=n,this.bottom=l,this.left=d,this.right=g}interpolate(n,l,d){return l.top!=null&&n.top!=null&&(this.top=a.number(n.top,l.top,d)),l.bottom!=null&&n.bottom!=null&&(this.bottom=a.number(n.bottom,l.bottom,d)),l.left!=null&&n.left!=null&&(this.left=a.number(n.left,l.left,d)),l.right!=null&&n.right!=null&&(this.right=a.number(n.right,l.right,d)),this}getCenter(n,l){const d=a.clamp((this.left+n-this.right)/2,0,n),g=a.clamp((this.top+l-this.bottom)/2,0,l);return new a.Point(d,g)}equals(n){return this.top===n.top&&this.bottom===n.bottom&&this.left===n.left&&this.right===n.right}clone(){return new Qi(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function oo(h,n){const l=a.getColumn(h,3);a.fromQuat(h,n),a.setColumn(h,3,l)}function Lr(h,n){const l=a.identity$1([]);return a.rotateZ$1(l,l,-n),a.rotateX$1(l,l,-h),l}function _s(h,n){const l=[h[0],h[1],0],d=[n[0],n[1],0];if(a.length(l)>=1e-15){const I=a.normalize([],l);a.scale$2(d,I,a.dot(d,I)),n[0]=d[0],n[1]=d[1]}const g=a.cross([],n,h);if(a.len(g)<1e-15)return null;const v=Math.atan2(-g[1],g[0]);return Lr(Math.atan2(Math.sqrt(h[0]*h[0]+h[1]*h[1]),-h[2]),v)}class Bo{constructor(n,l){this.position=n,this.orientation=l}get position(){return this._position}set position(n){if(n){const l=n instanceof a.MercatorCoordinate?n:new a.MercatorCoordinate(n[0],n[1],n[2]);this._renderWorldCopies&&(l.x=a.wrap(l.x,0,1)),this._position=l}else this._position=null}lookAtPoint(n,l){if(this.orientation=null,!this.position)return;const d=this.position,g=this._elevation?this._elevation.getAtPointOrZero(a.MercatorCoordinate.fromLngLat(n)):0,v=a.MercatorCoordinate.fromLngLat(n,g),I=[v.x-d.x,v.y-d.y,v.z-d.z];l||(l=[0,0,1]),l[2]=Math.abs(l[2]),this.orientation=_s(I,l)}setPitchBearing(n,l){this.orientation=Lr(a.degToRad(n),a.degToRad(-l))}}class Ss{constructor(n,l){this._transform=a.identity([]),this.orientation=l,this.position=n}get mercatorPosition(){const n=this.position;return new a.MercatorCoordinate(n[0],n[1],n[2])}get position(){const n=a.getColumn(this._transform,3);return[n[0],n[1],n[2]]}set position(n){var l;n&&a.setColumn(this._transform,3,[(l=n)[0],l[1],l[2],1])}get orientation(){return this._orientation}set orientation(n){this._orientation=n||a.identity$1([]),n&&oo(this._transform,this._orientation)}getPitchBearing(){const n=this.forward(),l=this.right();return{bearing:Math.atan2(-l[1],l[0]),pitch:Math.atan2(Math.sqrt(n[0]*n[0]+n[1]*n[1]),-n[2])}}setPitchBearing(n,l){this._orientation=Lr(n,l),oo(this._transform,this._orientation)}forward(){const n=a.getColumn(this._transform,2);return[-n[0],-n[1],-n[2]]}up(){const n=a.getColumn(this._transform,1);return[-n[0],-n[1],-n[2]]}right(){const n=a.getColumn(this._transform,0);return[n[0],n[1],n[2]]}getCameraToWorld(n,l){const d=new Float64Array(16);return a.invert(d,this.getWorldToCamera(n,l)),d}getWorldToCameraPosition(n,l,d){const g=this.position;a.scale$2(g,g,-n);const v=new Float64Array(16);return a.fromScaling(v,[d,d,d]),a.translate(v,v,g),v[10]*=l,v}getWorldToCamera(n,l){const d=new Float64Array(16),g=new Float64Array(4),v=this.position;return a.conjugate(g,this._orientation),a.scale$2(v,v,-n),a.fromQuat(d,g),a.translate(d,d,v),d[1]*=-1,d[5]*=-1,d[9]*=-1,d[13]*=-1,d[8]*=l,d[9]*=l,d[10]*=l,d[11]*=l,d}getCameraToClipPerspective(n,l,d,g){const v=new Float64Array(16);return a.perspective(v,n,l,d,g),v}getDistanceToElevation(n,l=!1){const d=n===0?0:a.mercatorZfromAltitude(n,l?a.latFromMercatorY(this.position[1]):this.position[1]),g=this.forward();return(d-this.position[2])/g[2]}clone(){return new Ss([...this.position],[...this.orientation])}}function pn(h,n){const l=bi(h.projection,h.zoom,h.width,h.height),d=function(v,I,S,P,k){const N=new a.LngLat(S.lng-180*Cs,S.lat),V=new a.LngLat(S.lng+180*Cs,S.lat),Y=v.project(N.lng,N.lat),tt=v.project(V.lng,V.lat),nt=-Math.atan2(tt.y-Y.y,tt.x-Y.x),it=a.MercatorCoordinate.fromLngLat(S);it.y=a.clamp(it.y,-1+Cs,1-Cs);const st=it.toLngLat(),j=v.project(st.lng,st.lat),Q=a.MercatorCoordinate.fromLngLat(st);Q.x+=Cs;const ct=Q.toLngLat(),pt=v.project(ct.lng,ct.lat),It=bn(pt.x-j.x,pt.y-j.y,nt),Ct=a.MercatorCoordinate.fromLngLat(st);Ct.y+=Cs;const St=Ct.toLngLat(),Bt=v.project(St.lng,St.lat),Nt=bn(Bt.x-j.x,Bt.y-j.y,nt),Zt=Math.abs(It.x)/Math.abs(Nt.y),ye=a.identity([]);a.rotateZ(ye,ye,-nt*(1-(k?0:P)));const Vt=a.identity([]);return a.scale(Vt,Vt,[1,1-(1-Zt)*P,1]),Vt[4]=-Nt.x/Nt.y*P,a.rotateZ(Vt,Vt,nt),a.multiply(Vt,ye,Vt),Vt}(h.projection,0,h.center,l,n),g=ts(h);return a.scale(d,d,[g,g,1]),d}function ts(h){const n=h.projection,l=bi(h.projection,h.zoom,h.width,h.height),d=Fl(n,h.center),g=Fl(n,a.LngLat.convert(n.center));return Math.pow(2,d*l+(1-l)*g)}function bi(h,n,l,d,g=1/0){const v=h.range;if(!v)return 0;const I=Math.min(g,Math.max(l,d)),S=Math.log(I/1024)/Math.LN2;return a.smoothstep(v[0]+S,v[1]+S,n)}const Cs=1/4e4;function Fl(h,n){const l=a.clamp(n.lat,-a.MAX_MERCATOR_LATITUDE,a.MAX_MERCATOR_LATITUDE),d=new a.LngLat(n.lng-180*Cs,l),g=new a.LngLat(n.lng+180*Cs,l),v=h.project(d.lng,l),I=h.project(g.lng,l),S=a.MercatorCoordinate.fromLngLat(d),P=a.MercatorCoordinate.fromLngLat(g),k=I.x-v.x,N=I.y-v.y,V=P.x-S.x,Y=P.y-S.y,tt=Math.sqrt((V*V+Y*Y)/(k*k+N*N));return Math.log(tt)/Math.LN2}function bn(h,n,l){const d=Math.cos(l),g=Math.sin(l);return{x:h*d-n*g,y:h*g+n*d}}class So{constructor(n,l,d,g,v,I,S){this.tileSize=512,this._renderWorldCopies=v===void 0||v,this._minZoom=n||0,this._maxZoom=l||22,this._minPitch=d??0,this._maxPitch=g??60,this.setProjection(I),this.setMaxBounds(S),this.width=0,this.height=0,this._center=new a.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Qi,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new Ss,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const n=new So(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return n._elevation=this._elevation,n._centerAltitude=this._centerAltitude,n._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,n.tileSize=this.tileSize,n.mercatorFromTransition=this.mercatorFromTransition,n.width=this.width,n.height=this.height,n.cameraElevationReference=this.cameraElevationReference,n._center=this._center,n._setZoom(this.zoom),n._seaLevelZoom=this._seaLevelZoom,n.angle=this.angle,n._fov=this._fov,n._pitch=this._pitch,n._nearZ=this._nearZ,n._farZ=this._farZ,n._averageElevation=this._averageElevation,n._unmodified=this._unmodified,n._edgeInsets=this._edgeInsets.clone(),n._camera=this._camera.clone(),n._calcMatrices(),n.freezeTileCoverage=this.freezeTileCoverage,n.frustumCorners=this.frustumCorners,n}get elevation(){return this._elevation}set elevation(n){this._elevation!==n&&(this._elevation=n,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(n,l=!1){const d=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||d)&&this._updateCameraOnTerrain(),(n||d)&&this._constrainCamera(l),this._calcMatrices()}getProjection(){return a.pick(this.projection,["name","center","parallels"])}setProjection(n){this.projectionOptions=n||{name:"mercator"};const l=this.projection?this.getProjection():void 0;this.projection=a.getProjection(this.projectionOptions);const d=!G(l,this.getProjection());return d&&this._calcMatrices(),this.mercatorFromTransition=!1,d}setMercatorFromTransition(){const n=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=a.getProjection({name:"mercator"});const l=n!==this.projection.name;return l&&this._calcMatrices(),l}get minZoom(){return this._minZoom}set minZoom(n){this._minZoom!==n&&(this._minZoom=n,this.zoom=Math.max(this.zoom,n))}get maxZoom(){return this._maxZoom}set maxZoom(n){this._maxZoom!==n&&(this._maxZoom=n,this.zoom=Math.min(this.zoom,n))}get minPitch(){return this._minPitch}set minPitch(n){this._minPitch!==n&&(this._minPitch=n,this.pitch=Math.max(this.pitch,n))}get maxPitch(){return this._maxPitch}set maxPitch(n){this._maxPitch!==n&&(this._maxPitch=n,this.pitch=Math.min(this.pitch,n))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(n){n===void 0?n=!0:n===null&&(n=!1),this._renderWorldCopies=n}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get cameraWorldSize(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return a.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new a.Point(this.width,this.height)}get bearing(){return a.wrap(this.rotation,-180,180)}set bearing(n){this.rotation=n}get rotation(){return-this.angle/Math.PI*180}set rotation(n){const l=-n*Math.PI/180;var d;this.angle!==l&&(this._unmodified=!1,this.angle=l,this._calcMatrices(),this.rotationMatrix=(d=new a.ARRAY_TYPE(4),a.ARRAY_TYPE!=Float32Array&&(d[1]=0,d[2]=0),d[0]=1,d[3]=1,d),function(g,v,I){var S=v[0],P=v[1],k=v[2],N=v[3],V=Math.sin(I),Y=Math.cos(I);g[0]=S*Y+k*V,g[1]=P*Y+N*V,g[2]=S*-V+k*Y,g[3]=P*-V+N*Y}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(n){const l=a.clamp(n,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==l&&(this._unmodified=!1,this._pitch=l,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const n=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/n)}set fov(n){n=Math.max(.01,Math.min(60,n)),this._fov!==n&&(this._unmodified=!1,this._fov=a.degToRad(n),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(n){this._averageElevation=n,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(n){const l=Math.min(Math.max(n,this.minZoom),this.maxZoom);this._zoom!==l&&(this._unmodified=!1,this._setZoom(l),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(n){this._zoom=n,this.scale=this.zoomScale(n),this.tileZoom=Math.floor(n),this.zoomFraction=n-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const n=this._elevation;this._centerAltitude=n.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=n.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const n=this._elevation,l=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],d=this.horizonLineFromTop();let g=0,v=0;for(let I=0;I<l.length;I++){const S=new a.Point(l[I][0]*this.width,d+l[I][1]*(this.height-d)),P=n.pointCoordinate(S);if(!P)continue;const k=1/Math.hypot(P[0]-this._camera.position[0],P[1]-this._camera.position[1]);g+=P[3]*k,v+=k}return v===0?NaN:g/v}get center(){return this._center}set center(n){n.lat===this._center.lat&&n.lng===this._center.lng||(this._unmodified=!1,this._center=n,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const n=this._seaLevelZoom,l=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),d=this.pixelsPerMeter/this.worldSize*l,g=this._mercatorZfromZoom(n),v=this._mercatorZfromZoom(this._maxZoom),I=Math.max(g-d,v);this._setZoom(this._zoomFromMercatorZ(I))}get padding(){return this._edgeInsets.toJSON()}set padding(n){this._edgeInsets.equals(n)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,n,1),this._calcMatrices())}computeZoomRelativeTo(n){const l=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,n.toAltitude()));let d;d=n.z<this._camera.position[2]?[l.x,l.y,l.z]:[n.x,n.y,n.z];const g=a.length(a.sub([],this._camera.position,d));return a.clamp(this._zoomFromMercatorZ(g),this._minZoom,this._maxZoom)}setFreeCameraOptions(n){if(!this.height||!n.position&&!n.orientation)return;this._updateCameraState();let l=!1;if(n.orientation&&!a.exactEquals(n.orientation,this._camera.orientation)&&(l=this._setCameraOrientation(n.orientation)),n.position){const d=[n.position.x,n.position.y,n.position.z];a.exactEquals$1(d,this._camera.position)||(this._setCameraPosition(d),l=!0)}l&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const n=this._camera.position,l=new Bo;return l.position=new a.MercatorCoordinate(n[0],n[1],n[2]),l.orientation=this._camera.orientation,l._elevation=this.elevation,l._renderWorldCopies=this.renderWorldCopies,l}_setCameraOrientation(n){if(!a.length$1(n))return!1;a.normalize$1(n,n);const l=a.transformQuat([],[0,0,-1],n),d=a.transformQuat([],[0,-1,0],n);if(d[2]<0)return!1;const g=_s(l,d);return!!g&&(this._camera.orientation=g,!0)}_setCameraPosition(n){const l=this.zoomScale(this.minZoom)*this.tileSize,d=this.zoomScale(this.maxZoom)*this.tileSize,g=this.cameraToCenterDistance;n[2]=a.clamp(n[2],g/d,g/l),this._camera.position=n}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(n){return this._edgeInsets.equals(n)}interpolatePadding(n,l,d){this._unmodified=!1,this._edgeInsets.interpolate(n,l,d),this._constrain(),this._calcMatrices()}coveringZoomLevel(n){const l=(n.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/n.tileSize));return Math.max(0,l)}getVisibleUnwrappedCoordinates(n){const l=[new a.UnwrappedTileID(0,n)];if(this.renderWorldCopies){const d=this.pointCoordinate(new a.Point(0,0)),g=this.pointCoordinate(new a.Point(this.width,0)),v=this.pointCoordinate(new a.Point(this.width,this.height)),I=this.pointCoordinate(new a.Point(0,this.height)),S=Math.floor(Math.min(d.x,g.x,v.x,I.x)),P=Math.floor(Math.max(d.x,g.x,v.x,I.x)),k=1;for(let N=S-k;N<=P+k;N++)N!==0&&l.push(new a.UnwrappedTileID(N,n))}return l}coveringTiles(n){let l=this.coveringZoomLevel(n);const d=l,g=this.elevation&&!n.isTerrainDEM,v=this.projection.name==="mercator";if(n.minzoom!==void 0&&l<n.minzoom)return[];n.maxzoom!==void 0&&l>n.maxzoom&&(l=n.maxzoom);const I=this.locationCoordinate(this.center),S=this.center.lat,P=1<<l,k=[P*I.x,P*I.y,0],N=this.projection.name==="globe",V=!N,Y=a.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,l,V),tt=N?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),nt=P*a.mercatorZfromAltitude(1,this.center.lat),it=this._camera.position[2]/a.mercatorZfromAltitude(1,this.center.lat),st=[P*tt.x,P*tt.y,it*(V?1:nt)],j=this.cameraToCenterDistance/n.tileSize*(n.roundZoom?1:.502),Q=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?l:0,ct=n.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,pt=n.isTerrainDEM?-ct:this._elevation?this._elevation.getMinElevationBelowMSL():0,It=this.projection.isReprojectedInTileSpace?ts(this):1,Ct=Xt=>{const be=new a.MercatorCoordinate(Xt.x+25e-6,Xt.y,Xt.z),fe=new a.MercatorCoordinate(Xt.x,Xt.y+25e-6,Xt.z),Ee=Xt.toLngLat(),Qe=be.toLngLat(),mr=fe.toLngLat(),$e=this.locationCoordinate(Ee),nr=this.locationCoordinate(Qe),Gr=this.locationCoordinate(mr),kr=Math.hypot(nr.x-$e.x,nr.y-$e.y),Je=Math.hypot(Gr.x-$e.x,Gr.y-$e.y);return Math.sqrt(kr*Je)*It/25e-6},St=Xt=>{const se=ct,be=pt;return{aabb:a.tileAABB(this,P,0,0,0,Xt,be,se,this.projection),zoom:0,x:0,y:0,minZ:be,maxZ:se,wrap:Xt,fullyVisible:!1}},Bt=[];let Nt=[];const Zt=l,ye=n.reparseOverscaled?d:l,Vt=Xt=>Xt*Xt,le=Vt((it-this._centerAltitude)*nt),Qt=Xt=>{if(!this._elevation||!Xt.tileID||!v)return;const se=this._elevation.getMinMaxForTile(Xt.tileID),be=Xt.aabb;se?(be.min[2]=se.min,be.max[2]=se.max,be.center[2]=(be.min[2]+be.max[2])/2):(Xt.shouldSplit=_e(Xt),Xt.shouldSplit||(be.min[2]=be.max[2]=be.center[2]=this._centerAltitude))},_e=Xt=>{if(Xt.zoom<Q)return!0;if(Xt.zoom===Zt)return!1;if(Xt.shouldSplit!=null)return Xt.shouldSplit;const se=Xt.aabb.distanceX(st),be=Xt.aabb.distanceY(st);let fe=le,Ee=1;if(N){fe=Vt(Xt.aabb.distanceZ(st));const $e=Math.pow(2,Xt.zoom),nr=a.latFromMercatorY((Xt.y+1)/$e),Gr=a.latFromMercatorY(Xt.y/$e),kr=Math.min(Math.max(S,nr),Gr),Je=a.circumferenceAtLatitude(kr)/a.circumferenceAtLatitude(S);if(Ee=kr===S?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Je/this._mercatorScaleRatio),this.zoom<=a.GLOBE_ZOOM_THRESHOLD_MIN&&Xt.zoom===Zt-1&&Je>=.9)return!0}else if(g&&(fe=Vt(Xt.aabb.distanceZ(st)*nt)),this.projection.isReprojectedInTileSpace&&d<=5){const $e=Math.pow(2,Xt.zoom),nr=Ct(new a.MercatorCoordinate((Xt.x+.5)/$e,(Xt.y+.5)/$e));Ee=nr>.85?1:nr}const Qe=se*se+be*be+fe,mr=Vt((1<<Zt-Xt.zoom)*j*Ee*(($e,nr)=>{if(nr*Vt(.707)<$e)return 1;const Gr=Math.sqrt(nr/$e);return Gr/(1.4144271570014144+(Math.pow(1.1,Gr-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(fe,le),Qe));return Qe<mr};if(this.renderWorldCopies)for(let Xt=1;Xt<=3;Xt++)Bt.push(St(-Xt)),Bt.push(St(Xt));for(Bt.push(St(0));Bt.length>0;){const Xt=Bt.pop(),se=Xt.x,be=Xt.y;let fe=Xt.fullyVisible;if(!fe){const Ee=Xt.aabb.intersects(Y);if(Ee===0)continue;fe=Ee===2}if(Xt.zoom!==Zt&&_e(Xt))for(let Ee=0;Ee<4;Ee++){const Qe=(se<<1)+Ee%2,mr=(be<<1)+(Ee>>1),$e={aabb:v?Xt.aabb.quadrant(Ee):a.tileAABB(this,P,Xt.zoom+1,Qe,mr,Xt.wrap,Xt.minZ,Xt.maxZ,this.projection),zoom:Xt.zoom+1,x:Qe,y:mr,wrap:Xt.wrap,fullyVisible:fe,tileID:void 0,shouldSplit:void 0,minZ:Xt.minZ,maxZ:Xt.maxZ};g&&!N&&($e.tileID=new a.OverscaledTileID(Xt.zoom+1===Zt?ye:Xt.zoom+1,Xt.wrap,Xt.zoom+1,Qe,mr),Qt($e)),Bt.push($e)}else{const Ee=Xt.zoom===Zt?ye:Xt.zoom;if(n.minzoom&&n.minzoom>Ee)continue;const Qe=k[0]-(.5+se+(Xt.wrap<<Xt.zoom))*(1<<l-Xt.zoom),mr=k[1]-.5-be,$e=Xt.tileID?Xt.tileID:new a.OverscaledTileID(Ee,Xt.wrap,Xt.zoom,se,be);Nt.push({tileID:$e,distanceSq:Qe*Qe+mr*mr})}}if(this.fogCullDistSq){const Xt=this.fogCullDistSq,se=this.horizonLineFromTop();Nt=Nt.filter(be=>{const fe=[0,0,0,1],Ee=[a.EXTENT,a.EXTENT,0,1],Qe=this.calculateFogTileMatrix(be.tileID.toUnwrapped());a.transformMat4$1(fe,fe,Qe),a.transformMat4$1(Ee,Ee,Qe);const mr=a.getAABBPointSquareDist(fe,Ee);if(mr===0)return!0;let $e=!1;const nr=this._elevation;if(nr&&mr>Xt&&se!==0){const Gr=this.calculateProjMatrix(be.tileID.toUnwrapped());let kr;n.isTerrainDEM||(kr=nr.getMinMaxForTile(be.tileID)),kr||(kr={min:pt,max:ct});const Je=a.furthestTileCorner(this.rotation),hi=[Je[0]*a.EXTENT,Je[1]*a.EXTENT,kr.max];a.transformMat4(hi,hi,Gr),$e=(1-hi[1])*this.height*.5<se}return mr<Xt||$e})}return Nt.sort((Xt,se)=>Xt.distanceSq-se.distanceSq).map(Xt=>Xt.tileID)}resize(n,l){this.width=n,this.height=l,this.pixelsToGLUnits=[2/n,-2/l],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(n){return Math.pow(2,n)}scaleZoom(n){return Math.log(n)/Math.LN2}project(n){const l=a.clamp(n.lat,-a.MAX_MERCATOR_LATITUDE,a.MAX_MERCATOR_LATITUDE),d=this.projection.project(n.lng,l);return new a.Point(d.x*this.worldSize,d.y*this.worldSize)}unproject(n){return this.projection.unproject(n.x/this.worldSize,n.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/a.mercatorZfromAltitude(1,this.center.lat)/this.worldSize}setLocationAtPoint(n,l){let d,g;const v=this.centerPoint;if(this.projection.name==="globe"){const S=this.worldSize;d=(l.x-v.x)/S,g=(l.y-v.y)/S}else{const S=this.pointCoordinate(l),P=this.pointCoordinate(v);d=S.x-P.x,g=S.y-P.y}const I=this.locationCoordinate(n);this.setLocation(new a.MercatorCoordinate(I.x-d,I.y-g))}setLocation(n){this.center=this.coordinateLocation(n),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(n){return this.projection.locationPoint(this,n)}locationPoint3D(n){return this.projection.locationPoint(this,n,!0)}pointLocation(n){return this.coordinateLocation(this.pointCoordinate(n))}pointLocation3D(n){return this.coordinateLocation(this.pointCoordinate3D(n))}locationCoordinate(n,l){const d=l?a.mercatorZfromAltitude(l,n.lat):void 0,g=this.projection.project(n.lng,n.lat);return new a.MercatorCoordinate(g.x,g.y,d)}coordinateLocation(n){return this.projection.unproject(n.x,n.y)}pointRayIntersection(n,l){const d=l??this._centerAltitude,g=[n.x,n.y,0,1],v=[n.x,n.y,1,1];a.transformMat4$1(g,g,this.pixelMatrixInverse),a.transformMat4$1(v,v,this.pixelMatrixInverse);const I=v[3];a.scale$1(g,g,1/g[3]),a.scale$1(v,v,1/I);const S=g[2],P=v[2];return{p0:g,p1:v,t:S===P?0:(d-S)/(P-S)}}screenPointToMercatorRay(n){const l=[n.x,n.y,0,1],d=[n.x,n.y,1,1];return a.transformMat4$1(l,l,this.pixelMatrixInverse),a.transformMat4$1(d,d,this.pixelMatrixInverse),a.scale$1(l,l,1/l[3]),a.scale$1(d,d,1/d[3]),l[2]=a.mercatorZfromAltitude(l[2],this._center.lat)*this.worldSize,d[2]=a.mercatorZfromAltitude(d[2],this._center.lat)*this.worldSize,a.scale$1(l,l,1/this.worldSize),a.scale$1(d,d,1/this.worldSize),new a.Ray([l[0],l[1],l[2]],a.normalize([],a.sub([],d,l)))}rayIntersectionCoordinate(n){const{p0:l,p1:d,t:g}=n,v=a.mercatorZfromAltitude(l[2],this._center.lat),I=a.mercatorZfromAltitude(d[2],this._center.lat);return new a.MercatorCoordinate(a.number(l[0],d[0],g)/this.worldSize,a.number(l[1],d[1],g)/this.worldSize,a.number(v,I,g))}pointCoordinate(n,l=this._centerAltitude){return this.projection.pointCoordinate(this,n.x,n.y,l)}pointCoordinate3D(n){if(!this.elevation)return this.pointCoordinate(n);let l=this.projection.pointCoordinate3D(this,n.x,n.y);if(l)return new a.MercatorCoordinate(l[0],l[1],l[2]);let d=0,g=this.horizonLineFromTop();if(n.y>g)return this.pointCoordinate(n);const v=.02*g,I=n.clone();for(let S=0;S<10&&g-d>v;S++){I.y=a.number(d,g,.66);const P=this.projection.pointCoordinate3D(this,I.x,I.y);P?(g=I.y,l=P):d=I.y}return l?new a.MercatorCoordinate(l[0],l[1],l[2]):this.pointCoordinate(n)}isPointAboveHorizon(n){return this.projection.isPointAboveHorizon(this,n)}isPointOnSurface(n){if(n.y<0||n.y>this.height||n.x<0||n.x>this.width)return!1;if(this.elevation||this.zoom>=a.GLOBE_ZOOM_THRESHOLD_MAX)return!this.isPointAboveHorizon(n);const l=this.pointCoordinate(n);return l.y>=0&&l.y<=1}_coordinatePoint(n,l){const d=l&&this.elevation?this.elevation.getAtPointOrZero(n,this._centerAltitude):this._centerAltitude,g=[n.x*this.worldSize,n.y*this.worldSize,d+n.toAltitude(),1];return a.transformMat4$1(g,g,this.pixelMatrix),g[3]>0?new a.Point(g[0]/g[3],g[1]/g[3]):new a.Point(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:n,left:l}=this._edgeInsets,d=this.height-this._edgeInsets.bottom,g=this.width-this._edgeInsets.right,v=this.pointLocation3D(new a.Point(l,n)),I=this.pointLocation3D(new a.Point(g,n)),S=this.pointLocation3D(new a.Point(g,d)),P=this.pointLocation3D(new a.Point(l,d));let k=Math.min(v.lng,I.lng,S.lng,P.lng),N=Math.max(v.lng,I.lng,S.lng,P.lng),V=Math.min(v.lat,I.lat,S.lat,P.lat),Y=Math.max(v.lat,I.lat,S.lat,P.lat);const tt=Math.pow(2,-this.zoom)/16*270,nt=this.projection.name==="globe"?1:4,it=(st,j,Q,ct,pt)=>{const It=(st+Q)/2,Ct=(j+ct)/2,St=new a.Point(It,Ct),{lng:Bt,lat:Nt}=this.pointLocation3D(St),Zt=Math.max(0,k-Bt,V-Nt,Bt-N,Nt-Y);k=Math.min(k,Bt),N=Math.max(N,Bt),V=Math.min(V,Nt),Y=Math.max(Y,Nt),(pt<nt||Zt>tt)&&(it(st,j,It,Ct,pt+1),it(It,Ct,Q,ct,pt+1))};if(it(l,n,g,n,1),it(g,n,g,d,1),it(g,d,l,d,1),it(l,d,l,n,1),this.projection.name==="globe"){const[st,j]=a.polesInViewport(this);st?(Y=90,N=180,k=-180):j&&(V=-90,N=180,k=-180)}return new a.LngLatBounds(new a.LngLat(k,V),new a.LngLat(N,Y))}_getBoundsRectangular(n,l){const{top:d,left:g}=this._edgeInsets,v=this.height-this._edgeInsets.bottom,I=this.width-this._edgeInsets.right,S=new a.Point(g,d),P=new a.Point(I,d),k=new a.Point(I,v),N=new a.Point(g,v);let V=this.pointCoordinate(S,n),Y=this.pointCoordinate(P,n);const tt=this.pointCoordinate(k,l),nt=this.pointCoordinate(N,l),it=(st,j)=>(j.y-st.y)/(j.x-st.x);return V.y>1&&Y.y>=0?V=new a.MercatorCoordinate((1-nt.y)/it(nt,V)+nt.x,1):V.y<0&&Y.y<=1&&(V=new a.MercatorCoordinate(-nt.y/it(nt,V)+nt.x,0)),Y.y>1&&V.y>=0?Y=new a.MercatorCoordinate((1-tt.y)/it(tt,Y)+tt.x,1):Y.y<0&&V.y<=1&&(Y=new a.MercatorCoordinate(-tt.y/it(tt,Y)+tt.x,0)),new a.LngLatBounds().extend(this.coordinateLocation(V)).extend(this.coordinateLocation(Y)).extend(this.coordinateLocation(nt)).extend(this.coordinateLocation(tt))}_getBoundsRectangularTerrain(){const n=this.elevation;if(!n.visibleDemTiles.length||n.isUsingMockSource())return this._getBoundsRectangular(0,0);const l=n.visibleDemTiles.reduce((d,g)=>{if(g.dem){const v=g.dem.tree;d.min=Math.min(d.min,v.minimums[0]),d.max=Math.max(d.max,v.maximums[0])}return d},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(l.min*n.exaggeration(),l.max*n.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(n=!0){const l=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,d=this.height/2-l*(1-this._horizonShift);return n?Math.max(0,d):d}getMaxBounds(){return this.maxBounds}setMaxBounds(n){this.maxBounds=n,this.minLat=-a.MAX_MERCATOR_LATITUDE,this.maxLat=a.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,n&&(this.minLat=n.getSouth(),this.maxLat=n.getNorth(),this.minLng=n.getWest(),this.maxLng=n.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=a.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=a.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=a.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=a.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(n,l){return this.projection.createTileMatrix(this,l,n)}calculateDistanceTileData(n){const l=n.key,d=this._distanceTileDataCache;if(d[l])return d[l];const g=n.canonical,v=1/this.height,I=this.cameraWorldSize,S=I/this.zoomScale(g.z),P=(g.x+Math.pow(2,g.z)*n.wrap)*S,k=g.y*S,N=this.point;N.x*=I/this.worldSize,N.y*=I/this.worldSize;const V=this.angle,Y=Math.sin(-V),tt=-Math.cos(-V);return d[l]={bearing:[Y,tt],center:[(N.x-P)*v,(N.y-k)*v],scale:S/a.EXTENT*v},d[l]}calculateFogTileMatrix(n){const l=n.key,d=this._fogTileMatrixCache;if(d[l])return d[l];const g=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,n);return a.multiply(g,this.worldToFogMatrix,g),d[l]=new Float32Array(g),d[l]}calculateProjMatrix(n,l=!1){const d=n.key,g=l?this._alignedProjMatrixCache:this._projMatrixCache;if(g[d])return g[d];const v=this.calculatePosMatrix(n,this.worldSize);return a.multiply(v,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:l?this.alignedProjMatrix:this.projMatrix,v),g[d]=new Float32Array(v),g[d]}calculatePixelsToTileUnitsMatrix(n){const l=n.tileID.key,d=this._pixelsToTileUnitsCache;if(d[l])return d[l];const g=function(v,I){const{scale:S}=v.tileTransform,P=S*a.EXTENT/(v.tileSize*Math.pow(2,I.zoom-v.tileID.overscaledZ+v.tileID.canonical.z));return k=new Float32Array(4),Y=(N=I.inverseAdjustmentMatrix)[1],tt=N[2],nt=N[3],st=(V=[P,P])[1],k[0]=N[0]*(it=V[0]),k[1]=Y*it,k[2]=tt*st,k[3]=nt*st,k;var k,N,V,Y,tt,nt,it,st}(n,this);return d[l]=g,d[l]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const n=1/this.worldSize,l=a.fromScaling([],[n,n,n]);return a.multiply(l,l,this.globeMatrix),l}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const n=this._elevation;this._updateCameraState();const l=a.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,d=this._computeCameraPosition(l),g=this._camera.forward(),v=a.mercatorZfromAltitude(1,this._center.lat);d[2]/=v,g[2]/=v,a.normalize(g,g);const I=n.raycast(d,g,n.exaggeration());if(I){const S=a.scaleAndAdd([],d,g,I),P=new a.MercatorCoordinate(S[0],S[1],a.mercatorZfromAltitude(S[2],a.latFromMercatorY(S[1]))),k=(P.z+a.length([P.x-d[0],P.y-d[1],P.z-d[2]*v]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(k),this._centerAltitude=P.toAltitude(),this._center=this.coordinateLocation(P),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(n=!1){if(!this._elevation)return;const l=this._elevation,d=a.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,g=this._computeCameraPosition(d),v=l.getAtPointOrZero(new a.MercatorCoordinate(...g)),I=this.pixelsPerMeter/this.worldSize*v,S=this._minimumHeightOverTerrain(),P=g[2]-I;if(P<=S)if(P<0||n){const k=this.locationCoordinate(this._center,this._centerAltitude),N=[g[0],g[1],k.z-g[2]],V=a.length(N);N[2]-=(S-P)/this._pixelsPerMercatorPixel;const Y=a.length(N);if(Y===0)return;a.scale$2(N,N,V/Y*this._pixelsPerMercatorPixel),this._camera.position=[g[0],g[1],k.z*this._pixelsPerMercatorPixel-N[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const n=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||n){const Y=this.center;return Y.lat=a.clamp(Y.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!n)&&(Y.lng=a.clamp(Y.lng,this.minLng,this.maxLng)),this.center=Y,void(this._constraining=!1)}const l=this._unmodified,{x:d,y:g}=this.point;let v=0,I=d,S=g;const P=this.width/2,k=this.height/2,N=this.worldMinY*this.scale,V=this.worldMaxY*this.scale;if(g-k<N&&(S=N+k),g+k>V&&(S=V-k),V-N<this.height&&(v=Math.max(v,this.height/(V-N)),S=(V+N)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const Y=this.worldMinX*this.scale,tt=this.worldMaxX*this.scale,nt=this.worldSize/2-(Y+tt)/2;I=(d+nt+this.worldSize)%this.worldSize-nt,I-P<Y&&(I=Y+P),I+P>tt&&(I=tt-P),tt-Y<this.width&&(v=Math.max(v,this.width/(tt-Y)),I=(tt+Y)/2)}I===d&&S===g||(this.center=this.unproject(new a.Point(I,S))),v&&(this.zoom+=this.scaleZoom(v)),this._constrainCamera(),this._unmodified=l,this._constraining=!1}_minZoomForBounds(){let n=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(n=Math.max(n,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),n}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const n=this.centerOffset,l=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=a.mercatorZfromAltitude(1,this.center.lat)/a.mercatorZfromAltitude(1,a.GLOBE_SCALE_MATCH_LATITUDE));const d=bi(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,d),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const g=this.projection.zAxisUnit==="meters"?l:1,v=this._camera.getWorldToCamera(this.worldSize,g),I=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);I[8]=2*-n.x/this.width,I[9]=2*n.y/this.height;let S=a.mul([],I,v);if(this.projection.isReprojectedInTileSpace){const Ct=this.locationCoordinate(this.center),St=a.identity([]);a.translate(St,St,[Ct.x*this.worldSize,Ct.y*this.worldSize,0]),a.multiply(St,St,pn(this)),a.translate(St,St,[-Ct.x*this.worldSize,-Ct.y*this.worldSize,0]),a.multiply(S,S,St),this.inverseAdjustmentMatrix=function(Bt){const Nt=pn(Bt,!0);return $t([],[Nt[0],Nt[1],Nt[4],Nt[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=a.scale([],S,[this.worldSize,this.worldSize,this.worldSize/g,1]),this.projMatrix=S,this.invProjMatrix=a.invert(new Float64Array(16),this.projMatrix);const P=a.invert([],I);this.frustumCorners=a.FrustumCorners.fromInvProjectionMatrix(P,this.horizonLineFromTop(),this.height);const k=new Float32Array(16);a.identity(k),a.scale(k,k,[1,-1,1]),a.rotateX(k,k,this._pitch),a.rotateZ(k,k,this.angle);const N=a.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),V=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;N[8]=2*-n.x/this.width,N[9]=2*(n.y+V)/this.height,this.skyboxMatrix=a.multiply(k,N,k);const Y=this.point,tt=Y.x,nt=Y.y,it=this.width%2/2,st=this.height%2/2,j=Math.cos(this.angle),Q=Math.sin(this.angle),ct=tt-Math.round(tt)+j*it+Q*st,pt=nt-Math.round(nt)+j*st+Q*it,It=new Float64Array(S);if(a.translate(It,It,[ct>.5?ct-1:ct,pt>.5?pt-1:pt,0]),this.alignedProjMatrix=It,S=a.create(),a.scale(S,S,[this.width/2,-this.height/2,1]),a.translate(S,S,[1,-1,0]),this.labelPlaneMatrix=S,S=a.create(),a.scale(S,S,[1,-1,1]),a.translate(S,S,[-1,-1,0]),a.scale(S,S,[2/this.width,2/this.height,1]),this.glCoordMatrix=S,this.pixelMatrix=a.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},S=a.invert(new Float64Array(16),this.pixelMatrix),!S)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=S,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=a.calculateGlobeMatrix(this);const Ct=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=a.transformMat4(Ct,Ct,v),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=S;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const n=this.cameraWorldSizeForFog,l=this.cameraPixelsPerMeter,d=this._camera.position,g=1/this.height/this._pixelsPerMercatorPixel,v=[n,n,l];a.scale$2(v,v,g),a.scale$2(d,d,-1),a.multiply$2(d,d,v);const I=a.create();a.translate(I,I,d),a.scale(I,I,v),this.mercatorFogMatrix=I,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(n,l,g)}_computeCameraPosition(n){const l=(n=n||this.pixelsPerMeter)/this.pixelsPerMeter,d=this._camera.forward(),g=this.point,v=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*l-n/this.worldSize*this._centerAltitude;return[g.x/this.worldSize-d[0]*v,g.y/this.worldSize-d[1]*v,n/this.worldSize*this._centerAltitude-d[2]*v]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(n){const l=this._maxCameraBoundsDistance()*Math.cos(this._pitch),d=this._camera.position[2],g=n[2];let v=1;this.projection.wrap&&(this.center=this.center.wrap()),g>0&&(v=Math.min((l-d)/g,1)),this._camera.position=a.scaleAndAdd([],this._camera.position,n,v),this._updateStateFromCamera()}_updateStateFromCamera(){const n=this._camera.position,l=this._camera.forward(),{pitch:d,bearing:g}=this._camera.getPitchBearing(),v=a.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,I=this._mercatorZfromZoom(this._maxZoom)*Math.cos(a.degToRad(this._maxPitch)),S=Math.max((n[2]-v)/Math.cos(d),I),P=this._zoomFromMercatorZ(S);a.scaleAndAdd(n,n,l,S),this._pitch=a.clamp(d,a.degToRad(this.minPitch),a.degToRad(this.maxPitch)),this.angle=a.wrap(g,-Math.PI,Math.PI),this._setZoom(a.clamp(P,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new a.MercatorCoordinate(n[0],n[1],n[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(n){return Math.pow(2,n)*this.tileSize}_mercatorZfromZoom(n){return this.cameraToCenterDistance/this._worldSizeFromZoom(n)}_minimumHeightOverTerrain(){const n=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(n)}_zoomFromMercatorZ(n){return this.scaleZoom(this.cameraToCenterDistance/(n*this.tileSize))}zoomFromMercatorZAdjusted(n){let l=0,d=a.GLOBE_ZOOM_THRESHOLD_MAX,g=0,v=1/0;for(;d-l>1e-6&&d>l;){const I=l+.5*(d-l),S=this.tileSize*Math.pow(2,I),P=this.getCameraToCenterDistance(this.projection,I,S),k=this.scaleZoom(P/(n*this.tileSize)),N=Math.abs(I-k);N<v&&(v=N,g=I),I<k?l=I:d=I}return g}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(a.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(n,l){const d=Math.min(n.x,l.x),g=Math.max(n.x,l.x),v=Math.min(n.y,l.y),I=Math.max(n.y,l.y);if(v<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const S=[new a.Point(d,v),new a.Point(g,I),new a.Point(d,I),new a.Point(g,v)],P=this.renderWorldCopies?-3:0,k=this.renderWorldCopies?4:1;for(const N of S){const V=this.pointRayIntersection(N);if(V.t<0)return!0;const Y=this.rayIntersectionCoordinate(V);if(Y.x<P||Y.y<0||Y.x>k||Y.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+a.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new a.Point(0,0),new a.Point(this.width,this.height))}zoomDeltaToMovement(n,l){const d=a.length(a.sub([],this._camera.position,n)),g=this._zoomFromMercatorZ(d)+l;return d-this._mercatorZfromZoom(g)}getCameraPoint(){if(this.projection.name==="globe"){const n=function([l,d,g],v){const I=[l,d,g,1];a.transformMat4$1(I,I,v);const S=I[3]=Math.max(I[3],1e-6);return I[0]/=S,I[1]/=S,I[2]/=S,I}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new a.Point(n[0],n[1])}{const n=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.Point(0,n))}}getCameraToCenterDistance(n,l=this.zoom,d=this.worldSize){const g=bi(n,l,this.width,this.height,1024),v=n.pixelSpaceConversion(this.center.lat,d,g);return .5/Math.tan(.5*this._fov)*this.height*v}getWorldToCameraMatrix(){const n=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&a.multiply(n,n,this.globeMatrix),n}}function ia(h,n){let l=!1,d=null;const g=()=>{d=null,l&&(h(),d=setTimeout(g,n),l=!1)};return()=>(l=!0,d||g(),d)}class Gs{constructor(n){this._hashName=n&&encodeURIComponent(n),a.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=ia(this._updateHashUnthrottled.bind(this),300)}addTo(n){return this._map=n,a.window.addEventListener("hashchange",this._onHashChange,!1),n.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),a.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const n=this._map;if(!n)return"";const l=Fo(n);if(this._hashName){const d=this._hashName;let g=!1;const v=a.window.location.hash.slice(1).split("&").map(I=>{const S=I.split("=")[0];return S===d?(g=!0,`${S}=${l}`):I}).filter(I=>I);return g||v.push(`${d}=${l}`),`#${v.join("&")}`}return`#${l}`}_getCurrentHash(){const n=a.window.location.hash.replace("#","");if(this._hashName){let l;return n.split("&").map(d=>d.split("=")).forEach(d=>{d[0]===this._hashName&&(l=d)}),(l&&l[1]||"").split("/")}return n.split("/")}_onHashChange(){const n=this._map;if(!n)return!1;const l=this._getCurrentHash();if(l.length>=3&&!l.some(d=>isNaN(d))){const d=n.dragRotate.isEnabled()&&n.touchZoomRotate.isEnabled()?+(l[3]||0):n.getBearing();return n.jumpTo({center:[+l[2],+l[1]],zoom:+l[0],bearing:d,pitch:+(l[4]||0)}),!0}return!1}_updateHashUnthrottled(){const n=a.window.location.href.replace(/(#.+)?$/,this.getHashString());a.window.history.replaceState(a.window.history.state,null,n)}}function Fo(h,n){const l=h.getCenter(),d=Math.round(100*h.getZoom())/100,g=Math.ceil((d*Math.LN2+Math.log(512/360/.5))/Math.LN10),v=Math.pow(10,g),I=Math.round(l.lng*v)/v,S=Math.round(l.lat*v)/v,P=h.getBearing(),k=h.getPitch();let N=n?`/${I}/${S}/${d}`:`${d}/${S}/${I}`;return(P||k)&&(N+="/"+Math.round(10*P)/10),k&&(N+=`/${Math.round(k)}`),N}const Yi={linearity:.3,easing:a.bezier(0,0,.3,1)},wn=a.extend({deceleration:2500,maxSpeed:1400},Yi),na=a.extend({deceleration:20,maxSpeed:1400},Yi),Le=a.extend({deceleration:1e3,maxSpeed:360},Yi),Uo=a.extend({deceleration:1e3,maxSpeed:90},Yi);class rl{constructor(n){this._map=n,this.clear()}clear(){this._inertiaBuffer=[]}record(n){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:a.exported.now(),settings:n})}_drainInertiaBuffer(){const n=this._inertiaBuffer,l=a.exported.now();for(;n.length>0&&l-n[0].time>160;)n.shift()}_onMoveEnd(n){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const l={zoom:0,bearing:0,pitch:0,pan:new a.Point(0,0),pinchAround:void 0,around:void 0};for(const{settings:v}of this._inertiaBuffer)l.zoom+=v.zoomDelta||0,l.bearing+=v.bearingDelta||0,l.pitch+=v.pitchDelta||0,v.panDelta&&l.pan._add(v.panDelta),v.around&&(l.around=v.around),v.pinchAround&&(l.pinchAround=v.pinchAround);const d=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,g={};if(l.pan.mag()){const v=il(l.pan.mag(),d,a.extend({},wn,n||{}));g.offset=l.pan.mult(v.amount/l.pan.mag()),g.center=this._map.transform.center,tn(g,v)}if(l.zoom){const v=il(l.zoom,d,na);g.zoom=this._map.transform.zoom+v.amount,tn(g,v)}if(l.bearing){const v=il(l.bearing,d,Le);g.bearing=this._map.transform.bearing+a.clamp(v.amount,-179,179),tn(g,v)}if(l.pitch){const v=il(l.pitch,d,Uo);g.pitch=this._map.transform.pitch+v.amount,tn(g,v)}if(g.zoom||g.bearing){const v=l.pinchAround===void 0?l.around:l.pinchAround;g.around=v?this._map.unproject(v):this._map.getCenter()}return this.clear(),g.noMoveStart=!0,g}}function tn(h,n){(!h.duration||h.duration<n.duration)&&(h.duration=n.duration,h.easing=n.easing)}function il(h,n,l){const{maxSpeed:d,linearity:g,deceleration:v}=l,I=a.clamp(h*g/(n/1e3),-d,d),S=Math.abs(I)/(v*g);return{easing:l.easing,duration:1e3*S,amount:I*(S/2)}}class wi extends a.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,l,d,g={}){const v=Ft(l.getCanvasContainer(),d),I=l.unproject(v);super(n,a.extend({point:v,lngLat:I,originalEvent:d},g)),this._defaultPrevented=!1,this.target=l}}class Ba extends a.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,l,d){const g=n==="touchend"?d.changedTouches:d.touches,v=Ie(l.getCanvasContainer(),g),I=v.map(P=>l.unproject(P)),S=v.reduce((P,k,N,V)=>P.add(k.div(V.length)),new a.Point(0,0));super(n,{points:v,point:S,lngLats:I,lngLat:l.unproject(S),originalEvent:d}),this._defaultPrevented=!1}}class oa extends a.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,l,d){super(n,{originalEvent:d}),this._defaultPrevented=!1}}class Ul{constructor(n,l){this._map=n,this._clickTolerance=l.clickTolerance}reset(){this._mousedownPos=void 0}wheel(n){return this._firePreventable(new oa(n.type,this._map,n))}mousedown(n,l){return this._mousedownPos=l,this._firePreventable(new wi(n.type,this._map,n))}mouseup(n){this._map.fire(new wi(n.type,this._map,n))}preclick(n){const l=a.extend({},n);l.type="preclick",this._map.fire(new wi(l.type,this._map,l))}click(n,l){this._mousedownPos&&this._mousedownPos.dist(l)>=this._clickTolerance||(this.preclick(n),this._map.fire(new wi(n.type,this._map,n)))}dblclick(n){return this._firePreventable(new wi(n.type,this._map,n))}mouseover(n){this._map.fire(new wi(n.type,this._map,n))}mouseout(n){this._map.fire(new wi(n.type,this._map,n))}touchstart(n){return this._firePreventable(new Ba(n.type,this._map,n))}touchmove(n){this._map.fire(new Ba(n.type,this._map,n))}touchend(n){this._map.fire(new Ba(n.type,this._map,n))}touchcancel(n){this._map.fire(new Ba(n.type,this._map,n))}_firePreventable(n){if(this._map.fire(n),n.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class bl{constructor(n){this._map=n}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(n){this._map.fire(new wi(n.type,this._map,n))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new wi("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(n){this._delayContextMenu?this._contextMenuEvent=n:this._map.fire(new wi(n.type,this._map,n)),this._map.listens("contextmenu")&&n.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class es{constructor(n,l){this._map=n,this._el=n.getCanvasContainer(),this._container=n.getContainer(),this._clickTolerance=l.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(n,l){this.isEnabled()&&n.shiftKey&&n.button===0&&(Ge(),this._startPos=this._lastPos=l,this._active=!0)}mousemoveWindow(n,l){if(!this._active)return;const d=l,g=this._startPos,v=this._lastPos;if(!g||!v||v.equals(d)||!this._box&&d.dist(g)<this._clickTolerance)return;this._lastPos=d,this._box||(this._box=At("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",n));const I=Math.min(g.x,d.x),S=Math.max(g.x,d.x),P=Math.min(g.y,d.y),k=Math.max(g.y,d.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${I}px,${P}px)`,this._box.style.width=S-I+"px",this._box.style.height=k-P+"px")})}mouseupWindow(n,l){if(!this._active)return;const d=this._startPos,g=l;if(d&&n.button===0){if(this.reset(),Et(),d.x!==g.x||d.y!==g.y)return this._map.fire(new a.Event("boxzoomend",{originalEvent:n})),{cameraAnimation:v=>v.fitScreenCoordinates(d,g,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",n)}}keydown(n){this._active&&n.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",n))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Mt(),delete this._startPos,delete this._lastPos}_fireEvent(n,l){return this._map.fire(new a.Event(n,{originalEvent:l}))}}function js(h,n){const l={};for(let d=0;d<h.length;d++)l[h[d].identifier]=n[d];return l}class ys{constructor(n){this.reset(),this.numTouches=n.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(n,l,d){(this.centroid||d.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=n.timeStamp),d.length===this.numTouches&&(this.centroid=function(g){const v=new a.Point(0,0);for(const I of g)v._add(I);return v.div(g.length)}(l),this.touches=js(d,l)))}touchmove(n,l,d){if(this.aborted||!this.centroid)return;const g=js(d,l);for(const v in this.touches){const I=g[v];(!I||I.dist(this.touches[v])>30)&&(this.aborted=!0)}}touchend(n,l,d){if((!this.centroid||n.timeStamp-this.startTime>500)&&(this.aborted=!0),d.length===0){const g=!this.aborted&&this.centroid;if(this.reset(),g)return g}}}class nl{constructor(n){this.singleTap=new ys(n),this.numTaps=n.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(n,l,d){this.singleTap.touchstart(n,l,d)}touchmove(n,l,d){this.singleTap.touchmove(n,l,d)}touchend(n,l,d){const g=this.singleTap.touchend(n,l,d);if(g){const v=n.timeStamp-this.lastTime<500,I=!this.lastTap||this.lastTap.dist(g)<30;if(v&&I||this.reset(),this.count++,this.lastTime=n.timeStamp,this.lastTap=g,this.count===this.numTaps)return this.reset(),g}}}class Fa{constructor(){this._zoomIn=new nl({numTouches:1,numTaps:2}),this._zoomOut=new nl({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(n,l,d){this._zoomIn.touchstart(n,l,d),this._zoomOut.touchstart(n,l,d)}touchmove(n,l,d){this._zoomIn.touchmove(n,l,d),this._zoomOut.touchmove(n,l,d)}touchend(n,l,d){const g=this._zoomIn.touchend(n,l,d),v=this._zoomOut.touchend(n,l,d);return g?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:I=>I.easeTo({duration:300,zoom:I.getZoom()+1,around:I.unproject(g)},{originalEvent:n})}):v?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:I=>I.easeTo({duration:300,zoom:I.getZoom()-1,around:I.unproject(v)},{originalEvent:n})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const qs={0:1,2:2};class Ms{constructor(n){this.reset(),this._clickTolerance=n.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(n,l){return!1}_move(n,l){return{}}mousedown(n,l){if(this._lastPoint)return;const d=de(n);this._correctButton(n,d)&&(this._lastPoint=l,this._eventButton=d)}mousemoveWindow(n,l){const d=this._lastPoint;if(d){if(n.preventDefault(),this._eventButton!=null&&function(g,v){const I=qs[v];return g.buttons===void 0||(g.buttons&I)!==I}(n,this._eventButton))this.reset();else if(this._moved||!(l.dist(d)<this._clickTolerance))return this._moved=!0,this._lastPoint=l,this._move(d,l)}}mouseupWindow(n){this._lastPoint&&de(n)===this._eventButton&&(this._moved&&Et(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class sa extends Ms{mousedown(n,l){super.mousedown(n,l),this._lastPoint&&(this._active=!0)}_correctButton(n,l){return l===0&&!n.ctrlKey}_move(n,l){return{around:l,panDelta:l.sub(n)}}}class As extends Ms{_correctButton(n,l){return l===0&&n.ctrlKey||l===2}_move(n,l){const d=.8*(l.x-n.x);if(d)return this._active=!0,{bearingDelta:d}}contextmenu(n){n.preventDefault()}}class cr extends Ms{_correctButton(n,l){return l===0&&n.ctrlKey||l===2}_move(n,l){const d=-.5*(l.y-n.y);if(d)return this._active=!0,{pitchDelta:d}}contextmenu(n){n.preventDefault()}}class rs{constructor(n,l){this._map=n,this._el=n.getCanvasContainer(),this._minTouches=1,this._clickTolerance=l.clickTolerance||1,this.reset(),a.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new a.Point(0,0)}touchstart(n,l,d){return this._calculateTransform(n,l,d)}touchmove(n,l,d){if(this._active&&!(d.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(d.length===1&&!a.isFullscreen())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return n.cancelable&&n.preventDefault(),this._calculateTransform(n,l,d)}}touchend(n,l,d){this._calculateTransform(n,l,d),this._active&&d.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(n,l,d){d.length>0&&(this._active=!0);const g=js(d,l),v=new a.Point(0,0),I=new a.Point(0,0);let S=0;for(const k in g){const N=g[k],V=this._touches[k];V&&(v._add(N),I._add(N.sub(V)),S++,g[k]=N)}if(this._touches=g,S<this._minTouches||!I.mag())return;const P=I.div(S);return this._sum._add(P),this._sum.mag()<this._clickTolerance?void 0:{around:v.div(S),panDelta:P}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=At("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class Ps{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(n){}_move(n,l,d){return{}}touchstart(n,l,d){this._firstTwoTouches||d.length<2||(this._firstTwoTouches=[d[0].identifier,d[1].identifier],this._start([l[0],l[1]]))}touchmove(n,l,d){const g=this._firstTwoTouches;if(!g)return;n.preventDefault();const[v,I]=g,S=is(d,l,v),P=is(d,l,I);if(!S||!P)return;const k=this._aroundCenter?null:S.add(P).div(2);return this._move([S,P],k,n)}touchend(n,l,d){if(!this._firstTwoTouches)return;const[g,v]=this._firstTwoTouches,I=is(d,l,g),S=is(d,l,v);I&&S||(this._active&&Et(),this.reset())}touchcancel(){this.reset()}enable(n){this._enabled=!0,this._aroundCenter=!!n&&n.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function is(h,n,l){for(let d=0;d<h.length;d++)if(h[d].identifier===l)return n[d]}function Kn(h,n){return Math.log(h/n)/Math.LN2}class Vl extends Ps{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(n){this._startDistance=this._distance=n[0].dist(n[1])}_move(n,l){const d=this._distance;if(this._distance=n[0].dist(n[1]),this._active||!(Math.abs(Kn(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Kn(this._distance,d),pinchAround:l}}}function Jn(h,n){return 180*h.angleWith(n)/Math.PI}class Hi extends Ps{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(n){this._startVector=this._vector=n[0].sub(n[1]),this._minDiameter=n[0].dist(n[1])}_move(n,l){const d=this._vector;if(this._vector=n[0].sub(n[1]),d&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Jn(this._vector,d),pinchAround:l}}_isBelowThreshold(n){this._minDiameter=Math.min(this._minDiameter,n.mag());const l=25/(Math.PI*this._minDiameter)*360,d=this._startVector;if(!d)return!1;const g=Jn(n,d);return Math.abs(g)<l}}function $s(h){return Math.abs(h.y)>Math.abs(h.x)}class Ua extends Ps{constructor(n){super(),this._map=n}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(n){this._lastPoints=n,$s(n[0].sub(n[1]))&&(this._valid=!1)}_move(n,l,d){const g=this._lastPoints;if(!g)return;const v=n[0].sub(g[0]),I=n[1].sub(g[1]);return this._map._cooperativeGestures&&!a.isFullscreen()&&d.touches.length<3||(this._valid=this.gestureBeginsVertically(v,I,d.timeStamp),!this._valid)?void 0:(this._lastPoints=n,this._active=!0,{pitchDelta:(v.y+I.y)/2*-.5})}gestureBeginsVertically(n,l,d){if(this._valid!==void 0)return this._valid;const g=n.mag()>=2,v=l.mag()>=2;if(!g&&!v)return;if(!g||!v)return this._firstMove==null&&(this._firstMove=d),d-this._firstMove<100&&void 0;const I=n.y>0==l.y>0;return $s(n)&&$s(l)&&I}}const r={panStep:100,bearingStep:15,pitchStep:10};class o{constructor(){const n=r;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(n){if(n.altKey||n.ctrlKey||n.metaKey)return;let l=0,d=0,g=0,v=0,I=0;switch(n.keyCode){case 61:case 107:case 171:case 187:l=1;break;case 189:case 109:case 173:l=-1;break;case 37:n.shiftKey?d=-1:(n.preventDefault(),v=-1);break;case 39:n.shiftKey?d=1:(n.preventDefault(),v=1);break;case 38:n.shiftKey?g=1:(n.preventDefault(),I=-1);break;case 40:n.shiftKey?g=-1:(n.preventDefault(),I=1);break;default:return}return this._rotationDisabled&&(d=0,g=0),{cameraAnimation:S=>{const P=S.getZoom();S.easeTo({duration:300,easeId:"keyboardHandler",easing:c,zoom:l?Math.round(P)+l*(n.shiftKey?2:1):P,bearing:S.getBearing()+d*this._bearingStep,pitch:S.getPitch()+g*this._pitchStep,offset:[-v*this._panStep,-I*this._panStep],center:S.getCenter()},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function c(h){return h*(2-h)}const p=4.000244140625;class _{constructor(n,l){this._map=n,this._el=n.getCanvasContainer(),this._handler=l,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,a.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(n){this._defaultZoomRate=n}setWheelZoomRate(n){this._wheelZoomRate=n}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(n){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!n&&n.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(n){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(n.ctrlKey||n.metaKey||this.isZooming()||a.isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let l=n.deltaMode===a.window.WheelEvent.DOM_DELTA_LINE?40*n.deltaY:n.deltaY;const d=a.exported.now(),g=d-(this._lastWheelEventTime||0);this._lastWheelEventTime=d,l!==0&&l%p==0?this._type="wheel":l!==0&&Math.abs(l)<4?this._type="trackpad":g>400?(this._type=null,this._lastValue=l,this._timeout=setTimeout(this._onTimeout,40,n)):this._type||(this._type=Math.abs(g*l)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,l+=this._lastValue)),n.shiftKey&&l&&(l/=4),this._type&&(this._lastWheelEvent=n,this._delta-=l,this._active||this._start(n)),n.preventDefault()}_onTimeout(n){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(n)}_start(n){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const l=Ft(this._el,n);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:l,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const n=this._map.transform;this._type==="wheel"&&n.projection.wrap&&(n._center.lng>=180||n._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const l=()=>n._terrainEnabled()&&this._aroundCoord?n.computeZoomRelativeTo(this._aroundCoord):n.zoom;if(this._delta!==0){const P=this._type==="wheel"&&Math.abs(this._delta)>p?this._wheelZoomRate:this._defaultZoomRate;let k=2/(1+Math.exp(-Math.abs(this._delta*P)));this._delta<0&&k!==0&&(k=1/k);const N=l(),V=Math.pow(2,N),Y=typeof this._targetZoom=="number"?n.zoomScale(this._targetZoom):V;this._targetZoom=Math.min(n.maxZoom,Math.max(n.minZoom,n.scaleZoom(Y*k))),this._type==="wheel"&&(this._startZoom=N,this._easing=this._smoothOutEasing(200)),this._delta=0}const d=typeof this._targetZoom=="number"?this._targetZoom:l(),g=this._startZoom,v=this._easing;let I,S=!1;if(this._type==="wheel"&&g&&v){const P=Math.min((a.exported.now()-this._lastWheelEventTime)/200,1),k=v(P);I=a.number(g,d,k),P<1?this._frameId||(this._frameId=!0):S=!0}else I=d,S=!0;return this._active=!0,S&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!S,zoomDelta:I-l(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(n){let l=a.ease;if(this._prevEase){const d=this._prevEase,g=(a.exported.now()-d.start)/d.duration,v=d.easing(g+.01)-d.easing(g),I=.27/Math.sqrt(v*v+1e-4)*.01,S=Math.sqrt(.0729-I*I);l=a.bezier(I,S,.25,1)}return this._prevEase={start:a.exported.now(),duration:n,easing:l},l}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=At("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(a.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class C{constructor(n,l){this._clickZoom=n,this._tapZoom=l}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class R{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(n,l){return n.preventDefault(),{cameraAnimation:d=>{d.easeTo({duration:300,zoom:d.getZoom()+(n.shiftKey?-1:1),around:d.unproject(l)},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ${constructor(){this._tap=new nl({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(n,l,d){this._swipePoint||(this._tapTime&&n.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?d.length>0&&(this._swipePoint=l[0],this._swipeTouch=d[0].identifier):this._tap.touchstart(n,l,d))}touchmove(n,l,d){if(this._tapTime){if(this._swipePoint){if(d[0].identifier!==this._swipeTouch)return;const g=l[0],v=g.y-this._swipePoint.y;return this._swipePoint=g,n.preventDefault(),this._active=!0,{zoomDelta:v/128}}}else this._tap.touchmove(n,l,d)}touchend(n,l,d){this._tapTime?this._swipePoint&&d.length===0&&this.reset():this._tap.touchend(n,l,d)&&(this._tapTime=n.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class rt{constructor(n,l,d){this._el=n,this._mousePan=l,this._touchPan=d}enable(n){this._inertiaOptions=n||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class bt{constructor(n,l,d){this._pitchWithRotate=n.pitchWithRotate,this._mouseRotate=l,this._mousePitch=d}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Yt{constructor(n,l,d,g){this._el=n,this._touchZoom=l,this._touchRotate=d,this._tapDragZoom=g,this._rotationDisabled=!1,this._enabled=!0}enable(n){this._touchZoom.enable(n),this._rotationDisabled||this._touchRotate.enable(n),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Ht=h=>h.zoom||h.drag||h.pitch||h.rotate;class Re extends a.Event{}class ze{constructor(){this.constants=[1,1,.01],this.radius=0}setup(n,l){const d=a.sub([],l,n);this.radius=a.length(d[2]<0?a.div([],d,this.constants):[d[0],d[1],0])}projectRay(n){a.div(n,n,this.constants),a.normalize(n,n),a.mul$1(n,n,this.constants);const l=a.scale$2([],n,this.radius);if(l[2]>0){const d=a.scale$2([],[0,0,1],a.dot(l,[0,0,1])),g=a.scale$2([],a.normalize([],[l[0],l[1],0]),this.radius),v=a.add([],l,a.scale$2([],a.sub([],a.add([],g,d),l),2));l[0]=v[0],l[1]=v[1]}return l}}function Ve(h){return h.panDelta&&h.panDelta.mag()||h.zoomDelta||h.bearingDelta||h.pitchDelta}class We{constructor(n,l){this._map=n,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new rl(n),this._bearingSnap=l.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new ze,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(l),a.bindAll(["handleEvent","handleWindowEvent"],this);const d=this._el;this._listeners=[[d,"touchstart",{passive:!0}],[d,"touchmove",{passive:!1}],[d,"touchend",void 0],[d,"touchcancel",void 0],[d,"mousedown",void 0],[d,"mousemove",void 0],[d,"mouseup",void 0],[a.window.document,"mousemove",{capture:!0}],[a.window.document,"mouseup",void 0],[d,"mouseover",void 0],[d,"mouseout",void 0],[d,"dblclick",void 0],[d,"click",void 0],[d,"keydown",{capture:!1}],[d,"keyup",void 0],[d,"wheel",{passive:!1}],[d,"contextmenu",void 0],[a.window,"blur",void 0]];for(const[g,v,I]of this._listeners)g.addEventListener(v,g===a.window.document?this.handleWindowEvent:this.handleEvent,I)}destroy(){for(const[n,l,d]of this._listeners)n.removeEventListener(l,n===a.window.document?this.handleWindowEvent:this.handleEvent,d)}_addDefaultHandlers(n){const l=this._map,d=l.getCanvasContainer();this._add("mapEvent",new Ul(l,n));const g=l.boxZoom=new es(l,n);this._add("boxZoom",g);const v=new Fa,I=new R;l.doubleClickZoom=new C(I,v),this._add("tapZoom",v),this._add("clickZoom",I);const S=new $;this._add("tapDragZoom",S);const P=l.touchPitch=new Ua(l);this._add("touchPitch",P);const k=new As(n),N=new cr(n);l.dragRotate=new bt(n,k,N),this._add("mouseRotate",k,["mousePitch"]),this._add("mousePitch",N,["mouseRotate"]);const V=new sa(n),Y=new rs(l,n);l.dragPan=new rt(d,V,Y),this._add("mousePan",V),this._add("touchPan",Y,["touchZoom","touchRotate"]);const tt=new Hi,nt=new Vl;l.touchZoomRotate=new Yt(d,nt,tt,S),this._add("touchRotate",tt,["touchPan","touchZoom"]),this._add("touchZoom",nt,["touchPan","touchRotate"]),this._add("blockableMapEvent",new bl(l));const it=l.scrollZoom=new _(l,this);this._add("scrollZoom",it,["mousePan"]);const st=l.keyboard=new o;this._add("keyboard",st);for(const j of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])n.interactive&&n[j]&&l[j].enable(n[j])}_add(n,l,d){this._handlers.push({handlerName:n,handler:l,allowed:d}),this._handlersById[n]=l}stop(n){if(!this._updatingCamera){for(const{handler:l}of this._handlers)l.reset();this._inertia.clear(),this._fireEvents({},{},n),this._changes=[]}}isActive(){for(const{handler:n}of this._handlers)if(n.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Ht(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(n,l,d){for(const g in n)if(g!==d&&(!l||l.indexOf(g)<0))return!0;return!1}handleWindowEvent(n){this.handleEvent(n,`${n.type}Window`)}_getMapTouches(n){const l=[];for(const d of n)this._el.contains(d.target)&&l.push(d);return l}handleEvent(n,l){this._updatingCamera=!0;const d=n.type==="renderFrame",g=d?void 0:n,v={needsRenderFrame:!1},I={},S={},P=n.touches?this._getMapTouches(n.touches):void 0,k=P?Ie(this._el,P):d?void 0:Ft(this._el,n);for(const{handlerName:Y,handler:tt,allowed:nt}of this._handlers){if(!tt.isEnabled())continue;let it;this._blockedByActive(S,nt,Y)?tt.reset():tt[l||n.type]&&(it=tt[l||n.type](n,k,P),this.mergeHandlerResult(v,I,it,Y,g),it&&it.needsRenderFrame&&this._triggerRenderFrame()),(it||tt.isActive())&&(S[Y]=tt)}const N={};for(const Y in this._previousActiveHandlers)S[Y]||(N[Y]=g);this._previousActiveHandlers=S,(Object.keys(N).length||Ve(v))&&(this._changes.push([v,I,N]),this._triggerRenderFrame()),(Object.keys(S).length||Ve(v))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:V}=v;V&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],V(this._map))}mergeHandlerResult(n,l,d,g,v){if(!d)return;a.extend(n,d);const I={handlerName:g,originalEvent:d.originalEvent||v};d.zoomDelta!==void 0&&(l.zoom=I),d.panDelta!==void 0&&(l.drag=I),d.pitchDelta!==void 0&&(l.pitch=I),d.bearingDelta!==void 0&&(l.rotate=I)}_applyChanges(){const n={},l={},d={};for(const[g,v,I]of this._changes)g.panDelta&&(n.panDelta=(n.panDelta||new a.Point(0,0))._add(g.panDelta)),g.zoomDelta&&(n.zoomDelta=(n.zoomDelta||0)+g.zoomDelta),g.bearingDelta&&(n.bearingDelta=(n.bearingDelta||0)+g.bearingDelta),g.pitchDelta&&(n.pitchDelta=(n.pitchDelta||0)+g.pitchDelta),g.around!==void 0&&(n.around=g.around),g.aroundCoord!==void 0&&(n.aroundCoord=g.aroundCoord),g.pinchAround!==void 0&&(n.pinchAround=g.pinchAround),g.noInertia&&(n.noInertia=g.noInertia),a.extend(l,v),a.extend(d,I);this._updateMapTransform(n,l,d),this._changes=[]}_updateMapTransform(n,l,d){const g=this._map,v=g.transform,I=Q=>[Q.x,Q.y,Q.z];if((Q=>{const ct=this._eventsInProgress.drag;return ct&&!this._handlersById[ct.handlerName].isActive()})()&&!Ve(n)){const Q=v.zoom;v.cameraElevationReference="sea",v.recenterOnTerrain(),v.cameraElevationReference="ground",Q!==v.zoom&&this._map._update(!0)}if(v._isCameraConstrained&&g._stop(!0),!Ve(n))return void this._fireEvents(l,d,!0);let{panDelta:S,zoomDelta:P,bearingDelta:k,pitchDelta:N,around:V,aroundCoord:Y,pinchAround:tt}=n;v._isCameraConstrained&&(P>0&&(P=0),v._isCameraConstrained=!1),tt!==void 0&&(V=tt),(P||(Q=>l[Q]&&!this._eventsInProgress[Q])("drag"))&&V&&(this._dragOrigin=I(v.pointCoordinate3D(V)),this._trackingEllipsoid.setup(v._camera.position,this._dragOrigin)),v.cameraElevationReference="sea",g._stop(!0),V=V||g.transform.centerPoint,k&&(v.bearing+=k),N&&(v.pitch+=N),v._updateCameraState();const nt=[0,0,0];if(S)if(v.projection.name==="mercator"){const Q=this._trackingEllipsoid.projectRay(v.screenPointToMercatorRay(V).dir),ct=this._trackingEllipsoid.projectRay(v.screenPointToMercatorRay(V.sub(S)).dir);nt[0]=ct[0]-Q[0],nt[1]=ct[1]-Q[1]}else{const Q=v.pointCoordinate(V);if(v.projection.name==="globe"){S=S.rotate(-v.angle);const ct=v._pixelsPerMercatorPixel/v.worldSize;nt[0]=-S.x*a.mercatorScale(a.latFromMercatorY(Q.y))*ct,nt[1]=-S.y*a.mercatorScale(v.center.lat)*ct}else{const ct=v.pointCoordinate(V.sub(S));Q&&ct&&(nt[0]=ct.x-Q.x,nt[1]=ct.y-Q.y)}}const it=v.zoom,st=[0,0,0];if(P){const Q=I(Y||v.pointCoordinate3D(V)),ct={dir:a.normalize([],a.sub([],Q,v._camera.position))};if(ct.dir[2]<0){const pt=v.zoomDeltaToMovement(Q,P);a.scale$2(st,ct.dir,pt)}}const j=a.add(nt,nt,st);v._translateCameraConstrained(j),P&&Math.abs(v.zoom-it)>1e-4&&v.recenterOnTerrain(),v.cameraElevationReference="ground",this._map._update(),n.noInertia||this._inertia.record(n),this._fireEvents(l,d,!0)}_fireEvents(n,l,d){const g=Ht(this._eventsInProgress),v=Ht(n),I={};for(const N in n){const{originalEvent:V}=n[N];this._eventsInProgress[N]||(I[`${N}start`]=V),this._eventsInProgress[N]=n[N]}!g&&v&&this._fireEvent("movestart",v.originalEvent);for(const N in I)this._fireEvent(N,I[N]);v&&this._fireEvent("move",v.originalEvent);for(const N in n){const{originalEvent:V}=n[N];this._fireEvent(N,V)}const S={};let P;for(const N in this._eventsInProgress){const{handlerName:V,originalEvent:Y}=this._eventsInProgress[N];this._handlersById[V].isActive()||(delete this._eventsInProgress[N],P=l[V]||Y,S[`${N}end`]=P)}for(const N in S)this._fireEvent(N,S[N]);const k=Ht(this._eventsInProgress);if(d&&(g||v)&&!k){this._updatingCamera=!0;const N=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),V=Y=>Y!==0&&-this._bearingSnap<Y&&Y<this._bearingSnap;N?(V(N.bearing||this._map.getBearing())&&(N.bearing=0),this._map.easeTo(N,{originalEvent:P})):(this._map.fire(new a.Event("moveend",{originalEvent:P})),V(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(n,l){this._map.fire(new a.Event(n,l?{originalEvent:l}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(n=>{this._frameId=void 0,this.handleEvent(new Re("renderFrame",{timeStamp:n})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Vr="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Bi extends a.Evented{constructor(n,l){super(),this._moving=!1,this._zooming=!1,this.transform=n,this._bearingSnap=l.bearingSnap,this._respectPrefersReducedMotion=l.respectPrefersReducedMotion!==!1,a.bindAll(["_renderFrameCallback"],this)}getCenter(){return new a.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(n,l){return this.jumpTo({center:n},l)}panBy(n,l,d){return n=a.Point.convert(n).mult(-1),this.panTo(this.transform.center,a.extend({offset:n},l),d)}panTo(n,l,d){return this.easeTo(a.extend({center:n},l),d)}getZoom(){return this.transform.zoom}setZoom(n,l){return this.jumpTo({zoom:n},l),this}zoomTo(n,l,d){return this.easeTo(a.extend({zoom:n},l),d)}zoomIn(n,l){return this.zoomTo(this.getZoom()+1,n,l),this}zoomOut(n,l){return this.zoomTo(this.getZoom()-1,n,l),this}getBearing(){return this.transform.bearing}setBearing(n,l){return this.jumpTo({bearing:n},l),this}getPadding(){return this.transform.padding}setPadding(n,l){return this.jumpTo({padding:n},l),this}rotateTo(n,l,d){return this.easeTo(a.extend({bearing:n},l),d)}resetNorth(n,l){return this.rotateTo(0,a.extend({duration:1e3},n),l),this}resetNorthPitch(n,l){return this.easeTo(a.extend({bearing:0,pitch:0,duration:1e3},n),l),this}snapToNorth(n,l){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(n,l):this}getPitch(){return this.transform.pitch}setPitch(n,l){return this.jumpTo({pitch:n},l),this}cameraForBounds(n,l){n=a.LngLatBounds.convert(n);const d=l&&l.bearing||0,g=l&&l.pitch||0,v=n.getNorthWest(),I=n.getSouthEast();return this._cameraForBounds(this.transform,v,I,d,g,l)}_extendCameraOptions(n){const l={top:0,bottom:0,right:0,left:0};if(typeof(n=a.extend({padding:l,offset:[0,0],maxZoom:this.transform.maxZoom},n)).padding=="number"){const d=n.padding;n.padding={top:d,bottom:d,right:d,left:d}}return n.padding=a.extend(l,n.padding),n}_minimumAABBFrustumDistance(n,l){const d=l.max[0]-l.min[0],g=l.max[1]-l.min[1];return d/g>n.aspect?d/(2*Math.tan(.5*n.fovX)*n.aspect):g/(2*Math.tan(.5*n.fovY)*n.aspect)}_cameraForBoundsOnGlobe(n,l,d,g,v,I){const S=n.clone(),P=this._extendCameraOptions(I);S.bearing=g,S.pitch=v;const k=a.LngLat.convert(l),N=a.LngLat.convert(d),V=.5*(k.lat+N.lat),Y=.5*(k.lng+N.lng),tt=a.latLngToECEF(V,Y),nt=a.normalize([],tt),it=a.normalize([],a.cross([],nt,[0,1,0])),st=a.cross([],it,nt),j=[it[0],it[1],it[2],0,st[0],st[1],st[2],0,nt[0],nt[1],nt[2],0,0,0,0,1],Q=[tt,a.latLngToECEF(k.lat,k.lng),a.latLngToECEF(N.lat,k.lng),a.latLngToECEF(N.lat,N.lng),a.latLngToECEF(k.lat,N.lng),a.latLngToECEF(V,k.lng),a.latLngToECEF(V,N.lng),a.latLngToECEF(k.lat,Y),a.latLngToECEF(N.lat,Y)];let ct=a.Aabb.fromPoints(Q.map(fe=>[a.dot(it,fe),a.dot(st,fe),a.dot(nt,fe)]));const pt=a.transformMat4([],ct.center,j);a.squaredLength(pt)===0&&a.set(pt,0,0,1),a.normalize(pt,pt),a.scale$2(pt,pt,a.GLOBE_RADIUS),S.center=a.ecefToLatLng(pt);const It=S.getWorldToCameraMatrix(),Ct=a.invert(new Float64Array(16),It);ct=a.Aabb.applyTransform(ct,a.multiply([],It,j)),a.transformMat4(pt,pt,It);const St=.5*(ct.max[2]-ct.min[2]),Bt=this._minimumAABBFrustumDistance(S,ct),Nt=a.scale$2([],[0,0,1],St),Zt=a.add(Nt,pt,Nt),ye=Bt+(S.pitch===0?0:a.distance(pt,Zt)),Vt=S.globeCenterInViewSpace,le=a.sub([],pt,[Vt[0],Vt[1],Vt[2]]);a.normalize(le,le),a.scale$2(le,le,ye);const Qt=a.add([],pt,le);a.transformMat4(Qt,Qt,Ct);const _e=a.earthRadius/a.GLOBE_RADIUS,Xt=a.length(Qt),se=a.mercatorZfromAltitude(Math.max(Xt*_e-a.earthRadius,Number.EPSILON),0),be=Math.min(S.zoomFromMercatorZAdjusted(se),P.maxZoom);return be>.5*(a.GLOBE_ZOOM_THRESHOLD_MIN+a.GLOBE_ZOOM_THRESHOLD_MAX)?(S.setProjection({name:"mercator"}),S.zoom=be,this._cameraForBounds(S,l,d,g,v,I)):{center:S.center,zoom:be,bearing:g,pitch:v}}queryTerrainElevation(n,l){const d=this.transform.elevation;return d?(l=a.extend({},{exaggerated:!0},l),d.getAtPoint(a.MercatorCoordinate.fromLngLat(n),null,l.exaggerated)):null}_cameraForBounds(n,l,d,g,v,I){if(n.projection.name==="globe")return this._cameraForBoundsOnGlobe(n,l,d,g,v,I);const S=n.clone(),P=this._extendCameraOptions(I),k=S.padding;S.bearing=g,S.pitch=v;const N=a.LngLat.convert(l),V=a.LngLat.convert(d),Y=new a.LngLat(N.lng,V.lat),tt=new a.LngLat(V.lng,N.lat),nt=S.project(N),it=S.project(V),st=this.queryTerrainElevation(N),j=this.queryTerrainElevation(V),Q=this.queryTerrainElevation(Y),ct=this.queryTerrainElevation(tt),pt=[[nt.x,nt.y,Math.min(st||0,j||0,Q||0,ct||0)],[it.x,it.y,Math.max(st||0,j||0,Q||0,ct||0)]];let It=a.Aabb.fromPoints(pt);const Ct=S.getWorldToCameraMatrix(),St=a.invert(new Float64Array(16),Ct);It=a.Aabb.applyTransform(It,Ct);const Bt=a.sub([],It.max,It.min),Nt=k.left||0,Zt=k.right||0,ye=k.bottom||0,Vt=k.top||0,{left:le,right:Qt,top:_e,bottom:Xt}=P.padding,se=.5*(Nt+Zt),be=.5*(Vt+ye),fe=Math.min(S.scaleZoom(S.scale*Math.min((S.width-(Nt+Zt+le+Qt))/Bt[0],(S.height-(ye+Vt+Xt+_e))/Bt[1])),P.maxZoom),Ee=S.scale/S.zoomScale(fe);It=new a.Aabb([It.min[0]-(le+se)*Ee,It.min[1]-(Xt+be)*Ee,It.min[2]],[It.max[0]+(Qt+se)*Ee,It.max[1]+(_e+be)*Ee,It.max[2]]);const Qe=.5*Bt[2],mr=this._minimumAABBFrustumDistance(S,It),$e=[0,0,1,0];a.transformMat4$1($e,$e,Ct),a.normalize$2($e,$e);const nr=a.scale$2([],$e,mr+Qe),Gr=a.add([],It.center,nr),kr=(typeof P.offset.x=="number"&&typeof P.offset.y=="number"?new a.Point(P.offset.x,P.offset.y):a.Point.convert(P.offset)).rotate(-a.degToRad(g));It.center[0]-=kr.x*Ee,It.center[1]+=kr.y*Ee,a.transformMat4(It.center,It.center,St),a.transformMat4(Gr,Gr,St);const Je=[It.center[0],It.center[1],Gr[2]*S.pixelsPerMeter];a.scale$2(Je,Je,1/S.worldSize);const hi=a.lngFromMercatorX(Je[0]),Ei=a.latFromMercatorY(Je[1]),Ti=Math.min(S._zoomFromMercatorZ(Je[2]),P.maxZoom),Ii=new a.LngLat(hi,Ei);return S.mercatorFromTransition&&Ti<.5*(a.GLOBE_ZOOM_THRESHOLD_MIN+a.GLOBE_ZOOM_THRESHOLD_MAX)?(S.setProjection({name:"globe"}),S.zoom=Ti,this._cameraForBounds(S,l,d,g,v,I)):{center:Ii,zoom:Ti,bearing:g,pitch:v}}fitBounds(n,l,d){const g=this.cameraForBounds(n,l);return this._fitInternal(g,l,d)}fitScreenCoordinates(n,l,d,g,v){const I=a.Point.convert(n),S=a.Point.convert(l),P=new a.Point(Math.min(I.x,S.x),Math.min(I.y,S.y)),k=new a.Point(Math.max(I.x,S.x),Math.max(I.y,S.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(I,S))return this;const N=this.transform.pointLocation3D(P),V=this.transform.pointLocation3D(k),Y=this.transform.pointLocation3D(new a.Point(P.x,k.y)),tt=this.transform.pointLocation3D(new a.Point(k.x,P.y)),nt=[Math.min(N.lng,V.lng,Y.lng,tt.lng),Math.min(N.lat,V.lat,Y.lat,tt.lat)],it=[Math.max(N.lng,V.lng,Y.lng,tt.lng),Math.max(N.lat,V.lat,Y.lat,tt.lat)],st=g&&g.pitch?g.pitch:this.getPitch(),j=this._cameraForBounds(this.transform,nt,it,d,st,g);return this._fitInternal(j,g,v)}_fitInternal(n,l,d){return n?(delete(l=a.extend(n,l)).padding,l.linear?this.easeTo(l,d):this.flyTo(l,d)):this}jumpTo(n,l){this.stop();const d=n.preloadOnly?this.transform.clone():this.transform;let g=!1,v=!1,I=!1;return"zoom"in n&&d.zoom!==+n.zoom&&(g=!0,d.zoom=+n.zoom),n.center!==void 0&&(d.center=a.LngLat.convert(n.center)),"bearing"in n&&d.bearing!==+n.bearing&&(v=!0,d.bearing=+n.bearing),"pitch"in n&&d.pitch!==+n.pitch&&(I=!0,d.pitch=+n.pitch),n.padding==null||d.isPaddingEqual(n.padding)||(d.padding=n.padding),n.preloadOnly?(this._preloadTiles(d),this):(this.fire(new a.Event("movestart",l)).fire(new a.Event("move",l)),g&&this.fire(new a.Event("zoomstart",l)).fire(new a.Event("zoom",l)).fire(new a.Event("zoomend",l)),v&&this.fire(new a.Event("rotatestart",l)).fire(new a.Event("rotate",l)).fire(new a.Event("rotateend",l)),I&&this.fire(new a.Event("pitchstart",l)).fire(new a.Event("pitch",l)).fire(new a.Event("pitchend",l)),this.fire(new a.Event("moveend",l)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||a.warnOnce(Vr),this.transform.getFreeCameraOptions()}setFreeCameraOptions(n,l){const d=this.transform;if(!d.projection.supportsFreeCamera)return a.warnOnce(Vr),this;this.stop();const g=d.zoom,v=d.pitch,I=d.bearing;d.setFreeCameraOptions(n);const S=g!==d.zoom,P=v!==d.pitch,k=I!==d.bearing;return this.fire(new a.Event("movestart",l)).fire(new a.Event("move",l)),S&&this.fire(new a.Event("zoomstart",l)).fire(new a.Event("zoom",l)).fire(new a.Event("zoomend",l)),k&&this.fire(new a.Event("rotatestart",l)).fire(new a.Event("rotate",l)).fire(new a.Event("rotateend",l)),P&&this.fire(new a.Event("pitchstart",l)).fire(new a.Event("pitch",l)).fire(new a.Event("pitchend",l)),this.fire(new a.Event("moveend",l)),this}easeTo(n,l){this._stop(!1,n.easeId),((n=a.extend({offset:[0,0],duration:500,easing:a.ease},n)).animate===!1||this._prefersReducedMotion(n))&&(n.duration=0);const d=this.transform,g=this.getZoom(),v=this.getBearing(),I=this.getPitch(),S=this.getPadding(),P="zoom"in n?+n.zoom:g,k="bearing"in n?this._normalizeBearing(n.bearing,v):v,N="pitch"in n?+n.pitch:I,V="padding"in n?n.padding:d.padding,Y=a.Point.convert(n.offset);let tt,nt,it;if(d.projection.name==="globe"){const Nt=a.MercatorCoordinate.fromLngLat(d.center),Zt=Y.rotate(-d.angle);Nt.x+=Zt.x/d.worldSize,Nt.y+=Zt.y/d.worldSize;const ye=Nt.toLngLat(),Vt=a.LngLat.convert(n.center||ye);this._normalizeCenter(Vt),tt=d.centerPoint.add(Zt),nt=new a.Point(Nt.x,Nt.y).mult(d.worldSize),it=new a.Point(a.mercatorXfromLng(Vt.lng),a.mercatorYfromLat(Vt.lat)).mult(d.worldSize).sub(nt)}else{tt=d.centerPoint.add(Y);const Nt=d.pointLocation(tt),Zt=a.LngLat.convert(n.center||Nt);this._normalizeCenter(Zt),nt=d.project(Nt),it=d.project(Zt).sub(nt)}const st=d.zoomScale(P-g);let j,Q;n.around&&(j=a.LngLat.convert(n.around),Q=d.locationPoint(j));const ct=this._zooming||P!==g,pt=this._rotating||v!==k,It=this._pitching||N!==I,Ct=!d.isPaddingEqual(V),St=Nt=>Zt=>{if(ct&&(Nt.zoom=a.number(g,P,Zt)),pt&&(Nt.bearing=a.number(v,k,Zt)),It&&(Nt.pitch=a.number(I,N,Zt)),Ct&&(Nt.interpolatePadding(S,V,Zt),tt=Nt.centerPoint.add(Y)),j)Nt.setLocationAtPoint(j,Q);else{const ye=Nt.zoomScale(Nt.zoom-g),Vt=P>g?Math.min(2,st):Math.max(.5,st),le=Math.pow(Vt,1-Zt),Qt=Nt.unproject(nt.add(it.mult(Zt*le)).mult(ye));Nt.setLocationAtPoint(Nt.renderWorldCopies?Qt.wrap():Qt,tt)}return n.preloadOnly||this._fireMoveEvents(l),Nt};if(n.preloadOnly){const Nt=this._emulate(St,n.duration,d);return this._preloadTiles(Nt),this}const Bt={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ct,this._rotating=pt,this._pitching=It,this._padding=Ct,this._easeId=n.easeId,this._prepareEase(l,n.noMoveStart,Bt),this._ease(St(d),Nt=>{d.recenterOnTerrain(),this._afterEase(l,Nt)},n),this}_prepareEase(n,l,d={}){this._moving=!0,this.transform.cameraElevationReference="sea",l||d.moving||this.fire(new a.Event("movestart",n)),this._zooming&&!d.zooming&&this.fire(new a.Event("zoomstart",n)),this._rotating&&!d.rotating&&this.fire(new a.Event("rotatestart",n)),this._pitching&&!d.pitching&&this.fire(new a.Event("pitchstart",n))}_fireMoveEvents(n){this.fire(new a.Event("move",n)),this._zooming&&this.fire(new a.Event("zoom",n)),this._rotating&&this.fire(new a.Event("rotate",n)),this._pitching&&this.fire(new a.Event("pitch",n))}_afterEase(n,l){if(this._easeId&&l&&this._easeId===l)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const d=this._zooming,g=this._rotating,v=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,d&&this.fire(new a.Event("zoomend",n)),g&&this.fire(new a.Event("rotateend",n)),v&&this.fire(new a.Event("pitchend",n)),this.fire(new a.Event("moveend",n))}flyTo(n,l){if(this._prefersReducedMotion(n)){const fe=a.pick(n,["center","zoom","bearing","pitch","around"]);return this.jumpTo(fe,l)}this.stop(),n=a.extend({offset:[0,0],speed:1.2,curve:1.42,easing:a.ease},n);const d=this.transform,g=this.getZoom(),v=this.getBearing(),I=this.getPitch(),S=this.getPadding(),P="zoom"in n?a.clamp(+n.zoom,d.minZoom,d.maxZoom):g,k="bearing"in n?this._normalizeBearing(n.bearing,v):v,N="pitch"in n?+n.pitch:I,V="padding"in n?n.padding:d.padding,Y=d.zoomScale(P-g),tt=a.Point.convert(n.offset);let nt=d.centerPoint.add(tt);const it=d.pointLocation(nt),st=a.LngLat.convert(n.center||it);this._normalizeCenter(st);const j=d.project(it),Q=d.project(st).sub(j);let ct=n.curve;const pt=Math.max(d.width,d.height),It=pt/Y,Ct=Q.mag();if("minZoom"in n){const fe=a.clamp(Math.min(n.minZoom,g,P),d.minZoom,d.maxZoom),Ee=pt/d.zoomScale(fe-g);ct=Math.sqrt(Ee/Ct*2)}const St=ct*ct;function Bt(fe){const Ee=(It*It-pt*pt+(fe?-1:1)*St*St*Ct*Ct)/(2*(fe?It:pt)*St*Ct);return Math.log(Math.sqrt(Ee*Ee+1)-Ee)}function Nt(fe){return(Math.exp(fe)-Math.exp(-fe))/2}function Zt(fe){return(Math.exp(fe)+Math.exp(-fe))/2}const ye=Bt(0);let Vt=function(fe){return Zt(ye)/Zt(ye+ct*fe)},le=function(fe){return pt*((Zt(ye)*(Nt(Ee=ye+ct*fe)/Zt(Ee))-Nt(ye))/St)/Ct;var Ee},Qt=(Bt(1)-ye)/ct;if(Math.abs(Ct)<1e-6||!isFinite(Qt)){if(Math.abs(pt-It)<1e-6)return this.easeTo(n,l);const fe=It<pt?-1:1;Qt=Math.abs(Math.log(It/pt))/ct,le=function(){return 0},Vt=function(Ee){return Math.exp(fe*ct*Ee)}}n.duration="duration"in n?+n.duration:1e3*Qt/("screenSpeed"in n?+n.screenSpeed/ct:+n.speed),n.maxDuration&&n.duration>n.maxDuration&&(n.duration=0);const _e=v!==k,Xt=N!==I,se=!d.isPaddingEqual(V),be=fe=>Ee=>{const Qe=Ee*Qt,mr=1/Vt(Qe);fe.zoom=Ee===1?P:g+fe.scaleZoom(mr),_e&&(fe.bearing=a.number(v,k,Ee)),Xt&&(fe.pitch=a.number(I,N,Ee)),se&&(fe.interpolatePadding(S,V,Ee),nt=fe.centerPoint.add(tt));const $e=Ee===1?st:fe.unproject(j.add(Q.mult(le(Qe))).mult(mr));return fe.setLocationAtPoint(fe.renderWorldCopies?$e.wrap():$e,nt),fe._updateCameraOnTerrain(),n.preloadOnly||this._fireMoveEvents(l),fe};if(n.preloadOnly){const fe=this._emulate(be,n.duration,d);return this._preloadTiles(fe),this}return this._zooming=!0,this._rotating=_e,this._pitching=Xt,this._padding=se,this._prepareEase(l,!1),this._ease(be(d),()=>this._afterEase(l),n),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(n,l){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const d=this._onEaseEnd;this._onEaseEnd=void 0,d.call(this,l)}if(!n){const d=this.handlers;d&&d.stop(!1)}return this}_ease(n,l,d){d.animate===!1||d.duration===0?(n(1),l()):(this._easeStart=a.exported.now(),this._easeOptions=d,this._onEaseFrame=n,this._onEaseEnd=l,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const n=Math.min((a.exported.now()-this._easeStart)/this._easeOptions.duration,1),l=this._onEaseFrame;l&&l(this._easeOptions.easing(n)),n<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(n,l){n=a.wrap(n,-180,180);const d=Math.abs(n-l);return Math.abs(n-360-l)<d&&(n-=360),Math.abs(n+360-l)<d&&(n+=360),n}_normalizeCenter(n){const l=this.transform;if(!l.renderWorldCopies||l.maxBounds)return;const d=n.lng-l.center.lng;n.lng+=d>180?-360:d<-180?360:0}_prefersReducedMotion(n){return this._respectPrefersReducedMotion&&a.exported.prefersReducedMotion&&!(n&&n.essential)}_emulate(n,l,d){const g=Math.ceil(15*l/1e3),v=[],I=n(d.clone());for(let S=0;S<=g;S++){const P=I(S/g);v.push(P.clone())}return v}}class De{constructor(n={}){this.options=n,a.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(n){const l=this.options&&this.options.compact;return this._map=n,this._container=At("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=At("button","mapboxgl-ctrl-attrib-button",this._container),At("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=At("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),l&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),l===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(n,l){const d=this._map._getUIString(`AttributionControl.${l}`);n.setAttribute("aria-label",d),n.removeAttribute("title"),n.firstElementChild&&n.firstElementChild.setAttribute("title",d)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let n=this._editLink;n||(n=this._editLink=this._container.querySelector(".mapbox-improve-map"));const l=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||a.config.ACCESS_TOKEN}];if(n){const d=l.reduce((g,v,I)=>(v.value&&(g+=`${v.key}=${v.value}${I<l.length-1?"&":""}`),g),"?");n.href=`${a.config.FEEDBACK_URL}/${d}#${Fo(this._map,!0)}`,n.rel="noopener nofollow",this._setElementTitle(n,"MapFeedback")}}_updateData(n){!n||n.sourceDataType!=="metadata"&&n.sourceDataType!=="visibility"&&n.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let n=[];if(this._map.style.stylesheet){const g=this._map.style.stylesheet;this.styleOwner=g.owner,this.styleId=g.id}const l=this._map.style._sourceCaches;for(const g in l){const v=l[g];if(v.used){const I=v.getSource();I.attribution&&n.indexOf(I.attribution)<0&&n.push(I.attribution)}}n.sort((g,v)=>g.length-v.length),n=n.filter((g,v)=>{for(let I=v+1;I<n.length;I++)if(n[I].indexOf(g)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?n=[...this.options.customAttribution,...n]:n.unshift(this.options.customAttribution));const d=n.join(" | ");d!==this._attribHTML&&(this._attribHTML=d,n.length?(this._innerContainer.innerHTML=d,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Vo{constructor(){a.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(n){this._map=n,this._container=At("div","mapboxgl-ctrl");const l=At("a","mapboxgl-ctrl-logo");return l.target="_blank",l.rel="noopener nofollow",l.href="https://www.mapbox.com/",l.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),l.setAttribute("rel","noopener nofollow"),this._container.appendChild(l),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(n){n&&n.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const n=this._map.style._sourceCaches;if(Object.entries(n).length===0)return!0;for(const l in n){const d=n[l].getSource();if(d.hasOwnProperty("mapbox_logo")&&!d.mapbox_logo)return!1}return!0}_updateCompact(){const n=this._container.children;if(n.length){const l=n[0];this._map.getCanvasContainer().offsetWidth<250?l.classList.add("mapboxgl-compact"):l.classList.remove("mapboxgl-compact")}}}class vs{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(n){const l=++this._id;return this._queue.push({callback:n,id:l,cancelled:!1}),l}remove(n){const l=this._currentlyRunning,d=l?this._queue.concat(l):this._queue;for(const g of d)if(g.id===n)return void(g.cancelled=!0)}run(n=0){const l=this._currentlyRunning=this._queue;this._queue=[];for(const d of l)if(!d.cancelled&&(d.callback(n),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function aa(h,n,l){if(h=new a.LngLat(h.lng,h.lat),n){const d=new a.LngLat(h.lng-360,h.lat),g=new a.LngLat(h.lng+360,h.lat),v=360*Math.ceil(Math.abs(h.lng-l.center.lng)/360),I=l.locationPoint(h).distSqr(n),S=n.x<0||n.y<0||n.x>l.width||n.y>l.height;l.locationPoint(d).distSqr(n)<I&&(S||Math.abs(d.lng-l.center.lng)<v)?h=d:l.locationPoint(g).distSqr(n)<I&&(S||Math.abs(g.lng-l.center.lng)<v)&&(h=g)}for(;Math.abs(h.lng-l.center.lng)>180;){const d=l.locationPoint(h);if(d.x>=0&&d.y>=0&&d.x<=l.width&&d.y<=l.height)break;h.lng>l.center.lng?h.lng-=360:h.lng+=360}return h}const ol={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Ue extends a.Evented{constructor(n,l){if(super(),(n instanceof a.window.HTMLElement||l)&&(n=a.extend({element:n},l)),a.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=n&&n.anchor||"center",this._color=n&&n.color||"#3FB1CE",this._scale=n&&n.scale||1,this._draggable=n&&n.draggable||!1,this._clickTolerance=n&&n.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=n&&n.rotation||0,this._rotationAlignment=n&&n.rotationAlignment||"auto",this._pitchAlignment=n&&n.pitchAlignment&&n.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=n&&n.occludedOpacity||.2,n&&n.element)this._element=n.element,this._offset=a.Point.convert(n&&n.offset||[0,0]);else{this._defaultMarker=!0,this._element=At("div");const g=41,v=27,I=qt("svg",{display:"block",height:g*this._scale+"px",width:v*this._scale+"px",viewBox:`0 0 ${v} ${g}`},this._element),S=qt("radialGradient",{id:"shadowGradient"},qt("defs",{},I));qt("stop",{offset:"10%","stop-opacity":.4},S),qt("stop",{offset:"100%","stop-opacity":.05},S),qt("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},I),qt("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},I),qt("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},I),qt("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},I),this._offset=a.Point.convert(n&&n.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",g=>{g.preventDefault()}),this._element.addEventListener("mousedown",g=>{g.preventDefault()});const d=this._element.classList;for(const g in ol)d.remove(`mapboxgl-marker-anchor-${g}`);d.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(n){return n===this._map||(this.remove(),this._map=n,n.getCanvasContainer().appendChild(this._element),n.on("move",this._updateMoving),n.on("moveend",this._update),n.on("remove",this._clearFadeTimer),n._addMarker(this),this.setDraggable(this._draggable),this._update(),n.on("click",this._onMapClick)),this}remove(){const n=this._map;return n&&(n.off("click",this._onMapClick),n.off("move",this._updateMoving),n.off("moveend",this._update),n.off("mousedown",this._addDragHandler),n.off("touchstart",this._addDragHandler),n.off("mouseup",this._onUp),n.off("touchend",this._onUp),n.off("mousemove",this._onMove),n.off("touchmove",this._onMove),n.off("remove",this._clearFadeTimer),n._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(n){return this._lngLat=a.LngLat.convert(n),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(n){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),n){if(!("offset"in n.options)){const g=Math.sqrt(Math.pow(13.5,2)/2);n.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[g,-1*(38.1-13.5+g)],"bottom-right":[-g,-1*(38.1-13.5+g)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=n,n._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(n){const l=n.code,d=n.charCode||n.keyCode;l!=="Space"&&l!=="Enter"&&d!==32&&d!==13||this.togglePopup()}_onMapClick(n){const l=n.originalEvent.target,d=this._element;this._popup&&(l===d||d.contains(l))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const n=this._popup;return n?(n.isOpen()?(n.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(n.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const n=this._map,l=this._pos;if(!n||!l)return!1;const d=n.unproject(l),g=n.getFreeCameraOptions();if(!g.position)return!1;const v=g.position.toLngLat();return v.distanceTo(d)<.9*v.distanceTo(this._lngLat)}_evaluateOpacity(){const n=this._map;if(!n)return;const l=this._pos;if(!l||l.x<0||l.x>n.transform.width||l.y<0||l.y>n.transform.height)return void this._clearFadeTimer();const d=n.unproject(l);let g;n._showingGlobe()&&a.isLngLatBehindGlobe(n.transform,this._lngLat)?g=0:(g=1-n._queryFogOpacity(d),n.transform._terrainEnabled()&&n.getTerrain()&&this._behindTerrain()&&(g*=this._occludedOpacity)),this._element.style.opacity=`${g}`,this._element.style.pointerEvents=g>0?"auto":"none",this._popup&&this._popup._setOpacity(g),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const n=this._pos;if(!n||!this._map)return;const l=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${n.x}px,${n.y}px)
            ${ol[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${l.x}px,${l.y}px)
        `}_calculateXYTransform(){const n=this._pos,l=this._map,d=this.getPitchAlignment();if(!l||!n||d!=="map")return"";if(!l._showingGlobe()){const P=l.getPitch();return P?`rotateX(${P}deg)`:""}const g=a.radToDeg(a.globeTiltAtLngLat(l.transform,this._lngLat)),v=n.sub(a.globeCenterToScreenPoint(l.transform)),I=Math.abs(v.x)+Math.abs(v.y);if(I===0)return"";const S=g/I;return`rotateX(${-v.y*S}deg) rotateY(${v.x*S}deg)`}_calculateZTransform(){const n=this._pos,l=this._map;if(!l||!n)return"";let d=0;const g=this.getRotationAlignment();if(g==="map")if(l._showingGlobe()){const v=l.project(new a.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),I=l.project(new a.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(v);d=a.radToDeg(Math.atan2(I.y,I.x))-90}else d=-l.getBearing();else if(g==="horizon"){const v=a.smoothstep(4,6,l.getZoom()),I=a.globeCenterToScreenPoint(l.transform);I.y+=v*l.transform.height;const S=n.sub(I),P=a.radToDeg(Math.atan2(S.y,S.x));d=(P>90?P-270:P+90)*(1-v)}return d+=this._rotation,d?`rotateZ(${d}deg)`:""}_update(n){a.window.cancelAnimationFrame(this._updateFrameId);const l=this._map;l&&(l.transform.renderWorldCopies&&(this._lngLat=aa(this._lngLat,this._pos,l.transform)),this._pos=l.project(this._lngLat),n===!0?this._updateFrameId=a.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),l._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(l._showingGlobe()||l.getTerrain()||l.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(n){return this._offset=a.Point.convert(n),this._update(),this}_onMove(n){const l=this._map;if(!l)return;const d=this._pointerdownPos,g=this._positionDelta;if(d&&g){if(!this._isDragging){const v=this._clickTolerance||l._clickTolerance;if(n.point.dist(d)<v)return;this._isDragging=!0}this._pos=n.point.sub(g),this._lngLat=l.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new a.Event("dragstart"))),this.fire(new a.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const n=this._map;n&&(n.off("mousemove",this._onMove),n.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new a.Event("dragend")),this._state="inactive"}_addDragHandler(n){const l=this._map,d=this._pos;l&&d&&this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(d),this._pointerdownPos=n.point,this._state="pending",l.on("mousemove",this._onMove),l.on("touchmove",this._onMove),l.once("mouseup",this._onUp),l.once("touchend",this._onUp))}setDraggable(n){this._draggable=!!n;const l=this._map;return l&&(n?(l.on("mousedown",this._addDragHandler),l.on("touchstart",this._addDragHandler)):(l.off("mousedown",this._addDragHandler),l.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(n){return this._rotation=n||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(n){return this._rotationAlignment=n||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(n){return this._pitchAlignment=n||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(n){return this._occludedOpacity=n||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Ju={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},xp=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function ah(h=new a.Point(0,0),n="bottom"){if(typeof h=="number"){const l=Math.round(Math.sqrt(.5*Math.pow(h,2)));switch(n){case"top":return new a.Point(0,h);case"top-left":return new a.Point(l,l);case"top-right":return new a.Point(-l,l);case"bottom":return new a.Point(0,-h);case"bottom-left":return new a.Point(l,-l);case"bottom-right":return new a.Point(-l,-l);case"left":return new a.Point(h,0);case"right":return new a.Point(-h,0)}return new a.Point(0,0)}return h instanceof a.Point||Array.isArray(h)?a.Point.convert(h):a.Point.convert(h[n]||[0,0])}class Qu{constructor(n){this.jumpTo(n)}getValue(n){if(n<=this._startTime)return this._start;if(n>=this._endTime)return this._end;const l=a.easeCubicInOut((n-this._startTime)/(this._endTime-this._startTime));return this._start*(1-l)+this._end*l}isEasing(n){return n>=this._startTime&&n<=this._endTime}jumpTo(n){this._startTime=-1/0,this._endTime=-1/0,this._start=n,this._end=n}easeTo(n,l,d){this._start=this.getValue(l),this._end=n,this._startTime=l,this._endTime=l+d}}const lh={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},uh={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0},bp={showCompass:!0,showZoom:!0,visualizePitch:!1};class wp{constructor(n,l,d=!1){this._clickTolerance=10,this.element=l,this.mouseRotate=new As({clickTolerance:n.dragRotate._mouseRotate._clickTolerance}),this.map=n,d&&(this.mousePitch=new cr({clickTolerance:n.dragRotate._mousePitch._clickTolerance})),a.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),l.addEventListener("mousedown",this.mousedown),l.addEventListener("touchstart",this.touchstart,{passive:!1}),l.addEventListener("touchmove",this.touchmove),l.addEventListener("touchend",this.touchend),l.addEventListener("touchcancel",this.reset)}down(n,l){this.mouseRotate.mousedown(n,l),this.mousePitch&&this.mousePitch.mousedown(n,l),Ge()}move(n,l){const d=this.map,g=this.mouseRotate.mousemoveWindow(n,l),v=g&&g.bearingDelta;if(v&&d.setBearing(d.getBearing()+v),this.mousePitch){const I=this.mousePitch.mousemoveWindow(n,l),S=I&&I.pitchDelta;S&&d.setPitch(d.getPitch()+S)}}off(){const n=this.element;n.removeEventListener("mousedown",this.mousedown),n.removeEventListener("touchstart",this.touchstart,{passive:!1}),n.removeEventListener("touchmove",this.touchmove),n.removeEventListener("touchend",this.touchend),n.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Mt(),a.window.removeEventListener("mousemove",this.mousemove),a.window.removeEventListener("mouseup",this.mouseup)}mousedown(n){this.down(a.extend({},n,{ctrlKey:!0,preventDefault:()=>n.preventDefault()}),Ft(this.element,n)),a.window.addEventListener("mousemove",this.mousemove),a.window.addEventListener("mouseup",this.mouseup)}mousemove(n){this.move(n,Ft(this.element,n))}mouseup(n){this.mouseRotate.mouseupWindow(n),this.mousePitch&&this.mousePitch.mouseupWindow(n),this.offTemp()}touchstart(n){n.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Ie(this.element,n.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>n.preventDefault()},this._startPos))}touchmove(n){n.targetTouches.length!==1?this.reset():(this._lastPos=Ie(this.element,n.targetTouches)[0],this.move({preventDefault:()=>n.preventDefault()},this._lastPos))}touchend(n){n.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const tc={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},ec={maxWidth:100,unit:"metric"},rc={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},wl={version:a.version,supported:ot,setRTLTextPlugin:a.setRTLTextPlugin,getRTLTextPluginStatus:a.getRTLTextPluginStatus,Map:class extends Bi{constructor(h){if(a.LivePerformanceUtils.mark(a.PerformanceMarkers.create),(h=a.extend({},uh,h)).minZoom!=null&&h.maxZoom!=null&&h.minZoom>h.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(h.minPitch!=null&&h.maxPitch!=null&&h.minPitch>h.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(h.minPitch!=null&&h.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(h.maxPitch!=null&&h.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(h.antialias&&a.isSafariWithAntialiasingBug(a.window)&&(h.antialias=!1,a.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new So(h.minZoom,h.maxZoom,h.minPitch,h.maxPitch,h.renderWorldCopies),h),this._interactive=h.interactive,this._minTileCacheSize=h.minTileCacheSize,this._maxTileCacheSize=h.maxTileCacheSize,this._failIfMajorPerformanceCaveat=h.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=h.preserveDrawingBuffer,this._antialias=h.antialias,this._useWebGL2=h.useWebGL2,this._trackResize=h.trackResize,this._bearingSnap=h.bearingSnap,this._refreshExpiredTiles=h.refreshExpiredTiles,this._fadeDuration=h.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=h.crossSourceCollisions,this._collectResourceTiming=h.collectResourceTiming,this._optimizeForTerrain=h.optimizeForTerrain,this._language=this._parseLanguage(h.language),this._worldview=h.worldview,this._renderTaskQueue=new vs,this._domRenderTaskQueue=new vs,this._controls=[],this._markers=[],this._popups=[],this._mapId=a.uniqueId(),this._locale=a.extend({},lh,h.locale),this._clickTolerance=h.clickTolerance,this._cooperativeGestures=h.cooperativeGestures,this._performanceMetricsCollection=h.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Qu(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new a.RequestManager(h.transformRequest,h.accessToken,h.testMode),this._silenceAuthErrors=!!h.testMode,typeof h.container=="string"){if(this._container=a.window.document.getElementById(h.container),!this._container)throw new Error(`Container '${h.container}' not found.`)}else{if(!(h.container instanceof a.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=h.container}if(this._container.childNodes.length>0&&a.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),h.maxBounds&&this.setMaxBounds(h.maxBounds),a.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),a.window!==void 0&&(a.window.addEventListener("online",this._onWindowOnline,!1),a.window.addEventListener("resize",this._onWindowResize,!1),a.window.addEventListener("orientationchange",this._onWindowResize,!1),a.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),a.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new We(this,h),this._localFontFamily=h.localFontFamily,this._localIdeographFontFamily=h.localIdeographFontFamily,h.style&&this.setStyle(h.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),h.projection&&this.setProjection(h.projection),this._hash=h.hash&&new Gs(typeof h.hash=="string"&&h.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch}),h.bounds&&(this.resize(),this.fitBounds(h.bounds,a.extend({},h.fitBoundsOptions,{duration:0})))),this.resize(),h.attributionControl&&this.addControl(new De({customAttribution:h.customAttribution})),this._logoControl=new Vo,this.addControl(this._logoControl,h.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",n=>{this._update(n.dataType==="style"),this.fire(new a.Event(`${n.dataType}data`,n))}),this.on("dataloading",n=>{this.fire(new a.Event(`${n.dataType}dataloading`,n))})}_getMapId(){return this._mapId}addControl(h,n){if(n===void 0&&(n=h.getDefaultPosition?h.getDefaultPosition():"top-right"),!h||!h.onAdd)return this.fire(new a.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const l=h.onAdd(this);this._controls.push(h);const d=this._controlPositions[n];return n.indexOf("bottom")!==-1?d.insertBefore(l,d.firstChild):d.appendChild(l),this}removeControl(h){if(!h||!h.onRemove)return this.fire(new a.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const n=this._controls.indexOf(h);return n>-1&&this._controls.splice(n,1),h.onRemove(this),this}hasControl(h){return this._controls.indexOf(h)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(h){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const n=!this._moving;return n&&this.fire(new a.Event("movestart",h)).fire(new a.Event("move",h)),this.fire(new a.Event("resize",h)),n&&this.fire(new a.Event("moveend",h)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(h){return this.transform.setMaxBounds(a.LngLatBounds.convert(h)),this._update()}setMinZoom(h){if((h=h??-2)>=-2&&h<=this.transform.maxZoom)return this.transform.minZoom=h,this._update(),this.getZoom()<h?this.setZoom(h):this.fire(new a.Event("zoomstart")).fire(new a.Event("zoom")).fire(new a.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(h){if((h=h??22)>=this.transform.minZoom)return this.transform.maxZoom=h,this._update(),this.getZoom()>h?this.setZoom(h):this.fire(new a.Event("zoomstart")).fire(new a.Event("zoom")).fire(new a.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(h){if((h=h??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(h>=0&&h<=this.transform.maxPitch)return this.transform.minPitch=h,this._update(),this.getPitch()<h?this.setPitch(h):this.fire(new a.Event("pitchstart")).fire(new a.Event("pitch")).fire(new a.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(h){if((h=h??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(h>=this.transform.minPitch)return this.transform.maxPitch=h,this._update(),this.getPitch()>h?this.setPitch(h):this.fire(new a.Event("pitchstart")).fire(new a.Event("pitch")).fire(new a.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(h){return this.transform.renderWorldCopies=h,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(h){return h==="auto"?a.window.navigator.language:Array.isArray(h)?h.length===0?void 0:h.map(n=>n==="auto"?a.window.navigator.language:n):h}setLanguage(h){const n=this._parseLanguage(h);if(!this.style||n===this._language)return this;this._language=n,this.style._reloadSources();for(const l of this._controls)l._setLanguage&&l._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(h){return this.style&&h!==this._worldview?(this._worldview=h,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(h){return this._lazyInitEmptyStyle(),h?typeof h=="string"&&(h={name:h}):h=null,this._useExplicitProjection=!!h,this._prioritizeAndUpdateProjection(h,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const h=this.transform,n=h.projection.name;let l;n==="globe"&&h.zoom>=a.GLOBE_ZOOM_THRESHOLD_MAX?(h.setMercatorFromTransition(),l=!0):n==="mercator"&&h.zoom<a.GLOBE_ZOOM_THRESHOLD_MAX&&(h.setProjection({name:"globe"}),l=!0),l&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(h,n){return this._updateProjection(h||n||{name:"mercator"})}_updateProjection(h){let n;if(n=h.name==="globe"&&this.transform.zoom>=a.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(h),this.style.applyProjectionUpdate(),n){this.painter.clearBackgroundTiles();for(const l in this.style._sourceCaches)this.style._sourceCaches[l].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(h){return this.transform.locationPoint3D(a.LngLat.convert(h))}unproject(h){return this.transform.pointLocation3D(a.Point.convert(h))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(h,n,l){if(h==="mouseenter"||h==="mouseover"){let d=!1;const g=I=>{const S=n.filter(k=>this.getLayer(k)),P=S.length?this.queryRenderedFeatures(I.point,{layers:S}):[];P.length?d||(d=!0,l.call(this,new wi(h,this,I.originalEvent,{features:P}))):d=!1},v=()=>{d=!1};return{layers:new Set(n),listener:l,delegates:{mousemove:g,mouseout:v}}}if(h==="mouseleave"||h==="mouseout"){let d=!1;const g=I=>{const S=n.filter(P=>this.getLayer(P));(S.length?this.queryRenderedFeatures(I.point,{layers:S}):[]).length?d=!0:d&&(d=!1,l.call(this,new wi(h,this,I.originalEvent)))},v=I=>{d&&(d=!1,l.call(this,new wi(h,this,I.originalEvent)))};return{layers:new Set(n),listener:l,delegates:{mousemove:g,mouseout:v}}}{const d=g=>{const v=n.filter(S=>this.getLayer(S)),I=v.length?this.queryRenderedFeatures(g.point,{layers:v}):[];I.length&&(g.features=I,l.call(this,g),delete g.features)};return{layers:new Set(n),listener:l,delegates:{[h]:d}}}}on(h,n,l){if(l===void 0)return super.on(h,n);Array.isArray(n)||(n=[n]);const d=this._createDelegatedListener(h,n,l);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[h]=this._delegatedListeners[h]||[],this._delegatedListeners[h].push(d);for(const g in d.delegates)this.on(g,d.delegates[g]);return this}once(h,n,l){if(l===void 0)return super.once(h,n);Array.isArray(n)||(n=[n]);const d=this._createDelegatedListener(h,n,l);for(const g in d.delegates)this.once(g,d.delegates[g]);return this}off(h,n,l){if(l===void 0)return super.off(h,n);n=new Set(Array.isArray(n)?n:[n]);const d=(v,I)=>{if(v.size!==I.size)return!1;for(const S of v)if(!I.has(S))return!1;return!0},g=this._delegatedListeners?this._delegatedListeners[h]:void 0;return g&&(v=>{for(let I=0;I<v.length;I++){const S=v[I];if(S.listener===l&&d(S.layers,n)){for(const P in S.delegates)this.off(P,S.delegates[P]);return v.splice(I,1),this}}})(g),this}queryRenderedFeatures(h,n){return this.style?(n!==void 0||h===void 0||h instanceof a.Point||Array.isArray(h)||(n=h,h=void 0),this.style.queryRenderedFeatures(h=h||[[0,0],[this.transform.width,this.transform.height]],n=n||{},this.transform)):[]}querySourceFeatures(h,n){return this.style.querySourceFeatures(h,n)}isPointOnSurface(h){const{name:n}=this.transform.projection;return n!=="globe"&&n!=="mercator"&&a.warnOnce(`${n} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(a.Point.convert(h))}setStyle(h,n){return(n=a.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},n)).diff!==!1&&n.localIdeographFontFamily===this._localIdeographFontFamily&&n.localFontFamily===this._localFontFamily&&this.style&&h?(this._diffStyle(h,n),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._localFontFamily=n.localFontFamily,this._updateStyle(h,n))}_getUIString(h){const n=this._locale[h];if(n==null)throw new Error(`Missing UI string '${h}'`);return n}_updateStyle(h,n){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),h&&(this.style=new Ro(this,n||{}),this.style.setEventedParent(this,{style:this.style}),typeof h=="string"?this.style.loadURL(h):this.style.loadJSON(h)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Ro(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(h,n){if(typeof h=="string"){const l=this._requestManager.normalizeStyleURL(h),d=this._requestManager.transformRequest(l,a.ResourceType.Style);a.getJSON(d,(g,v)=>{g?this.fire(new a.ErrorEvent(g)):v&&this._updateDiff(v,n)})}else typeof h=="object"&&this._updateDiff(h,n)}_updateDiff(h,n){try{this.style.setState(h)&&this._update(!0)}catch(l){a.warnOnce(`Unable to perform style diff: ${l.message||l.error||l}.  Rebuilding the style from scratch.`),this._updateStyle(h,n)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(a.warnOnce("There is no style added to the map."),!1)}addSource(h,n){return this._lazyInitEmptyStyle(),this.style.addSource(h,n),this._update(!0)}isSourceLoaded(h){return!!this.style&&this.style._isSourceCacheLoaded(h)}areTilesLoaded(){const h=this.style&&this.style._sourceCaches;for(const n in h){const l=h[n]._tiles;for(const d in l){const g=l[d];if(g.state!=="loaded"&&g.state!=="errored")return!1}}return!0}addSourceType(h,n,l){this._lazyInitEmptyStyle(),this.style.addSourceType(h,n,l)}removeSource(h){return this.style.removeSource(h),this._updateTerrain(),this._update(!0)}getSource(h){return this.style.getSource(h)}addImage(h,n,{pixelRatio:l=1,sdf:d=!1,stretchX:g,stretchY:v,content:I}={}){if(this._lazyInitEmptyStyle(),n instanceof a.window.HTMLImageElement||a.window.ImageBitmap&&n instanceof a.window.ImageBitmap){const{width:S,height:P,data:k}=a.exported.getImageData(n);this.style.addImage(h,{data:new a.RGBAImage({width:S,height:P},k),pixelRatio:l,stretchX:g,stretchY:v,content:I,sdf:d,version:0})}else if(n.width===void 0||n.height===void 0)this.fire(new a.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:S,height:P}=n,k=n;this.style.addImage(h,{data:new a.RGBAImage({width:S,height:P},new Uint8Array(k.data)),pixelRatio:l,stretchX:g,stretchY:v,content:I,sdf:d,version:0,userImage:k}),k.onAdd&&k.onAdd(this,h)}}updateImage(h,n){const l=this.style.getImage(h);if(!l)return void this.fire(new a.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const d=n instanceof a.window.HTMLImageElement||a.window.ImageBitmap&&n instanceof a.window.ImageBitmap?a.exported.getImageData(n):n,{width:g,height:v}=d;g!==void 0&&v!==void 0?g===l.data.width&&v===l.data.height?(l.data.replace(d.data,!(n instanceof a.window.HTMLImageElement||a.window.ImageBitmap&&n instanceof a.window.ImageBitmap)),this.style.updateImage(h,l)):this.fire(new a.ErrorEvent(new Error(`The width and height of the updated image (${g}, ${v})
                must be that same as the previous version of the image
                (${l.data.width}, ${l.data.height})`))):this.fire(new a.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(h){return h?!!this.style.getImage(h):(this.fire(new a.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(h){this.style.removeImage(h)}loadImage(h,n){a.getImage(this._requestManager.transformRequest(h,a.ResourceType.Image),(l,d)=>{n(l,d instanceof a.window.HTMLImageElement?a.exported.getImageData(d):d)})}listImages(){return this.style.listImages()}addLayer(h,n){return this._lazyInitEmptyStyle(),this.style.addLayer(h,n),this._update(!0)}moveLayer(h,n){return this.style.moveLayer(h,n),this._update(!0)}removeLayer(h){return this.style.removeLayer(h),this._update(!0)}getLayer(h){return this.style.getLayer(h)}setLayerZoomRange(h,n,l){return this.style.setLayerZoomRange(h,n,l),this._update(!0)}setFilter(h,n,l={}){return this.style.setFilter(h,n,l),this._update(!0)}getFilter(h){return this.style.getFilter(h)}setPaintProperty(h,n,l,d={}){return this.style.setPaintProperty(h,n,l,d),this._update(!0)}getPaintProperty(h,n){return this.style.getPaintProperty(h,n)}setLayoutProperty(h,n,l,d={}){return this.style.setLayoutProperty(h,n,l,d),this._update(!0)}getLayoutProperty(h,n){return this.style.getLayoutProperty(h,n)}setLight(h,n={}){return this._lazyInitEmptyStyle(),this.style.setLight(h,n),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(h){return this._lazyInitEmptyStyle(),!h&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(h),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(h){return this._lazyInitEmptyStyle(),this.style.setFog(h),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(h){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(a.LngLat.convert(h),this.transform):0}setFeatureState(h,n){return this.style.setFeatureState(h,n),this._update()}removeFeatureState(h,n){return this.style.removeFeatureState(h,n),this._update()}getFeatureState(h){return this.style.getFeatureState(h)}_updateContainerDimensions(){if(!this._container)return;const h=this._container.getBoundingClientRect().width||400,n=this._container.getBoundingClientRect().height||300;let l,d,g,v=this._container;for(;v&&(!d||!g);){const I=a.window.getComputedStyle(v).transform;I&&I!=="none"&&(l=I.match(/matrix.*\((.+)\)/)[1].split(", "),l[0]&&l[0]!=="0"&&l[0]!=="1"&&(d=l[0]),l[3]&&l[3]!=="0"&&l[3]!=="1"&&(g=l[3])),v=v.parentElement}this._containerWidth=d?Math.abs(h/d):h,this._containerHeight=g?Math.abs(n/g):n}_detectMissingCSS(){a.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&a.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const h=this._container;h.classList.add("mapboxgl-map"),(this._missingCSSCanary=At("div","mapboxgl-canary",h)).style.visibility="hidden",this._detectMissingCSS();const n=this._canvasContainer=At("div","mapboxgl-canvas-container",h);this._interactive&&n.classList.add("mapboxgl-interactive"),this._canvas=At("canvas","mapboxgl-canvas",n),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const l=this._controlContainer=At("div","mapboxgl-control-container",h),d=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(g=>{d[g]=At("div",`mapboxgl-ctrl-${g}`,l)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(h,n){const l=a.exported.devicePixelRatio||1;this._canvas.width=l*Math.ceil(h),this._canvas.height=l*Math.ceil(n),this._canvas.style.width=`${h}px`,this._canvas.style.height=`${n}px`}_addMarker(h){this._markers.push(h)}_removeMarker(h){const n=this._markers.indexOf(h);n!==-1&&this._markers.splice(n,1)}_addPopup(h){this._popups.push(h)}_removePopup(h){const n=this._popups.indexOf(h);n!==-1&&this._popups.splice(n,1)}_setupPainter(){const h=a.extend({},ot.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),n=this._useWebGL2&&this._canvas.getContext("webgl2",h),l=n||this._canvas.getContext("webgl",h)||this._canvas.getContext("experimental-webgl",h);l?(this._useWebGL2&&!n&&a.warnOnce("Failed to create WebGL 2 context. Using WebGL 1."),a.storeAuthState(l,!0),this.painter=new Hn(l,this.transform,!!n),this.on("data",d=>{d.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),a.exported$1.testSupport(l)):this.fire(new a.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(h){h.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new a.Event("webglcontextlost",{originalEvent:h}))}_contextRestored(h){this._setupPainter(),this.resize(),this._update(),this.fire(new a.Event("webglcontextrestored",{originalEvent:h}))}_onMapScroll(h){if(h.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(h){return this.style?(this._styleDirty=this._styleDirty||h,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(h){return this._update(),this._renderTaskQueue.add(h)}_cancelRenderFrame(h){this._renderTaskQueue.remove(h)}_requestDomTask(h){!this.loaded()||this.loaded()&&!this.isMoving()?h():this._domRenderTaskQueue.add(h)}_render(h){let n;const l=this.painter.context.extTimerQuery,d=a.exported.now();if(this.listens("gpu-timing-frame")&&(n=l.createQueryEXT(),l.beginQueryEXT(l.TIME_ELAPSED_EXT,n)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],a.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],a.window.performance.now())),this._renderTaskQueue.run(h),this._domRenderTaskQueue.run(h),this._removed)return;this._updateProjectionTransition();const g=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const S=this.transform.zoom,P=this.transform.pitch,k=a.exported.now(),N=new a.EvaluationParameters(S,{now:k,fadeDuration:g,pitch:P,transition:this.style.getTransition()});this.style.update(N)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let v=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),v=this._updateAverageElevation(d),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):v=this._updateAverageElevation(d),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,g,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:g,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new a.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new a.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),n){const S=a.exported.now()-d;l.endQueryEXT(l.TIME_ELAPSED_EXT,n),setTimeout(()=>{const P=l.getQueryObjectEXT(n,l.QUERY_RESULT_EXT)/1e6;l.deleteQueryEXT(n),this.fire(new a.Event("gpu-timing-frame",{cpuTime:S,gpuTime:P})),a.window.performance.mark("frame-gpu",{startTime:d,detail:{gpuTime:P}})},50)}if(this.listens("gpu-timing-layer")){const S=this.painter.collectGpuTimers();setTimeout(()=>{const P=this.painter.queryGpuTimers(S);this.fire(new a.Event("gpu-timing-layer",{layerTimes:P}))},50)}if(this.listens("gpu-timing-deferred-render")){const S=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const P=this.painter.queryGpuTimeDeferredRender(S);this.fire(new a.Event("gpu-timing-deferred-render",{gpuTime:P}))},50)}const I=this._sourcesDirty||this._styleDirty||this._placementDirty||v;if(I||this._repaint)this.triggerRepaint();else{const S=!this.isMoving()&&this.loaded();if(S&&(v=this._updateAverageElevation(d,!0)),v)this.triggerRepaint();else if(this._triggerFrame(!1),S&&(this.fire(new a.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const P=this._calculateSpeedIndex();this.fire(new a.Event("speedindexcompleted",{speedIndex:P})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||I||(this._fullyLoaded=!0,a.LivePerformanceUtils.mark(a.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&a.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(h){for(const n of this._markers)h&&!this.getRenderWorldCopies()&&(n._lngLat=n._lngLat.wrap()),n._update();for(const n of this._popups)!h||this.getRenderWorldCopies()||n._trackPointer||(n._lngLat=n._lngLat.wrap()),n._update()}_updateAverageElevation(h,n=!1){const l=d=>(this.transform.averageElevation=d,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&l(0);if((n||h-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(h)){const d=this.transform.averageElevation;let g=this.transform.sampleAverageElevation(),v=!1;this.transform.elevation&&(v=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(g)?g=0:this._averageElevationLastSampledAt=h;const I=Math.abs(d-g);if(I>1){if(this._isInitialLoad||v)return this._averageElevation.jumpTo(g),l(g);this._averageElevation.easeTo(g,h,300)}else if(I>1e-4)return this._averageElevation.jumpTo(g),l(g)}return!!this._averageElevation.isEasing(h)&&l(this._averageElevation.getValue(h))}_authenticate(){a.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,h=>{if(h&&(h.message===a.AUTH_ERR_MSG||h.status===401)){const n=this.painter.context.gl;a.storeAuthState(n,!1),this._logoControl instanceof Vo&&this._logoControl._updateLogo(),n&&n.clear(n.DEPTH_BUFFER_BIT|n.COLOR_BUFFER_BIT|n.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new a.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),a.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const h=this._isDragging();this.painter.updateTerrain(this.style,h)}_calculateSpeedIndex(){const h=this.painter.canvasCopy(),n=this.painter.getCanvasCopiesAndTimestamps();n.timeStamps.push(performance.now());const l=this.painter.context.gl,d=l.createFramebuffer();function g(v){l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,v,0);const I=new Uint8Array(l.drawingBufferWidth*l.drawingBufferHeight*4);return l.readPixels(0,0,l.drawingBufferWidth,l.drawingBufferHeight,l.RGBA,l.UNSIGNED_BYTE,I),I}return l.bindFramebuffer(l.FRAMEBUFFER,d),this._canvasPixelComparison(g(h),n.canvasCopies.map(g),n.timeStamps)}_canvasPixelComparison(h,n,l){let d=l[1]-l[0];const g=h.length/4;for(let v=0;v<n.length;v++){const I=n[v];let S=0;for(let P=0;P<I.length;P+=4)I[P]===h[P]&&I[P+1]===h[P+1]&&I[P+2]===h[P+2]&&I[P+3]===h[P+3]&&(S+=1);d+=(l[v+2]-l[v+1])*(1-S/g)}return d}remove(){this._hash&&this._hash.remove();for(const n of this._controls)n.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),a.window!==void 0&&(a.window.removeEventListener("resize",this._onWindowResize,!1),a.window.removeEventListener("orientationchange",this._onWindowResize,!1),a.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),a.window.removeEventListener("online",this._onWindowOnline,!1),a.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const h=this.painter.context.gl.getExtension("WEBGL_lose_context");h&&h.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),a.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new a.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(h){this._renderNextFrame=this._renderNextFrame||h,this.style&&!this._frame&&(this._frame=a.exported.frame(n=>{const l=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,l&&this._render(n)}))}_preloadTiles(h){const n=this.style?Object.values(this.style._sourceCaches):[];return a.asyncAll(n,(l,d)=>l._preloadTiles(h,d),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(h){this._trackResize&&this.resize({originalEvent:h})._update()}_onVisibilityChange(){a.window.document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(h){this._showTileBoundaries!==h&&(this._showTileBoundaries=h,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(h){this._showTerrainWireframe!==h&&(this._showTerrainWireframe=h,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(h){this._speedIndexTiming!==h&&(this._speedIndexTiming=h,this._update())}get showPadding(){return!!this._showPadding}set showPadding(h){this._showPadding!==h&&(this._showPadding=h,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(h){this._showCollisionBoxes!==h&&(this._showCollisionBoxes=h,h?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(h){this._showOverdrawInspector!==h&&(this._showOverdrawInspector=h,this._update())}get repaint(){return!!this._repaint}set repaint(h){this._repaint!==h&&(this._repaint=h,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(h){this._vertices=h,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(h){this._showTileAABBs!==h&&(this._showTileAABBs=h,h&&this._update())}_setCacheLimits(h,n){a.setCacheLimits(h,n)}get version(){return a.version}},NavigationControl:class{constructor(h){this.options=a.extend({},bp,h),this._container=At("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",n=>n.preventDefault()),this.options.showZoom&&(a.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",n=>{this._map&&this._map.zoomIn({},{originalEvent:n})}),At("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",n=>{this._map&&this._map.zoomOut({},{originalEvent:n})}),At("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(a.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",n=>{const l=this._map;l&&(this.options.visualizePitch?l.resetNorthPitch({},{originalEvent:n}):l.resetNorth({},{originalEvent:n}))}),this._compassIcon=At("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const h=this._map;if(!h)return;const n=h.getZoom(),l=n===h.getMaxZoom(),d=n===h.getMinZoom();this._zoomInButton.disabled=l,this._zoomOutButton.disabled=d,this._zoomInButton.setAttribute("aria-disabled",l.toString()),this._zoomOutButton.setAttribute("aria-disabled",d.toString())}_rotateCompassArrow(){const h=this._map;if(!h)return;const n=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(h.transform.pitch*(Math.PI/180)),.5)}) rotateX(${h.transform.pitch}deg) rotateZ(${h.transform.angle*(180/Math.PI)}deg)`:`rotate(${h.transform.angle*(180/Math.PI)}deg)`;h._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=n)})}onAdd(h){return this._map=h,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),h.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&h.on("pitch",this._rotateCompassArrow),h.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new wp(h,this._compass,this.options.visualizePitch)),this._container}onRemove(){const h=this._map;h&&(this._container.remove(),this.options.showZoom&&h.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&h.off("pitch",this._rotateCompassArrow),h.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(h,n){const l=At("button",h,this._container);return l.type="button",l.addEventListener("click",n),l}_setButtonTitle(h,n){if(!this._map)return;const l=this._map._getUIString(`NavigationControl.${n}`);h.setAttribute("aria-label",l),h.firstElementChild&&h.firstElementChild.setAttribute("title",l)}},GeolocateControl:class extends a.Evented{constructor(h){super(),this.options=a.extend({geolocation:a.window.navigator.geolocation},tc,h),a.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=ia(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(h){return this._map=h,this._container=At("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(h){const n=(l=!!this.options.geolocation)=>{this._supportsGeolocation=l,h(l)};this._supportsGeolocation!==void 0?h(this._supportsGeolocation):a.window.navigator.permissions!==void 0?a.window.navigator.permissions.query({name:"geolocation"}).then(l=>n(l.state!=="denied")).catch(()=>n()):n()}_isOutOfMapMaxBounds(h){const n=this._map.getMaxBounds(),l=h.coords;return!!n&&(l.longitude<n.getWest()||l.longitude>n.getEast()||l.latitude<n.getSouth()||l.latitude>n.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(h){if(this._map){if(this._isOutOfMapMaxBounds(h))return this._setErrorState(),this.fire(new a.Event("outofmaxbounds",h)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=h,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(h),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(h),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new a.Event("geolocate",h)),this._finish()}}_updateCamera(h){const n=new a.LngLat(h.coords.longitude,h.coords.latitude),l=h.coords.accuracy,d=this._map.getBearing(),g=a.extend({bearing:d},this.options.fitBoundsOptions);this._map.fitBounds(n.toBounds(l),g,{geolocateSource:!0})}_updateMarker(h){if(h){const n=new a.LngLat(h.coords.longitude,h.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=h.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const h=this._map.transform,n=a.mercatorZfromAltitude(1,h._center.lat)*h.worldSize,l=Math.ceil(2*this._accuracy*n);this._circleElement.style.width=`${l}px`,this._circleElement.style.height=`${l}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(h){if(this._map){if(this.options.trackUserLocation)if(h.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(h.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new a.Event("error",h)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(h){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",n=>n.preventDefault()),this._geolocateButton=At("button","mapboxgl-ctrl-geolocate",this._container),At("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",h===!1){a.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}else{const n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=At("div","mapboxgl-user-location"),this._dotElement.appendChild(At("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(At("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Ue({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=At("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ue({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",n=>{n.geolocateSource||this._watchState!=="ACTIVE_LOCK"||n.originalEvent&&n.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new a.Event("trackuserlocationend")))})}}_onDeviceOrientation(h){this._userLocationDotMarker&&(h.webkitCompassHeading?this._heading=h.webkitCompassHeading:h.absolute===!0&&(this._heading=-1*h.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return a.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new a.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let h;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(h={maximumAge:6e5,timeout:0},this._noTimeout=!0):(h=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,h),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const h=()=>{a.window.addEventListener("ondeviceorientationabsolute"in a.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};a.window.DeviceMotionEvent!==void 0&&typeof a.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(n=>{n==="granted"&&h()}).catch(console.error):h()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),a.window.removeEventListener("deviceorientation",this._onDeviceOrientation),a.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:De,ScaleControl:class{constructor(h){this.options=a.extend({},ec,h),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),a.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const h=this.options.maxWidth||100,n=this._map,l=n._containerHeight/2,d=n._containerWidth/2-h/2,g=n.unproject([d,l]),v=n.unproject([d+h,l]),I=g.distanceTo(v);if(this.options.unit==="imperial"){const S=3.2808*I;S>5280?this._setScale(h,S/5280,"mile"):this._setScale(h,S,"foot")}else this.options.unit==="nautical"?this._setScale(h,I/1852,"nautical-mile"):I>=1e3?this._setScale(h,I/1e3,"kilometer"):this._setScale(h,I,"meter")}_setScale(h,n,l){this._map._requestDomTask(()=>{const d=function(v){const I=Math.pow(10,`${Math.floor(v)}`.length-1);let S=v/I;return S=S>=10?10:S>=5?5:S>=3?3:S>=2?2:S>=1?1:function(P){const k=Math.pow(10,Math.ceil(-Math.log(P)/Math.LN10));return Math.round(P*k)/k}(S),I*S}(n),g=d/n;this._container.innerHTML=this._isNumberFormatSupported&&l!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:l}).format(d):`${d}&nbsp;${rc[l]}`,this._container.style.width=h*g+"px"})}onAdd(h){return this._map=h,this._language=h.getLanguage(),this._container=At("div","mapboxgl-ctrl mapboxgl-ctrl-scale",h.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(h){this._language=h,this._update()}setUnit(h){this.options.unit=h,this._update()}},FullscreenControl:class{constructor(h){this._fullscreen=!1,h&&h.container&&(h.container instanceof a.window.HTMLElement?this._container=h.container:a.warnOnce("Full screen control 'container' must be a DOM element.")),a.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in a.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in a.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(h){return this._map=h,this._container||(this._container=this._map.getContainer()),this._controlContainer=At("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",a.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,a.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!a.window.document.fullscreenEnabled&&!a.window.document.webkitFullscreenEnabled)}_setupUI(){const h=this._fullscreenButton=At("button","mapboxgl-ctrl-fullscreen",this._controlContainer);At("span","mapboxgl-ctrl-icon",h).setAttribute("aria-hidden","true"),h.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),a.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const h=this._getTitle();this._fullscreenButton.setAttribute("aria-label",h),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",h)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(a.window.document.fullscreenElement||a.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?a.window.document.exitFullscreen?a.window.document.exitFullscreen():a.window.document.webkitCancelFullScreen&&a.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends a.Evented{constructor(h){super(),this.options=a.extend(Object.create(Ju),h),a.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(h&&h.className?h.className.trim().split(/\s+/):[])}addTo(h){return this._map&&this.remove(),this._map=h,this.options.closeOnClick&&h.on("preclick",this._onClose),this.options.closeOnMove&&h.on("move",this._onClose),h.on("remove",this.remove),this._update(),h._addPopup(this),this._focusFirstElement(),this._trackPointer?(h.on("mousemove",this._onMouseEvent),h.on("mouseup",this._onMouseEvent),h._canvasContainer.classList.add("mapboxgl-track-pointer")):h.on("move",this._update),this.fire(new a.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const h=this._map;return h&&(h.off("move",this._update),h.off("move",this._onClose),h.off("preclick",this._onClose),h.off("click",this._onClose),h.off("remove",this.remove),h.off("mousemove",this._onMouseEvent),h.off("mouseup",this._onMouseEvent),h.off("drag",this._onMouseEvent),h._canvasContainer&&h._canvasContainer.classList.remove("mapboxgl-track-pointer"),h._removePopup(this),this._map=void 0),this.fire(new a.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(h){this._lngLat=a.LngLat.convert(h),this._pos=null,this._trackPointer=!1,this._update();const n=this._map;return n&&(n.on("move",this._update),n.off("mousemove",this._onMouseEvent),n._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const h=this._map;return h&&(h.off("move",this._update),h.on("mousemove",this._onMouseEvent),h.on("drag",this._onMouseEvent),h._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(h){return this.setDOMContent(a.window.document.createTextNode(h))}setHTML(h){const n=a.window.document.createDocumentFragment(),l=a.window.document.createElement("body");let d;for(l.innerHTML=h;d=l.firstChild,d;)n.appendChild(d);return this.setDOMContent(n)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(h){return this.options.maxWidth=h,this._update(),this}setDOMContent(h){let n=this._content;if(n)for(;n.hasChildNodes();)n.firstChild&&n.removeChild(n.firstChild);else n=this._content=At("div","mapboxgl-popup-content",this._container||void 0);if(n.appendChild(h),this.options.closeButton){const l=this._closeButton=At("button","mapboxgl-popup-close-button",n);l.type="button",l.setAttribute("aria-label","Close popup"),l.setAttribute("aria-hidden","true"),l.innerHTML="&#215;",l.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(h){return this._classList.add(h),this._updateClassList(),this}removeClassName(h){return this._classList.delete(h),this._updateClassList(),this}setOffset(h){return this.options.offset=h,this._update(),this}toggleClassName(h){let n;return this._classList.delete(h)?n=!1:(this._classList.add(h),n=!0),this._updateClassList(),n}_onMouseEvent(h){this._update(h.point)}_getAnchor(h){if(this.options.anchor)return this.options.anchor;const n=this._map,l=this._container,d=this._pos;if(!n||!l||!d)return"bottom";const g=l.offsetWidth,v=l.offsetHeight,I=d.x<g/2,S=d.x>n.transform.width-g/2;if(d.y+h<v)return I?"top-left":S?"top-right":"top";if(d.y>n.transform.height-v){if(I)return"bottom-left";if(S)return"bottom-right"}return I?"left":S?"right":"bottom"}_updateClassList(){const h=this._container;if(!h)return;const n=[...this._classList];n.push("mapboxgl-popup"),this._anchor&&n.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&n.push("mapboxgl-popup-track-pointer"),h.className=n.join(" ")}_update(h){const n=this._map,l=this._content;if(!n||!this._lngLat&&!this._trackPointer||!l)return;let d=this._container;if(d||(d=this._container=At("div","mapboxgl-popup",n.getContainer()),this._tip=At("div","mapboxgl-popup-tip",d),d.appendChild(l)),this.options.maxWidth&&d.style.maxWidth!==this.options.maxWidth&&(d.style.maxWidth=this.options.maxWidth),n.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=aa(this._lngLat,this._pos,n.transform)),!this._trackPointer||h){const g=this._pos=this._trackPointer&&h?h:n.project(this._lngLat),v=ah(this.options.offset),I=this._anchor=this._getAnchor(v.y),S=ah(this.options.offset,I),P=g.add(S).round();n._requestDomTask(()=>{this._container&&I&&(this._container.style.transform=`${ol[I]} translate(${P.x}px,${P.y}px)`)})}if(!this._marker&&n._showingGlobe()){const g=a.isLngLatBehindGlobe(n.transform,this._lngLat)?0:1;this._setOpacity(g)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const h=this._container.querySelector(xp);h&&h.focus()}_onClose(){this.remove()}_setOpacity(h){this._container&&(this._container.style.opacity=`${h}`),this._content&&(this._content.style.pointerEvents=h?"auto":"none")}},Marker:Ue,Style:Ro,LngLat:a.LngLat,LngLatBounds:a.LngLatBounds,Point:a.Point,MercatorCoordinate:a.MercatorCoordinate,FreeCameraOptions:Bo,Evented:a.Evented,config:a.config,prewarm:function(){Pn().acquire(an)},clearPrewarmedResources:function(){const h=ln;h&&(h.isPreloaded()&&h.numActive()===1?(h.release(an),ln=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return a.config.ACCESS_TOKEN},set accessToken(h){a.config.ACCESS_TOKEN=h},get baseApiUrl(){return a.config.API_URL},set baseApiUrl(h){a.config.API_URL=h},get workerCount(){return Kr.workerCount},set workerCount(h){Kr.workerCount=h},get maxParallelImageRequests(){return a.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(h){a.config.MAX_PARALLEL_IMAGE_REQUESTS=h},clearStorage(h){a.clearTileCache(h)},workerUrl:"",workerClass:null,setNow:a.exported.setNow,restoreNow:a.exported.restoreNow};return wl});var U=D;return U})})(ny);var sy=ny.exports,a_={};const ay=(b,T,E,A)=>{const D=b.getStyle().layers;if(!A){const z=D.findIndex(U=>U.id===T);A=D[z+1]&&D[z+1].id}b.getLayer(T)&&b.removeLayer(T),b.addLayer(E,A)},Kw=async(b,T,E)=>{b.getLayer(T.id)?ay(b,T.id,T,E):b.addLayer(T,E)};function pd(b,T,E){E===void 0&&(E={});var A={type:"Feature"};return(E.id===0||E.id)&&(A.id=E.id),E.bbox&&(A.bbox=E.bbox),A.properties=T||{},A.geometry=b,A}function ly(b,T,E){if(E===void 0&&(E={}),!b)throw new Error("coordinates is required");if(!Array.isArray(b))throw new Error("coordinates must be an Array");if(b.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!l_(b[0])||!l_(b[1]))throw new Error("coordinates must contain numbers");var A={type:"Point",coordinates:b};return pd(A,T,E)}function uy(b,T,E){E===void 0&&(E={});for(var A=0,D=b;A<D.length;A++){var z=D[A];if(z.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var U=0;U<z[z.length-1].length;U++)if(z[z.length-1][U]!==z[0][U])throw new Error("First and last Position are not equivalent.")}var a={type:"Polygon",coordinates:b};return pd(a,T,E)}function V0(b,T,E){E===void 0&&(E={});var A={type:"MultiPoint",coordinates:b};return pd(A,T,E)}function l_(b){return!isNaN(b)&&b!==null&&!Array.isArray(b)}function cy(b,T,E){if(b!==null)for(var A,D,z,U,a,G,ot,Rt=0,xt=0,At,qt=b.type,re=qt==="FeatureCollection",ee=qt==="Feature",Oe=re?b.features.length:1,Ge=0;Ge<Oe;Ge++){ot=re?b.features[Ge].geometry:ee?b.geometry:b,At=ot?ot.type==="GeometryCollection":!1,a=At?ot.geometries.length:1;for(var Mt=0;Mt<a;Mt++){var gt=0,Et=0;if(U=At?ot.geometries[Mt]:ot,U!==null){G=U.coordinates;var Ft=U.type;switch(Rt=0,Ft){case null:break;case"Point":if(T(G,xt,Ge,gt,Et)===!1)return!1;xt++,gt++;break;case"LineString":case"MultiPoint":for(A=0;A<G.length;A++){if(T(G[A],xt,Ge,gt,Et)===!1)return!1;xt++,Ft==="MultiPoint"&&gt++}Ft==="LineString"&&gt++;break;case"Polygon":case"MultiLineString":for(A=0;A<G.length;A++){for(D=0;D<G[A].length-Rt;D++){if(T(G[A][D],xt,Ge,gt,Et)===!1)return!1;xt++}Ft==="MultiLineString"&&gt++,Ft==="Polygon"&&Et++}Ft==="Polygon"&&gt++;break;case"MultiPolygon":for(A=0;A<G.length;A++){for(Et=0,D=0;D<G[A].length;D++){for(z=0;z<G[A][D].length-Rt;z++){if(T(G[A][D][z],xt,Ge,gt,Et)===!1)return!1;xt++}Et++}gt++}break;case"GeometryCollection":for(A=0;A<U.geometries.length;A++)if(cy(U.geometries[A],T)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Jf(b){var T=[1/0,1/0,-1/0,-1/0];return cy(b,function(E){T[0]>E[0]&&(T[0]=E[0]),T[1]>E[1]&&(T[1]=E[1]),T[2]<E[0]&&(T[2]=E[0]),T[3]<E[1]&&(T[3]=E[1])}),T}Jf.default=Jf;function G0(b){if(!b)throw new Error("coord is required");if(!Array.isArray(b)){if(b.type==="Feature"&&b.geometry!==null&&b.geometry.type==="Point")return b.geometry.coordinates;if(b.type==="Point")return b.coordinates}if(Array.isArray(b)&&b.length>=2&&!Array.isArray(b[0])&&!Array.isArray(b[1]))return b;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function j0(b){return b.type==="Feature"?b.geometry:b}var ih=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function q0(b){var T=b.default;if(typeof T=="function"){var E=function(){return T.apply(this,arguments)};E.prototype=T.prototype}else E={};return Object.defineProperty(E,"__esModule",{value:!0}),Object.keys(b).forEach(function(A){var D=Object.getOwnPropertyDescriptor(b,A);Object.defineProperty(E,A,D.get?D:{enumerable:!0,get:function(){return b[A]}})}),E}/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var u_=Object.getOwnPropertySymbols,$0=Object.prototype.hasOwnProperty,X0=Object.prototype.propertyIsEnumerable;function Z0(b){if(b==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(b)}function W0(){try{if(!Object.assign)return!1;var b=new String("abc");if(b[5]="de",Object.getOwnPropertyNames(b)[0]==="5")return!1;for(var T={},E=0;E<10;E++)T["_"+String.fromCharCode(E)]=E;var A=Object.getOwnPropertyNames(T).map(function(z){return T[z]});if(A.join("")!=="0123456789")return!1;var D={};return"abcdefghijklmnopqrst".split("").forEach(function(z){D[z]=z}),Object.keys(Object.assign({},D)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}W0();var hy={exports:{}},fd={exports:{}};(function(b,T){(function(E,A){b.exports=A()})(ih,function(){function E(Mt,gt,Et,Ft,Ie){(function de(xe,$t,yt,ue,Kt){for(;ue>yt;){if(ue-yt>600){var ae=ue-yt+1,wt=$t-yt+1,_i=Math.log(ae),Ne=.5*Math.exp(2*_i/3),Tr=.5*Math.sqrt(_i*Ne*(ae-Ne)/ae)*(wt-ae/2<0?-1:1),Ye=Math.max(yt,Math.floor($t-wt*Ne/ae+Tr)),ti=Math.min(ue,Math.floor($t+(ae-wt)*Ne/ae+Tr));de(xe,$t,Ye,ti,Kt)}var Pe=xe[$t],tr=yt,Ot=ue;for(A(xe,yt,$t),Kt(xe[ue],Pe)>0&&A(xe,yt,ue);tr<Ot;){for(A(xe,tr,Ot),tr++,Ot--;Kt(xe[tr],Pe)<0;)tr++;for(;Kt(xe[Ot],Pe)>0;)Ot--}Kt(xe[yt],Pe)===0?A(xe,yt,Ot):A(xe,++Ot,ue),Ot<=$t&&(yt=Ot+1),$t<=Ot&&(ue=Ot-1)}})(Mt,gt,Et||0,Ft||Mt.length-1,Ie||D)}function A(Mt,gt,Et){var Ft=Mt[gt];Mt[gt]=Mt[Et],Mt[Et]=Ft}function D(Mt,gt){return Mt<gt?-1:Mt>gt?1:0}var z=function(Mt){Mt===void 0&&(Mt=9),this._maxEntries=Math.max(4,Mt),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function U(Mt,gt,Et){if(!Et)return gt.indexOf(Mt);for(var Ft=0;Ft<gt.length;Ft++)if(Et(Mt,gt[Ft]))return Ft;return-1}function a(Mt,gt){G(Mt,0,Mt.children.length,gt,Mt)}function G(Mt,gt,Et,Ft,Ie){Ie||(Ie=Oe(null)),Ie.minX=1/0,Ie.minY=1/0,Ie.maxX=-1/0,Ie.maxY=-1/0;for(var de=gt;de<Et;de++){var xe=Mt.children[de];ot(Ie,Mt.leaf?Ft(xe):xe)}return Ie}function ot(Mt,gt){return Mt.minX=Math.min(Mt.minX,gt.minX),Mt.minY=Math.min(Mt.minY,gt.minY),Mt.maxX=Math.max(Mt.maxX,gt.maxX),Mt.maxY=Math.max(Mt.maxY,gt.maxY),Mt}function Rt(Mt,gt){return Mt.minX-gt.minX}function xt(Mt,gt){return Mt.minY-gt.minY}function At(Mt){return(Mt.maxX-Mt.minX)*(Mt.maxY-Mt.minY)}function qt(Mt){return Mt.maxX-Mt.minX+(Mt.maxY-Mt.minY)}function re(Mt,gt){return Mt.minX<=gt.minX&&Mt.minY<=gt.minY&&gt.maxX<=Mt.maxX&&gt.maxY<=Mt.maxY}function ee(Mt,gt){return gt.minX<=Mt.maxX&&gt.minY<=Mt.maxY&&gt.maxX>=Mt.minX&&gt.maxY>=Mt.minY}function Oe(Mt){return{children:Mt,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function Ge(Mt,gt,Et,Ft,Ie){for(var de=[gt,Et];de.length;)if(!((Et=de.pop())-(gt=de.pop())<=Ft)){var xe=gt+Math.ceil((Et-gt)/Ft/2)*Ft;E(Mt,xe,gt,Et,Ie),de.push(gt,xe,xe,Et)}}return z.prototype.all=function(){return this._all(this.data,[])},z.prototype.search=function(Mt){var gt=this.data,Et=[];if(!ee(Mt,gt))return Et;for(var Ft=this.toBBox,Ie=[];gt;){for(var de=0;de<gt.children.length;de++){var xe=gt.children[de],$t=gt.leaf?Ft(xe):xe;ee(Mt,$t)&&(gt.leaf?Et.push(xe):re(Mt,$t)?this._all(xe,Et):Ie.push(xe))}gt=Ie.pop()}return Et},z.prototype.collides=function(Mt){var gt=this.data;if(!ee(Mt,gt))return!1;for(var Et=[];gt;){for(var Ft=0;Ft<gt.children.length;Ft++){var Ie=gt.children[Ft],de=gt.leaf?this.toBBox(Ie):Ie;if(ee(Mt,de)){if(gt.leaf||re(Mt,de))return!0;Et.push(Ie)}}gt=Et.pop()}return!1},z.prototype.load=function(Mt){if(!Mt||!Mt.length)return this;if(Mt.length<this._minEntries){for(var gt=0;gt<Mt.length;gt++)this.insert(Mt[gt]);return this}var Et=this._build(Mt.slice(),0,Mt.length-1,0);if(this.data.children.length)if(this.data.height===Et.height)this._splitRoot(this.data,Et);else{if(this.data.height<Et.height){var Ft=this.data;this.data=Et,Et=Ft}this._insert(Et,this.data.height-Et.height-1,!0)}else this.data=Et;return this},z.prototype.insert=function(Mt){return Mt&&this._insert(Mt,this.data.height-1),this},z.prototype.clear=function(){return this.data=Oe([]),this},z.prototype.remove=function(Mt,gt){if(!Mt)return this;for(var Et,Ft,Ie,de=this.data,xe=this.toBBox(Mt),$t=[],yt=[];de||$t.length;){if(de||(de=$t.pop(),Ft=$t[$t.length-1],Et=yt.pop(),Ie=!0),de.leaf){var ue=U(Mt,de.children,gt);if(ue!==-1)return de.children.splice(ue,1),$t.push(de),this._condense($t),this}Ie||de.leaf||!re(de,xe)?Ft?(Et++,de=Ft.children[Et],Ie=!1):de=null:($t.push(de),yt.push(Et),Et=0,Ft=de,de=de.children[0])}return this},z.prototype.toBBox=function(Mt){return Mt},z.prototype.compareMinX=function(Mt,gt){return Mt.minX-gt.minX},z.prototype.compareMinY=function(Mt,gt){return Mt.minY-gt.minY},z.prototype.toJSON=function(){return this.data},z.prototype.fromJSON=function(Mt){return this.data=Mt,this},z.prototype._all=function(Mt,gt){for(var Et=[];Mt;)Mt.leaf?gt.push.apply(gt,Mt.children):Et.push.apply(Et,Mt.children),Mt=Et.pop();return gt},z.prototype._build=function(Mt,gt,Et,Ft){var Ie,de=Et-gt+1,xe=this._maxEntries;if(de<=xe)return a(Ie=Oe(Mt.slice(gt,Et+1)),this.toBBox),Ie;Ft||(Ft=Math.ceil(Math.log(de)/Math.log(xe)),xe=Math.ceil(de/Math.pow(xe,Ft-1))),(Ie=Oe([])).leaf=!1,Ie.height=Ft;var $t=Math.ceil(de/xe),yt=$t*Math.ceil(Math.sqrt(xe));Ge(Mt,gt,Et,yt,this.compareMinX);for(var ue=gt;ue<=Et;ue+=yt){var Kt=Math.min(ue+yt-1,Et);Ge(Mt,ue,Kt,$t,this.compareMinY);for(var ae=ue;ae<=Kt;ae+=$t){var wt=Math.min(ae+$t-1,Kt);Ie.children.push(this._build(Mt,ae,wt,Ft-1))}}return a(Ie,this.toBBox),Ie},z.prototype._chooseSubtree=function(Mt,gt,Et,Ft){for(;Ft.push(gt),!gt.leaf&&Ft.length-1!==Et;){for(var Ie=1/0,de=1/0,xe=void 0,$t=0;$t<gt.children.length;$t++){var yt=gt.children[$t],ue=At(yt),Kt=(ae=Mt,wt=yt,(Math.max(wt.maxX,ae.maxX)-Math.min(wt.minX,ae.minX))*(Math.max(wt.maxY,ae.maxY)-Math.min(wt.minY,ae.minY))-ue);Kt<de?(de=Kt,Ie=ue<Ie?ue:Ie,xe=yt):Kt===de&&ue<Ie&&(Ie=ue,xe=yt)}gt=xe||gt.children[0]}var ae,wt;return gt},z.prototype._insert=function(Mt,gt,Et){var Ft=Et?Mt:this.toBBox(Mt),Ie=[],de=this._chooseSubtree(Ft,this.data,gt,Ie);for(de.children.push(Mt),ot(de,Ft);gt>=0&&Ie[gt].children.length>this._maxEntries;)this._split(Ie,gt),gt--;this._adjustParentBBoxes(Ft,Ie,gt)},z.prototype._split=function(Mt,gt){var Et=Mt[gt],Ft=Et.children.length,Ie=this._minEntries;this._chooseSplitAxis(Et,Ie,Ft);var de=this._chooseSplitIndex(Et,Ie,Ft),xe=Oe(Et.children.splice(de,Et.children.length-de));xe.height=Et.height,xe.leaf=Et.leaf,a(Et,this.toBBox),a(xe,this.toBBox),gt?Mt[gt-1].children.push(xe):this._splitRoot(Et,xe)},z.prototype._splitRoot=function(Mt,gt){this.data=Oe([Mt,gt]),this.data.height=Mt.height+1,this.data.leaf=!1,a(this.data,this.toBBox)},z.prototype._chooseSplitIndex=function(Mt,gt,Et){for(var Ft,Ie,de,xe,$t,yt,ue,Kt=1/0,ae=1/0,wt=gt;wt<=Et-gt;wt++){var _i=G(Mt,0,wt,this.toBBox),Ne=G(Mt,wt,Et,this.toBBox),Tr=(Ie=_i,de=Ne,xe=void 0,$t=void 0,yt=void 0,ue=void 0,xe=Math.max(Ie.minX,de.minX),$t=Math.max(Ie.minY,de.minY),yt=Math.min(Ie.maxX,de.maxX),ue=Math.min(Ie.maxY,de.maxY),Math.max(0,yt-xe)*Math.max(0,ue-$t)),Ye=At(_i)+At(Ne);Tr<Kt?(Kt=Tr,Ft=wt,ae=Ye<ae?Ye:ae):Tr===Kt&&Ye<ae&&(ae=Ye,Ft=wt)}return Ft||Et-gt},z.prototype._chooseSplitAxis=function(Mt,gt,Et){var Ft=Mt.leaf?this.compareMinX:Rt,Ie=Mt.leaf?this.compareMinY:xt;this._allDistMargin(Mt,gt,Et,Ft)<this._allDistMargin(Mt,gt,Et,Ie)&&Mt.children.sort(Ft)},z.prototype._allDistMargin=function(Mt,gt,Et,Ft){Mt.children.sort(Ft);for(var Ie=this.toBBox,de=G(Mt,0,gt,Ie),xe=G(Mt,Et-gt,Et,Ie),$t=qt(de)+qt(xe),yt=gt;yt<Et-gt;yt++){var ue=Mt.children[yt];ot(de,Mt.leaf?Ie(ue):ue),$t+=qt(de)}for(var Kt=Et-gt-1;Kt>=gt;Kt--){var ae=Mt.children[Kt];ot(xe,Mt.leaf?Ie(ae):ae),$t+=qt(xe)}return $t},z.prototype._adjustParentBBoxes=function(Mt,gt,Et){for(var Ft=Et;Ft>=0;Ft--)ot(gt[Ft],Mt)},z.prototype._condense=function(Mt){for(var gt=Mt.length-1,Et=void 0;gt>=0;gt--)Mt[gt].children.length===0?gt>0?(Et=Mt[gt-1].children).splice(Et.indexOf(Mt[gt]),1):this.clear():a(Mt[gt],this.toBBox)},z})})(fd);class Y0{constructor(T=[],E=H0){if(this.data=T,this.length=this.data.length,this.compare=E,this.length>0)for(let A=(this.length>>1)-1;A>=0;A--)this._down(A)}push(T){this.data.push(T),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const T=this.data[0],E=this.data.pop();return this.length--,this.length>0&&(this.data[0]=E,this._down(0)),T}peek(){return this.data[0]}_up(T){const{data:E,compare:A}=this,D=E[T];for(;T>0;){const z=T-1>>1,U=E[z];if(A(D,U)>=0)break;E[T]=U,T=z}E[T]=D}_down(T){const{data:E,compare:A}=this,D=this.length>>1,z=E[T];for(;T<D;){let U=(T<<1)+1,a=E[U];const G=U+1;if(G<this.length&&A(E[G],a)<0&&(U=G,a=E[G]),A(a,z)>=0)break;E[T]=a,T=U}E[T]=z}}function H0(b,T){return b<T?-1:b>T?1:0}var K0=Object.freeze({__proto__:null,default:Y0}),J0=q0(K0),dp={exports:{}},Q0=function(T,E,A,D){var z=T[0],U=T[1],a=!1;A===void 0&&(A=0),D===void 0&&(D=E.length);for(var G=(D-A)/2,ot=0,Rt=G-1;ot<G;Rt=ot++){var xt=E[A+ot*2+0],At=E[A+ot*2+1],qt=E[A+Rt*2+0],re=E[A+Rt*2+1],ee=At>U!=re>U&&z<(qt-xt)*(U-At)/(re-At)+xt;ee&&(a=!a)}return a},t1=function(T,E,A,D){var z=T[0],U=T[1],a=!1;A===void 0&&(A=0),D===void 0&&(D=E.length);for(var G=D-A,ot=0,Rt=G-1;ot<G;Rt=ot++){var xt=E[ot+A][0],At=E[ot+A][1],qt=E[Rt+A][0],re=E[Rt+A][1],ee=At>U!=re>U&&z<(qt-xt)*(U-At)/(re-At)+xt;ee&&(a=!a)}return a},py=Q0,fy=t1;dp.exports=function(T,E,A,D){return E.length>0&&Array.isArray(E[0])?fy(T,E,A,D):py(T,E,A,D)};dp.exports.nested=fy;dp.exports.flat=py;var Qf={exports:{}};(function(b,T){(function(E,A){A(T)})(ih,function(E){const D=33306690738754706e-32;function z(ee,Oe,Ge,Mt,gt){let Et,Ft,Ie,de,xe=Oe[0],$t=Mt[0],yt=0,ue=0;$t>xe==$t>-xe?(Et=xe,xe=Oe[++yt]):(Et=$t,$t=Mt[++ue]);let Kt=0;if(yt<ee&&ue<Ge)for($t>xe==$t>-xe?(Ie=Et-((Ft=xe+Et)-xe),xe=Oe[++yt]):(Ie=Et-((Ft=$t+Et)-$t),$t=Mt[++ue]),Et=Ft,Ie!==0&&(gt[Kt++]=Ie);yt<ee&&ue<Ge;)$t>xe==$t>-xe?(Ie=Et-((Ft=Et+xe)-(de=Ft-Et))+(xe-de),xe=Oe[++yt]):(Ie=Et-((Ft=Et+$t)-(de=Ft-Et))+($t-de),$t=Mt[++ue]),Et=Ft,Ie!==0&&(gt[Kt++]=Ie);for(;yt<ee;)Ie=Et-((Ft=Et+xe)-(de=Ft-Et))+(xe-de),xe=Oe[++yt],Et=Ft,Ie!==0&&(gt[Kt++]=Ie);for(;ue<Ge;)Ie=Et-((Ft=Et+$t)-(de=Ft-Et))+($t-de),$t=Mt[++ue],Et=Ft,Ie!==0&&(gt[Kt++]=Ie);return Et===0&&Kt!==0||(gt[Kt++]=Et),Kt}function U(ee){return new Float64Array(ee)}const a=33306690738754716e-32,G=22204460492503146e-32,ot=11093356479670487e-47,Rt=U(4),xt=U(8),At=U(12),qt=U(16),re=U(4);E.orient2d=function(ee,Oe,Ge,Mt,gt,Et){const Ft=(Oe-Et)*(Ge-gt),Ie=(ee-gt)*(Mt-Et),de=Ft-Ie;if(Ft===0||Ie===0||Ft>0!=Ie>0)return de;const xe=Math.abs(Ft+Ie);return Math.abs(de)>=a*xe?de:-function($t,yt,ue,Kt,ae,wt,_i){let Ne,Tr,Ye,ti,Pe,tr,Ot,ur,pr,Li,je,Zr,Tn,oi,Br,He,qe,jr;const pi=$t-ae,Dr=ue-ae,Hr=yt-wt,rn=Kt-wt;Pe=(Br=(ur=pi-(Ot=(tr=134217729*pi)-(tr-pi)))*(Li=rn-(pr=(tr=134217729*rn)-(tr-rn)))-((oi=pi*rn)-Ot*pr-ur*pr-Ot*Li))-(je=Br-(qe=(ur=Hr-(Ot=(tr=134217729*Hr)-(tr-Hr)))*(Li=Dr-(pr=(tr=134217729*Dr)-(tr-Dr)))-((He=Hr*Dr)-Ot*pr-ur*pr-Ot*Li))),Rt[0]=Br-(je+Pe)+(Pe-qe),Pe=(Tn=oi-((Zr=oi+je)-(Pe=Zr-oi))+(je-Pe))-(je=Tn-He),Rt[1]=Tn-(je+Pe)+(Pe-He),Pe=(jr=Zr+je)-Zr,Rt[2]=Zr-(jr-Pe)+(je-Pe),Rt[3]=jr;let ii=function(ft,Dt){let Jt=Dt[0];for(let pe=1;pe<ft;pe++)Jt+=Dt[pe];return Jt}(4,Rt),zt=G*_i;if(ii>=zt||-ii>=zt||(Ne=$t-(pi+(Pe=$t-pi))+(Pe-ae),Ye=ue-(Dr+(Pe=ue-Dr))+(Pe-ae),Tr=yt-(Hr+(Pe=yt-Hr))+(Pe-wt),ti=Kt-(rn+(Pe=Kt-rn))+(Pe-wt),Ne===0&&Tr===0&&Ye===0&&ti===0)||(zt=ot*_i+D*Math.abs(ii),(ii+=pi*ti+rn*Ne-(Hr*Ye+Dr*Tr))>=zt||-ii>=zt))return ii;Pe=(Br=(ur=Ne-(Ot=(tr=134217729*Ne)-(tr-Ne)))*(Li=rn-(pr=(tr=134217729*rn)-(tr-rn)))-((oi=Ne*rn)-Ot*pr-ur*pr-Ot*Li))-(je=Br-(qe=(ur=Tr-(Ot=(tr=134217729*Tr)-(tr-Tr)))*(Li=Dr-(pr=(tr=134217729*Dr)-(tr-Dr)))-((He=Tr*Dr)-Ot*pr-ur*pr-Ot*Li))),re[0]=Br-(je+Pe)+(Pe-qe),Pe=(Tn=oi-((Zr=oi+je)-(Pe=Zr-oi))+(je-Pe))-(je=Tn-He),re[1]=Tn-(je+Pe)+(Pe-He),Pe=(jr=Zr+je)-Zr,re[2]=Zr-(jr-Pe)+(je-Pe),re[3]=jr;const J=z(4,Rt,4,re,xt);Pe=(Br=(ur=pi-(Ot=(tr=134217729*pi)-(tr-pi)))*(Li=ti-(pr=(tr=134217729*ti)-(tr-ti)))-((oi=pi*ti)-Ot*pr-ur*pr-Ot*Li))-(je=Br-(qe=(ur=Hr-(Ot=(tr=134217729*Hr)-(tr-Hr)))*(Li=Ye-(pr=(tr=134217729*Ye)-(tr-Ye)))-((He=Hr*Ye)-Ot*pr-ur*pr-Ot*Li))),re[0]=Br-(je+Pe)+(Pe-qe),Pe=(Tn=oi-((Zr=oi+je)-(Pe=Zr-oi))+(je-Pe))-(je=Tn-He),re[1]=Tn-(je+Pe)+(Pe-He),Pe=(jr=Zr+je)-Zr,re[2]=Zr-(jr-Pe)+(je-Pe),re[3]=jr;const Z=z(J,xt,4,re,At);Pe=(Br=(ur=Ne-(Ot=(tr=134217729*Ne)-(tr-Ne)))*(Li=ti-(pr=(tr=134217729*ti)-(tr-ti)))-((oi=Ne*ti)-Ot*pr-ur*pr-Ot*Li))-(je=Br-(qe=(ur=Tr-(Ot=(tr=134217729*Tr)-(tr-Tr)))*(Li=Ye-(pr=(tr=134217729*Ye)-(tr-Ye)))-((He=Tr*Ye)-Ot*pr-ur*pr-Ot*Li))),re[0]=Br-(je+Pe)+(Pe-qe),Pe=(Tn=oi-((Zr=oi+je)-(Pe=Zr-oi))+(je-Pe))-(je=Tn-He),re[1]=Tn-(je+Pe)+(Pe-He),Pe=(jr=Zr+je)-Zr,re[2]=Zr-(jr-Pe)+(je-Pe),re[3]=jr;const H=z(Z,At,4,re,qt);return qt[H-1]}(ee,Oe,Ge,Mt,gt,Et,xe)},E.orient2dfast=function(ee,Oe,Ge,Mt,gt,Et){return(Oe-Et)*(Ge-gt)-(ee-gt)*(Mt-Et)},Object.defineProperty(E,"__esModule",{value:!0})})})(Qf,Qf.exports);var c_=fd.exports,rp=J0,e1=dp.exports,r1=Qf.exports.orient2d;rp.default&&(rp=rp.default);hy.exports=dy;hy.exports.default=dy;function dy(b,T,E){T=Math.max(0,T===void 0?2:T),E=E||0;var A=a1(b),D=new c_(16);D.toBBox=function(Mt){return{minX:Mt[0],minY:Mt[1],maxX:Mt[0],maxY:Mt[1]}},D.compareMinX=function(Mt,gt){return Mt[0]-gt[0]},D.compareMinY=function(Mt,gt){return Mt[1]-gt[1]},D.load(b);for(var z=[],U=0,a;U<A.length;U++){var G=A[U];D.remove(G),a=f_(G,a),z.push(a)}var ot=new c_(16);for(U=0;U<z.length;U++)ot.insert(Of(z[U]));for(var Rt=T*T,xt=E*E;z.length;){var At=z.shift(),qt=At.p,re=At.next.p,ee=Nf(qt,re);if(!(ee<xt)){var Oe=ee/Rt;G=i1(D,At.prev.p,qt,re,At.next.next.p,Oe,ot),G&&Math.min(Nf(G,qt),Nf(G,re))<=Oe&&(z.push(At),z.push(f_(G,At)),D.remove(G),ot.remove(At),ot.insert(Of(At)),ot.insert(Of(At.next)))}}At=a;var Ge=[];do Ge.push(At.p),At=At.next;while(At!==a);return Ge.push(At.p),Ge}function i1(b,T,E,A,D,z,U){for(var a=new rp([],n1),G=b.data;G;){for(var ot=0;ot<G.children.length;ot++){var Rt=G.children[ot],xt=G.leaf?zf(Rt,E,A):o1(E,A,Rt);xt>z||a.push({node:Rt,dist:xt})}for(;a.length&&!a.peek().node.children;){var At=a.pop(),qt=At.node,re=zf(qt,T,E),ee=zf(qt,A,D);if(At.dist<re&&At.dist<ee&&p_(E,qt,U)&&p_(A,qt,U))return qt}G=a.pop(),G&&(G=G.node)}return null}function n1(b,T){return b.dist-T.dist}function o1(b,T,E){if(h_(b,E)||h_(T,E))return 0;var A=Yh(b[0],b[1],T[0],T[1],E.minX,E.minY,E.maxX,E.minY);if(A===0)return 0;var D=Yh(b[0],b[1],T[0],T[1],E.minX,E.minY,E.minX,E.maxY);if(D===0)return 0;var z=Yh(b[0],b[1],T[0],T[1],E.maxX,E.minY,E.maxX,E.maxY);if(z===0)return 0;var U=Yh(b[0],b[1],T[0],T[1],E.minX,E.maxY,E.maxX,E.maxY);return U===0?0:Math.min(A,D,z,U)}function h_(b,T){return b[0]>=T.minX&&b[0]<=T.maxX&&b[1]>=T.minY&&b[1]<=T.maxY}function p_(b,T,E){for(var A=Math.min(b[0],T[0]),D=Math.min(b[1],T[1]),z=Math.max(b[0],T[0]),U=Math.max(b[1],T[1]),a=E.search({minX:A,minY:D,maxX:z,maxY:U}),G=0;G<a.length;G++)if(s1(a[G].p,a[G].next.p,b,T))return!1;return!0}function Bu(b,T,E){return r1(b[0],b[1],T[0],T[1],E[0],E[1])}function s1(b,T,E,A){return b!==A&&T!==E&&Bu(b,T,E)>0!=Bu(b,T,A)>0&&Bu(E,A,b)>0!=Bu(E,A,T)>0}function Of(b){var T=b.p,E=b.next.p;return b.minX=Math.min(T[0],E[0]),b.minY=Math.min(T[1],E[1]),b.maxX=Math.max(T[0],E[0]),b.maxY=Math.max(T[1],E[1]),b}function a1(b){for(var T=b[0],E=b[0],A=b[0],D=b[0],z=0;z<b.length;z++){var U=b[z];U[0]<T[0]&&(T=U),U[0]>A[0]&&(A=U),U[1]<E[1]&&(E=U),U[1]>D[1]&&(D=U)}var a=[T,E,A,D],G=a.slice();for(z=0;z<b.length;z++)e1(b[z],a)||G.push(b[z]);return u1(G)}function f_(b,T){var E={p:b,prev:null,next:null,minX:0,minY:0,maxX:0,maxY:0};return T?(E.next=T.next,E.prev=T,T.next.prev=E,T.next=E):(E.prev=E,E.next=E),E}function Nf(b,T){var E=b[0]-T[0],A=b[1]-T[1];return E*E+A*A}function zf(b,T,E){var A=T[0],D=T[1],z=E[0]-A,U=E[1]-D;if(z!==0||U!==0){var a=((b[0]-A)*z+(b[1]-D)*U)/(z*z+U*U);a>1?(A=E[0],D=E[1]):a>0&&(A+=z*a,D+=U*a)}return z=b[0]-A,U=b[1]-D,z*z+U*U}function Yh(b,T,E,A,D,z,U,a){var G=E-b,ot=A-T,Rt=U-D,xt=a-z,At=b-D,qt=T-z,re=G*G+ot*ot,ee=G*Rt+ot*xt,Oe=Rt*Rt+xt*xt,Ge=G*At+ot*qt,Mt=Rt*At+xt*qt,gt=re*Oe-ee*ee,Et,Ft,Ie,de,xe=gt,$t=gt;gt===0?(Ft=0,xe=1,de=Mt,$t=Oe):(Ft=ee*Mt-Oe*Ge,de=re*Mt-ee*Ge,Ft<0?(Ft=0,de=Mt,$t=Oe):Ft>xe&&(Ft=xe,de=Mt+ee,$t=Oe)),de<0?(de=0,-Ge<0?Ft=0:-Ge>re?Ft=xe:(Ft=-Ge,xe=re)):de>$t&&(de=$t,-Ge+ee<0?Ft=0:-Ge+ee>re?Ft=xe:(Ft=-Ge+ee,xe=re)),Et=Ft===0?0:Ft/xe,Ie=de===0?0:de/$t;var yt=(1-Et)*b+Et*E,ue=(1-Et)*T+Et*A,Kt=(1-Ie)*D+Ie*U,ae=(1-Ie)*z+Ie*a,wt=Kt-yt,_i=ae-ue;return wt*wt+_i*_i}function l1(b,T){return b[0]===T[0]?b[1]-T[1]:b[0]-T[0]}function u1(b){b.sort(l1);for(var T=[],E=0;E<b.length;E++){for(;T.length>=2&&Bu(T[T.length-2],T[T.length-1],b[E])<=0;)T.pop();T.push(b[E])}for(var A=[],D=b.length-1;D>=0;D--){for(;A.length>=2&&Bu(A[A.length-2],A[A.length-1],b[D])<=0;)A.pop();A.push(b[D])}return A.pop(),T.pop(),T.concat(A)}function my(b,T,E){if(E===void 0&&(E={}),!b)throw new Error("point is required");if(!T)throw new Error("polygon is required");var A=G0(b),D=j0(T),z=D.type,U=T.bbox,a=D.coordinates;if(U&&c1(A,U)===!1)return!1;z==="Polygon"&&(a=[a]);for(var G=!1,ot=0;ot<a.length&&!G;ot++)if(d_(A,a[ot][0],E.ignoreBoundary)){for(var Rt=!1,xt=1;xt<a[ot].length&&!Rt;)d_(A,a[ot][xt],!E.ignoreBoundary)&&(Rt=!0),xt++;Rt||(G=!0)}return G}function d_(b,T,E){var A=!1;T[0][0]===T[T.length-1][0]&&T[0][1]===T[T.length-1][1]&&(T=T.slice(0,T.length-1));for(var D=0,z=T.length-1;D<T.length;z=D++){var U=T[D][0],a=T[D][1],G=T[z][0],ot=T[z][1],Rt=b[1]*(U-G)+a*(G-b[0])+ot*(b[0]-U)===0&&(U-b[0])*(G-b[0])<=0&&(a-b[1])*(ot-b[1])<=0;if(Rt)return!E;var xt=a>b[1]!=ot>b[1]&&b[0]<(G-U)*(b[1]-a)/(ot-a)+U;xt&&(A=!A)}return A}function c1(b,T){return T[0]<=b[0]&&T[1]<=b[1]&&T[2]>=b[0]&&T[3]>=b[1]}var gy={exports:{}},_y={exports:{}};(function(b,T){(function(E,A){b.exports=A()})(ih,function(){function E(U,a,G,ot,Rt){A(U,a,G||0,ot||U.length-1,Rt||z)}function A(U,a,G,ot,Rt){for(;ot>G;){if(ot-G>600){var xt=ot-G+1,At=a-G+1,qt=Math.log(xt),re=.5*Math.exp(2*qt/3),ee=.5*Math.sqrt(qt*re*(xt-re)/xt)*(At-xt/2<0?-1:1),Oe=Math.max(G,Math.floor(a-At*re/xt+ee)),Ge=Math.min(ot,Math.floor(a+(xt-At)*re/xt+ee));A(U,a,Oe,Ge,Rt)}var Mt=U[a],gt=G,Et=ot;for(D(U,G,a),Rt(U[ot],Mt)>0&&D(U,G,ot);gt<Et;){for(D(U,gt,Et),gt++,Et--;Rt(U[gt],Mt)<0;)gt++;for(;Rt(U[Et],Mt)>0;)Et--}Rt(U[G],Mt)===0?D(U,G,Et):(Et++,D(U,Et,ot)),Et<=a&&(G=Et+1),a<=Et&&(ot=Et-1)}}function D(U,a,G){var ot=U[a];U[a]=U[G],U[G]=ot}function z(U,a){return U<a?-1:U>a?1:0}return E})})(_y);gy.exports=Yc;gy.exports.default=Yc;var h1=_y.exports;function Yc(b,T){if(!(this instanceof Yc))return new Yc(b,T);this._maxEntries=Math.max(4,b||9),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),T&&this._initFormat(T),this.clear()}Yc.prototype={all:function(){return this._all(this.data,[])},search:function(b){var T=this.data,E=[],A=this.toBBox;if(!Kh(b,T))return E;for(var D=[],z,U,a,G;T;){for(z=0,U=T.children.length;z<U;z++)a=T.children[z],G=T.leaf?A(a):a,Kh(b,G)&&(T.leaf?E.push(a):Bf(b,G)?this._all(a,E):D.push(a));T=D.pop()}return E},collides:function(b){var T=this.data,E=this.toBBox;if(!Kh(b,T))return!1;for(var A=[],D,z,U,a;T;){for(D=0,z=T.children.length;D<z;D++)if(U=T.children[D],a=T.leaf?E(U):U,Kh(b,a)){if(T.leaf||Bf(b,a))return!0;A.push(U)}T=A.pop()}return!1},load:function(b){if(!(b&&b.length))return this;if(b.length<this._minEntries){for(var T=0,E=b.length;T<E;T++)this.insert(b[T]);return this}var A=this._build(b.slice(),0,b.length-1,0);if(!this.data.children.length)this.data=A;else if(this.data.height===A.height)this._splitRoot(this.data,A);else{if(this.data.height<A.height){var D=this.data;this.data=A,A=D}this._insert(A,this.data.height-A.height-1,!0)}return this},insert:function(b){return b&&this._insert(b,this.data.height-1),this},clear:function(){return this.data=zu([]),this},remove:function(b,T){if(!b)return this;for(var E=this.data,A=this.toBBox(b),D=[],z=[],U,a,G,ot;E||D.length;){if(E||(E=D.pop(),a=D[D.length-1],U=z.pop(),ot=!0),E.leaf&&(G=p1(b,E.children,T),G!==-1))return E.children.splice(G,1),D.push(E),this._condense(D),this;!ot&&!E.leaf&&Bf(E,A)?(D.push(E),z.push(U),U=0,a=E,E=E.children[0]):a?(U++,E=a.children[U],ot=!1):E=null}return this},toBBox:function(b){return b},compareMinX:m_,compareMinY:g_,toJSON:function(){return this.data},fromJSON:function(b){return this.data=b,this},_all:function(b,T){for(var E=[];b;)b.leaf?T.push.apply(T,b.children):E.push.apply(E,b.children),b=E.pop();return T},_build:function(b,T,E,A){var D=E-T+1,z=this._maxEntries,U;if(D<=z)return U=zu(b.slice(T,E+1)),Du(U,this.toBBox),U;A||(A=Math.ceil(Math.log(D)/Math.log(z)),z=Math.ceil(D/Math.pow(z,A-1))),U=zu([]),U.leaf=!1,U.height=A;var a=Math.ceil(D/z),G=a*Math.ceil(Math.sqrt(z)),ot,Rt,xt,At;for(__(b,T,E,G,this.compareMinX),ot=T;ot<=E;ot+=G)for(xt=Math.min(ot+G-1,E),__(b,ot,xt,a,this.compareMinY),Rt=ot;Rt<=xt;Rt+=a)At=Math.min(Rt+a-1,xt),U.children.push(this._build(b,Rt,At,A-1));return Du(U,this.toBBox),U},_chooseSubtree:function(b,T,E,A){for(var D,z,U,a,G,ot,Rt,xt;A.push(T),!(T.leaf||A.length-1===E);){for(Rt=xt=1/0,D=0,z=T.children.length;D<z;D++)U=T.children[D],G=kf(U),ot=f1(b,U)-G,ot<xt?(xt=ot,Rt=G<Rt?G:Rt,a=U):ot===xt&&G<Rt&&(Rt=G,a=U);T=a||T.children[0]}return T},_insert:function(b,T,E){var A=this.toBBox,D=E?b:A(b),z=[],U=this._chooseSubtree(D,this.data,T,z);for(U.children.push(b),qc(U,D);T>=0&&z[T].children.length>this._maxEntries;)this._split(z,T),T--;this._adjustParentBBoxes(D,z,T)},_split:function(b,T){var E=b[T],A=E.children.length,D=this._minEntries;this._chooseSplitAxis(E,D,A);var z=this._chooseSplitIndex(E,D,A),U=zu(E.children.splice(z,E.children.length-z));U.height=E.height,U.leaf=E.leaf,Du(E,this.toBBox),Du(U,this.toBBox),T?b[T-1].children.push(U):this._splitRoot(E,U)},_splitRoot:function(b,T){this.data=zu([b,T]),this.data.height=b.height+1,this.data.leaf=!1,Du(this.data,this.toBBox)},_chooseSplitIndex:function(b,T,E){var A,D,z,U,a,G,ot,Rt;for(G=ot=1/0,A=T;A<=E-T;A++)D=jc(b,0,A,this.toBBox),z=jc(b,A,E,this.toBBox),U=d1(D,z),a=kf(D)+kf(z),U<G?(G=U,Rt=A,ot=a<ot?a:ot):U===G&&a<ot&&(ot=a,Rt=A);return Rt},_chooseSplitAxis:function(b,T,E){var A=b.leaf?this.compareMinX:m_,D=b.leaf?this.compareMinY:g_,z=this._allDistMargin(b,T,E,A),U=this._allDistMargin(b,T,E,D);z<U&&b.children.sort(A)},_allDistMargin:function(b,T,E,A){b.children.sort(A);var D=this.toBBox,z=jc(b,0,T,D),U=jc(b,E-T,E,D),a=Hh(z)+Hh(U),G,ot;for(G=T;G<E-T;G++)ot=b.children[G],qc(z,b.leaf?D(ot):ot),a+=Hh(z);for(G=E-T-1;G>=T;G--)ot=b.children[G],qc(U,b.leaf?D(ot):ot),a+=Hh(U);return a},_adjustParentBBoxes:function(b,T,E){for(var A=E;A>=0;A--)qc(T[A],b)},_condense:function(b){for(var T=b.length-1,E;T>=0;T--)b[T].children.length===0?T>0?(E=b[T-1].children,E.splice(E.indexOf(b[T]),1)):this.clear():Du(b[T],this.toBBox)},_initFormat:function(b){var T=["return a"," - b",";"];this.compareMinX=new Function("a","b",T.join(b[0])),this.compareMinY=new Function("a","b",T.join(b[1])),this.toBBox=new Function("a","return {minX: a"+b[0]+", minY: a"+b[1]+", maxX: a"+b[2]+", maxY: a"+b[3]+"};")}};function p1(b,T,E){if(!E)return T.indexOf(b);for(var A=0;A<T.length;A++)if(E(b,T[A]))return A;return-1}function Du(b,T){jc(b,0,b.children.length,T,b)}function jc(b,T,E,A,D){D||(D=zu(null)),D.minX=1/0,D.minY=1/0,D.maxX=-1/0,D.maxY=-1/0;for(var z=T,U;z<E;z++)U=b.children[z],qc(D,b.leaf?A(U):U);return D}function qc(b,T){return b.minX=Math.min(b.minX,T.minX),b.minY=Math.min(b.minY,T.minY),b.maxX=Math.max(b.maxX,T.maxX),b.maxY=Math.max(b.maxY,T.maxY),b}function m_(b,T){return b.minX-T.minX}function g_(b,T){return b.minY-T.minY}function kf(b){return(b.maxX-b.minX)*(b.maxY-b.minY)}function Hh(b){return b.maxX-b.minX+(b.maxY-b.minY)}function f1(b,T){return(Math.max(T.maxX,b.maxX)-Math.min(T.minX,b.minX))*(Math.max(T.maxY,b.maxY)-Math.min(T.minY,b.minY))}function d1(b,T){var E=Math.max(b.minX,T.minX),A=Math.max(b.minY,T.minY),D=Math.min(b.maxX,T.maxX),z=Math.min(b.maxY,T.maxY);return Math.max(0,D-E)*Math.max(0,z-A)}function Bf(b,T){return b.minX<=T.minX&&b.minY<=T.minY&&T.maxX<=b.maxX&&T.maxY<=b.maxY}function Kh(b,T){return T.minX<=b.maxX&&T.minY<=b.maxY&&T.maxX>=b.minX&&T.maxY>=b.minY}function zu(b){return{children:b,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function __(b,T,E,A,D){for(var z=[T,E],U;z.length;)E=z.pop(),T=z.pop(),!(E-T<=A)&&(U=T+Math.ceil((E-T)/A/2)*A,h1(b,U,T,E,D),z.push(T,U,U,E))}function m1(b,T){T===void 0&&(T={});var E=Number(b[0]),A=Number(b[1]),D=Number(b[2]),z=Number(b[3]);if(b.length===6)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var U=[E,A],a=[E,z],G=[D,z],ot=[D,A];return uy([[U,ot,G,a,U]],T.properties,{bbox:b,id:T.id})}function yy(b){return m1(Jf(b))}var vy={exports:{}};vy.exports=mp;vy.exports.default=mp;function mp(b,T,E){E=E||2;var A=T&&T.length,D=A?T[0]*E:b.length,z=xy(b,0,D,E,!0),U=[];if(!z||z.next===z.prev)return U;var a,G,ot,Rt,xt,At,qt;if(A&&(z=x1(b,T,z,E)),b.length>80*E){a=ot=b[0],G=Rt=b[1];for(var re=E;re<D;re+=E)xt=b[re],At=b[re+1],xt<a&&(a=xt),At<G&&(G=At),xt>ot&&(ot=xt),At>Rt&&(Rt=At);qt=Math.max(ot-a,Rt-G),qt=qt!==0?32767/qt:0}return Hc(z,U,E,a,G,qt,0),U}function xy(b,T,E,A,D){var z,U;if(D===rd(b,T,E,A)>0)for(z=T;z<E;z+=A)U=y_(z,b[z],b[z+1],U);else for(z=E-A;z>=T;z-=A)U=y_(z,b[z],b[z+1],U);return U&&gp(U,U.next)&&(Jc(U),U=U.next),U}function nu(b,T){if(!b)return b;T||(T=b);var E=b,A;do if(A=!1,!E.steiner&&(gp(E,E.next)||Vn(E.prev,E,E.next)===0)){if(Jc(E),E=T=E.prev,E===E.next)break;A=!0}else E=E.next;while(A||E!==T);return T}function Hc(b,T,E,A,D,z,U){if(b){!U&&z&&I1(b,A,D,z);for(var a=b,G,ot;b.prev!==b.next;){if(G=b.prev,ot=b.next,z?_1(b,A,D,z):g1(b)){T.push(G.i/E|0),T.push(b.i/E|0),T.push(ot.i/E|0),Jc(b),b=ot.next,a=ot.next;continue}if(b=ot,b===a){U?U===1?(b=y1(nu(b),T,E),Hc(b,T,E,A,D,z,2)):U===2&&v1(b,T,E,A,D,z):Hc(nu(b),T,E,A,D,z,1);break}}}}function g1(b){var T=b.prev,E=b,A=b.next;if(Vn(T,E,A)>=0)return!1;for(var D=T.x,z=E.x,U=A.x,a=T.y,G=E.y,ot=A.y,Rt=D<z?D<U?D:U:z<U?z:U,xt=a<G?a<ot?a:ot:G<ot?G:ot,At=D>z?D>U?D:U:z>U?z:U,qt=a>G?a>ot?a:ot:G>ot?G:ot,re=A.next;re!==T;){if(re.x>=Rt&&re.x<=At&&re.y>=xt&&re.y<=qt&&Fu(D,a,z,G,U,ot,re.x,re.y)&&Vn(re.prev,re,re.next)>=0)return!1;re=re.next}return!0}function _1(b,T,E,A){var D=b.prev,z=b,U=b.next;if(Vn(D,z,U)>=0)return!1;for(var a=D.x,G=z.x,ot=U.x,Rt=D.y,xt=z.y,At=U.y,qt=a<G?a<ot?a:ot:G<ot?G:ot,re=Rt<xt?Rt<At?Rt:At:xt<At?xt:At,ee=a>G?a>ot?a:ot:G>ot?G:ot,Oe=Rt>xt?Rt>At?Rt:At:xt>At?xt:At,Ge=td(qt,re,T,E,A),Mt=td(ee,Oe,T,E,A),gt=b.prevZ,Et=b.nextZ;gt&&gt.z>=Ge&&Et&&Et.z<=Mt;){if(gt.x>=qt&&gt.x<=ee&&gt.y>=re&&gt.y<=Oe&&gt!==D&&gt!==U&&Fu(a,Rt,G,xt,ot,At,gt.x,gt.y)&&Vn(gt.prev,gt,gt.next)>=0||(gt=gt.prevZ,Et.x>=qt&&Et.x<=ee&&Et.y>=re&&Et.y<=Oe&&Et!==D&&Et!==U&&Fu(a,Rt,G,xt,ot,At,Et.x,Et.y)&&Vn(Et.prev,Et,Et.next)>=0))return!1;Et=Et.nextZ}for(;gt&&gt.z>=Ge;){if(gt.x>=qt&&gt.x<=ee&&gt.y>=re&&gt.y<=Oe&&gt!==D&&gt!==U&&Fu(a,Rt,G,xt,ot,At,gt.x,gt.y)&&Vn(gt.prev,gt,gt.next)>=0)return!1;gt=gt.prevZ}for(;Et&&Et.z<=Mt;){if(Et.x>=qt&&Et.x<=ee&&Et.y>=re&&Et.y<=Oe&&Et!==D&&Et!==U&&Fu(a,Rt,G,xt,ot,At,Et.x,Et.y)&&Vn(Et.prev,Et,Et.next)>=0)return!1;Et=Et.nextZ}return!0}function y1(b,T,E){var A=b;do{var D=A.prev,z=A.next.next;!gp(D,z)&&by(D,A,A.next,z)&&Kc(D,z)&&Kc(z,D)&&(T.push(D.i/E|0),T.push(A.i/E|0),T.push(z.i/E|0),Jc(A),Jc(A.next),A=b=z),A=A.next}while(A!==b);return nu(A)}function v1(b,T,E,A,D,z){var U=b;do{for(var a=U.next.next;a!==U.prev;){if(U.i!==a.i&&M1(U,a)){var G=wy(U,a);U=nu(U,U.next),G=nu(G,G.next),Hc(U,T,E,A,D,z,0),Hc(G,T,E,A,D,z,0);return}a=a.next}U=U.next}while(U!==b)}function x1(b,T,E,A){var D=[],z,U,a,G,ot;for(z=0,U=T.length;z<U;z++)a=T[z]*A,G=z<U-1?T[z+1]*A:b.length,ot=xy(b,a,G,A,!1),ot===ot.next&&(ot.steiner=!0),D.push(C1(ot));for(D.sort(b1),z=0;z<D.length;z++)E=w1(D[z],E);return E}function b1(b,T){return b.x-T.x}function w1(b,T){var E=E1(b,T);if(!E)return T;var A=wy(E,b);return nu(A,A.next),nu(E,E.next)}function E1(b,T){var E=T,A=b.x,D=b.y,z=-1/0,U;do{if(D<=E.y&&D>=E.next.y&&E.next.y!==E.y){var a=E.x+(D-E.y)*(E.next.x-E.x)/(E.next.y-E.y);if(a<=A&&a>z&&(z=a,U=E.x<E.next.x?E:E.next,a===A))return U}E=E.next}while(E!==T);if(!U)return null;var G=U,ot=U.x,Rt=U.y,xt=1/0,At;E=U;do A>=E.x&&E.x>=ot&&A!==E.x&&Fu(D<Rt?A:z,D,ot,Rt,D<Rt?z:A,D,E.x,E.y)&&(At=Math.abs(D-E.y)/(A-E.x),Kc(E,b)&&(At<xt||At===xt&&(E.x>U.x||E.x===U.x&&T1(U,E)))&&(U=E,xt=At)),E=E.next;while(E!==G);return U}function T1(b,T){return Vn(b.prev,b,T.prev)<0&&Vn(T.next,b,b.next)<0}function I1(b,T,E,A){var D=b;do D.z===0&&(D.z=td(D.x,D.y,T,E,A)),D.prevZ=D.prev,D.nextZ=D.next,D=D.next;while(D!==b);D.prevZ.nextZ=null,D.prevZ=null,S1(D)}function S1(b){var T,E,A,D,z,U,a,G,ot=1;do{for(E=b,b=null,z=null,U=0;E;){for(U++,A=E,a=0,T=0;T<ot&&(a++,A=A.nextZ,!!A);T++);for(G=ot;a>0||G>0&&A;)a!==0&&(G===0||!A||E.z<=A.z)?(D=E,E=E.nextZ,a--):(D=A,A=A.nextZ,G--),z?z.nextZ=D:b=D,D.prevZ=z,z=D;E=A}z.nextZ=null,ot*=2}while(U>1);return b}function td(b,T,E,A,D){return b=(b-E)*D|0,T=(T-A)*D|0,b=(b|b<<8)&16711935,b=(b|b<<4)&252645135,b=(b|b<<2)&858993459,b=(b|b<<1)&1431655765,T=(T|T<<8)&16711935,T=(T|T<<4)&252645135,T=(T|T<<2)&858993459,T=(T|T<<1)&1431655765,b|T<<1}function C1(b){var T=b,E=b;do(T.x<E.x||T.x===E.x&&T.y<E.y)&&(E=T),T=T.next;while(T!==b);return E}function Fu(b,T,E,A,D,z,U,a){return(D-U)*(T-a)>=(b-U)*(z-a)&&(b-U)*(A-a)>=(E-U)*(T-a)&&(E-U)*(z-a)>=(D-U)*(A-a)}function M1(b,T){return b.next.i!==T.i&&b.prev.i!==T.i&&!A1(b,T)&&(Kc(b,T)&&Kc(T,b)&&P1(b,T)&&(Vn(b.prev,b,T.prev)||Vn(b,T.prev,T))||gp(b,T)&&Vn(b.prev,b,b.next)>0&&Vn(T.prev,T,T.next)>0)}function Vn(b,T,E){return(T.y-b.y)*(E.x-T.x)-(T.x-b.x)*(E.y-T.y)}function gp(b,T){return b.x===T.x&&b.y===T.y}function by(b,T,E,A){var D=Qh(Vn(b,T,E)),z=Qh(Vn(b,T,A)),U=Qh(Vn(E,A,b)),a=Qh(Vn(E,A,T));return!!(D!==z&&U!==a||D===0&&Jh(b,E,T)||z===0&&Jh(b,A,T)||U===0&&Jh(E,b,A)||a===0&&Jh(E,T,A))}function Jh(b,T,E){return T.x<=Math.max(b.x,E.x)&&T.x>=Math.min(b.x,E.x)&&T.y<=Math.max(b.y,E.y)&&T.y>=Math.min(b.y,E.y)}function Qh(b){return b>0?1:b<0?-1:0}function A1(b,T){var E=b;do{if(E.i!==b.i&&E.next.i!==b.i&&E.i!==T.i&&E.next.i!==T.i&&by(E,E.next,b,T))return!0;E=E.next}while(E!==b);return!1}function Kc(b,T){return Vn(b.prev,b,b.next)<0?Vn(b,T,b.next)>=0&&Vn(b,b.prev,T)>=0:Vn(b,T,b.prev)<0||Vn(b,b.next,T)<0}function P1(b,T){var E=b,A=!1,D=(b.x+T.x)/2,z=(b.y+T.y)/2;do E.y>z!=E.next.y>z&&E.next.y!==E.y&&D<(E.next.x-E.x)*(z-E.y)/(E.next.y-E.y)+E.x&&(A=!A),E=E.next;while(E!==b);return A}function wy(b,T){var E=new ed(b.i,b.x,b.y),A=new ed(T.i,T.x,T.y),D=b.next,z=T.prev;return b.next=T,T.prev=b,E.next=D,D.prev=E,A.next=E,E.prev=A,z.next=A,A.prev=z,A}function y_(b,T,E,A){var D=new ed(b,T,E);return A?(D.next=A.next,D.prev=A,A.next.prev=D,A.next=D):(D.prev=D,D.next=D),D}function Jc(b){b.next.prev=b.prev,b.prev.next=b.next,b.prevZ&&(b.prevZ.nextZ=b.nextZ),b.nextZ&&(b.nextZ.prevZ=b.prevZ)}function ed(b,T,E){this.i=b,this.x=T,this.y=E,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}mp.deviation=function(b,T,E,A){var D=T&&T.length,z=D?T[0]*E:b.length,U=Math.abs(rd(b,0,z,E));if(D)for(var a=0,G=T.length;a<G;a++){var ot=T[a]*E,Rt=a<G-1?T[a+1]*E:b.length;U-=Math.abs(rd(b,ot,Rt,E))}var xt=0;for(a=0;a<A.length;a+=3){var At=A[a]*E,qt=A[a+1]*E,re=A[a+2]*E;xt+=Math.abs((b[At]-b[re])*(b[qt+1]-b[At+1])-(b[At]-b[qt])*(b[re+1]-b[At+1]))}return U===0&&xt===0?0:Math.abs((xt-U)/U)};function rd(b,T,E,A){for(var D=0,z=T,U=E-A;z<E;z+=A)D+=(b[U]-b[z])*(b[z+1]+b[U+1]),U=z;return D}mp.flatten=function(b){for(var T=b[0][0].length,E={vertices:[],holes:[],dimensions:T},A=0,D=0;D<b.length;D++){for(var z=0;z<b[D].length;z++)for(var U=0;U<T;U++)E.vertices.push(b[D][z][U]);D>0&&(A+=b[D-1].length,E.holes.push(A))}return E};var Ey={exports:{}},dd={};(function(b){Object.defineProperty(b,"__esModule",{value:!0}),b.earthRadius=63710088e-1,b.factors={centimeters:b.earthRadius*100,centimetres:b.earthRadius*100,degrees:b.earthRadius/111325,feet:b.earthRadius*3.28084,inches:b.earthRadius*39.37,kilometers:b.earthRadius/1e3,kilometres:b.earthRadius/1e3,meters:b.earthRadius,metres:b.earthRadius,miles:b.earthRadius/1609.344,millimeters:b.earthRadius*1e3,millimetres:b.earthRadius*1e3,nauticalmiles:b.earthRadius/1852,radians:1,yards:b.earthRadius*1.0936},b.unitsFactors={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/b.earthRadius,yards:1.0936133},b.areaFactors={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function T(ue,Kt,ae){ae===void 0&&(ae={});var wt={type:"Feature"};return(ae.id===0||ae.id)&&(wt.id=ae.id),ae.bbox&&(wt.bbox=ae.bbox),wt.properties=Kt||{},wt.geometry=ue,wt}b.feature=T;function E(ue,Kt,ae){switch(ue){case"Point":return A(Kt).geometry;case"LineString":return a(Kt).geometry;case"Polygon":return z(Kt).geometry;case"MultiPoint":return xt(Kt).geometry;case"MultiLineString":return Rt(Kt).geometry;case"MultiPolygon":return At(Kt).geometry;default:throw new Error(ue+" is invalid")}}b.geometry=E;function A(ue,Kt,ae){if(ae===void 0&&(ae={}),!ue)throw new Error("coordinates is required");if(!Array.isArray(ue))throw new Error("coordinates must be an Array");if(ue.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!de(ue[0])||!de(ue[1]))throw new Error("coordinates must contain numbers");var wt={type:"Point",coordinates:ue};return T(wt,Kt,ae)}b.point=A;function D(ue,Kt,ae){return ae===void 0&&(ae={}),ot(ue.map(function(wt){return A(wt,Kt)}),ae)}b.points=D;function z(ue,Kt,ae){ae===void 0&&(ae={});for(var wt=0,_i=ue;wt<_i.length;wt++){var Ne=_i[wt];if(Ne.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var Tr=0;Tr<Ne[Ne.length-1].length;Tr++)if(Ne[Ne.length-1][Tr]!==Ne[0][Tr])throw new Error("First and last Position are not equivalent.")}var Ye={type:"Polygon",coordinates:ue};return T(Ye,Kt,ae)}b.polygon=z;function U(ue,Kt,ae){return ae===void 0&&(ae={}),ot(ue.map(function(wt){return z(wt,Kt)}),ae)}b.polygons=U;function a(ue,Kt,ae){if(ae===void 0&&(ae={}),ue.length<2)throw new Error("coordinates must be an array of two or more positions");var wt={type:"LineString",coordinates:ue};return T(wt,Kt,ae)}b.lineString=a;function G(ue,Kt,ae){return ae===void 0&&(ae={}),ot(ue.map(function(wt){return a(wt,Kt)}),ae)}b.lineStrings=G;function ot(ue,Kt){Kt===void 0&&(Kt={});var ae={type:"FeatureCollection"};return Kt.id&&(ae.id=Kt.id),Kt.bbox&&(ae.bbox=Kt.bbox),ae.features=ue,ae}b.featureCollection=ot;function Rt(ue,Kt,ae){ae===void 0&&(ae={});var wt={type:"MultiLineString",coordinates:ue};return T(wt,Kt,ae)}b.multiLineString=Rt;function xt(ue,Kt,ae){ae===void 0&&(ae={});var wt={type:"MultiPoint",coordinates:ue};return T(wt,Kt,ae)}b.multiPoint=xt;function At(ue,Kt,ae){ae===void 0&&(ae={});var wt={type:"MultiPolygon",coordinates:ue};return T(wt,Kt,ae)}b.multiPolygon=At;function qt(ue,Kt,ae){ae===void 0&&(ae={});var wt={type:"GeometryCollection",geometries:ue};return T(wt,Kt,ae)}b.geometryCollection=qt;function re(ue,Kt){if(Kt===void 0&&(Kt=0),Kt&&!(Kt>=0))throw new Error("precision must be a positive number");var ae=Math.pow(10,Kt||0);return Math.round(ue*ae)/ae}b.round=re;function ee(ue,Kt){Kt===void 0&&(Kt="kilometers");var ae=b.factors[Kt];if(!ae)throw new Error(Kt+" units is invalid");return ue*ae}b.radiansToLength=ee;function Oe(ue,Kt){Kt===void 0&&(Kt="kilometers");var ae=b.factors[Kt];if(!ae)throw new Error(Kt+" units is invalid");return ue/ae}b.lengthToRadians=Oe;function Ge(ue,Kt){return gt(Oe(ue,Kt))}b.lengthToDegrees=Ge;function Mt(ue){var Kt=ue%360;return Kt<0&&(Kt+=360),Kt}b.bearingToAzimuth=Mt;function gt(ue){var Kt=ue%(2*Math.PI);return Kt*180/Math.PI}b.radiansToDegrees=gt;function Et(ue){var Kt=ue%360;return Kt*Math.PI/180}b.degreesToRadians=Et;function Ft(ue,Kt,ae){if(Kt===void 0&&(Kt="kilometers"),ae===void 0&&(ae="kilometers"),!(ue>=0))throw new Error("length must be a positive number");return ee(Oe(ue,Kt),ae)}b.convertLength=Ft;function Ie(ue,Kt,ae){if(Kt===void 0&&(Kt="meters"),ae===void 0&&(ae="kilometers"),!(ue>=0))throw new Error("area must be a positive number");var wt=b.areaFactors[Kt];if(!wt)throw new Error("invalid original units");var _i=b.areaFactors[ae];if(!_i)throw new Error("invalid final units");return ue/wt*_i}b.convertArea=Ie;function de(ue){return!isNaN(ue)&&ue!==null&&!Array.isArray(ue)}b.isNumber=de;function xe(ue){return!!ue&&ue.constructor===Object}b.isObject=xe;function $t(ue){if(!ue)throw new Error("bbox is required");if(!Array.isArray(ue))throw new Error("bbox must be an Array");if(ue.length!==4&&ue.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");ue.forEach(function(Kt){if(!de(Kt))throw new Error("bbox must only contain numbers")})}b.validateBBox=$t;function yt(ue){if(!ue)throw new Error("id is required");if(["string","number"].indexOf(typeof ue)===-1)throw new Error("id must be a number or a string")}b.validateId=yt})(dd);var uo={};Object.defineProperty(uo,"__esModule",{value:!0});var hs=dd;function nh(b,T,E){if(b!==null)for(var A,D,z,U,a,G,ot,Rt=0,xt=0,At,qt=b.type,re=qt==="FeatureCollection",ee=qt==="Feature",Oe=re?b.features.length:1,Ge=0;Ge<Oe;Ge++){ot=re?b.features[Ge].geometry:ee?b.geometry:b,At=ot?ot.type==="GeometryCollection":!1,a=At?ot.geometries.length:1;for(var Mt=0;Mt<a;Mt++){var gt=0,Et=0;if(U=At?ot.geometries[Mt]:ot,U!==null){G=U.coordinates;var Ft=U.type;switch(Rt=E&&(Ft==="Polygon"||Ft==="MultiPolygon")?1:0,Ft){case null:break;case"Point":if(T(G,xt,Ge,gt,Et)===!1)return!1;xt++,gt++;break;case"LineString":case"MultiPoint":for(A=0;A<G.length;A++){if(T(G[A],xt,Ge,gt,Et)===!1)return!1;xt++,Ft==="MultiPoint"&&gt++}Ft==="LineString"&&gt++;break;case"Polygon":case"MultiLineString":for(A=0;A<G.length;A++){for(D=0;D<G[A].length-Rt;D++){if(T(G[A][D],xt,Ge,gt,Et)===!1)return!1;xt++}Ft==="MultiLineString"&&gt++,Ft==="Polygon"&&Et++}Ft==="Polygon"&&gt++;break;case"MultiPolygon":for(A=0;A<G.length;A++){for(Et=0,D=0;D<G[A].length;D++){for(z=0;z<G[A][D].length-Rt;z++){if(T(G[A][D][z],xt,Ge,gt,Et)===!1)return!1;xt++}Et++}gt++}break;case"GeometryCollection":for(A=0;A<U.geometries.length;A++)if(nh(U.geometries[A],T,E)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function L1(b,T,E,A){var D=E;return nh(b,function(z,U,a,G,ot){U===0&&E===void 0?D=z:D=T(D,z,U,a,G,ot)},A),D}function Ty(b,T){var E;switch(b.type){case"FeatureCollection":for(E=0;E<b.features.length&&T(b.features[E].properties,E)!==!1;E++);break;case"Feature":T(b.properties,0);break}}function D1(b,T,E){var A=E;return Ty(b,function(D,z){z===0&&E===void 0?A=D:A=T(A,D,z)}),A}function Iy(b,T){if(b.type==="Feature")T(b,0);else if(b.type==="FeatureCollection")for(var E=0;E<b.features.length&&T(b.features[E],E)!==!1;E++);}function R1(b,T,E){var A=E;return Iy(b,function(D,z){z===0&&E===void 0?A=D:A=T(A,D,z)}),A}function O1(b){var T=[];return nh(b,function(E){T.push(E)}),T}function md(b,T){var E,A,D,z,U,a,G,ot,Rt,xt,At=0,qt=b.type==="FeatureCollection",re=b.type==="Feature",ee=qt?b.features.length:1;for(E=0;E<ee;E++){for(a=qt?b.features[E].geometry:re?b.geometry:b,ot=qt?b.features[E].properties:re?b.properties:{},Rt=qt?b.features[E].bbox:re?b.bbox:void 0,xt=qt?b.features[E].id:re?b.id:void 0,G=a?a.type==="GeometryCollection":!1,U=G?a.geometries.length:1,D=0;D<U;D++){if(z=G?a.geometries[D]:a,z===null){if(T(null,At,ot,Rt,xt)===!1)return!1;continue}switch(z.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(T(z,At,ot,Rt,xt)===!1)return!1;break}case"GeometryCollection":{for(A=0;A<z.geometries.length;A++)if(T(z.geometries[A],At,ot,Rt,xt)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}At++}}function N1(b,T,E){var A=E;return md(b,function(D,z,U,a,G){z===0&&E===void 0?A=D:A=T(A,D,z,U,a,G)}),A}function _p(b,T){md(b,function(E,A,D,z,U){var a=E===null?null:E.type;switch(a){case null:case"Point":case"LineString":case"Polygon":return T(hs.feature(E,D,{bbox:z,id:U}),A,0)===!1?!1:void 0}var G;switch(a){case"MultiPoint":G="Point";break;case"MultiLineString":G="LineString";break;case"MultiPolygon":G="Polygon";break}for(var ot=0;ot<E.coordinates.length;ot++){var Rt=E.coordinates[ot],xt={type:G,coordinates:Rt};if(T(hs.feature(xt,D),A,ot)===!1)return!1}})}function z1(b,T,E){var A=E;return _p(b,function(D,z,U){z===0&&U===0&&E===void 0?A=D:A=T(A,D,z,U)}),A}function Sy(b,T){_p(b,function(E,A,D){var z=0;if(E.geometry){var U=E.geometry.type;if(!(U==="Point"||U==="MultiPoint")){var a,G=0,ot=0,Rt=0;if(nh(E,function(xt,At,qt,re,ee){if(a===void 0||A>G||re>ot||ee>Rt){a=xt,G=A,ot=re,Rt=ee,z=0;return}var Oe=hs.lineString([a,xt],E.properties);if(T(Oe,A,D,ee,z)===!1)return!1;z++,a=xt})===!1)return!1}}})}function k1(b,T,E){var A=E,D=!1;return Sy(b,function(z,U,a,G,ot){D===!1&&E===void 0?A=z:A=T(A,z,U,a,G,ot),D=!0}),A}function Cy(b,T){if(!b)throw new Error("geojson is required");_p(b,function(E,A,D){if(E.geometry!==null){var z=E.geometry.type,U=E.geometry.coordinates;switch(z){case"LineString":if(T(E,A,D,0,0)===!1)return!1;break;case"Polygon":for(var a=0;a<U.length;a++)if(T(hs.lineString(U[a],E.properties),A,D,a)===!1)return!1;break}}})}function B1(b,T,E){var A=E;return Cy(b,function(D,z,U,a){z===0&&E===void 0?A=D:A=T(A,D,z,U,a)}),A}function F1(b,T){if(T=T||{},!hs.isObject(T))throw new Error("options is invalid");var E=T.featureIndex||0,A=T.multiFeatureIndex||0,D=T.geometryIndex||0,z=T.segmentIndex||0,U=T.properties,a;switch(b.type){case"FeatureCollection":E<0&&(E=b.features.length+E),U=U||b.features[E].properties,a=b.features[E].geometry;break;case"Feature":U=U||b.properties,a=b.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":a=b;break;default:throw new Error("geojson is invalid")}if(a===null)return null;var G=a.coordinates;switch(a.type){case"Point":case"MultiPoint":return null;case"LineString":return z<0&&(z=G.length+z-1),hs.lineString([G[z],G[z+1]],U,T);case"Polygon":return D<0&&(D=G.length+D),z<0&&(z=G[D].length+z-1),hs.lineString([G[D][z],G[D][z+1]],U,T);case"MultiLineString":return A<0&&(A=G.length+A),z<0&&(z=G[A].length+z-1),hs.lineString([G[A][z],G[A][z+1]],U,T);case"MultiPolygon":return A<0&&(A=G.length+A),D<0&&(D=G[A].length+D),z<0&&(z=G[A][D].length-z-1),hs.lineString([G[A][D][z],G[A][D][z+1]],U,T)}throw new Error("geojson is invalid")}function U1(b,T){if(T=T||{},!hs.isObject(T))throw new Error("options is invalid");var E=T.featureIndex||0,A=T.multiFeatureIndex||0,D=T.geometryIndex||0,z=T.coordIndex||0,U=T.properties,a;switch(b.type){case"FeatureCollection":E<0&&(E=b.features.length+E),U=U||b.features[E].properties,a=b.features[E].geometry;break;case"Feature":U=U||b.properties,a=b.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":a=b;break;default:throw new Error("geojson is invalid")}if(a===null)return null;var G=a.coordinates;switch(a.type){case"Point":return hs.point(G,U,T);case"MultiPoint":return A<0&&(A=G.length+A),hs.point(G[A],U,T);case"LineString":return z<0&&(z=G.length+z),hs.point(G[z],U,T);case"Polygon":return D<0&&(D=G.length+D),z<0&&(z=G[D].length+z),hs.point(G[D][z],U,T);case"MultiLineString":return A<0&&(A=G.length+A),z<0&&(z=G[A].length+z),hs.point(G[A][z],U,T);case"MultiPolygon":return A<0&&(A=G.length+A),D<0&&(D=G[A].length+D),z<0&&(z=G[A][D].length-z),hs.point(G[A][D][z],U,T)}throw new Error("geojson is invalid")}uo.coordAll=O1;uo.coordEach=nh;uo.coordReduce=L1;uo.featureEach=Iy;uo.featureReduce=R1;uo.findPoint=U1;uo.findSegment=F1;uo.flattenEach=_p;uo.flattenReduce=z1;uo.geomEach=md;uo.geomReduce=N1;uo.lineEach=Cy;uo.lineReduce=B1;uo.propEach=Ty;uo.propReduce=D1;uo.segmentEach=Sy;uo.segmentReduce=k1;var gd={};Object.defineProperty(gd,"__esModule",{value:!0});var V1=uo;function id(b){var T=[1/0,1/0,-1/0,-1/0];return V1.coordEach(b,function(E){T[0]>E[0]&&(T[0]=E[0]),T[1]>E[1]&&(T[1]=E[1]),T[2]<E[0]&&(T[2]=E[0]),T[3]<E[1]&&(T[3]=E[1])}),T}id.default=id;gd.default=id;var Ha=fd.exports,My=dd,Ay=uo,Ru=gd.default,G1=Ay.featureEach;Ay.coordEach;My.polygon;var v_=My.featureCollection;function Py(b){var T=new Ha(b);return T.insert=function(E){if(E.type!=="Feature")throw new Error("invalid feature");return E.bbox=E.bbox?E.bbox:Ru(E),Ha.prototype.insert.call(this,E)},T.load=function(E){var A=[];return Array.isArray(E)?E.forEach(function(D){if(D.type!=="Feature")throw new Error("invalid features");D.bbox=D.bbox?D.bbox:Ru(D),A.push(D)}):G1(E,function(D){if(D.type!=="Feature")throw new Error("invalid features");D.bbox=D.bbox?D.bbox:Ru(D),A.push(D)}),Ha.prototype.load.call(this,A)},T.remove=function(E,A){if(E.type!=="Feature")throw new Error("invalid feature");return E.bbox=E.bbox?E.bbox:Ru(E),Ha.prototype.remove.call(this,E,A)},T.clear=function(){return Ha.prototype.clear.call(this)},T.search=function(E){var A=Ha.prototype.search.call(this,this.toBBox(E));return v_(A)},T.collides=function(E){return Ha.prototype.collides.call(this,this.toBBox(E))},T.all=function(){var E=Ha.prototype.all.call(this);return v_(E)},T.toJSON=function(){return Ha.prototype.toJSON.call(this)},T.fromJSON=function(E){return Ha.prototype.fromJSON.call(this,E)},T.toBBox=function(E){var A;if(E.bbox)A=E.bbox;else if(Array.isArray(E)&&E.length===4)A=E;else if(Array.isArray(E)&&E.length===6)A=[E[0],E[1],E[3],E[4]];else if(E.type==="Feature")A=Ru(E);else if(E.type==="FeatureCollection")A=Ru(E);else throw new Error("invalid geojson");return{minX:A[0],minY:A[1],maxX:A[2],maxY:A[3]}},T}Ey.exports=Py;Ey.exports.default=Py;var x_=Object.prototype.toString,Ly=function(T){var E=x_.call(T),A=E==="[object Arguments]";return A||(A=E!=="[object Array]"&&T!==null&&typeof T=="object"&&typeof T.length=="number"&&T.length>=0&&x_.call(T.callee)==="[object Function]"),A},Ff,b_;function j1(){if(b_)return Ff;b_=1;var b;if(!Object.keys){var T=Object.prototype.hasOwnProperty,E=Object.prototype.toString,A=Ly,D=Object.prototype.propertyIsEnumerable,z=!D.call({toString:null},"toString"),U=D.call(function(){},"prototype"),a=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],G=function(At){var qt=At.constructor;return qt&&qt.prototype===At},ot={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},Rt=function(){if(typeof window>"u")return!1;for(var At in window)try{if(!ot["$"+At]&&T.call(window,At)&&window[At]!==null&&typeof window[At]=="object")try{G(window[At])}catch{return!0}}catch{return!0}return!1}(),xt=function(At){if(typeof window>"u"||!Rt)return G(At);try{return G(At)}catch{return!1}};b=function(qt){var re=qt!==null&&typeof qt=="object",ee=E.call(qt)==="[object Function]",Oe=A(qt),Ge=re&&E.call(qt)==="[object String]",Mt=[];if(!re&&!ee&&!Oe)throw new TypeError("Object.keys called on a non-object");var gt=U&&ee;if(Ge&&qt.length>0&&!T.call(qt,0))for(var Et=0;Et<qt.length;++Et)Mt.push(String(Et));if(Oe&&qt.length>0)for(var Ft=0;Ft<qt.length;++Ft)Mt.push(String(Ft));else for(var Ie in qt)!(gt&&Ie==="prototype")&&T.call(qt,Ie)&&Mt.push(String(Ie));if(z)for(var de=xt(qt),xe=0;xe<a.length;++xe)!(de&&a[xe]==="constructor")&&T.call(qt,a[xe])&&Mt.push(a[xe]);return Mt}}return Ff=b,Ff}var q1=Array.prototype.slice,$1=Ly,w_=Object.keys,ip=w_?function(T){return w_(T)}:j1(),E_=Object.keys;ip.shim=function(){if(Object.keys){var T=function(){var E=Object.keys(arguments);return E&&E.length===arguments.length}(1,2);T||(Object.keys=function(A){return $1(A)?E_(q1.call(A)):E_(A)})}else Object.keys=ip;return Object.keys||ip};var X1=ip,Dy=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var T={},E=Symbol("test"),A=Object(E);if(typeof E=="string"||Object.prototype.toString.call(E)!=="[object Symbol]"||Object.prototype.toString.call(A)!=="[object Symbol]")return!1;var D=42;T[E]=D;for(E in T)return!1;if(typeof Object.keys=="function"&&Object.keys(T).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(T).length!==0)return!1;var z=Object.getOwnPropertySymbols(T);if(z.length!==1||z[0]!==E||!Object.prototype.propertyIsEnumerable.call(T,E))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var U=Object.getOwnPropertyDescriptor(T,E);if(U.value!==D||U.enumerable!==!0)return!1}return!0},Z1=Dy,_d=function(){return Z1()&&!!Symbol.toStringTag},T_=typeof Symbol<"u"&&Symbol,W1=Dy,Y1=function(){return typeof T_!="function"||typeof Symbol!="function"||typeof T_("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:W1()},H1="Function.prototype.bind called on incompatible ",Uf=Array.prototype.slice,K1=Object.prototype.toString,J1="[object Function]",Q1=function(T){var E=this;if(typeof E!="function"||K1.call(E)!==J1)throw new TypeError(H1+E);for(var A=Uf.call(arguments,1),D,z=function(){if(this instanceof D){var Rt=E.apply(this,A.concat(Uf.call(arguments)));return Object(Rt)===Rt?Rt:this}else return E.apply(T,A.concat(Uf.call(arguments)))},U=Math.max(0,E.length-A.length),a=[],G=0;G<U;G++)a.push("$"+G);if(D=Function("binder","return function ("+a.join(",")+"){ return binder.apply(this,arguments); }")(z),E.prototype){var ot=function(){};ot.prototype=E.prototype,D.prototype=new ot,ot.prototype=null}return D},tb=Q1,yd=Function.prototype.bind||tb,eb=yd,rb=eb.call(Function.call,Object.prototype.hasOwnProperty),gi,Hu=SyntaxError,Ry=Function,ju=TypeError,Vf=function(b){try{return Ry('"use strict"; return ('+b+").constructor;")()}catch{}},iu=Object.getOwnPropertyDescriptor;if(iu)try{iu({},"")}catch{iu=null}var Gf=function(){throw new ju},ib=iu?function(){try{return arguments.callee,Gf}catch{try{return iu(arguments,"callee").get}catch{return Gf}}}():Gf,Ou=Y1(),Ol=Object.getPrototypeOf||function(b){return b.__proto__},ku={},nb=typeof Uint8Array>"u"?gi:Ol(Uint8Array),qu={"%AggregateError%":typeof AggregateError>"u"?gi:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?gi:ArrayBuffer,"%ArrayIteratorPrototype%":Ou?Ol([][Symbol.iterator]()):gi,"%AsyncFromSyncIteratorPrototype%":gi,"%AsyncFunction%":ku,"%AsyncGenerator%":ku,"%AsyncGeneratorFunction%":ku,"%AsyncIteratorPrototype%":ku,"%Atomics%":typeof Atomics>"u"?gi:Atomics,"%BigInt%":typeof BigInt>"u"?gi:BigInt,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?gi:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":typeof Float32Array>"u"?gi:Float32Array,"%Float64Array%":typeof Float64Array>"u"?gi:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?gi:FinalizationRegistry,"%Function%":Ry,"%GeneratorFunction%":ku,"%Int8Array%":typeof Int8Array>"u"?gi:Int8Array,"%Int16Array%":typeof Int16Array>"u"?gi:Int16Array,"%Int32Array%":typeof Int32Array>"u"?gi:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":Ou?Ol(Ol([][Symbol.iterator]())):gi,"%JSON%":typeof JSON=="object"?JSON:gi,"%Map%":typeof Map>"u"?gi:Map,"%MapIteratorPrototype%":typeof Map>"u"||!Ou?gi:Ol(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?gi:Promise,"%Proxy%":typeof Proxy>"u"?gi:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":typeof Reflect>"u"?gi:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?gi:Set,"%SetIteratorPrototype%":typeof Set>"u"||!Ou?gi:Ol(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?gi:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":Ou?Ol(""[Symbol.iterator]()):gi,"%Symbol%":Ou?Symbol:gi,"%SyntaxError%":Hu,"%ThrowTypeError%":ib,"%TypedArray%":nb,"%TypeError%":ju,"%Uint8Array%":typeof Uint8Array>"u"?gi:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?gi:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?gi:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?gi:Uint32Array,"%URIError%":URIError,"%WeakMap%":typeof WeakMap>"u"?gi:WeakMap,"%WeakRef%":typeof WeakRef>"u"?gi:WeakRef,"%WeakSet%":typeof WeakSet>"u"?gi:WeakSet},ob=function b(T){var E;if(T==="%AsyncFunction%")E=Vf("async function () {}");else if(T==="%GeneratorFunction%")E=Vf("function* () {}");else if(T==="%AsyncGeneratorFunction%")E=Vf("async function* () {}");else if(T==="%AsyncGenerator%"){var A=b("%AsyncGeneratorFunction%");A&&(E=A.prototype)}else if(T==="%AsyncIteratorPrototype%"){var D=b("%AsyncGenerator%");D&&(E=Ol(D.prototype))}return qu[T]=E,E},I_={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},oh=yd,sp=rb,sb=oh.call(Function.call,Array.prototype.concat),ab=oh.call(Function.apply,Array.prototype.splice),S_=oh.call(Function.call,String.prototype.replace),ap=oh.call(Function.call,String.prototype.slice),lb=oh.call(Function.call,RegExp.prototype.exec),ub=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,cb=/\\(\\)?/g,hb=function(T){var E=ap(T,0,1),A=ap(T,-1);if(E==="%"&&A!=="%")throw new Hu("invalid intrinsic syntax, expected closing `%`");if(A==="%"&&E!=="%")throw new Hu("invalid intrinsic syntax, expected opening `%`");var D=[];return S_(T,ub,function(z,U,a,G){D[D.length]=a?S_(G,cb,"$1"):U||z}),D},pb=function(T,E){var A=T,D;if(sp(I_,A)&&(D=I_[A],A="%"+D[0]+"%"),sp(qu,A)){var z=qu[A];if(z===ku&&(z=ob(A)),typeof z>"u"&&!E)throw new ju("intrinsic "+T+" exists, but is not available. Please file an issue!");return{alias:D,name:A,value:z}}throw new Hu("intrinsic "+T+" does not exist!")},vd=function(T,E){if(typeof T!="string"||T.length===0)throw new ju("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof E!="boolean")throw new ju('"allowMissing" argument must be a boolean');if(lb(/^%?[^%]*%?$/g,T)===null)throw new Hu("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var A=hb(T),D=A.length>0?A[0]:"",z=pb("%"+D+"%",E),U=z.name,a=z.value,G=!1,ot=z.alias;ot&&(D=ot[0],ab(A,sb([0,1],ot)));for(var Rt=1,xt=!0;Rt<A.length;Rt+=1){var At=A[Rt],qt=ap(At,0,1),re=ap(At,-1);if((qt==='"'||qt==="'"||qt==="`"||re==='"'||re==="'"||re==="`")&&qt!==re)throw new Hu("property names with quotes must have matching quotes");if((At==="constructor"||!xt)&&(G=!0),D+="."+At,U="%"+D+"%",sp(qu,U))a=qu[U];else if(a!=null){if(!(At in a)){if(!E)throw new ju("base intrinsic for "+T+" exists, but the property is not available.");return}if(iu&&Rt+1>=A.length){var ee=iu(a,At);xt=!!ee,xt&&"get"in ee&&!("originalValue"in ee.get)?a=ee.get:a=a[At]}else xt=sp(a,At),a=a[At];xt&&!G&&(qu[U]=a)}}return a},yp={exports:{}};(function(b){var T=yd,E=vd,A=E("%Function.prototype.apply%"),D=E("%Function.prototype.call%"),z=E("%Reflect.apply%",!0)||T.call(D,A),U=E("%Object.getOwnPropertyDescriptor%",!0),a=E("%Object.defineProperty%",!0),G=E("%Math.max%");if(a)try{a({},"a",{value:1})}catch{a=null}b.exports=function(xt){var At=z(T,D,arguments);if(U&&a){var qt=U(At,"length");qt.configurable&&a(At,"length",{value:1+G(0,xt.length-(arguments.length-1))})}return At};var ot=function(){return z(T,A,arguments)};a?a(b.exports,"apply",{value:ot}):b.exports.apply=ot})(yp);var Oy=vd,Ny=yp.exports,fb=Ny(Oy("String.prototype.indexOf")),zy=function(T,E){var A=Oy(T,!!E);return typeof A=="function"&&fb(T,".prototype.")>-1?Ny(A):A},db=_d(),mb=zy,nd=mb("Object.prototype.toString"),xd=function(T){return db&&T&&typeof T=="object"&&Symbol.toStringTag in T?!1:nd(T)==="[object Arguments]"},gb=function(T){return xd(T)?!0:T!==null&&typeof T=="object"&&typeof T.length=="number"&&T.length>=0&&nd(T)!=="[object Array]"&&nd(T.callee)==="[object Function]"};(function(){return xd(arguments)})();xd.isLegacyArguments=gb;var _b=vd,od=_b("%Object.defineProperty%",!0),sd=function(){if(od)try{return od({},"a",{value:1}),!0}catch{return!1}return!1};sd.hasArrayLengthDefineBug=function(){if(!sd())return null;try{return od([],"length",{value:1}).length!==1}catch{return!0}};var yb=sd,vb=X1,xb=typeof Symbol=="function"&&typeof Symbol("foo")=="symbol",bb=Object.prototype.toString,wb=Array.prototype.concat,ky=Object.defineProperty,Eb=function(b){return typeof b=="function"&&bb.call(b)==="[object Function]"},Tb=yb(),By=ky&&Tb,Ib=function(b,T,E,A){T in b&&(!Eb(A)||!A())||(By?ky(b,T,{configurable:!0,enumerable:!1,value:E,writable:!0}):b[T]=E)},Fy=function(b,T){var E=arguments.length>2?arguments[2]:{},A=vb(T);xb&&(A=wb.call(A,Object.getOwnPropertySymbols(T)));for(var D=0;D<A.length;D+=1)Ib(b,A[D],T[A[D]],E[A[D]])};Fy.supportsDescriptors=!!By;var sh=Fy,C_=function(b){return b!==b},Uy=function(T,E){return T===0&&E===0?1/T===1/E:!!(T===E||C_(T)&&C_(E))},Sb=Uy,Vy=function(){return typeof Object.is=="function"?Object.is:Sb},Cb=Vy,Mb=sh,Ab=function(){var T=Cb();return Mb(Object,{is:T},{is:function(){return Object.is!==T}}),T},Pb=sh,Lb=yp.exports,Db=Uy,Gy=Vy,Rb=Ab,Ob=Lb(Gy(),Object);Pb(Ob,{getPolyfill:Gy,implementation:Db,shim:Rb});var ad=zy,Nb=_d(),M_,A_;if(Nb){ad("Object.prototype.hasOwnProperty"),ad("RegExp.prototype.exec"),M_={};var jf=function(){throw M_};A_={toString:jf,valueOf:jf},typeof Symbol.toPrimitive=="symbol"&&(A_[Symbol.toPrimitive]=jf)}ad("Object.prototype.toString");var bd={exports:{}},Qc=function(){return typeof function(){}.name=="string"},Xc=Object.getOwnPropertyDescriptor;if(Xc)try{Xc([],"length")}catch{Xc=null}Qc.functionsHaveConfigurableNames=function(){if(!Qc()||!Xc)return!1;var T=Xc(function(){},"name");return!!T&&!!T.configurable};var zb=Function.prototype.bind;Qc.boundFunctionsHaveNames=function(){return Qc()&&typeof zb=="function"&&function(){}.bind().name!==""};var kb=Qc;(function(b){var T=kb.functionsHaveConfigurableNames(),E=Object,A=TypeError;b.exports=function(){if(this!=null&&this!==E(this))throw new A("RegExp.prototype.flags getter called on non-object");var z="";return this.hasIndices&&(z+="d"),this.global&&(z+="g"),this.ignoreCase&&(z+="i"),this.multiline&&(z+="m"),this.dotAll&&(z+="s"),this.unicode&&(z+="u"),this.sticky&&(z+="y"),z},T&&Object.defineProperty&&Object.defineProperty(b.exports,"name",{value:"get flags"})})(bd);var Bb=bd.exports,Fb=sh.supportsDescriptors,Ub=Object.getOwnPropertyDescriptor,jy=function(){if(Fb&&/a/mig.flags==="gim"){var T=Ub(RegExp.prototype,"flags");if(T&&typeof T.get=="function"&&typeof RegExp.prototype.dotAll=="boolean"&&typeof RegExp.prototype.hasIndices=="boolean"){var E="",A={};if(Object.defineProperty(A,"hasIndices",{get:function(){E+="d"}}),Object.defineProperty(A,"sticky",{get:function(){E+="y"}}),E==="dy")return T.get}}return Bb},Vb=sh.supportsDescriptors,Gb=jy,jb=Object.getOwnPropertyDescriptor,qb=Object.defineProperty,$b=TypeError,P_=Object.getPrototypeOf,Xb=/a/,Zb=function(){if(!Vb||!P_)throw new $b("RegExp.prototype.flags requires a true ES5 environment that supports property descriptors");var T=Gb(),E=P_(Xb),A=jb(E,"flags");return(!A||A.get!==T)&&qb(E,"flags",{configurable:!0,enumerable:!1,get:T}),T},Wb=sh,Yb=yp.exports,Hb=bd.exports,qy=jy,Kb=Zb,Jb=Yb(qy());Wb(Jb,{getPolyfill:qy,implementation:Hb,shim:Kb});_d();function Qb(b){return(b>0)-(b<0)||+b}function tw(b,T,E){var A=T[0]-b[0],D=T[1]-b[1],z=E[0]-T[0],U=E[1]-T[1];return Qb(A*U-z*D)}function ew(b,T){var E=b.geometry.coordinates[0].map(function(U){return U[0]}),A=b.geometry.coordinates[0].map(function(U){return U[1]}),D=T.geometry.coordinates[0].map(function(U){return U[0]}),z=T.geometry.coordinates[0].map(function(U){return U[1]});return Math.max.apply(null,E)===Math.max.apply(null,D)&&Math.max.apply(null,A)===Math.max.apply(null,z)&&Math.min.apply(null,E)===Math.min.apply(null,D)&&Math.min.apply(null,A)===Math.min.apply(null,z)}function L_(b,T){return T.geometry.coordinates[0].every(function(E){return my(ly(E),b)})}function rw(b,T){return b[0]===T[0]&&b[1]===T[1]}(function(){function b(){this.edges=[],this.polygon=void 0,this.envelope=void 0}return b.prototype.push=function(T){this.edges.push(T),this.polygon=this.envelope=void 0},b.prototype.get=function(T){return this.edges[T]},Object.defineProperty(b.prototype,"length",{get:function(){return this.edges.length},enumerable:!0,configurable:!0}),b.prototype.forEach=function(T){this.edges.forEach(T)},b.prototype.map=function(T){return this.edges.map(T)},b.prototype.some=function(T){return this.edges.some(T)},b.prototype.isValid=function(){return!0},b.prototype.isHole=function(){var T=this,E=this.edges.reduce(function(U,a,G){return a.from.coordinates[1]>T.edges[U].from.coordinates[1]&&(U=G),U},0),A=(E===0?this.length:E)-1,D=(E+1)%this.length,z=tw(this.edges[A].from.coordinates,this.edges[E].from.coordinates,this.edges[D].from.coordinates);return z===0?this.edges[A].from.coordinates[0]>this.edges[D].from.coordinates[0]:z>0},b.prototype.toMultiPoint=function(){return V0(this.edges.map(function(T){return T.from.coordinates}))},b.prototype.toPolygon=function(){if(this.polygon)return this.polygon;var T=this.edges.map(function(E){return E.from.coordinates});return T.push(this.edges[0].from.coordinates),this.polygon=uy([T])},b.prototype.getEnvelope=function(){return this.envelope?this.envelope:this.envelope=yy(this.toPolygon())},b.findEdgeRingContaining=function(T,E){var A=T.getEnvelope(),D,z;return E.forEach(function(U){var a=U.getEnvelope();if(z&&(D=z.getEnvelope()),!ew(a,A)&&L_(a,A)){for(var G=T.map(function(re){return re.from.coordinates}),ot=void 0,Rt=function(re){U.some(function(ee){return rw(re,ee.from.coordinates)})||(ot=re)},xt=0,At=G;xt<At.length;xt++){var qt=At[xt];Rt(qt)}ot&&U.inside(ly(ot))&&(!z||L_(D,a))&&(z=U)}}),z},b.prototype.inside=function(T){return my(T,this.toPolygon())},b})();var iw={exports:{}},qf={exports:{}},D_;function nw(){return D_||(D_=1,function(b){function T(E,A,D,z){this.dataset=[],this.epsilon=1,this.minPts=2,this.distance=this._euclideanDistance,this.clusters=[],this.noise=[],this._visited=[],this._assigned=[],this._datasetLength=0,this._init(E,A,D,z)}T.prototype.run=function(E,A,D,z){this._init(E,A,D,z);for(var U=0;U<this._datasetLength;U++)if(this._visited[U]!==1){this._visited[U]=1;var a=this._regionQuery(U);if(a.length<this.minPts)this.noise.push(U);else{var G=this.clusters.length;this.clusters.push([]),this._addToCluster(U,G),this._expandCluster(G,a)}}return this.clusters},T.prototype._init=function(E,A,D,z){if(E){if(!(E instanceof Array))throw Error("Dataset must be of type array, "+typeof E+" given");this.dataset=E,this.clusters=[],this.noise=[],this._datasetLength=E.length,this._visited=new Array(this._datasetLength),this._assigned=new Array(this._datasetLength)}A&&(this.epsilon=A),D&&(this.minPts=D),z&&(this.distance=z)},T.prototype._expandCluster=function(E,A){for(var D=0;D<A.length;D++){var z=A[D];if(this._visited[z]!==1){this._visited[z]=1;var U=this._regionQuery(z);U.length>=this.minPts&&(A=this._mergeArrays(A,U))}this._assigned[z]!==1&&this._addToCluster(z,E)}},T.prototype._addToCluster=function(E,A){this.clusters[A].push(E),this._assigned[E]=1},T.prototype._regionQuery=function(E){for(var A=[],D=0;D<this._datasetLength;D++){var z=this.distance(this.dataset[E],this.dataset[D]);z<this.epsilon&&A.push(D)}return A},T.prototype._mergeArrays=function(E,A){for(var D=A.length,z=0;z<D;z++){var U=A[z];E.indexOf(U)<0&&E.push(U)}return E},T.prototype._euclideanDistance=function(E,A){for(var D=0,z=Math.min(E.length,A.length);z--;)D+=(E[z]-A[z])*(E[z]-A[z]);return Math.sqrt(D)},b.exports&&(b.exports=T)}(qf)),qf.exports}var $f={exports:{}},R_;function ow(){return R_||(R_=1,function(b){function T(E,A,D){this.k=3,this.dataset=[],this.assignments=[],this.centroids=[],this.init(E,A,D)}T.prototype.init=function(E,A,D){this.assignments=[],this.centroids=[],typeof E<"u"&&(this.dataset=E),typeof A<"u"&&(this.k=A),typeof D<"u"&&(this.distance=D)},T.prototype.run=function(E,A){this.init(E,A);for(var D=this.dataset.length,z=0;z<this.k;z++)this.centroids[z]=this.randomCentroid();for(var U=!0;U;){U=this.assign();for(var a=0;a<this.k;a++){for(var G=new Array(At),ot=0,Rt=0;Rt<At;Rt++)G[Rt]=0;for(var xt=0;xt<D;xt++){var At=this.dataset[xt].length;if(a===this.assignments[xt]){for(var Rt=0;Rt<At;Rt++)G[Rt]+=this.dataset[xt][Rt];ot++}}if(ot>0){for(var Rt=0;Rt<At;Rt++)G[Rt]/=ot;this.centroids[a]=G}else this.centroids[a]=this.randomCentroid(),U=!0}}return this.getClusters()},T.prototype.randomCentroid=function(){var E=this.dataset.length-1,A,D;do D=Math.round(Math.random()*E),A=this.dataset[D];while(this.centroids.indexOf(A)>=0);return A},T.prototype.assign=function(){for(var E=!1,A=this.dataset.length,D,z=0;z<A;z++)D=this.argmin(this.dataset[z],this.centroids,this.distance),D!=this.assignments[z]&&(this.assignments[z]=D,E=!0);return E},T.prototype.getClusters=function(){for(var E=new Array(this.k),A,D=0;D<this.assignments.length;D++)A=this.assignments[D],typeof E[A]>"u"&&(E[A]=[]),E[A].push(D);return E},T.prototype.argmin=function(E,A,D){for(var z=Number.MAX_VALUE,U=0,a=A.length,G,ot=0;ot<a;ot++)G=D(E,A[ot]),G<z&&(z=G,U=ot);return U},T.prototype.distance=function(E,A){for(var D=0,z=Math.min(E.length,A.length);z--;){var U=E[z]-A[z];D+=U*U}return Math.sqrt(D)},b.exports&&(b.exports=T)}($f)),$f.exports}var Xf={exports:{}},Zf={exports:{}},O_;function $y(){return O_||(O_=1,function(b){function T(E,A,D){this._queue=[],this._priorities=[],this._sorting="desc",this._init(E,A,D)}T.prototype.insert=function(E,A){for(var D=this._queue.length,z=D;z--;){var U=this._priorities[z];this._sorting==="desc"?A>U&&(D=z):A<U&&(D=z)}this._insertAt(E,A,D)},T.prototype.remove=function(E){for(var A=this._queue.length;A--;){var D=this._queue[A];if(E===D){this._queue.splice(A,1),this._priorities.splice(A,1);break}}},T.prototype.forEach=function(E){this._queue.forEach(E)},T.prototype.getElements=function(){return this._queue},T.prototype.getElementPriority=function(E){return this._priorities[E]},T.prototype.getPriorities=function(){return this._priorities},T.prototype.getElementsWithPriorities=function(){for(var E=[],A=0,D=this._queue.length;A<D;A++)E.push([this._queue[A],this._priorities[A]]);return E},T.prototype._init=function(E,A,D){if(E&&A){if(this._queue=[],this._priorities=[],E.length!==A.length)throw new Error("Arrays must have the same length");for(var z=0;z<E.length;z++)this.insert(E[z],A[z])}D&&(this._sorting=D)},T.prototype._insertAt=function(E,A,D){this._queue.length===D?(this._queue.push(E),this._priorities.push(A)):(this._queue.splice(D,0,E),this._priorities.splice(D,0,A))},b.exports&&(b.exports=T)}(Zf)),Zf.exports}var N_;function sw(){return N_||(N_=1,function(b){if(b.exports)var T=$y();function E(A,D,z,U){this.epsilon=1,this.minPts=1,this.distance=this._euclideanDistance,this._reachability=[],this._processed=[],this._coreDistance=0,this._orderedList=[],this._init(A,D,z,U)}E.prototype.run=function(A,D,z,U){this._init(A,D,z,U);for(var a=0,G=this.dataset.length;a<G;a++)if(this._processed[a]!==1){this._processed[a]=1,this.clusters.push([a]);var ot=this.clusters.length-1;this._orderedList.push(a);var Rt=new T(null,null,"asc"),xt=this._regionQuery(a);this._distanceToCore(a)!==void 0&&(this._updateQueue(a,xt,Rt),this._expandCluster(ot,Rt))}return this.clusters},E.prototype.getReachabilityPlot=function(){for(var A=[],D=0,z=this._orderedList.length;D<z;D++){var U=this._orderedList[D],a=this._reachability[U];A.push([U,a])}return A},E.prototype._init=function(A,D,z,U){if(A){if(!(A instanceof Array))throw Error("Dataset must be of type array, "+typeof A+" given");this.dataset=A,this.clusters=[],this._reachability=new Array(this.dataset.length),this._processed=new Array(this.dataset.length),this._coreDistance=0,this._orderedList=[]}D&&(this.epsilon=D),z&&(this.minPts=z),U&&(this.distance=U)},E.prototype._updateQueue=function(A,D,z){var U=this;this._coreDistance=this._distanceToCore(A),D.forEach(function(a){if(U._processed[a]===void 0){var G=U.distance(U.dataset[A],U.dataset[a]),ot=Math.max(U._coreDistance,G);U._reachability[a]===void 0?(U._reachability[a]=ot,z.insert(a,ot)):ot<U._reachability[a]&&(U._reachability[a]=ot,z.remove(a),z.insert(a,ot))}})},E.prototype._expandCluster=function(A,D){for(var z=D.getElements(),U=0,a=z.length;U<a;U++){var G=z[U];if(this._processed[G]===void 0){var ot=this._regionQuery(G);this._processed[G]=1,this.clusters[A].push(G),this._orderedList.push(G),this._distanceToCore(G)!==void 0&&(this._updateQueue(G,ot,D),this._expandCluster(A,D))}}},E.prototype._distanceToCore=function(A){for(var D=this.epsilon,z=0;z<D;z++){var U=this._regionQuery(A,z);if(U.length>=this.minPts)return z}},E.prototype._regionQuery=function(A,D){D=D||this.epsilon;for(var z=[],U=0,a=this.dataset.length;U<a;U++)this.distance(this.dataset[A],this.dataset[U])<D&&z.push(U);return z},E.prototype._euclideanDistance=function(A,D){for(var z=0,U=Math.min(A.length,D.length);U--;)z+=(A[U]-D[U])*(A[U]-D[U]);return Math.sqrt(z)},b.exports&&(b.exports=E)}(Xf)),Xf.exports}(function(b){b.exports&&(b.exports={DBSCAN:nw(),KMEANS:ow(),OPTICS:sw(),PriorityQueue:$y()})})(iw);function lp(){this._=null}function vp(b){b.U=b.C=b.L=b.R=b.P=b.N=null}lp.prototype={constructor:lp,insert:function(b,T){var E,A,D;if(b){if(T.P=b,T.N=b.N,b.N&&(b.N.P=T),b.N=T,b.R){for(b=b.R;b.L;)b=b.L;b.L=T}else b.R=T;E=b}else this._?(b=z_(this._),T.P=null,T.N=b,b.P=b.L=T,E=b):(T.P=T.N=null,this._=T,E=null);for(T.L=T.R=null,T.U=E,T.C=!0,b=T;E&&E.C;)A=E.U,E===A.L?(D=A.R,D&&D.C?(E.C=D.C=!1,A.C=!0,b=A):(b===E.R&&(Uc(this,E),b=E,E=b.U),E.C=!1,A.C=!0,Vc(this,A))):(D=A.L,D&&D.C?(E.C=D.C=!1,A.C=!0,b=A):(b===E.L&&(Vc(this,E),b=E,E=b.U),E.C=!1,A.C=!0,Uc(this,A))),E=b.U;this._.C=!1},remove:function(b){b.N&&(b.N.P=b.P),b.P&&(b.P.N=b.N),b.N=b.P=null;var T=b.U,E,A=b.L,D=b.R,z,U;if(A?D?z=z_(D):z=A:z=D,T?T.L===b?T.L=z:T.R=z:this._=z,A&&D?(U=z.C,z.C=b.C,z.L=A,A.U=z,z!==D?(T=z.U,z.U=b.U,b=z.R,T.L=b,z.R=D,D.U=z):(z.U=T,T=z,b=z.R)):(U=b.C,b=z),b&&(b.U=T),!U){if(b&&b.C){b.C=!1;return}do{if(b===this._)break;if(b===T.L){if(E=T.R,E.C&&(E.C=!1,T.C=!0,Uc(this,T),E=T.R),E.L&&E.L.C||E.R&&E.R.C){(!E.R||!E.R.C)&&(E.L.C=!1,E.C=!0,Vc(this,E),E=T.R),E.C=T.C,T.C=E.R.C=!1,Uc(this,T),b=this._;break}}else if(E=T.L,E.C&&(E.C=!1,T.C=!0,Vc(this,T),E=T.L),E.L&&E.L.C||E.R&&E.R.C){(!E.L||!E.L.C)&&(E.R.C=!1,E.C=!0,Uc(this,E),E=T.L),E.C=T.C,T.C=E.L.C=!1,Vc(this,T),b=this._;break}E.C=!0,b=T,T=T.U}while(!b.C);b&&(b.C=!1)}}};function Uc(b,T){var E=T,A=T.R,D=E.U;D?D.L===E?D.L=A:D.R=A:b._=A,A.U=D,E.U=A,E.R=A.L,E.R&&(E.R.U=E),A.L=E}function Vc(b,T){var E=T,A=T.L,D=E.U;D?D.L===E?D.L=A:D.R=A:b._=A,A.U=D,E.U=A,E.L=A.R,E.L&&(E.L.U=E),A.R=E}function z_(b){for(;b.L;)b=b.L;return b}function $c(b,T,E,A){var D=[null,null],z=cs.push(D)-1;return D.left=b,D.right=T,E&&up(D,b,T,E),A&&up(D,T,b,A),Ys[b.index].halfedges.push(z),Ys[T.index].halfedges.push(z),D}function Gc(b,T,E){var A=[T,E];return A.left=b,A}function up(b,T,E,A){!b[0]&&!b[1]?(b[0]=A,b.left=T,b.right=E):b.left===E?b[1]=A:b[0]=A}function aw(b,T,E,A,D){var z=b[0],U=b[1],a=z[0],G=z[1],ot=U[0],Rt=U[1],xt=0,At=1,qt=ot-a,re=Rt-G,ee;if(ee=T-a,!(!qt&&ee>0)){if(ee/=qt,qt<0){if(ee<xt)return;ee<At&&(At=ee)}else if(qt>0){if(ee>At)return;ee>xt&&(xt=ee)}if(ee=A-a,!(!qt&&ee<0)){if(ee/=qt,qt<0){if(ee>At)return;ee>xt&&(xt=ee)}else if(qt>0){if(ee<xt)return;ee<At&&(At=ee)}if(ee=E-G,!(!re&&ee>0)){if(ee/=re,re<0){if(ee<xt)return;ee<At&&(At=ee)}else if(re>0){if(ee>At)return;ee>xt&&(xt=ee)}if(ee=D-G,!(!re&&ee<0)){if(ee/=re,re<0){if(ee>At)return;ee>xt&&(xt=ee)}else if(re>0){if(ee<xt)return;ee<At&&(At=ee)}return!(xt>0)&&!(At<1)||(xt>0&&(b[0]=[a+xt*qt,G+xt*re]),At<1&&(b[1]=[a+At*qt,G+At*re])),!0}}}}}function lw(b,T,E,A,D){var z=b[1];if(z)return!0;var U=b[0],a=b.left,G=b.right,ot=a[0],Rt=a[1],xt=G[0],At=G[1],qt=(ot+xt)/2,re=(Rt+At)/2,ee,Oe;if(At===Rt){if(qt<T||qt>=A)return;if(ot>xt){if(!U)U=[qt,E];else if(U[1]>=D)return;z=[qt,D]}else{if(!U)U=[qt,D];else if(U[1]<E)return;z=[qt,E]}}else if(ee=(ot-xt)/(At-Rt),Oe=re-ee*qt,ee<-1||ee>1)if(ot>xt){if(!U)U=[(E-Oe)/ee,E];else if(U[1]>=D)return;z=[(D-Oe)/ee,D]}else{if(!U)U=[(D-Oe)/ee,D];else if(U[1]<E)return;z=[(E-Oe)/ee,E]}else if(Rt<At){if(!U)U=[T,ee*T+Oe];else if(U[0]>=A)return;z=[A,ee*A+Oe]}else{if(!U)U=[A,ee*A+Oe];else if(U[0]<T)return;z=[T,ee*T+Oe]}return b[0]=U,b[1]=z,!0}function uw(b,T,E,A){for(var D=cs.length,z;D--;)(!lw(z=cs[D],b,T,E,A)||!aw(z,b,T,E,A)||!(Math.abs(z[0][0]-z[1][0])>An||Math.abs(z[0][1]-z[1][1])>An))&&delete cs[D]}function cw(b){return Ys[b.index]={site:b,halfedges:[]}}function hw(b,T){var E=b.site,A=T.left,D=T.right;return E===D&&(D=A,A=E),D?Math.atan2(D[1]-A[1],D[0]-A[0]):(E===A?(A=T[1],D=T[0]):(A=T[0],D=T[1]),Math.atan2(A[0]-D[0],D[1]-A[1]))}function Xy(b,T){return T[+(T.left!==b.site)]}function pw(b,T){return T[+(T.left===b.site)]}function fw(){for(var b=0,T=Ys.length,E,A,D,z;b<T;++b)if((E=Ys[b])&&(z=(A=E.halfedges).length)){var U=new Array(z),a=new Array(z);for(D=0;D<z;++D)U[D]=D,a[D]=hw(E,cs[A[D]]);for(U.sort(function(G,ot){return a[ot]-a[G]}),D=0;D<z;++D)a[D]=A[U[D]];for(D=0;D<z;++D)A[D]=a[D]}}function dw(b,T,E,A){var D=Ys.length,z,U,a,G,ot,Rt,xt,At,qt,re,ee,Oe,Ge=!0;for(z=0;z<D;++z)if(U=Ys[z]){for(a=U.site,ot=U.halfedges,G=ot.length;G--;)cs[ot[G]]||ot.splice(G,1);for(G=0,Rt=ot.length;G<Rt;)re=pw(U,cs[ot[G]]),ee=re[0],Oe=re[1],xt=Xy(U,cs[ot[++G%Rt]]),At=xt[0],qt=xt[1],(Math.abs(ee-At)>An||Math.abs(Oe-qt)>An)&&(ot.splice(G,0,cs.push(Gc(a,re,Math.abs(ee-b)<An&&A-Oe>An?[b,Math.abs(At-b)<An?qt:A]:Math.abs(Oe-A)<An&&E-ee>An?[Math.abs(qt-A)<An?At:E,A]:Math.abs(ee-E)<An&&Oe-T>An?[E,Math.abs(At-E)<An?qt:T]:Math.abs(Oe-T)<An&&ee-b>An?[Math.abs(qt-T)<An?At:b,T]:null))-1),++Rt);Rt&&(Ge=!1)}if(Ge){var Mt,gt,Et,Ft=1/0;for(z=0,Ge=null;z<D;++z)(U=Ys[z])&&(a=U.site,Mt=a[0]-b,gt=a[1]-T,Et=Mt*Mt+gt*gt,Et<Ft&&(Ft=Et,Ge=U));if(Ge){var Ie=[b,T],de=[b,A],xe=[E,A],$t=[E,T];Ge.halfedges.push(cs.push(Gc(a=Ge.site,Ie,de))-1,cs.push(Gc(a,de,xe))-1,cs.push(Gc(a,xe,$t))-1,cs.push(Gc(a,$t,Ie))-1)}}for(z=0;z<D;++z)(U=Ys[z])&&(U.halfedges.length||delete Ys[z])}var Zy=[],wd;function mw(){vp(this),this.x=this.y=this.arc=this.site=this.cy=null}function Uu(b){var T=b.P,E=b.N;if(!(!T||!E)){var A=T.site,D=b.site,z=E.site;if(A!==z){var U=D[0],a=D[1],G=A[0]-U,ot=A[1]-a,Rt=z[0]-U,xt=z[1]-a,At=2*(G*xt-ot*Rt);if(!(At>=-xw)){var qt=G*G+ot*ot,re=Rt*Rt+xt*xt,ee=(xt*qt-ot*re)/At,Oe=(G*re-Rt*qt)/At,Ge=Zy.pop()||new mw;Ge.arc=b,Ge.site=D,Ge.x=ee+U,Ge.y=(Ge.cy=Oe+a)+Math.sqrt(ee*ee+Oe*Oe),b.circle=Ge;for(var Mt=null,gt=th._;gt;)if(Ge.y<gt.y||Ge.y===gt.y&&Ge.x<=gt.x)if(gt.L)gt=gt.L;else{Mt=gt.P;break}else if(gt.R)gt=gt.R;else{Mt=gt;break}th.insert(Mt,Ge),Mt||(wd=Ge)}}}}function $u(b){var T=b.circle;T&&(T.P||(wd=T.N),th.remove(T),Zy.push(T),vp(T),b.circle=null)}var Wy=[];function gw(){vp(this),this.edge=this.site=this.circle=null}function k_(b){var T=Wy.pop()||new gw;return T.site=b,T}function Wf(b){$u(b),Xu.remove(b),Wy.push(b),vp(b)}function _w(b){var T=b.circle,E=T.x,A=T.cy,D=[E,A],z=b.P,U=b.N,a=[b];Wf(b);for(var G=z;G.circle&&Math.abs(E-G.circle.x)<An&&Math.abs(A-G.circle.cy)<An;)z=G.P,a.unshift(G),Wf(G),G=z;a.unshift(G),$u(G);for(var ot=U;ot.circle&&Math.abs(E-ot.circle.x)<An&&Math.abs(A-ot.circle.cy)<An;)U=ot.N,a.push(ot),Wf(ot),ot=U;a.push(ot),$u(ot);var Rt=a.length,xt;for(xt=1;xt<Rt;++xt)ot=a[xt],G=a[xt-1],up(ot.edge,G.site,ot.site,D);G=a[0],ot=a[Rt-1],ot.edge=$c(G.site,ot.site,null,D),Uu(G),Uu(ot)}function yw(b){for(var T=b[0],E=b[1],A,D,z,U,a=Xu._;a;)if(z=Yy(a,E)-T,z>An)a=a.L;else if(U=T-vw(a,E),U>An){if(!a.R){A=a;break}a=a.R}else{z>-An?(A=a.P,D=a):U>-An?(A=a,D=a.N):A=D=a;break}cw(b);var G=k_(b);if(Xu.insert(A,G),!(!A&&!D)){if(A===D){$u(A),D=k_(A.site),Xu.insert(G,D),G.edge=D.edge=$c(A.site,G.site),Uu(A),Uu(D);return}if(!D){G.edge=$c(A.site,G.site);return}$u(A),$u(D);var ot=A.site,Rt=ot[0],xt=ot[1],At=b[0]-Rt,qt=b[1]-xt,re=D.site,ee=re[0]-Rt,Oe=re[1]-xt,Ge=2*(At*Oe-qt*ee),Mt=At*At+qt*qt,gt=ee*ee+Oe*Oe,Et=[(Oe*Mt-qt*gt)/Ge+Rt,(At*gt-ee*Mt)/Ge+xt];up(D.edge,ot,re,Et),G.edge=$c(ot,b,null,Et),D.edge=$c(b,re,null,Et),Uu(A),Uu(D)}}function Yy(b,T){var E=b.site,A=E[0],D=E[1],z=D-T;if(!z)return A;var U=b.P;if(!U)return-1/0;E=U.site;var a=E[0],G=E[1],ot=G-T;if(!ot)return a;var Rt=a-A,xt=1/z-1/ot,At=Rt/ot;return xt?(-At+Math.sqrt(At*At-2*xt*(Rt*Rt/(-2*ot)-G+ot/2+D-z/2)))/xt+A:(A+a)/2}function vw(b,T){var E=b.N;if(E)return Yy(E,T);var A=b.site;return A[1]===T?A[0]:1/0}var An=1e-6,xw=1e-12,Xu,Ys,th,cs;function bw(b,T,E){return(b[0]-E[0])*(T[1]-b[1])-(b[0]-T[0])*(E[1]-b[1])}function ww(b,T){return T[1]-b[1]||T[0]-b[0]}function B_(b,T){var E=b.sort(ww).pop(),A,D,z;for(cs=[],Ys=new Array(b.length),Xu=new lp,th=new lp;;)if(z=wd,E&&(!z||E[1]<z.y||E[1]===z.y&&E[0]<z.x))(E[0]!==A||E[1]!==D)&&(yw(E),A=E[0],D=E[1]),E=b.pop();else if(z)_w(z.arc);else break;if(fw(),T){var U=+T[0][0],a=+T[0][1],G=+T[1][0],ot=+T[1][1];uw(U,a,G,ot),dw(U,a,G,ot)}this.edges=cs,this.cells=Ys,Xu=th=cs=Ys=null}B_.prototype={constructor:B_,polygons:function(){var b=this.edges;return this.cells.map(function(T){var E=T.halfedges.map(function(A){return Xy(T,b[A])});return E.data=T.site.data,E})},triangles:function(){var b=[],T=this.edges;return this.cells.forEach(function(E,A){if(a=(z=E.halfedges).length)for(var D=E.site,z,U=-1,a,G,ot=T[z[a-1]],Rt=ot.left===D?ot.right:ot.left;++U<a;)G=Rt,ot=T[z[U]],Rt=ot.left===D?ot.right:ot.left,G&&Rt&&A<G.index&&A<Rt.index&&bw(D,G,Rt)<0&&b.push([D.data,G.data,Rt.data])}),b},links:function(){return this.edges.filter(function(b){return b.right}).map(function(b){return{source:b.left.data,target:b.right.data}})},find:function(b,T,E){for(var A=this,D,z=A._found||0,U=A.cells.length,a;!(a=A.cells[z]);)if(++z>=U)return null;var G=b-a.site[0],ot=T-a.site[1],Rt=G*G+ot*ot;do a=A.cells[D=z],z=null,a.halfedges.forEach(function(xt){var At=A.edges[xt],qt=At.left;if(!((qt===a.site||!qt)&&!(qt=At.right))){var re=b-qt[0],ee=T-qt[1],Oe=re*re+ee*ee;Oe<Rt&&(Rt=Oe,z=qt.index)}});while(z!==null);return A._found=D,E==null||Rt<=E*E?a.site:null}};var Ew={exports:{}};(function(b,T){(function(E,A){b.exports=A()})(ih,function(){function E(zt,J){if(!(zt instanceof J))throw new TypeError("Cannot call a class as a function")}function A(zt,J){for(var Z=0;Z<J.length;Z++){var H=J[Z];H.enumerable=H.enumerable||!1,H.configurable=!0,"value"in H&&(H.writable=!0),Object.defineProperty(zt,H.key,H)}}function D(zt,J,Z){return J&&A(zt.prototype,J),Z&&A(zt,Z),zt}/**
 * splaytree v3.1.0
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */var z=function(){function zt(J,Z){this.next=null,this.key=J,this.data=Z,this.left=null,this.right=null}return zt}();function U(zt,J){return zt>J?1:zt<J?-1:0}function a(zt,J,Z){for(var H=new z(null,null),ft=H,Dt=H;;){var Jt=Z(zt,J.key);if(Jt<0){if(J.left===null)break;if(Z(zt,J.left.key)<0){var pe=J.left;if(J.left=pe.right,pe.right=J,J=pe,J.left===null)break}Dt.left=J,Dt=J,J=J.left}else if(Jt>0){if(J.right===null)break;if(Z(zt,J.right.key)>0){var pe=J.right;if(J.right=pe.left,pe.left=J,J=pe,J.right===null)break}ft.right=J,ft=J,J=J.right}else break}return ft.right=J.left,Dt.left=J.right,J.left=H.right,J.right=H.left,J}function G(zt,J,Z,H){var ft=new z(zt,J);if(Z===null)return ft.left=ft.right=null,ft;Z=a(zt,Z,H);var Dt=H(zt,Z.key);return Dt<0?(ft.left=Z.left,ft.right=Z,Z.left=null):Dt>=0&&(ft.right=Z.right,ft.left=Z,Z.right=null),ft}function ot(zt,J,Z){var H=null,ft=null;if(J){J=a(zt,J,Z);var Dt=Z(J.key,zt);Dt===0?(H=J.left,ft=J.right):Dt<0?(ft=J.right,J.right=null,H=J):(H=J.left,J.left=null,ft=J)}return{left:H,right:ft}}function Rt(zt,J,Z){return J===null?zt:(zt===null||(J=a(zt.key,J,Z),J.left=zt),J)}function xt(zt,J,Z,H,ft){if(zt){H(""+J+(Z?"└── ":"├── ")+ft(zt)+`
`);var Dt=J+(Z?"    ":"│   ");zt.left&&xt(zt.left,Dt,!1,H,ft),zt.right&&xt(zt.right,Dt,!0,H,ft)}}var At=function(){function zt(J){J===void 0&&(J=U),this._root=null,this._size=0,this._comparator=J}return zt.prototype.insert=function(J,Z){return this._size++,this._root=G(J,Z,this._root,this._comparator)},zt.prototype.add=function(J,Z){var H=new z(J,Z);this._root===null&&(H.left=H.right=null,this._size++,this._root=H);var ft=this._comparator,Dt=a(J,this._root,ft),Jt=ft(J,Dt.key);return Jt===0?this._root=Dt:(Jt<0?(H.left=Dt.left,H.right=Dt,Dt.left=null):Jt>0&&(H.right=Dt.right,H.left=Dt,Dt.right=null),this._size++,this._root=H),this._root},zt.prototype.remove=function(J){this._root=this._remove(J,this._root,this._comparator)},zt.prototype._remove=function(J,Z,H){var ft;if(Z===null)return null;Z=a(J,Z,H);var Dt=H(J,Z.key);return Dt===0?(Z.left===null?ft=Z.right:(ft=a(J,Z.left,H),ft.right=Z.right),this._size--,ft):Z},zt.prototype.pop=function(){var J=this._root;if(J){for(;J.left;)J=J.left;return this._root=a(J.key,this._root,this._comparator),this._root=this._remove(J.key,this._root,this._comparator),{key:J.key,data:J.data}}return null},zt.prototype.findStatic=function(J){for(var Z=this._root,H=this._comparator;Z;){var ft=H(J,Z.key);if(ft===0)return Z;ft<0?Z=Z.left:Z=Z.right}return null},zt.prototype.find=function(J){return this._root&&(this._root=a(J,this._root,this._comparator),this._comparator(J,this._root.key)!==0)?null:this._root},zt.prototype.contains=function(J){for(var Z=this._root,H=this._comparator;Z;){var ft=H(J,Z.key);if(ft===0)return!0;ft<0?Z=Z.left:Z=Z.right}return!1},zt.prototype.forEach=function(J,Z){for(var H=this._root,ft=[],Dt=!1;!Dt;)H!==null?(ft.push(H),H=H.left):ft.length!==0?(H=ft.pop(),J.call(Z,H),H=H.right):Dt=!0;return this},zt.prototype.range=function(J,Z,H,ft){for(var Dt=[],Jt=this._comparator,pe=this._root,kt;Dt.length!==0||pe;)if(pe)Dt.push(pe),pe=pe.left;else{if(pe=Dt.pop(),kt=Jt(pe.key,Z),kt>0)break;if(Jt(pe.key,J)>=0&&H.call(ft,pe))return this;pe=pe.right}return this},zt.prototype.keys=function(){var J=[];return this.forEach(function(Z){var H=Z.key;return J.push(H)}),J},zt.prototype.values=function(){var J=[];return this.forEach(function(Z){var H=Z.data;return J.push(H)}),J},zt.prototype.min=function(){return this._root?this.minNode(this._root).key:null},zt.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},zt.prototype.minNode=function(J){if(J===void 0&&(J=this._root),J)for(;J.left;)J=J.left;return J},zt.prototype.maxNode=function(J){if(J===void 0&&(J=this._root),J)for(;J.right;)J=J.right;return J},zt.prototype.at=function(J){for(var Z=this._root,H=!1,ft=0,Dt=[];!H;)if(Z)Dt.push(Z),Z=Z.left;else if(Dt.length>0){if(Z=Dt.pop(),ft===J)return Z;ft++,Z=Z.right}else H=!0;return null},zt.prototype.next=function(J){var Z=this._root,H=null;if(J.right){for(H=J.right;H.left;)H=H.left;return H}for(var ft=this._comparator;Z;){var Dt=ft(J.key,Z.key);if(Dt===0)break;Dt<0?(H=Z,Z=Z.left):Z=Z.right}return H},zt.prototype.prev=function(J){var Z=this._root,H=null;if(J.left!==null){for(H=J.left;H.right;)H=H.right;return H}for(var ft=this._comparator;Z;){var Dt=ft(J.key,Z.key);if(Dt===0)break;Dt<0?Z=Z.left:(H=Z,Z=Z.right)}return H},zt.prototype.clear=function(){return this._root=null,this._size=0,this},zt.prototype.toList=function(){return ee(this._root)},zt.prototype.load=function(J,Z,H){Z===void 0&&(Z=[]),H===void 0&&(H=!1);var ft=J.length,Dt=this._comparator;if(H&&Mt(J,Z,0,ft-1,Dt),this._root===null)this._root=qt(J,Z,0,ft),this._size=ft;else{var Jt=Ge(this.toList(),re(J,Z),Dt);ft=this._size+ft,this._root=Oe({head:Jt},0,ft)}return this},zt.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(zt.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(zt.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),zt.prototype.toString=function(J){J===void 0&&(J=function(ft){return String(ft.key)});var Z=[];return xt(this._root,"",!0,function(H){return Z.push(H)},J),Z.join("")},zt.prototype.update=function(J,Z,H){var ft=this._comparator,Dt=ot(J,this._root,ft),Jt=Dt.left,pe=Dt.right;ft(J,Z)<0?pe=G(Z,H,pe,ft):Jt=G(Z,H,Jt,ft),this._root=Rt(Jt,pe,ft)},zt.prototype.split=function(J){return ot(J,this._root,this._comparator)},zt}();function qt(zt,J,Z,H){var ft=H-Z;if(ft>0){var Dt=Z+Math.floor(ft/2),Jt=zt[Dt],pe=J[Dt],kt=new z(Jt,pe);return kt.left=qt(zt,J,Z,Dt),kt.right=qt(zt,J,Dt+1,H),kt}return null}function re(zt,J){for(var Z=new z(null,null),H=Z,ft=0;ft<zt.length;ft++)H=H.next=new z(zt[ft],J[ft]);return H.next=null,Z.next}function ee(zt){for(var J=zt,Z=[],H=!1,ft=new z(null,null),Dt=ft;!H;)J?(Z.push(J),J=J.left):Z.length>0?(J=Dt=Dt.next=Z.pop(),J=J.right):H=!0;return Dt.next=null,ft.next}function Oe(zt,J,Z){var H=Z-J;if(H>0){var ft=J+Math.floor(H/2),Dt=Oe(zt,J,ft),Jt=zt.head;return Jt.left=Dt,zt.head=zt.head.next,Jt.right=Oe(zt,ft+1,Z),Jt}return null}function Ge(zt,J,Z){for(var H=new z(null,null),ft=H,Dt=zt,Jt=J;Dt!==null&&Jt!==null;)Z(Dt.key,Jt.key)<0?(ft.next=Dt,Dt=Dt.next):(ft.next=Jt,Jt=Jt.next),ft=ft.next;return Dt!==null?ft.next=Dt:Jt!==null&&(ft.next=Jt),H.next}function Mt(zt,J,Z,H,ft){if(!(Z>=H)){for(var Dt=zt[Z+H>>1],Jt=Z-1,pe=H+1;;){do Jt++;while(ft(zt[Jt],Dt)<0);do pe--;while(ft(zt[pe],Dt)>0);if(Jt>=pe)break;var kt=zt[Jt];zt[Jt]=zt[pe],zt[pe]=kt,kt=J[Jt],J[Jt]=J[pe],J[pe]=kt}Mt(zt,J,Z,pe,ft),Mt(zt,J,pe+1,H,ft)}}var gt=function(J,Z){return J.ll.x<=Z.x&&Z.x<=J.ur.x&&J.ll.y<=Z.y&&Z.y<=J.ur.y},Et=function(J,Z){if(Z.ur.x<J.ll.x||J.ur.x<Z.ll.x||Z.ur.y<J.ll.y||J.ur.y<Z.ll.y)return null;var H=J.ll.x<Z.ll.x?Z.ll.x:J.ll.x,ft=J.ur.x<Z.ur.x?J.ur.x:Z.ur.x,Dt=J.ll.y<Z.ll.y?Z.ll.y:J.ll.y,Jt=J.ur.y<Z.ur.y?J.ur.y:Z.ur.y;return{ll:{x:H,y:Dt},ur:{x:ft,y:Jt}}},Ft=Number.EPSILON;Ft===void 0&&(Ft=Math.pow(2,-52));var Ie=Ft*Ft,de=function(J,Z){if(-Ft<J&&J<Ft&&-Ft<Z&&Z<Ft)return 0;var H=J-Z;return H*H<Ie*J*Z?0:J<Z?-1:1},xe=function(){function zt(){E(this,zt),this.reset()}return D(zt,[{key:"reset",value:function(){this.xRounder=new $t,this.yRounder=new $t}},{key:"round",value:function(Z,H){return{x:this.xRounder.round(Z),y:this.yRounder.round(H)}}}]),zt}(),$t=function(){function zt(){E(this,zt),this.tree=new At,this.round(0)}return D(zt,[{key:"round",value:function(Z){var H=this.tree.add(Z),ft=this.tree.prev(H);if(ft!==null&&de(H.key,ft.key)===0)return this.tree.remove(Z),ft.key;var Dt=this.tree.next(H);return Dt!==null&&de(H.key,Dt.key)===0?(this.tree.remove(Z),Dt.key):Z}}]),zt}(),yt=new xe,ue=function(J,Z){return J.x*Z.y-J.y*Z.x},Kt=function(J,Z){return J.x*Z.x+J.y*Z.y},ae=function(J,Z,H){var ft={x:Z.x-J.x,y:Z.y-J.y},Dt={x:H.x-J.x,y:H.y-J.y},Jt=ue(ft,Dt);return de(Jt,0)},wt=function(J){return Math.sqrt(Kt(J,J))},_i=function(J,Z,H){var ft={x:Z.x-J.x,y:Z.y-J.y},Dt={x:H.x-J.x,y:H.y-J.y};return ue(Dt,ft)/wt(Dt)/wt(ft)},Ne=function(J,Z,H){var ft={x:Z.x-J.x,y:Z.y-J.y},Dt={x:H.x-J.x,y:H.y-J.y};return Kt(Dt,ft)/wt(Dt)/wt(ft)},Tr=function(J,Z,H){return Z.y===0?null:{x:J.x+Z.x/Z.y*(H-J.y),y:H}},Ye=function(J,Z,H){return Z.x===0?null:{x:H,y:J.y+Z.y/Z.x*(H-J.x)}},ti=function(J,Z,H,ft){if(Z.x===0)return Ye(H,ft,J.x);if(ft.x===0)return Ye(J,Z,H.x);if(Z.y===0)return Tr(H,ft,J.y);if(ft.y===0)return Tr(J,Z,H.y);var Dt=ue(Z,ft);if(Dt==0)return null;var Jt={x:H.x-J.x,y:H.y-J.y},pe=ue(Jt,Z)/Dt,kt=ue(Jt,ft)/Dt,Ze=J.x+kt*Z.x,rr=H.x+pe*ft.x,Me=J.y+kt*Z.y,fr=H.y+pe*ft.y,Sr=(Ze+rr)/2,Fr=(Me+fr)/2;return{x:Sr,y:Fr}},Pe=function(){D(zt,null,[{key:"compare",value:function(Z,H){var ft=zt.comparePoints(Z.point,H.point);return ft!==0?ft:(Z.point!==H.point&&Z.link(H),Z.isLeft!==H.isLeft?Z.isLeft?1:-1:Ot.compare(Z.segment,H.segment))}},{key:"comparePoints",value:function(Z,H){return Z.x<H.x?-1:Z.x>H.x?1:Z.y<H.y?-1:Z.y>H.y?1:0}}]);function zt(J,Z){E(this,zt),J.events===void 0?J.events=[this]:J.events.push(this),this.point=J,this.isLeft=Z}return D(zt,[{key:"link",value:function(Z){if(Z.point===this.point)throw new Error("Tried to link already linked events");for(var H=Z.point.events,ft=0,Dt=H.length;ft<Dt;ft++){var Jt=H[ft];this.point.events.push(Jt),Jt.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var Z=this.point.events.length,H=0;H<Z;H++){var ft=this.point.events[H];if(ft.segment.consumedBy===void 0)for(var Dt=H+1;Dt<Z;Dt++){var Jt=this.point.events[Dt];Jt.consumedBy===void 0&&ft.otherSE.point.events===Jt.otherSE.point.events&&ft.segment.consume(Jt.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var Z=[],H=0,ft=this.point.events.length;H<ft;H++){var Dt=this.point.events[H];Dt!==this&&!Dt.segment.ringOut&&Dt.segment.isInResult()&&Z.push(Dt)}return Z}},{key:"getLeftmostComparator",value:function(Z){var H=this,ft=new Map,Dt=function(pe){var kt=pe.otherSE;ft.set(pe,{sine:_i(H.point,Z.point,kt.point),cosine:Ne(H.point,Z.point,kt.point)})};return function(Jt,pe){ft.has(Jt)||Dt(Jt),ft.has(pe)||Dt(pe);var kt=ft.get(Jt),Ze=kt.sine,rr=kt.cosine,Me=ft.get(pe),fr=Me.sine,Sr=Me.cosine;return Ze>=0&&fr>=0?rr<Sr?1:rr>Sr?-1:0:Ze<0&&fr<0?rr<Sr?-1:rr>Sr?1:0:fr<Ze?-1:fr>Ze?1:0}}}]),zt}(),tr=0,Ot=function(){D(zt,null,[{key:"compare",value:function(Z,H){var ft=Z.leftSE.point.x,Dt=H.leftSE.point.x,Jt=Z.rightSE.point.x,pe=H.rightSE.point.x;if(pe<ft)return 1;if(Jt<Dt)return-1;var kt=Z.leftSE.point.y,Ze=H.leftSE.point.y,rr=Z.rightSE.point.y,Me=H.rightSE.point.y;if(ft<Dt){if(Ze<kt&&Ze<rr)return 1;if(Ze>kt&&Ze>rr)return-1;var fr=Z.comparePoint(H.leftSE.point);if(fr<0)return 1;if(fr>0)return-1;var Sr=H.comparePoint(Z.rightSE.point);return Sr!==0?Sr:-1}if(ft>Dt){if(kt<Ze&&kt<Me)return-1;if(kt>Ze&&kt>Me)return 1;var Fr=H.comparePoint(Z.leftSE.point);if(Fr!==0)return Fr;var gr=Z.comparePoint(H.rightSE.point);return gr<0?1:gr>0?-1:1}if(kt<Ze)return-1;if(kt>Ze)return 1;if(Jt<pe){var $r=H.comparePoint(Z.rightSE.point);if($r!==0)return $r}if(Jt>pe){var yi=Z.comparePoint(H.rightSE.point);if(yi<0)return 1;if(yi>0)return-1}if(Jt!==pe){var Di=rr-kt,sn=Jt-ft,ht=Me-Ze,X=pe-Dt;if(Di>sn&&ht<X)return 1;if(Di<sn&&ht>X)return-1}return Jt>pe?1:Jt<pe||rr<Me?-1:rr>Me?1:Z.id<H.id?-1:Z.id>H.id?1:0}}]);function zt(J,Z,H,ft){E(this,zt),this.id=++tr,this.leftSE=J,J.segment=this,J.otherSE=Z,this.rightSE=Z,Z.segment=this,Z.otherSE=J,this.rings=H,this.windings=ft}return D(zt,[{key:"replaceRightSE",value:function(Z){this.rightSE=Z,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var Z=this.leftSE.point.y,H=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:Z<H?Z:H},ur:{x:this.rightSE.point.x,y:Z>H?Z:H}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(Z){return Z.x===this.leftSE.point.x&&Z.y===this.leftSE.point.y||Z.x===this.rightSE.point.x&&Z.y===this.rightSE.point.y}},{key:"comparePoint",value:function(Z){if(this.isAnEndpoint(Z))return 0;var H=this.leftSE.point,ft=this.rightSE.point,Dt=this.vector();if(H.x===ft.x)return Z.x===H.x?0:Z.x<H.x?1:-1;var Jt=(Z.y-H.y)/Dt.y,pe=H.x+Jt*Dt.x;if(Z.x===pe)return 0;var kt=(Z.x-H.x)/Dt.x,Ze=H.y+kt*Dt.y;return Z.y===Ze?0:Z.y<Ze?-1:1}},{key:"getIntersection",value:function(Z){var H=this.bbox(),ft=Z.bbox(),Dt=Et(H,ft);if(Dt===null)return null;var Jt=this.leftSE.point,pe=this.rightSE.point,kt=Z.leftSE.point,Ze=Z.rightSE.point,rr=gt(H,kt)&&this.comparePoint(kt)===0,Me=gt(ft,Jt)&&Z.comparePoint(Jt)===0,fr=gt(H,Ze)&&this.comparePoint(Ze)===0,Sr=gt(ft,pe)&&Z.comparePoint(pe)===0;if(Me&&rr)return Sr&&!fr?pe:!Sr&&fr?Ze:null;if(Me)return fr&&Jt.x===Ze.x&&Jt.y===Ze.y?null:Jt;if(rr)return Sr&&pe.x===kt.x&&pe.y===kt.y?null:kt;if(Sr&&fr)return null;if(Sr)return pe;if(fr)return Ze;var Fr=ti(Jt,this.vector(),kt,Z.vector());return Fr===null||!gt(Dt,Fr)?null:yt.round(Fr.x,Fr.y)}},{key:"split",value:function(Z){var H=[],ft=Z.events!==void 0,Dt=new Pe(Z,!0),Jt=new Pe(Z,!1),pe=this.rightSE;this.replaceRightSE(Jt),H.push(Jt),H.push(Dt);var kt=new zt(Dt,pe,this.rings.slice(),this.windings.slice());return Pe.comparePoints(kt.leftSE.point,kt.rightSE.point)>0&&kt.swapEvents(),Pe.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),ft&&(Dt.checkForConsuming(),Jt.checkForConsuming()),H}},{key:"swapEvents",value:function(){var Z=this.rightSE;this.rightSE=this.leftSE,this.leftSE=Z,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var H=0,ft=this.windings.length;H<ft;H++)this.windings[H]*=-1}},{key:"consume",value:function(Z){for(var H=this,ft=Z;H.consumedBy;)H=H.consumedBy;for(;ft.consumedBy;)ft=ft.consumedBy;var Dt=zt.compare(H,ft);if(Dt!==0){if(Dt>0){var Jt=H;H=ft,ft=Jt}if(H.prev===ft){var pe=H;H=ft,ft=pe}for(var kt=0,Ze=ft.rings.length;kt<Ze;kt++){var rr=ft.rings[kt],Me=ft.windings[kt],fr=H.rings.indexOf(rr);fr===-1?(H.rings.push(rr),H.windings.push(Me)):H.windings[fr]+=Me}ft.rings=null,ft.windings=null,ft.consumedBy=H,ft.leftSE.consumedBy=H.leftSE,ft.rightSE.consumedBy=H.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}},{key:"beforeState",value:function(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{var Z=this.prev.consumedBy||this.prev;this._beforeState=Z.afterState()}return this._beforeState}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var Z=this.beforeState();this._afterState={rings:Z.rings.slice(0),windings:Z.windings.slice(0),multiPolys:[]};for(var H=this._afterState.rings,ft=this._afterState.windings,Dt=this._afterState.multiPolys,Jt=0,pe=this.rings.length;Jt<pe;Jt++){var kt=this.rings[Jt],Ze=this.windings[Jt],rr=H.indexOf(kt);rr===-1?(H.push(kt),ft.push(Ze)):ft[rr]+=Ze}for(var Me=[],fr=[],Sr=0,Fr=H.length;Sr<Fr;Sr++)if(ft[Sr]!==0){var gr=H[Sr],$r=gr.poly;if(fr.indexOf($r)===-1)if(gr.isExterior)Me.push($r);else{fr.indexOf($r)===-1&&fr.push($r);var yi=Me.indexOf(gr.poly);yi!==-1&&Me.splice(yi,1)}}for(var Di=0,sn=Me.length;Di<sn;Di++){var ht=Me[Di].multiPoly;Dt.indexOf(ht)===-1&&Dt.push(ht)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var Z=this.beforeState().multiPolys,H=this.afterState().multiPolys;switch(jr.type){case"union":{var ft=Z.length===0,Dt=H.length===0;this._isInResult=ft!==Dt;break}case"intersection":{var Jt,pe;Z.length<H.length?(Jt=Z.length,pe=H.length):(Jt=H.length,pe=Z.length),this._isInResult=pe===jr.numMultiPolys&&Jt<pe;break}case"xor":{var kt=Math.abs(Z.length-H.length);this._isInResult=kt%2===1;break}case"difference":{var Ze=function(Me){return Me.length===1&&Me[0].isSubject};this._isInResult=Ze(Z)!==Ze(H);break}default:throw new Error("Unrecognized operation type found ".concat(jr.type))}return this._isInResult}}],[{key:"fromRing",value:function(Z,H,ft){var Dt,Jt,pe,kt=Pe.comparePoints(Z,H);if(kt<0)Dt=Z,Jt=H,pe=1;else if(kt>0)Dt=H,Jt=Z,pe=-1;else throw new Error("Tried to create degenerate segment at [".concat(Z.x,", ").concat(Z.y,"]"));var Ze=new Pe(Dt,!0),rr=new Pe(Jt,!1);return new zt(Ze,rr,[ft],[pe])}}]),zt}(),ur=function(){function zt(J,Z,H){if(E(this,zt),!Array.isArray(J)||J.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=Z,this.isExterior=H,this.segments=[],typeof J[0][0]!="number"||typeof J[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var ft=yt.round(J[0][0],J[0][1]);this.bbox={ll:{x:ft.x,y:ft.y},ur:{x:ft.x,y:ft.y}};for(var Dt=ft,Jt=1,pe=J.length;Jt<pe;Jt++){if(typeof J[Jt][0]!="number"||typeof J[Jt][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var kt=yt.round(J[Jt][0],J[Jt][1]);kt.x===Dt.x&&kt.y===Dt.y||(this.segments.push(Ot.fromRing(Dt,kt,this)),kt.x<this.bbox.ll.x&&(this.bbox.ll.x=kt.x),kt.y<this.bbox.ll.y&&(this.bbox.ll.y=kt.y),kt.x>this.bbox.ur.x&&(this.bbox.ur.x=kt.x),kt.y>this.bbox.ur.y&&(this.bbox.ur.y=kt.y),Dt=kt)}(ft.x!==Dt.x||ft.y!==Dt.y)&&this.segments.push(Ot.fromRing(Dt,ft,this))}return D(zt,[{key:"getSweepEvents",value:function(){for(var Z=[],H=0,ft=this.segments.length;H<ft;H++){var Dt=this.segments[H];Z.push(Dt.leftSE),Z.push(Dt.rightSE)}return Z}}]),zt}(),pr=function(){function zt(J,Z){if(E(this,zt),!Array.isArray(J))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new ur(J[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var H=1,ft=J.length;H<ft;H++){var Dt=new ur(J[H],this,!1);Dt.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=Dt.bbox.ll.x),Dt.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=Dt.bbox.ll.y),Dt.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=Dt.bbox.ur.x),Dt.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=Dt.bbox.ur.y),this.interiorRings.push(Dt)}this.multiPoly=Z}return D(zt,[{key:"getSweepEvents",value:function(){for(var Z=this.exteriorRing.getSweepEvents(),H=0,ft=this.interiorRings.length;H<ft;H++)for(var Dt=this.interiorRings[H].getSweepEvents(),Jt=0,pe=Dt.length;Jt<pe;Jt++)Z.push(Dt[Jt]);return Z}}]),zt}(),Li=function(){function zt(J,Z){if(E(this,zt),!Array.isArray(J))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof J[0][0][0]=="number"&&(J=[J])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var H=0,ft=J.length;H<ft;H++){var Dt=new pr(J[H],this);Dt.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=Dt.bbox.ll.x),Dt.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=Dt.bbox.ll.y),Dt.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=Dt.bbox.ur.x),Dt.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=Dt.bbox.ur.y),this.polys.push(Dt)}this.isSubject=Z}return D(zt,[{key:"getSweepEvents",value:function(){for(var Z=[],H=0,ft=this.polys.length;H<ft;H++)for(var Dt=this.polys[H].getSweepEvents(),Jt=0,pe=Dt.length;Jt<pe;Jt++)Z.push(Dt[Jt]);return Z}}]),zt}(),je=function(){D(zt,null,[{key:"factory",value:function(Z){for(var H=[],ft=0,Dt=Z.length;ft<Dt;ft++){var Jt=Z[ft];if(!(!Jt.isInResult()||Jt.ringOut)){for(var pe=null,kt=Jt.leftSE,Ze=Jt.rightSE,rr=[kt],Me=kt.point,fr=[];pe=kt,kt=Ze,rr.push(kt),kt.point!==Me;)for(;;){var Sr=kt.getAvailableLinkedEvents();if(Sr.length===0){var Fr=rr[0].point,gr=rr[rr.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(Fr.x,",")+" ".concat(Fr.y,"]. Last matching segment found ends at")+" [".concat(gr.x,", ").concat(gr.y,"]."))}if(Sr.length===1){Ze=Sr[0].otherSE;break}for(var $r=null,yi=0,Di=fr.length;yi<Di;yi++)if(fr[yi].point===kt.point){$r=yi;break}if($r!==null){var sn=fr.splice($r)[0],ht=rr.splice(sn.index);ht.unshift(ht[0].otherSE),H.push(new zt(ht.reverse()));continue}fr.push({index:rr.length,point:kt.point});var X=kt.getLeftmostComparator(pe);Ze=Sr.sort(X)[0].otherSE;break}H.push(new zt(rr))}}return H}}]);function zt(J){E(this,zt),this.events=J;for(var Z=0,H=J.length;Z<H;Z++)J[Z].segment.ringOut=this;this.poly=null}return D(zt,[{key:"getGeom",value:function(){for(var Z=this.events[0].point,H=[Z],ft=1,Dt=this.events.length-1;ft<Dt;ft++){var Jt=this.events[ft].point,pe=this.events[ft+1].point;ae(Jt,Z,pe)!==0&&(H.push(Jt),Z=Jt)}if(H.length===1)return null;var kt=H[0],Ze=H[1];ae(kt,Z,Ze)===0&&H.shift(),H.push(H[0]);for(var rr=this.isExteriorRing()?1:-1,Me=this.isExteriorRing()?0:H.length-1,fr=this.isExteriorRing()?H.length:-1,Sr=[],Fr=Me;Fr!=fr;Fr+=rr)Sr.push([H[Fr].x,H[Fr].y]);return Sr}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var Z=this.enclosingRing();this._isExteriorRing=Z?!Z.isExteriorRing():!0}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var Z=this.events[0],H=1,ft=this.events.length;H<ft;H++){var Dt=this.events[H];Pe.compare(Z,Dt)>0&&(Z=Dt)}for(var Jt=Z.segment.prevInResult(),pe=Jt?Jt.prevInResult():null;;){if(!Jt)return null;if(!pe)return Jt.ringOut;if(pe.ringOut!==Jt.ringOut)return pe.ringOut.enclosingRing()!==Jt.ringOut?Jt.ringOut:Jt.ringOut.enclosingRing();Jt=pe.prevInResult(),pe=Jt?Jt.prevInResult():null}}}]),zt}(),Zr=function(){function zt(J){E(this,zt),this.exteriorRing=J,J.poly=this,this.interiorRings=[]}return D(zt,[{key:"addInterior",value:function(Z){this.interiorRings.push(Z),Z.poly=this}},{key:"getGeom",value:function(){var Z=[this.exteriorRing.getGeom()];if(Z[0]===null)return null;for(var H=0,ft=this.interiorRings.length;H<ft;H++){var Dt=this.interiorRings[H].getGeom();Dt!==null&&Z.push(Dt)}return Z}}]),zt}(),Tn=function(){function zt(J){E(this,zt),this.rings=J,this.polys=this._composePolys(J)}return D(zt,[{key:"getGeom",value:function(){for(var Z=[],H=0,ft=this.polys.length;H<ft;H++){var Dt=this.polys[H].getGeom();Dt!==null&&Z.push(Dt)}return Z}},{key:"_composePolys",value:function(Z){for(var H=[],ft=0,Dt=Z.length;ft<Dt;ft++){var Jt=Z[ft];if(!Jt.poly)if(Jt.isExteriorRing())H.push(new Zr(Jt));else{var pe=Jt.enclosingRing();pe.poly||H.push(new Zr(pe)),pe.poly.addInterior(Jt)}}return H}}]),zt}(),oi=function(){function zt(J){var Z=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Ot.compare;E(this,zt),this.queue=J,this.tree=new At(Z),this.segments=[]}return D(zt,[{key:"process",value:function(Z){var H=Z.segment,ft=[];if(Z.consumedBy)return Z.isLeft?this.queue.remove(Z.otherSE):this.tree.remove(H),ft;var Dt=Z.isLeft?this.tree.insert(H):this.tree.find(H);if(!Dt)throw new Error("Unable to find segment #".concat(H.id," ")+"[".concat(H.leftSE.point.x,", ").concat(H.leftSE.point.y,"] -> ")+"[".concat(H.rightSE.point.x,", ").concat(H.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var Jt=Dt,pe=Dt,kt=void 0,Ze=void 0;kt===void 0;)Jt=this.tree.prev(Jt),Jt===null?kt=null:Jt.key.consumedBy===void 0&&(kt=Jt.key);for(;Ze===void 0;)pe=this.tree.next(pe),pe===null?Ze=null:pe.key.consumedBy===void 0&&(Ze=pe.key);if(Z.isLeft){var rr=null;if(kt){var Me=kt.getIntersection(H);if(Me!==null&&(H.isAnEndpoint(Me)||(rr=Me),!kt.isAnEndpoint(Me)))for(var fr=this._splitSafely(kt,Me),Sr=0,Fr=fr.length;Sr<Fr;Sr++)ft.push(fr[Sr])}var gr=null;if(Ze){var $r=Ze.getIntersection(H);if($r!==null&&(H.isAnEndpoint($r)||(gr=$r),!Ze.isAnEndpoint($r)))for(var yi=this._splitSafely(Ze,$r),Di=0,sn=yi.length;Di<sn;Di++)ft.push(yi[Di])}if(rr!==null||gr!==null){var ht=null;if(rr===null)ht=gr;else if(gr===null)ht=rr;else{var X=Pe.comparePoints(rr,gr);ht=X<=0?rr:gr}this.queue.remove(H.rightSE),ft.push(H.rightSE);for(var W=H.split(ht),ut=0,et=W.length;ut<et;ut++)ft.push(W[ut])}ft.length>0?(this.tree.remove(H),ft.push(Z)):(this.segments.push(H),H.prev=kt)}else{if(kt&&Ze){var Pt=kt.getIntersection(Ze);if(Pt!==null){if(!kt.isAnEndpoint(Pt))for(var Ut=this._splitSafely(kt,Pt),Tt=0,Lt=Ut.length;Tt<Lt;Tt++)ft.push(Ut[Tt]);if(!Ze.isAnEndpoint(Pt))for(var jt=this._splitSafely(Ze,Pt),ge=0,Se=jt.length;ge<Se;ge++)ft.push(jt[ge])}}this.tree.remove(H)}return ft}},{key:"_splitSafely",value:function(Z,H){this.tree.remove(Z);var ft=Z.rightSE;this.queue.remove(ft);var Dt=Z.split(H);return Dt.push(ft),Z.consumedBy===void 0&&this.tree.insert(Z),Dt}}]),zt}(),Br=typeof process<"u"&&a_.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,He=typeof process<"u"&&a_.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,qe=function(){function zt(){E(this,zt)}return D(zt,[{key:"run",value:function(Z,H,ft){jr.type=Z,yt.reset();for(var Dt=[new Li(H,!0)],Jt=0,pe=ft.length;Jt<pe;Jt++)Dt.push(new Li(ft[Jt],!1));if(jr.numMultiPolys=Dt.length,jr.type==="difference")for(var kt=Dt[0],Ze=1;Ze<Dt.length;)Et(Dt[Ze].bbox,kt.bbox)!==null?Ze++:Dt.splice(Ze,1);if(jr.type==="intersection"){for(var rr=0,Me=Dt.length;rr<Me;rr++)for(var fr=Dt[rr],Sr=rr+1,Fr=Dt.length;Sr<Fr;Sr++)if(Et(fr.bbox,Dt[Sr].bbox)===null)return[]}for(var gr=new At(Pe.compare),$r=0,yi=Dt.length;$r<yi;$r++)for(var Di=Dt[$r].getSweepEvents(),sn=0,ht=Di.length;sn<ht;sn++)if(gr.insert(Di[sn]),gr.size>Br)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var X=new oi(gr),W=gr.size,ut=gr.pop();ut;){var et=ut.key;if(gr.size===W){var Pt=et.segment;throw new Error("Unable to pop() ".concat(et.isLeft?"left":"right"," SweepEvent ")+"[".concat(et.point.x,", ").concat(et.point.y,"] from segment #").concat(Pt.id," ")+"[".concat(Pt.leftSE.point.x,", ").concat(Pt.leftSE.point.y,"] -> ")+"[".concat(Pt.rightSE.point.x,", ").concat(Pt.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(gr.size>Br)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(X.segments.length>He)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var Ut=X.process(et),Tt=0,Lt=Ut.length;Tt<Lt;Tt++){var jt=Ut[Tt];jt.consumedBy===void 0&&gr.insert(jt)}W=gr.size,ut=gr.pop()}yt.reset();var ge=je.factory(X.segments),Se=new Tn(ge);return Se.getGeom()}}]),zt}(),jr=new qe,pi=function(J){for(var Z=arguments.length,H=new Array(Z>1?Z-1:0),ft=1;ft<Z;ft++)H[ft-1]=arguments[ft];return jr.run("union",J,H)},Dr=function(J){for(var Z=arguments.length,H=new Array(Z>1?Z-1:0),ft=1;ft<Z;ft++)H[ft-1]=arguments[ft];return jr.run("intersection",J,H)},Hr=function(J){for(var Z=arguments.length,H=new Array(Z>1?Z-1:0),ft=1;ft<Z;ft++)H[ft-1]=arguments[ft];return jr.run("xor",J,H)},rn=function(J){for(var Z=arguments.length,H=new Array(Z>1?Z-1:0),ft=1;ft<Z;ft++)H[ft-1]=arguments[ft];return jr.run("difference",J,H)},ii={union:pi,intersection:Dr,xor:Hr,difference:rn};return ii})})(Ew);var F_={exports:{}};(function(b,T){(function(E,A){A(T)})(ih,function(E){function A(){}function D(r){this.message=r||""}function z(r){this.message=r||""}function U(r){this.message=r||""}function a(){}function G(r){return r===null?or:r.color}function ot(r){return r===null?null:r.parent}function Rt(r,o){r!==null&&(r.color=o)}function xt(r){return r===null?null:r.left}function At(r){return r===null?null:r.right}function qt(){this.root_=null,this.size_=0}function re(){}function ee(){this.array_=[],arguments[0]instanceof X&&this.addAll(arguments[0])}function Oe(){}function Ge(r){this.message=r||""}function Mt(){this.array_=[]}"fill"in Array.prototype||Object.defineProperty(Array.prototype,"fill",{configurable:!0,value:function(r){if(this===void 0||this===null)throw new TypeError(this+" is not an object");var o=Object(this),c=Math.max(Math.min(o.length,9007199254740991),0)||0,p=1 in arguments&&parseInt(Number(arguments[1]),10)||0;p=p<0?Math.max(c+p,0):Math.min(p,c);var _=2 in arguments&&arguments[2]!==void 0?parseInt(Number(arguments[2]),10)||0:c;for(_=_<0?Math.max(c+arguments[2],0):Math.min(_,c);p<_;)o[p]=r,++p;return o},writable:!0}),Number.isFinite=Number.isFinite||function(r){return typeof r=="number"&&isFinite(r)},Number.isInteger=Number.isInteger||function(r){return typeof r=="number"&&isFinite(r)&&Math.floor(r)===r},Number.parseFloat=Number.parseFloat||parseFloat,Number.isNaN=Number.isNaN||function(r){return r!=r},Math.trunc=Math.trunc||function(r){return r<0?Math.ceil(r):Math.floor(r)};var gt=function(){};gt.prototype.interfaces_=function(){return[]},gt.prototype.getClass=function(){return gt},gt.prototype.equalsWithTolerance=function(r,o,c){return Math.abs(r-o)<=c};var Et=function(r){function o(c){r.call(this,c),this.name="IllegalArgumentException",this.message=c,this.stack=new r().stack}return r&&(o.__proto__=r),o.prototype=Object.create(r&&r.prototype),o.prototype.constructor=o,o}(Error),Ft=function(){},Ie={MAX_VALUE:{configurable:!0}};Ft.isNaN=function(r){return Number.isNaN(r)},Ft.doubleToLongBits=function(r){return r},Ft.longBitsToDouble=function(r){return r},Ft.isInfinite=function(r){return!Number.isFinite(r)},Ie.MAX_VALUE.get=function(){return Number.MAX_VALUE},Object.defineProperties(Ft,Ie);var de=function(){},xe=function(){},$t=function(){},yt=function r(){if(this.x=null,this.y=null,this.z=null,arguments.length===0)this.x=0,this.y=0,this.z=r.NULL_ORDINATE;else if(arguments.length===1){var o=arguments[0];this.x=o.x,this.y=o.y,this.z=o.z}else arguments.length===2?(this.x=arguments[0],this.y=arguments[1],this.z=r.NULL_ORDINATE):arguments.length===3&&(this.x=arguments[0],this.y=arguments[1],this.z=arguments[2])},ue={DimensionalComparator:{configurable:!0},serialVersionUID:{configurable:!0},NULL_ORDINATE:{configurable:!0},X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0}};yt.prototype.setOrdinate=function(r,o){switch(r){case yt.X:this.x=o;break;case yt.Y:this.y=o;break;case yt.Z:this.z=o;break;default:throw new Et("Invalid ordinate index: "+r)}},yt.prototype.equals2D=function(){if(arguments.length===1){var r=arguments[0];return this.x===r.x&&this.y===r.y}if(arguments.length===2){var o=arguments[0],c=arguments[1];return!!gt.equalsWithTolerance(this.x,o.x,c)&&!!gt.equalsWithTolerance(this.y,o.y,c)}},yt.prototype.getOrdinate=function(r){switch(r){case yt.X:return this.x;case yt.Y:return this.y;case yt.Z:return this.z}throw new Et("Invalid ordinate index: "+r)},yt.prototype.equals3D=function(r){return this.x===r.x&&this.y===r.y&&(this.z===r.z||Ft.isNaN(this.z))&&Ft.isNaN(r.z)},yt.prototype.equals=function(r){return r instanceof yt&&this.equals2D(r)},yt.prototype.equalInZ=function(r,o){return gt.equalsWithTolerance(this.z,r.z,o)},yt.prototype.compareTo=function(r){var o=r;return this.x<o.x?-1:this.x>o.x?1:this.y<o.y?-1:this.y>o.y?1:0},yt.prototype.clone=function(){},yt.prototype.copy=function(){return new yt(this)},yt.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+")"},yt.prototype.distance3D=function(r){var o=this.x-r.x,c=this.y-r.y,p=this.z-r.z;return Math.sqrt(o*o+c*c+p*p)},yt.prototype.distance=function(r){var o=this.x-r.x,c=this.y-r.y;return Math.sqrt(o*o+c*c)},yt.prototype.hashCode=function(){var r=17;return r=37*r+yt.hashCode(this.x),r=37*r+yt.hashCode(this.y)},yt.prototype.setCoordinate=function(r){this.x=r.x,this.y=r.y,this.z=r.z},yt.prototype.interfaces_=function(){return[de,xe,A]},yt.prototype.getClass=function(){return yt},yt.hashCode=function(){if(arguments.length===1){var r=arguments[0],o=Ft.doubleToLongBits(r);return Math.trunc((o^o)>>>32)}},ue.DimensionalComparator.get=function(){return Kt},ue.serialVersionUID.get=function(){return 6683108902428367e3},ue.NULL_ORDINATE.get=function(){return Ft.NaN},ue.X.get=function(){return 0},ue.Y.get=function(){return 1},ue.Z.get=function(){return 2},Object.defineProperties(yt,ue);var Kt=function(r){if(this._dimensionsToTest=2,arguments.length!==0){if(arguments.length===1){var o=arguments[0];if(o!==2&&o!==3)throw new Et("only 2 or 3 dimensions may be specified");this._dimensionsToTest=o}}};Kt.prototype.compare=function(r,o){var c=r,p=o,_=Kt.compare(c.x,p.x);if(_!==0)return _;var C=Kt.compare(c.y,p.y);return C!==0?C:this._dimensionsToTest<=2?0:Kt.compare(c.z,p.z)},Kt.prototype.interfaces_=function(){return[$t]},Kt.prototype.getClass=function(){return Kt},Kt.compare=function(r,o){return r<o?-1:r>o?1:Ft.isNaN(r)?Ft.isNaN(o)?0:-1:Ft.isNaN(o)?1:0};var ae=function(){};ae.prototype.create=function(){},ae.prototype.interfaces_=function(){return[]},ae.prototype.getClass=function(){return ae};var wt=function(){},_i={INTERIOR:{configurable:!0},BOUNDARY:{configurable:!0},EXTERIOR:{configurable:!0},NONE:{configurable:!0}};wt.prototype.interfaces_=function(){return[]},wt.prototype.getClass=function(){return wt},wt.toLocationSymbol=function(r){switch(r){case wt.EXTERIOR:return"e";case wt.BOUNDARY:return"b";case wt.INTERIOR:return"i";case wt.NONE:return"-"}throw new Et("Unknown location value: "+r)},_i.INTERIOR.get=function(){return 0},_i.BOUNDARY.get=function(){return 1},_i.EXTERIOR.get=function(){return 2},_i.NONE.get=function(){return-1},Object.defineProperties(wt,_i);var Ne=function(r,o){return r.interfaces_&&r.interfaces_().indexOf(o)>-1},Tr=function(){},Ye={LOG_10:{configurable:!0}};Tr.prototype.interfaces_=function(){return[]},Tr.prototype.getClass=function(){return Tr},Tr.log10=function(r){var o=Math.log(r);return Ft.isInfinite(o)||Ft.isNaN(o)?o:o/Tr.LOG_10},Tr.min=function(r,o,c,p){var _=r;return o<_&&(_=o),c<_&&(_=c),p<_&&(_=p),_},Tr.clamp=function(){if(typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var r=arguments[0],o=arguments[1],c=arguments[2];return r<o?o:r>c?c:r}if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var p=arguments[0],_=arguments[1],C=arguments[2];return p<_?_:p>C?C:p}},Tr.wrap=function(r,o){return r<0?o- -r%o:r%o},Tr.max=function(){if(arguments.length===3){var r=arguments[0],o=arguments[1],c=arguments[2],p=r;return o>p&&(p=o),c>p&&(p=c),p}if(arguments.length===4){var _=arguments[0],C=arguments[1],R=arguments[2],$=arguments[3],rt=_;return C>rt&&(rt=C),R>rt&&(rt=R),$>rt&&(rt=$),rt}},Tr.average=function(r,o){return(r+o)/2},Ye.LOG_10.get=function(){return Math.log(10)},Object.defineProperties(Tr,Ye);var ti=function(r){this.str=r};ti.prototype.append=function(r){this.str+=r},ti.prototype.setCharAt=function(r,o){this.str=this.str.substr(0,r)+o+this.str.substr(r+1)},ti.prototype.toString=function(r){return this.str};var Pe=function(r){this.value=r};Pe.prototype.intValue=function(){return this.value},Pe.prototype.compareTo=function(r){return this.value<r?-1:this.value>r?1:0},Pe.isNaN=function(r){return Number.isNaN(r)};var tr=function(){};tr.isWhitespace=function(r){return r<=32&&r>=0||r===127},tr.toUpperCase=function(r){return r.toUpperCase()};var Ot=function r(){if(this._hi=0,this._lo=0,arguments.length===0)this.init(0);else if(arguments.length===1){if(typeof arguments[0]=="number"){var o=arguments[0];this.init(o)}else if(arguments[0]instanceof r){var c=arguments[0];this.init(c)}else if(typeof arguments[0]=="string"){var p=arguments[0];r.call(this,r.parse(p))}}else if(arguments.length===2){var _=arguments[0],C=arguments[1];this.init(_,C)}},ur={PI:{configurable:!0},TWO_PI:{configurable:!0},PI_2:{configurable:!0},E:{configurable:!0},NaN:{configurable:!0},EPS:{configurable:!0},SPLIT:{configurable:!0},MAX_PRINT_DIGITS:{configurable:!0},TEN:{configurable:!0},ONE:{configurable:!0},SCI_NOT_EXPONENT_CHAR:{configurable:!0},SCI_NOT_ZERO:{configurable:!0}};Ot.prototype.le=function(r){return(this._hi<r._hi||this._hi===r._hi)&&this._lo<=r._lo},Ot.prototype.extractSignificantDigits=function(r,o){var c=this.abs(),p=Ot.magnitude(c._hi),_=Ot.TEN.pow(p);(c=c.divide(_)).gt(Ot.TEN)?(c=c.divide(Ot.TEN),p+=1):c.lt(Ot.ONE)&&(c=c.multiply(Ot.TEN),p-=1);for(var C=p+1,R=new ti,$=Ot.MAX_PRINT_DIGITS-1,rt=0;rt<=$;rt++){r&&rt===C&&R.append(".");var bt=Math.trunc(c._hi);if(bt<0)break;var Yt=!1,Ht=0;bt>9?(Yt=!0,Ht="9"):Ht="0"+bt,R.append(Ht),c=c.subtract(Ot.valueOf(bt)).multiply(Ot.TEN),Yt&&c.selfAdd(Ot.TEN);var Re=!0,ze=Ot.magnitude(c._hi);if(ze<0&&Math.abs(ze)>=$-rt&&(Re=!1),!Re)break}return o[0]=p,R.toString()},Ot.prototype.sqr=function(){return this.multiply(this)},Ot.prototype.doubleValue=function(){return this._hi+this._lo},Ot.prototype.subtract=function(){if(arguments[0]instanceof Ot){var r=arguments[0];return this.add(r.negate())}if(typeof arguments[0]=="number"){var o=arguments[0];return this.add(-o)}},Ot.prototype.equals=function(){if(arguments.length===1){var r=arguments[0];return this._hi===r._hi&&this._lo===r._lo}},Ot.prototype.isZero=function(){return this._hi===0&&this._lo===0},Ot.prototype.selfSubtract=function(){if(arguments[0]instanceof Ot){var r=arguments[0];return this.isNaN()?this:this.selfAdd(-r._hi,-r._lo)}if(typeof arguments[0]=="number"){var o=arguments[0];return this.isNaN()?this:this.selfAdd(-o,0)}},Ot.prototype.getSpecialNumberString=function(){return this.isZero()?"0.0":this.isNaN()?"NaN ":null},Ot.prototype.min=function(r){return this.le(r)?this:r},Ot.prototype.selfDivide=function(){if(arguments.length===1){if(arguments[0]instanceof Ot){var r=arguments[0];return this.selfDivide(r._hi,r._lo)}if(typeof arguments[0]=="number"){var o=arguments[0];return this.selfDivide(o,0)}}else if(arguments.length===2){var c=arguments[0],p=arguments[1],_=null,C=null,R=null,$=null,rt=null,bt=null,Yt=null,Ht=null;return rt=this._hi/c,bt=Ot.SPLIT*rt,_=bt-rt,Ht=Ot.SPLIT*c,_=bt-_,C=rt-_,R=Ht-c,Yt=rt*c,R=Ht-R,$=c-R,Ht=_*R-Yt+_*$+C*R+C*$,bt=(this._hi-Yt-Ht+this._lo-rt*p)/c,Ht=rt+bt,this._hi=Ht,this._lo=rt-Ht+bt,this}},Ot.prototype.dump=function(){return"DD<"+this._hi+", "+this._lo+">"},Ot.prototype.divide=function(){if(arguments[0]instanceof Ot){var r=arguments[0],o=null,c=null,p=null,_=null,C=null,R=null,$=null,rt=null;return c=(C=this._hi/r._hi)-(o=(R=Ot.SPLIT*C)-(o=R-C)),rt=o*(p=(rt=Ot.SPLIT*r._hi)-(p=rt-r._hi))-($=C*r._hi)+o*(_=r._hi-p)+c*p+c*_,R=(this._hi-$-rt+this._lo-C*r._lo)/r._hi,new Ot(rt=C+R,C-rt+R)}if(typeof arguments[0]=="number"){var bt=arguments[0];return Ft.isNaN(bt)?Ot.createNaN():Ot.copy(this).selfDivide(bt,0)}},Ot.prototype.ge=function(r){return(this._hi>r._hi||this._hi===r._hi)&&this._lo>=r._lo},Ot.prototype.pow=function(r){if(r===0)return Ot.valueOf(1);var o=new Ot(this),c=Ot.valueOf(1),p=Math.abs(r);if(p>1)for(;p>0;)p%2==1&&c.selfMultiply(o),(p/=2)>0&&(o=o.sqr());else c=o;return r<0?c.reciprocal():c},Ot.prototype.ceil=function(){if(this.isNaN())return Ot.NaN;var r=Math.ceil(this._hi),o=0;return r===this._hi&&(o=Math.ceil(this._lo)),new Ot(r,o)},Ot.prototype.compareTo=function(r){var o=r;return this._hi<o._hi?-1:this._hi>o._hi?1:this._lo<o._lo?-1:this._lo>o._lo?1:0},Ot.prototype.rint=function(){return this.isNaN()?this:this.add(.5).floor()},Ot.prototype.setValue=function(){if(arguments[0]instanceof Ot){var r=arguments[0];return this.init(r),this}if(typeof arguments[0]=="number"){var o=arguments[0];return this.init(o),this}},Ot.prototype.max=function(r){return this.ge(r)?this:r},Ot.prototype.sqrt=function(){if(this.isZero())return Ot.valueOf(0);if(this.isNegative())return Ot.NaN;var r=1/Math.sqrt(this._hi),o=this._hi*r,c=Ot.valueOf(o),p=this.subtract(c.sqr())._hi*(.5*r);return c.add(p)},Ot.prototype.selfAdd=function(){if(arguments.length===1){if(arguments[0]instanceof Ot){var r=arguments[0];return this.selfAdd(r._hi,r._lo)}if(typeof arguments[0]=="number"){var o=arguments[0],c=null,p=null,_=null,C=null,R=null,$=null;return _=this._hi+o,R=_-this._hi,C=_-R,C=o-R+(this._hi-C),$=C+this._lo,c=_+$,p=$+(_-c),this._hi=c+p,this._lo=p+(c-this._hi),this}}else if(arguments.length===2){var rt=arguments[0],bt=arguments[1],Yt=null,Ht=null,Re=null,ze=null,Ve=null,We=null,Vr=null;ze=this._hi+rt,Ht=this._lo+bt,Ve=ze-(We=ze-this._hi),Re=Ht-(Vr=Ht-this._lo);var Bi=(Yt=ze+(We=(Ve=rt-We+(this._hi-Ve))+Ht))+(We=(Re=bt-Vr+(this._lo-Re))+(We+(ze-Yt))),De=We+(Yt-Bi);return this._hi=Bi,this._lo=De,this}},Ot.prototype.selfMultiply=function(){if(arguments.length===1){if(arguments[0]instanceof Ot){var r=arguments[0];return this.selfMultiply(r._hi,r._lo)}if(typeof arguments[0]=="number"){var o=arguments[0];return this.selfMultiply(o,0)}}else if(arguments.length===2){var c=arguments[0],p=arguments[1],_=null,C=null,R=null,$=null,rt=null,bt=null;_=(rt=Ot.SPLIT*this._hi)-this._hi,bt=Ot.SPLIT*c,_=rt-_,C=this._hi-_,R=bt-c;var Yt=(rt=this._hi*c)+(bt=_*(R=bt-R)-rt+_*($=c-R)+C*R+C*$+(this._hi*p+this._lo*c)),Ht=bt+(_=rt-Yt);return this._hi=Yt,this._lo=Ht,this}},Ot.prototype.selfSqr=function(){return this.selfMultiply(this)},Ot.prototype.floor=function(){if(this.isNaN())return Ot.NaN;var r=Math.floor(this._hi),o=0;return r===this._hi&&(o=Math.floor(this._lo)),new Ot(r,o)},Ot.prototype.negate=function(){return this.isNaN()?this:new Ot(-this._hi,-this._lo)},Ot.prototype.clone=function(){},Ot.prototype.multiply=function(){if(arguments[0]instanceof Ot){var r=arguments[0];return r.isNaN()?Ot.createNaN():Ot.copy(this).selfMultiply(r)}if(typeof arguments[0]=="number"){var o=arguments[0];return Ft.isNaN(o)?Ot.createNaN():Ot.copy(this).selfMultiply(o,0)}},Ot.prototype.isNaN=function(){return Ft.isNaN(this._hi)},Ot.prototype.intValue=function(){return Math.trunc(this._hi)},Ot.prototype.toString=function(){var r=Ot.magnitude(this._hi);return r>=-3&&r<=20?this.toStandardNotation():this.toSciNotation()},Ot.prototype.toStandardNotation=function(){var r=this.getSpecialNumberString();if(r!==null)return r;var o=new Array(1).fill(null),c=this.extractSignificantDigits(!0,o),p=o[0]+1,_=c;if(c.charAt(0)===".")_="0"+c;else if(p<0)_="0."+Ot.stringOfChar("0",-p)+c;else if(c.indexOf(".")===-1){var C=p-c.length;_=c+Ot.stringOfChar("0",C)+".0"}return this.isNegative()?"-"+_:_},Ot.prototype.reciprocal=function(){var r=null,o=null,c=null,p=null,_=null,C=null,R=null,$=null;o=(_=1/this._hi)-(r=(C=Ot.SPLIT*_)-(r=C-_)),c=($=Ot.SPLIT*this._hi)-this._hi;var rt=_+(C=(1-(R=_*this._hi)-($=r*(c=$-c)-R+r*(p=this._hi-c)+o*c+o*p)-_*this._lo)/this._hi);return new Ot(rt,_-rt+C)},Ot.prototype.toSciNotation=function(){if(this.isZero())return Ot.SCI_NOT_ZERO;var r=this.getSpecialNumberString();if(r!==null)return r;var o=new Array(1).fill(null),c=this.extractSignificantDigits(!1,o),p=Ot.SCI_NOT_EXPONENT_CHAR+o[0];if(c.charAt(0)==="0")throw new Error("Found leading zero: "+c);var _="";c.length>1&&(_=c.substring(1));var C=c.charAt(0)+"."+_;return this.isNegative()?"-"+C+p:C+p},Ot.prototype.abs=function(){return this.isNaN()?Ot.NaN:this.isNegative()?this.negate():new Ot(this)},Ot.prototype.isPositive=function(){return(this._hi>0||this._hi===0)&&this._lo>0},Ot.prototype.lt=function(r){return(this._hi<r._hi||this._hi===r._hi)&&this._lo<r._lo},Ot.prototype.add=function(){if(arguments[0]instanceof Ot){var r=arguments[0];return Ot.copy(this).selfAdd(r)}if(typeof arguments[0]=="number"){var o=arguments[0];return Ot.copy(this).selfAdd(o)}},Ot.prototype.init=function(){if(arguments.length===1){if(typeof arguments[0]=="number"){var r=arguments[0];this._hi=r,this._lo=0}else if(arguments[0]instanceof Ot){var o=arguments[0];this._hi=o._hi,this._lo=o._lo}}else if(arguments.length===2){var c=arguments[0],p=arguments[1];this._hi=c,this._lo=p}},Ot.prototype.gt=function(r){return(this._hi>r._hi||this._hi===r._hi)&&this._lo>r._lo},Ot.prototype.isNegative=function(){return(this._hi<0||this._hi===0)&&this._lo<0},Ot.prototype.trunc=function(){return this.isNaN()?Ot.NaN:this.isPositive()?this.floor():this.ceil()},Ot.prototype.signum=function(){return this._hi>0?1:this._hi<0?-1:this._lo>0?1:this._lo<0?-1:0},Ot.prototype.interfaces_=function(){return[A,de,xe]},Ot.prototype.getClass=function(){return Ot},Ot.sqr=function(r){return Ot.valueOf(r).selfMultiply(r)},Ot.valueOf=function(){if(typeof arguments[0]=="string"){var r=arguments[0];return Ot.parse(r)}if(typeof arguments[0]=="number"){var o=arguments[0];return new Ot(o)}},Ot.sqrt=function(r){return Ot.valueOf(r).sqrt()},Ot.parse=function(r){for(var o=0,c=r.length;tr.isWhitespace(r.charAt(o));)o++;var p=!1;if(o<c){var _=r.charAt(o);_!=="-"&&_!=="+"||(o++,_==="-"&&(p=!0))}for(var C=new Ot,R=0,$=0,rt=0;!(o>=c);){var bt=r.charAt(o);if(o++,tr.isDigit(bt)){var Yt=bt-"0";C.selfMultiply(Ot.TEN),C.selfAdd(Yt),R++}else{if(bt!=="."){if(bt==="e"||bt==="E"){var Ht=r.substring(o);try{rt=Pe.parseInt(Ht)}catch(Vr){throw Vr instanceof Error?new Error("Invalid exponent "+Ht+" in string "+r):Vr}break}throw new Error("Unexpected character '"+bt+"' at position "+o+" in string "+r)}$=R}}var Re=C,ze=R-$-rt;if(ze===0)Re=C;else if(ze>0){var Ve=Ot.TEN.pow(ze);Re=C.divide(Ve)}else if(ze<0){var We=Ot.TEN.pow(-ze);Re=C.multiply(We)}return p?Re.negate():Re},Ot.createNaN=function(){return new Ot(Ft.NaN,Ft.NaN)},Ot.copy=function(r){return new Ot(r)},Ot.magnitude=function(r){var o=Math.abs(r),c=Math.log(o)/Math.log(10),p=Math.trunc(Math.floor(c));return 10*Math.pow(10,p)<=o&&(p+=1),p},Ot.stringOfChar=function(r,o){for(var c=new ti,p=0;p<o;p++)c.append(r);return c.toString()},ur.PI.get=function(){return new Ot(3.141592653589793,12246467991473532e-32)},ur.TWO_PI.get=function(){return new Ot(6.283185307179586,24492935982947064e-32)},ur.PI_2.get=function(){return new Ot(1.5707963267948966,6123233995736766e-32)},ur.E.get=function(){return new Ot(2.718281828459045,14456468917292502e-32)},ur.NaN.get=function(){return new Ot(Ft.NaN,Ft.NaN)},ur.EPS.get=function(){return 123259516440783e-46},ur.SPLIT.get=function(){return 134217729},ur.MAX_PRINT_DIGITS.get=function(){return 32},ur.TEN.get=function(){return Ot.valueOf(10)},ur.ONE.get=function(){return Ot.valueOf(1)},ur.SCI_NOT_EXPONENT_CHAR.get=function(){return"E"},ur.SCI_NOT_ZERO.get=function(){return"0.0E0"},Object.defineProperties(Ot,ur);var pr=function(){},Li={DP_SAFE_EPSILON:{configurable:!0}};pr.prototype.interfaces_=function(){return[]},pr.prototype.getClass=function(){return pr},pr.orientationIndex=function(r,o,c){var p=pr.orientationIndexFilter(r,o,c);if(p<=1)return p;var _=Ot.valueOf(o.x).selfAdd(-r.x),C=Ot.valueOf(o.y).selfAdd(-r.y),R=Ot.valueOf(c.x).selfAdd(-o.x),$=Ot.valueOf(c.y).selfAdd(-o.y);return _.selfMultiply($).selfSubtract(C.selfMultiply(R)).signum()},pr.signOfDet2x2=function(r,o,c,p){return r.multiply(p).selfSubtract(o.multiply(c)).signum()},pr.intersection=function(r,o,c,p){var _=Ot.valueOf(p.y).selfSubtract(c.y).selfMultiply(Ot.valueOf(o.x).selfSubtract(r.x)),C=Ot.valueOf(p.x).selfSubtract(c.x).selfMultiply(Ot.valueOf(o.y).selfSubtract(r.y)),R=_.subtract(C),$=Ot.valueOf(p.x).selfSubtract(c.x).selfMultiply(Ot.valueOf(r.y).selfSubtract(c.y)),rt=Ot.valueOf(p.y).selfSubtract(c.y).selfMultiply(Ot.valueOf(r.x).selfSubtract(c.x)),bt=$.subtract(rt).selfDivide(R).doubleValue(),Yt=Ot.valueOf(r.x).selfAdd(Ot.valueOf(o.x).selfSubtract(r.x).selfMultiply(bt)).doubleValue(),Ht=Ot.valueOf(o.x).selfSubtract(r.x).selfMultiply(Ot.valueOf(r.y).selfSubtract(c.y)),Re=Ot.valueOf(o.y).selfSubtract(r.y).selfMultiply(Ot.valueOf(r.x).selfSubtract(c.x)),ze=Ht.subtract(Re).selfDivide(R).doubleValue(),Ve=Ot.valueOf(c.y).selfAdd(Ot.valueOf(p.y).selfSubtract(c.y).selfMultiply(ze)).doubleValue();return new yt(Yt,Ve)},pr.orientationIndexFilter=function(r,o,c){var p=null,_=(r.x-c.x)*(o.y-c.y),C=(r.y-c.y)*(o.x-c.x),R=_-C;if(_>0){if(C<=0)return pr.signum(R);p=_+C}else{if(!(_<0)||C>=0)return pr.signum(R);p=-_-C}var $=pr.DP_SAFE_EPSILON*p;return R>=$||-R>=$?pr.signum(R):2},pr.signum=function(r){return r>0?1:r<0?-1:0},Li.DP_SAFE_EPSILON.get=function(){return 1e-15},Object.defineProperties(pr,Li);var je=function(){},Zr={X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0},M:{configurable:!0}};Zr.X.get=function(){return 0},Zr.Y.get=function(){return 1},Zr.Z.get=function(){return 2},Zr.M.get=function(){return 3},je.prototype.setOrdinate=function(r,o,c){},je.prototype.size=function(){},je.prototype.getOrdinate=function(r,o){},je.prototype.getCoordinate=function(){},je.prototype.getCoordinateCopy=function(r){},je.prototype.getDimension=function(){},je.prototype.getX=function(r){},je.prototype.clone=function(){},je.prototype.expandEnvelope=function(r){},je.prototype.copy=function(){},je.prototype.getY=function(r){},je.prototype.toCoordinateArray=function(){},je.prototype.interfaces_=function(){return[xe]},je.prototype.getClass=function(){return je},Object.defineProperties(je,Zr);var Tn=function(){},oi=function(r){function o(){r.call(this,"Projective point not representable on the Cartesian plane.")}return r&&(o.__proto__=r),o.prototype=Object.create(r&&r.prototype),o.prototype.constructor=o,o.prototype.interfaces_=function(){return[]},o.prototype.getClass=function(){return o},o}(Tn),Br=function(){};Br.arraycopy=function(r,o,c,p,_){for(var C=0,R=o;R<o+_;R++)c[p+C]=r[R],C++},Br.getProperty=function(r){return{"line.separator":`
`}[r]};var He=function r(){if(this.x=null,this.y=null,this.w=null,arguments.length===0)this.x=0,this.y=0,this.w=1;else if(arguments.length===1){var o=arguments[0];this.x=o.x,this.y=o.y,this.w=1}else if(arguments.length===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var c=arguments[0],p=arguments[1];this.x=c,this.y=p,this.w=1}else if(arguments[0]instanceof r&&arguments[1]instanceof r){var _=arguments[0],C=arguments[1];this.x=_.y*C.w-C.y*_.w,this.y=C.x*_.w-_.x*C.w,this.w=_.x*C.y-C.x*_.y}else if(arguments[0]instanceof yt&&arguments[1]instanceof yt){var R=arguments[0],$=arguments[1];this.x=R.y-$.y,this.y=$.x-R.x,this.w=R.x*$.y-$.x*R.y}}else if(arguments.length===3){var rt=arguments[0],bt=arguments[1],Yt=arguments[2];this.x=rt,this.y=bt,this.w=Yt}else if(arguments.length===4){var Ht=arguments[0],Re=arguments[1],ze=arguments[2],Ve=arguments[3],We=Ht.y-Re.y,Vr=Re.x-Ht.x,Bi=Ht.x*Re.y-Re.x*Ht.y,De=ze.y-Ve.y,Vo=Ve.x-ze.x,vs=ze.x*Ve.y-Ve.x*ze.y;this.x=Vr*vs-Vo*Bi,this.y=De*Bi-We*vs,this.w=We*Vo-De*Vr}};He.prototype.getY=function(){var r=this.y/this.w;if(Ft.isNaN(r)||Ft.isInfinite(r))throw new oi;return r},He.prototype.getX=function(){var r=this.x/this.w;if(Ft.isNaN(r)||Ft.isInfinite(r))throw new oi;return r},He.prototype.getCoordinate=function(){var r=new yt;return r.x=this.getX(),r.y=this.getY(),r},He.prototype.interfaces_=function(){return[]},He.prototype.getClass=function(){return He},He.intersection=function(r,o,c,p){var _=r.y-o.y,C=o.x-r.x,R=r.x*o.y-o.x*r.y,$=c.y-p.y,rt=p.x-c.x,bt=c.x*p.y-p.x*c.y,Yt=_*rt-$*C,Ht=(C*bt-rt*R)/Yt,Re=($*R-_*bt)/Yt;if(Ft.isNaN(Ht)||Ft.isInfinite(Ht)||Ft.isNaN(Re)||Ft.isInfinite(Re))throw new oi;return new yt(Ht,Re)};var qe=function r(){if(this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,arguments.length===0)this.init();else if(arguments.length===1){if(arguments[0]instanceof yt){var o=arguments[0];this.init(o.x,o.x,o.y,o.y)}else if(arguments[0]instanceof r){var c=arguments[0];this.init(c)}}else if(arguments.length===2){var p=arguments[0],_=arguments[1];this.init(p.x,_.x,p.y,_.y)}else if(arguments.length===4){var C=arguments[0],R=arguments[1],$=arguments[2],rt=arguments[3];this.init(C,R,$,rt)}},jr={serialVersionUID:{configurable:!0}};qe.prototype.getArea=function(){return this.getWidth()*this.getHeight()},qe.prototype.equals=function(r){if(!(r instanceof qe))return!1;var o=r;return this.isNull()?o.isNull():this._maxx===o.getMaxX()&&this._maxy===o.getMaxY()&&this._minx===o.getMinX()&&this._miny===o.getMinY()},qe.prototype.intersection=function(r){if(this.isNull()||r.isNull()||!this.intersects(r))return new qe;var o=this._minx>r._minx?this._minx:r._minx,c=this._miny>r._miny?this._miny:r._miny,p=this._maxx<r._maxx?this._maxx:r._maxx,_=this._maxy<r._maxy?this._maxy:r._maxy;return new qe(o,p,c,_)},qe.prototype.isNull=function(){return this._maxx<this._minx},qe.prototype.getMaxX=function(){return this._maxx},qe.prototype.covers=function(){if(arguments.length===1){if(arguments[0]instanceof yt){var r=arguments[0];return this.covers(r.x,r.y)}if(arguments[0]instanceof qe){var o=arguments[0];return!this.isNull()&&!o.isNull()&&o.getMinX()>=this._minx&&o.getMaxX()<=this._maxx&&o.getMinY()>=this._miny&&o.getMaxY()<=this._maxy}}else if(arguments.length===2){var c=arguments[0],p=arguments[1];return!this.isNull()&&c>=this._minx&&c<=this._maxx&&p>=this._miny&&p<=this._maxy}},qe.prototype.intersects=function(){if(arguments.length===1){if(arguments[0]instanceof qe){var r=arguments[0];return!this.isNull()&&!r.isNull()&&!(r._minx>this._maxx||r._maxx<this._minx||r._miny>this._maxy||r._maxy<this._miny)}if(arguments[0]instanceof yt){var o=arguments[0];return this.intersects(o.x,o.y)}}else if(arguments.length===2){var c=arguments[0],p=arguments[1];return!this.isNull()&&!(c>this._maxx||c<this._minx||p>this._maxy||p<this._miny)}},qe.prototype.getMinY=function(){return this._miny},qe.prototype.getMinX=function(){return this._minx},qe.prototype.expandToInclude=function(){if(arguments.length===1){if(arguments[0]instanceof yt){var r=arguments[0];this.expandToInclude(r.x,r.y)}else if(arguments[0]instanceof qe){var o=arguments[0];if(o.isNull())return null;this.isNull()?(this._minx=o.getMinX(),this._maxx=o.getMaxX(),this._miny=o.getMinY(),this._maxy=o.getMaxY()):(o._minx<this._minx&&(this._minx=o._minx),o._maxx>this._maxx&&(this._maxx=o._maxx),o._miny<this._miny&&(this._miny=o._miny),o._maxy>this._maxy&&(this._maxy=o._maxy))}}else if(arguments.length===2){var c=arguments[0],p=arguments[1];this.isNull()?(this._minx=c,this._maxx=c,this._miny=p,this._maxy=p):(c<this._minx&&(this._minx=c),c>this._maxx&&(this._maxx=c),p<this._miny&&(this._miny=p),p>this._maxy&&(this._maxy=p))}},qe.prototype.minExtent=function(){if(this.isNull())return 0;var r=this.getWidth(),o=this.getHeight();return r<o?r:o},qe.prototype.getWidth=function(){return this.isNull()?0:this._maxx-this._minx},qe.prototype.compareTo=function(r){var o=r;return this.isNull()?o.isNull()?0:-1:o.isNull()?1:this._minx<o._minx?-1:this._minx>o._minx?1:this._miny<o._miny?-1:this._miny>o._miny?1:this._maxx<o._maxx?-1:this._maxx>o._maxx?1:this._maxy<o._maxy?-1:this._maxy>o._maxy?1:0},qe.prototype.translate=function(r,o){if(this.isNull())return null;this.init(this.getMinX()+r,this.getMaxX()+r,this.getMinY()+o,this.getMaxY()+o)},qe.prototype.toString=function(){return"Env["+this._minx+" : "+this._maxx+", "+this._miny+" : "+this._maxy+"]"},qe.prototype.setToNull=function(){this._minx=0,this._maxx=-1,this._miny=0,this._maxy=-1},qe.prototype.getHeight=function(){return this.isNull()?0:this._maxy-this._miny},qe.prototype.maxExtent=function(){if(this.isNull())return 0;var r=this.getWidth(),o=this.getHeight();return r>o?r:o},qe.prototype.expandBy=function(){if(arguments.length===1){var r=arguments[0];this.expandBy(r,r)}else if(arguments.length===2){var o=arguments[0],c=arguments[1];if(this.isNull())return null;this._minx-=o,this._maxx+=o,this._miny-=c,this._maxy+=c,(this._minx>this._maxx||this._miny>this._maxy)&&this.setToNull()}},qe.prototype.contains=function(){if(arguments.length===1){if(arguments[0]instanceof qe){var r=arguments[0];return this.covers(r)}if(arguments[0]instanceof yt){var o=arguments[0];return this.covers(o)}}else if(arguments.length===2){var c=arguments[0],p=arguments[1];return this.covers(c,p)}},qe.prototype.centre=function(){return this.isNull()?null:new yt((this.getMinX()+this.getMaxX())/2,(this.getMinY()+this.getMaxY())/2)},qe.prototype.init=function(){if(arguments.length===0)this.setToNull();else if(arguments.length===1){if(arguments[0]instanceof yt){var r=arguments[0];this.init(r.x,r.x,r.y,r.y)}else if(arguments[0]instanceof qe){var o=arguments[0];this._minx=o._minx,this._maxx=o._maxx,this._miny=o._miny,this._maxy=o._maxy}}else if(arguments.length===2){var c=arguments[0],p=arguments[1];this.init(c.x,p.x,c.y,p.y)}else if(arguments.length===4){var _=arguments[0],C=arguments[1],R=arguments[2],$=arguments[3];_<C?(this._minx=_,this._maxx=C):(this._minx=C,this._maxx=_),R<$?(this._miny=R,this._maxy=$):(this._miny=$,this._maxy=R)}},qe.prototype.getMaxY=function(){return this._maxy},qe.prototype.distance=function(r){if(this.intersects(r))return 0;var o=0;this._maxx<r._minx?o=r._minx-this._maxx:this._minx>r._maxx&&(o=this._minx-r._maxx);var c=0;return this._maxy<r._miny?c=r._miny-this._maxy:this._miny>r._maxy&&(c=this._miny-r._maxy),o===0?c:c===0?o:Math.sqrt(o*o+c*c)},qe.prototype.hashCode=function(){var r=17;return r=37*r+yt.hashCode(this._minx),r=37*r+yt.hashCode(this._maxx),r=37*r+yt.hashCode(this._miny),r=37*r+yt.hashCode(this._maxy)},qe.prototype.interfaces_=function(){return[de,A]},qe.prototype.getClass=function(){return qe},qe.intersects=function(){if(arguments.length===3){var r=arguments[0],o=arguments[1],c=arguments[2];return c.x>=(r.x<o.x?r.x:o.x)&&c.x<=(r.x>o.x?r.x:o.x)&&c.y>=(r.y<o.y?r.y:o.y)&&c.y<=(r.y>o.y?r.y:o.y)}if(arguments.length===4){var p=arguments[0],_=arguments[1],C=arguments[2],R=arguments[3],$=Math.min(C.x,R.x),rt=Math.max(C.x,R.x),bt=Math.min(p.x,_.x),Yt=Math.max(p.x,_.x);return!(bt>rt)&&!(Yt<$)&&($=Math.min(C.y,R.y),rt=Math.max(C.y,R.y),bt=Math.min(p.y,_.y),Yt=Math.max(p.y,_.y),!(bt>rt)&&!(Yt<$))}},jr.serialVersionUID.get=function(){return 5873921885273102e3},Object.defineProperties(qe,jr);var pi={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,emptyTypeStr:/^\s*(\w+)\s*EMPTY\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/},Dr=function(r){this.geometryFactory=r||new lr};Dr.prototype.read=function(r){var o,c,p;r=r.replace(/[\n\r]/g," ");var _=pi.typeStr.exec(r);if(r.search("EMPTY")!==-1&&((_=pi.emptyTypeStr.exec(r))[2]=void 0),_&&(c=_[1].toLowerCase(),p=_[2],rn[c]&&(o=rn[c].apply(this,[p]))),o===void 0)throw new Error("Could not parse WKT "+r);return o},Dr.prototype.write=function(r){return this.extractGeometry(r)},Dr.prototype.extractGeometry=function(r){var o=r.getGeometryType().toLowerCase();if(!Hr[o])return null;var c=o.toUpperCase();return r.isEmpty()?c+" EMPTY":c+"("+Hr[o].apply(this,[r])+")"};var Hr={coordinate:function(r){return r.x+" "+r.y},point:function(r){return Hr.coordinate.call(this,r._coordinates._coordinates[0])},multipoint:function(r){for(var o=[],c=0,p=r._geometries.length;c<p;++c)o.push("("+Hr.point.apply(this,[r._geometries[c]])+")");return o.join(",")},linestring:function(r){for(var o=[],c=0,p=r._points._coordinates.length;c<p;++c)o.push(Hr.coordinate.apply(this,[r._points._coordinates[c]]));return o.join(",")},linearring:function(r){for(var o=[],c=0,p=r._points._coordinates.length;c<p;++c)o.push(Hr.coordinate.apply(this,[r._points._coordinates[c]]));return o.join(",")},multilinestring:function(r){for(var o=[],c=0,p=r._geometries.length;c<p;++c)o.push("("+Hr.linestring.apply(this,[r._geometries[c]])+")");return o.join(",")},polygon:function(r){var o=[];o.push("("+Hr.linestring.apply(this,[r._shell])+")");for(var c=0,p=r._holes.length;c<p;++c)o.push("("+Hr.linestring.apply(this,[r._holes[c]])+")");return o.join(",")},multipolygon:function(r){for(var o=[],c=0,p=r._geometries.length;c<p;++c)o.push("("+Hr.polygon.apply(this,[r._geometries[c]])+")");return o.join(",")},geometrycollection:function(r){for(var o=[],c=0,p=r._geometries.length;c<p;++c)o.push(this.extractGeometry(r._geometries[c]));return o.join(",")}},rn={point:function(r){if(r===void 0)return this.geometryFactory.createPoint();var o=r.trim().split(pi.spaces);return this.geometryFactory.createPoint(new yt(Number.parseFloat(o[0]),Number.parseFloat(o[1])))},multipoint:function(r){if(r===void 0)return this.geometryFactory.createMultiPoint();for(var o,c=r.trim().split(","),p=[],_=0,C=c.length;_<C;++_)o=c[_].replace(pi.trimParens,"$1"),p.push(rn.point.apply(this,[o]));return this.geometryFactory.createMultiPoint(p)},linestring:function(r){if(r===void 0)return this.geometryFactory.createLineString();for(var o,c=r.trim().split(","),p=[],_=0,C=c.length;_<C;++_)o=c[_].trim().split(pi.spaces),p.push(new yt(Number.parseFloat(o[0]),Number.parseFloat(o[1])));return this.geometryFactory.createLineString(p)},linearring:function(r){if(r===void 0)return this.geometryFactory.createLinearRing();for(var o,c=r.trim().split(","),p=[],_=0,C=c.length;_<C;++_)o=c[_].trim().split(pi.spaces),p.push(new yt(Number.parseFloat(o[0]),Number.parseFloat(o[1])));return this.geometryFactory.createLinearRing(p)},multilinestring:function(r){if(r===void 0)return this.geometryFactory.createMultiLineString();for(var o,c=r.trim().split(pi.parenComma),p=[],_=0,C=c.length;_<C;++_)o=c[_].replace(pi.trimParens,"$1"),p.push(rn.linestring.apply(this,[o]));return this.geometryFactory.createMultiLineString(p)},polygon:function(r){if(r===void 0)return this.geometryFactory.createPolygon();for(var o,c,p,_,C=r.trim().split(pi.parenComma),R=[],$=0,rt=C.length;$<rt;++$)o=C[$].replace(pi.trimParens,"$1"),c=rn.linestring.apply(this,[o]),p=this.geometryFactory.createLinearRing(c._points),$===0?_=p:R.push(p);return this.geometryFactory.createPolygon(_,R)},multipolygon:function(r){if(r===void 0)return this.geometryFactory.createMultiPolygon();for(var o,c=r.trim().split(pi.doubleParenComma),p=[],_=0,C=c.length;_<C;++_)o=c[_].replace(pi.trimParens,"$1"),p.push(rn.polygon.apply(this,[o]));return this.geometryFactory.createMultiPolygon(p)},geometrycollection:function(r){if(r===void 0)return this.geometryFactory.createGeometryCollection();for(var o=(r=r.replace(/,\s*([A-Za-z])/g,"|$1")).trim().split("|"),c=[],p=0,_=o.length;p<_;++p)c.push(this.read(o[p]));return this.geometryFactory.createGeometryCollection(c)}},ii=function(r){this.parser=new Dr(r)};ii.prototype.write=function(r){return this.parser.write(r)},ii.toLineString=function(r,o){if(arguments.length!==2)throw new Error("Not implemented");return"LINESTRING ( "+r.x+" "+r.y+", "+o.x+" "+o.y+" )"};var zt=function(r){function o(c){r.call(this,c),this.name="RuntimeException",this.message=c,this.stack=new r().stack}return r&&(o.__proto__=r),o.prototype=Object.create(r&&r.prototype),o.prototype.constructor=o,o}(Error),J=function(r){function o(){if(r.call(this),arguments.length===0)r.call(this);else if(arguments.length===1){var c=arguments[0];r.call(this,c)}}return r&&(o.__proto__=r),o.prototype=Object.create(r&&r.prototype),o.prototype.constructor=o,o.prototype.interfaces_=function(){return[]},o.prototype.getClass=function(){return o},o}(zt),Z=function(){};Z.prototype.interfaces_=function(){return[]},Z.prototype.getClass=function(){return Z},Z.shouldNeverReachHere=function(){if(arguments.length===0)Z.shouldNeverReachHere(null);else if(arguments.length===1){var r=arguments[0];throw new J("Should never reach here"+(r!==null?": "+r:""))}},Z.isTrue=function(){var r,o;if(arguments.length===1)r=arguments[0],Z.isTrue(r,null);else if(arguments.length===2&&(r=arguments[0],o=arguments[1],!r))throw o===null?new J:new J(o)},Z.equals=function(){var r,o,c;if(arguments.length===2)r=arguments[0],o=arguments[1],Z.equals(r,o,null);else if(arguments.length===3&&(r=arguments[0],o=arguments[1],c=arguments[2],!o.equals(r)))throw new J("Expected "+r+" but encountered "+o+(c!==null?": "+c:""))};var H=function(){this._result=null,this._inputLines=Array(2).fill().map(function(){return Array(2)}),this._intPt=new Array(2).fill(null),this._intLineIndex=null,this._isProper=null,this._pa=null,this._pb=null,this._precisionModel=null,this._intPt[0]=new yt,this._intPt[1]=new yt,this._pa=this._intPt[0],this._pb=this._intPt[1],this._result=0},ft={DONT_INTERSECT:{configurable:!0},DO_INTERSECT:{configurable:!0},COLLINEAR:{configurable:!0},NO_INTERSECTION:{configurable:!0},POINT_INTERSECTION:{configurable:!0},COLLINEAR_INTERSECTION:{configurable:!0}};H.prototype.getIndexAlongSegment=function(r,o){return this.computeIntLineIndex(),this._intLineIndex[r][o]},H.prototype.getTopologySummary=function(){var r=new ti;return this.isEndPoint()&&r.append(" endpoint"),this._isProper&&r.append(" proper"),this.isCollinear()&&r.append(" collinear"),r.toString()},H.prototype.computeIntersection=function(r,o,c,p){this._inputLines[0][0]=r,this._inputLines[0][1]=o,this._inputLines[1][0]=c,this._inputLines[1][1]=p,this._result=this.computeIntersect(r,o,c,p)},H.prototype.getIntersectionNum=function(){return this._result},H.prototype.computeIntLineIndex=function(){if(arguments.length===0)this._intLineIndex===null&&(this._intLineIndex=Array(2).fill().map(function(){return Array(2)}),this.computeIntLineIndex(0),this.computeIntLineIndex(1));else if(arguments.length===1){var r=arguments[0];this.getEdgeDistance(r,0)>this.getEdgeDistance(r,1)?(this._intLineIndex[r][0]=0,this._intLineIndex[r][1]=1):(this._intLineIndex[r][0]=1,this._intLineIndex[r][1]=0)}},H.prototype.isProper=function(){return this.hasIntersection()&&this._isProper},H.prototype.setPrecisionModel=function(r){this._precisionModel=r},H.prototype.isInteriorIntersection=function(){if(arguments.length===0)return!!this.isInteriorIntersection(0)||!!this.isInteriorIntersection(1);if(arguments.length===1){for(var r=arguments[0],o=0;o<this._result;o++)if(!this._intPt[o].equals2D(this._inputLines[r][0])&&!this._intPt[o].equals2D(this._inputLines[r][1]))return!0;return!1}},H.prototype.getIntersection=function(r){return this._intPt[r]},H.prototype.isEndPoint=function(){return this.hasIntersection()&&!this._isProper},H.prototype.hasIntersection=function(){return this._result!==H.NO_INTERSECTION},H.prototype.getEdgeDistance=function(r,o){return H.computeEdgeDistance(this._intPt[o],this._inputLines[r][0],this._inputLines[r][1])},H.prototype.isCollinear=function(){return this._result===H.COLLINEAR_INTERSECTION},H.prototype.toString=function(){return ii.toLineString(this._inputLines[0][0],this._inputLines[0][1])+" - "+ii.toLineString(this._inputLines[1][0],this._inputLines[1][1])+this.getTopologySummary()},H.prototype.getEndpoint=function(r,o){return this._inputLines[r][o]},H.prototype.isIntersection=function(r){for(var o=0;o<this._result;o++)if(this._intPt[o].equals2D(r))return!0;return!1},H.prototype.getIntersectionAlongSegment=function(r,o){return this.computeIntLineIndex(),this._intPt[this._intLineIndex[r][o]]},H.prototype.interfaces_=function(){return[]},H.prototype.getClass=function(){return H},H.computeEdgeDistance=function(r,o,c){var p=Math.abs(c.x-o.x),_=Math.abs(c.y-o.y),C=-1;if(r.equals(o))C=0;else if(r.equals(c))C=p>_?p:_;else{var R=Math.abs(r.x-o.x),$=Math.abs(r.y-o.y);(C=p>_?R:$)!==0||r.equals(o)||(C=Math.max(R,$))}return Z.isTrue(!(C===0&&!r.equals(o)),"Bad distance calculation"),C},H.nonRobustComputeEdgeDistance=function(r,o,c){var p=r.x-o.x,_=r.y-o.y,C=Math.sqrt(p*p+_*_);return Z.isTrue(!(C===0&&!r.equals(o)),"Invalid distance calculation"),C},ft.DONT_INTERSECT.get=function(){return 0},ft.DO_INTERSECT.get=function(){return 1},ft.COLLINEAR.get=function(){return 2},ft.NO_INTERSECTION.get=function(){return 0},ft.POINT_INTERSECTION.get=function(){return 1},ft.COLLINEAR_INTERSECTION.get=function(){return 2},Object.defineProperties(H,ft);var Dt=function(r){function o(){r.apply(this,arguments)}return r&&(o.__proto__=r),o.prototype=Object.create(r&&r.prototype),o.prototype.constructor=o,o.prototype.isInSegmentEnvelopes=function(c){var p=new qe(this._inputLines[0][0],this._inputLines[0][1]),_=new qe(this._inputLines[1][0],this._inputLines[1][1]);return p.contains(c)&&_.contains(c)},o.prototype.computeIntersection=function(){if(arguments.length!==3)return r.prototype.computeIntersection.apply(this,arguments);var c=arguments[0],p=arguments[1],_=arguments[2];if(this._isProper=!1,qe.intersects(p,_,c)&&kt.orientationIndex(p,_,c)===0&&kt.orientationIndex(_,p,c)===0)return this._isProper=!0,(c.equals(p)||c.equals(_))&&(this._isProper=!1),this._result=r.POINT_INTERSECTION,null;this._result=r.NO_INTERSECTION},o.prototype.normalizeToMinimum=function(c,p,_,C,R){R.x=this.smallestInAbsValue(c.x,p.x,_.x,C.x),R.y=this.smallestInAbsValue(c.y,p.y,_.y,C.y),c.x-=R.x,c.y-=R.y,p.x-=R.x,p.y-=R.y,_.x-=R.x,_.y-=R.y,C.x-=R.x,C.y-=R.y},o.prototype.safeHCoordinateIntersection=function(c,p,_,C){var R=null;try{R=He.intersection(c,p,_,C)}catch($){if(!($ instanceof oi))throw $;R=o.nearestEndpoint(c,p,_,C)}return R},o.prototype.intersection=function(c,p,_,C){var R=this.intersectionWithNormalization(c,p,_,C);return this.isInSegmentEnvelopes(R)||(R=new yt(o.nearestEndpoint(c,p,_,C))),this._precisionModel!==null&&this._precisionModel.makePrecise(R),R},o.prototype.smallestInAbsValue=function(c,p,_,C){var R=c,$=Math.abs(R);return Math.abs(p)<$&&(R=p,$=Math.abs(p)),Math.abs(_)<$&&(R=_,$=Math.abs(_)),Math.abs(C)<$&&(R=C),R},o.prototype.checkDD=function(c,p,_,C,R){var $=pr.intersection(c,p,_,C),rt=this.isInSegmentEnvelopes($);Br.out.println("DD in env = "+rt+"  --------------------- "+$),R.distance($)>1e-4&&Br.out.println("Distance = "+R.distance($))},o.prototype.intersectionWithNormalization=function(c,p,_,C){var R=new yt(c),$=new yt(p),rt=new yt(_),bt=new yt(C),Yt=new yt;this.normalizeToEnvCentre(R,$,rt,bt,Yt);var Ht=this.safeHCoordinateIntersection(R,$,rt,bt);return Ht.x+=Yt.x,Ht.y+=Yt.y,Ht},o.prototype.computeCollinearIntersection=function(c,p,_,C){var R=qe.intersects(c,p,_),$=qe.intersects(c,p,C),rt=qe.intersects(_,C,c),bt=qe.intersects(_,C,p);return R&&$?(this._intPt[0]=_,this._intPt[1]=C,r.COLLINEAR_INTERSECTION):rt&&bt?(this._intPt[0]=c,this._intPt[1]=p,r.COLLINEAR_INTERSECTION):R&&rt?(this._intPt[0]=_,this._intPt[1]=c,!_.equals(c)||$||bt?r.COLLINEAR_INTERSECTION:r.POINT_INTERSECTION):R&&bt?(this._intPt[0]=_,this._intPt[1]=p,!_.equals(p)||$||rt?r.COLLINEAR_INTERSECTION:r.POINT_INTERSECTION):$&&rt?(this._intPt[0]=C,this._intPt[1]=c,!C.equals(c)||R||bt?r.COLLINEAR_INTERSECTION:r.POINT_INTERSECTION):$&&bt?(this._intPt[0]=C,this._intPt[1]=p,!C.equals(p)||R||rt?r.COLLINEAR_INTERSECTION:r.POINT_INTERSECTION):r.NO_INTERSECTION},o.prototype.normalizeToEnvCentre=function(c,p,_,C,R){var $=c.x<p.x?c.x:p.x,rt=c.y<p.y?c.y:p.y,bt=c.x>p.x?c.x:p.x,Yt=c.y>p.y?c.y:p.y,Ht=_.x<C.x?_.x:C.x,Re=_.y<C.y?_.y:C.y,ze=_.x>C.x?_.x:C.x,Ve=_.y>C.y?_.y:C.y,We=(($>Ht?$:Ht)+(bt<ze?bt:ze))/2,Vr=((rt>Re?rt:Re)+(Yt<Ve?Yt:Ve))/2;R.x=We,R.y=Vr,c.x-=R.x,c.y-=R.y,p.x-=R.x,p.y-=R.y,_.x-=R.x,_.y-=R.y,C.x-=R.x,C.y-=R.y},o.prototype.computeIntersect=function(c,p,_,C){if(this._isProper=!1,!qe.intersects(c,p,_,C))return r.NO_INTERSECTION;var R=kt.orientationIndex(c,p,_),$=kt.orientationIndex(c,p,C);if(R>0&&$>0||R<0&&$<0)return r.NO_INTERSECTION;var rt=kt.orientationIndex(_,C,c),bt=kt.orientationIndex(_,C,p);return rt>0&&bt>0||rt<0&&bt<0?r.NO_INTERSECTION:R===0&&$===0&&rt===0&&bt===0?this.computeCollinearIntersection(c,p,_,C):(R===0||$===0||rt===0||bt===0?(this._isProper=!1,c.equals2D(_)||c.equals2D(C)?this._intPt[0]=c:p.equals2D(_)||p.equals2D(C)?this._intPt[0]=p:R===0?this._intPt[0]=new yt(_):$===0?this._intPt[0]=new yt(C):rt===0?this._intPt[0]=new yt(c):bt===0&&(this._intPt[0]=new yt(p))):(this._isProper=!0,this._intPt[0]=this.intersection(c,p,_,C)),r.POINT_INTERSECTION)},o.prototype.interfaces_=function(){return[]},o.prototype.getClass=function(){return o},o.nearestEndpoint=function(c,p,_,C){var R=c,$=kt.distancePointLine(c,_,C),rt=kt.distancePointLine(p,_,C);return rt<$&&($=rt,R=p),(rt=kt.distancePointLine(_,c,p))<$&&($=rt,R=_),(rt=kt.distancePointLine(C,c,p))<$&&($=rt,R=C),R},o}(H),Jt=function(){};Jt.prototype.interfaces_=function(){return[]},Jt.prototype.getClass=function(){return Jt},Jt.orientationIndex=function(r,o,c){var p=o.x-r.x,_=o.y-r.y,C=c.x-o.x,R=c.y-o.y;return Jt.signOfDet2x2(p,_,C,R)},Jt.signOfDet2x2=function(r,o,c,p){var _=null,C=null,R=null;if(_=1,r===0||p===0)return o===0||c===0?0:o>0?c>0?-_:_:c>0?_:-_;if(o===0||c===0)return p>0?r>0?_:-_:r>0?-_:_;if(o>0?p>0?o<=p||(_=-_,C=r,r=c,c=C,C=o,o=p,p=C):o<=-p?(_=-_,c=-c,p=-p):(C=r,r=-c,c=C,C=o,o=-p,p=C):p>0?-o<=p?(_=-_,r=-r,o=-o):(C=-r,r=c,c=C,C=-o,o=p,p=C):o>=p?(r=-r,o=-o,c=-c,p=-p):(_=-_,C=-r,r=-c,c=C,C=-o,o=-p,p=C),r>0){if(!(c>0)||!(r<=c))return _}else{if(c>0||!(r>=c))return-_;_=-_,r=-r,c=-c}for(;;){if(R=Math.floor(c/r),c-=R*r,(p-=R*o)<0)return-_;if(p>o)return _;if(r>c+c){if(o<p+p)return _}else{if(o>p+p)return-_;c=r-c,p=o-p,_=-_}if(p===0)return c===0?0:-_;if(c===0||(R=Math.floor(r/c),r-=R*c,(o-=R*p)<0))return _;if(o>p)return-_;if(c>r+r){if(p<o+o)return-_}else{if(p>o+o)return _;r=c-r,o=p-o,_=-_}if(o===0)return r===0?0:_;if(r===0)return-_}};var pe=function(){this._p=null,this._crossingCount=0,this._isPointOnSegment=!1;var r=arguments[0];this._p=r};pe.prototype.countSegment=function(r,o){if(r.x<this._p.x&&o.x<this._p.x)return null;if(this._p.x===o.x&&this._p.y===o.y)return this._isPointOnSegment=!0,null;if(r.y===this._p.y&&o.y===this._p.y){var c=r.x,p=o.x;return c>p&&(c=o.x,p=r.x),this._p.x>=c&&this._p.x<=p&&(this._isPointOnSegment=!0),null}if(r.y>this._p.y&&o.y<=this._p.y||o.y>this._p.y&&r.y<=this._p.y){var _=r.x-this._p.x,C=r.y-this._p.y,R=o.x-this._p.x,$=o.y-this._p.y,rt=Jt.signOfDet2x2(_,C,R,$);if(rt===0)return this._isPointOnSegment=!0,null;$<C&&(rt=-rt),rt>0&&this._crossingCount++}},pe.prototype.isPointInPolygon=function(){return this.getLocation()!==wt.EXTERIOR},pe.prototype.getLocation=function(){return this._isPointOnSegment?wt.BOUNDARY:this._crossingCount%2==1?wt.INTERIOR:wt.EXTERIOR},pe.prototype.isOnSegment=function(){return this._isPointOnSegment},pe.prototype.interfaces_=function(){return[]},pe.prototype.getClass=function(){return pe},pe.locatePointInRing=function(){if(arguments[0]instanceof yt&&Ne(arguments[1],je)){for(var r=arguments[0],o=arguments[1],c=new pe(r),p=new yt,_=new yt,C=1;C<o.size();C++)if(o.getCoordinate(C,p),o.getCoordinate(C-1,_),c.countSegment(p,_),c.isOnSegment())return c.getLocation();return c.getLocation()}if(arguments[0]instanceof yt&&arguments[1]instanceof Array){for(var R=arguments[0],$=arguments[1],rt=new pe(R),bt=1;bt<$.length;bt++){var Yt=$[bt],Ht=$[bt-1];if(rt.countSegment(Yt,Ht),rt.isOnSegment())return rt.getLocation()}return rt.getLocation()}};var kt=function(){},Ze={CLOCKWISE:{configurable:!0},RIGHT:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},LEFT:{configurable:!0},COLLINEAR:{configurable:!0},STRAIGHT:{configurable:!0}};kt.prototype.interfaces_=function(){return[]},kt.prototype.getClass=function(){return kt},kt.orientationIndex=function(r,o,c){return pr.orientationIndex(r,o,c)},kt.signedArea=function(){if(arguments[0]instanceof Array){var r=arguments[0];if(r.length<3)return 0;for(var o=0,c=r[0].x,p=1;p<r.length-1;p++){var _=r[p].x-c,C=r[p+1].y;o+=_*(r[p-1].y-C)}return o/2}if(Ne(arguments[0],je)){var R=arguments[0],$=R.size();if($<3)return 0;var rt=new yt,bt=new yt,Yt=new yt;R.getCoordinate(0,bt),R.getCoordinate(1,Yt);var Ht=bt.x;Yt.x-=Ht;for(var Re=0,ze=1;ze<$-1;ze++)rt.y=bt.y,bt.x=Yt.x,bt.y=Yt.y,R.getCoordinate(ze+1,Yt),Yt.x-=Ht,Re+=bt.x*(rt.y-Yt.y);return Re/2}},kt.distanceLineLine=function(r,o,c,p){if(r.equals(o))return kt.distancePointLine(r,c,p);if(c.equals(p))return kt.distancePointLine(p,r,o);var _=!1;if(qe.intersects(r,o,c,p)){var C=(o.x-r.x)*(p.y-c.y)-(o.y-r.y)*(p.x-c.x);if(C===0)_=!0;else{var R=(r.y-c.y)*(p.x-c.x)-(r.x-c.x)*(p.y-c.y),$=((r.y-c.y)*(o.x-r.x)-(r.x-c.x)*(o.y-r.y))/C,rt=R/C;(rt<0||rt>1||$<0||$>1)&&(_=!0)}}else _=!0;return _?Tr.min(kt.distancePointLine(r,c,p),kt.distancePointLine(o,c,p),kt.distancePointLine(c,r,o),kt.distancePointLine(p,r,o)):0},kt.isPointInRing=function(r,o){return kt.locatePointInRing(r,o)!==wt.EXTERIOR},kt.computeLength=function(r){var o=r.size();if(o<=1)return 0;var c=0,p=new yt;r.getCoordinate(0,p);for(var _=p.x,C=p.y,R=1;R<o;R++){r.getCoordinate(R,p);var $=p.x,rt=p.y,bt=$-_,Yt=rt-C;c+=Math.sqrt(bt*bt+Yt*Yt),_=$,C=rt}return c},kt.isCCW=function(r){var o=r.length-1;if(o<3)throw new Et("Ring has fewer than 4 points, so orientation cannot be determined");for(var c=r[0],p=0,_=1;_<=o;_++){var C=r[_];C.y>c.y&&(c=C,p=_)}var R=p;do(R-=1)<0&&(R=o);while(r[R].equals2D(c)&&R!==p);var $=p;do $=($+1)%o;while(r[$].equals2D(c)&&$!==p);var rt=r[R],bt=r[$];if(rt.equals2D(c)||bt.equals2D(c)||rt.equals2D(bt))return!1;var Yt=kt.computeOrientation(rt,c,bt),Ht=!1;return Ht=Yt===0?rt.x>bt.x:Yt>0,Ht},kt.locatePointInRing=function(r,o){return pe.locatePointInRing(r,o)},kt.distancePointLinePerpendicular=function(r,o,c){var p=(c.x-o.x)*(c.x-o.x)+(c.y-o.y)*(c.y-o.y),_=((o.y-r.y)*(c.x-o.x)-(o.x-r.x)*(c.y-o.y))/p;return Math.abs(_)*Math.sqrt(p)},kt.computeOrientation=function(r,o,c){return kt.orientationIndex(r,o,c)},kt.distancePointLine=function(){if(arguments.length===2){var r=arguments[0],o=arguments[1];if(o.length===0)throw new Et("Line array must contain at least one vertex");for(var c=r.distance(o[0]),p=0;p<o.length-1;p++){var _=kt.distancePointLine(r,o[p],o[p+1]);_<c&&(c=_)}return c}if(arguments.length===3){var C=arguments[0],R=arguments[1],$=arguments[2];if(R.x===$.x&&R.y===$.y)return C.distance(R);var rt=($.x-R.x)*($.x-R.x)+($.y-R.y)*($.y-R.y),bt=((C.x-R.x)*($.x-R.x)+(C.y-R.y)*($.y-R.y))/rt;if(bt<=0)return C.distance(R);if(bt>=1)return C.distance($);var Yt=((R.y-C.y)*($.x-R.x)-(R.x-C.x)*($.y-R.y))/rt;return Math.abs(Yt)*Math.sqrt(rt)}},kt.isOnLine=function(r,o){for(var c=new Dt,p=1;p<o.length;p++){var _=o[p-1],C=o[p];if(c.computeIntersection(r,_,C),c.hasIntersection())return!0}return!1},Ze.CLOCKWISE.get=function(){return-1},Ze.RIGHT.get=function(){return kt.CLOCKWISE},Ze.COUNTERCLOCKWISE.get=function(){return 1},Ze.LEFT.get=function(){return kt.COUNTERCLOCKWISE},Ze.COLLINEAR.get=function(){return 0},Ze.STRAIGHT.get=function(){return kt.COLLINEAR},Object.defineProperties(kt,Ze);var rr=function(){};rr.prototype.filter=function(r){},rr.prototype.interfaces_=function(){return[]},rr.prototype.getClass=function(){return rr};var Me=function(){var r=arguments[0];this._envelope=null,this._factory=null,this._SRID=null,this._userData=null,this._factory=r,this._SRID=r.getSRID()},fr={serialVersionUID:{configurable:!0},SORTINDEX_POINT:{configurable:!0},SORTINDEX_MULTIPOINT:{configurable:!0},SORTINDEX_LINESTRING:{configurable:!0},SORTINDEX_LINEARRING:{configurable:!0},SORTINDEX_MULTILINESTRING:{configurable:!0},SORTINDEX_POLYGON:{configurable:!0},SORTINDEX_MULTIPOLYGON:{configurable:!0},SORTINDEX_GEOMETRYCOLLECTION:{configurable:!0},geometryChangedFilter:{configurable:!0}};Me.prototype.isGeometryCollection=function(){return this.getSortIndex()===Me.SORTINDEX_GEOMETRYCOLLECTION},Me.prototype.getFactory=function(){return this._factory},Me.prototype.getGeometryN=function(r){return this},Me.prototype.getArea=function(){return 0},Me.prototype.isRectangle=function(){return!1},Me.prototype.equals=function(){if(arguments[0]instanceof Me){var r=arguments[0];return r!==null&&this.equalsTopo(r)}if(arguments[0]instanceof Object){var o=arguments[0];if(!(o instanceof Me))return!1;var c=o;return this.equalsExact(c)}},Me.prototype.equalsExact=function(r){return this===r||this.equalsExact(r,0)},Me.prototype.geometryChanged=function(){this.apply(Me.geometryChangedFilter)},Me.prototype.geometryChangedAction=function(){this._envelope=null},Me.prototype.equalsNorm=function(r){return r!==null&&this.norm().equalsExact(r.norm())},Me.prototype.getLength=function(){return 0},Me.prototype.getNumGeometries=function(){return 1},Me.prototype.compareTo=function(){if(arguments.length===1){var r=arguments[0],o=r;return this.getSortIndex()!==o.getSortIndex()?this.getSortIndex()-o.getSortIndex():this.isEmpty()&&o.isEmpty()?0:this.isEmpty()?-1:o.isEmpty()?1:this.compareToSameClass(r)}if(arguments.length===2){var c=arguments[0],p=arguments[1];return this.getSortIndex()!==c.getSortIndex()?this.getSortIndex()-c.getSortIndex():this.isEmpty()&&c.isEmpty()?0:this.isEmpty()?-1:c.isEmpty()?1:this.compareToSameClass(c,p)}},Me.prototype.getUserData=function(){return this._userData},Me.prototype.getSRID=function(){return this._SRID},Me.prototype.getEnvelope=function(){return this.getFactory().toGeometry(this.getEnvelopeInternal())},Me.prototype.checkNotGeometryCollection=function(r){if(r.getSortIndex()===Me.SORTINDEX_GEOMETRYCOLLECTION)throw new Et("This method does not support GeometryCollection arguments")},Me.prototype.equal=function(r,o,c){return c===0?r.equals(o):r.distance(o)<=c},Me.prototype.norm=function(){var r=this.copy();return r.normalize(),r},Me.prototype.getPrecisionModel=function(){return this._factory.getPrecisionModel()},Me.prototype.getEnvelopeInternal=function(){return this._envelope===null&&(this._envelope=this.computeEnvelopeInternal()),new qe(this._envelope)},Me.prototype.setSRID=function(r){this._SRID=r},Me.prototype.setUserData=function(r){this._userData=r},Me.prototype.compare=function(r,o){for(var c=r.iterator(),p=o.iterator();c.hasNext()&&p.hasNext();){var _=c.next(),C=p.next(),R=_.compareTo(C);if(R!==0)return R}return c.hasNext()?1:p.hasNext()?-1:0},Me.prototype.hashCode=function(){return this.getEnvelopeInternal().hashCode()},Me.prototype.isGeometryCollectionOrDerived=function(){return this.getSortIndex()===Me.SORTINDEX_GEOMETRYCOLLECTION||this.getSortIndex()===Me.SORTINDEX_MULTIPOINT||this.getSortIndex()===Me.SORTINDEX_MULTILINESTRING||this.getSortIndex()===Me.SORTINDEX_MULTIPOLYGON},Me.prototype.interfaces_=function(){return[xe,de,A]},Me.prototype.getClass=function(){return Me},Me.hasNonEmptyElements=function(r){for(var o=0;o<r.length;o++)if(!r[o].isEmpty())return!0;return!1},Me.hasNullElements=function(r){for(var o=0;o<r.length;o++)if(r[o]===null)return!0;return!1},fr.serialVersionUID.get=function(){return 8763622679187377e3},fr.SORTINDEX_POINT.get=function(){return 0},fr.SORTINDEX_MULTIPOINT.get=function(){return 1},fr.SORTINDEX_LINESTRING.get=function(){return 2},fr.SORTINDEX_LINEARRING.get=function(){return 3},fr.SORTINDEX_MULTILINESTRING.get=function(){return 4},fr.SORTINDEX_POLYGON.get=function(){return 5},fr.SORTINDEX_MULTIPOLYGON.get=function(){return 6},fr.SORTINDEX_GEOMETRYCOLLECTION.get=function(){return 7},fr.geometryChangedFilter.get=function(){return Sr},Object.defineProperties(Me,fr);var Sr=function(){};Sr.interfaces_=function(){return[rr]},Sr.filter=function(r){r.geometryChangedAction()};var Fr=function(){};Fr.prototype.filter=function(r){},Fr.prototype.interfaces_=function(){return[]},Fr.prototype.getClass=function(){return Fr};var gr=function(){},$r={Mod2BoundaryNodeRule:{configurable:!0},EndPointBoundaryNodeRule:{configurable:!0},MultiValentEndPointBoundaryNodeRule:{configurable:!0},MonoValentEndPointBoundaryNodeRule:{configurable:!0},MOD2_BOUNDARY_RULE:{configurable:!0},ENDPOINT_BOUNDARY_RULE:{configurable:!0},MULTIVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},MONOVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},OGC_SFS_BOUNDARY_RULE:{configurable:!0}};gr.prototype.isInBoundary=function(r){},gr.prototype.interfaces_=function(){return[]},gr.prototype.getClass=function(){return gr},$r.Mod2BoundaryNodeRule.get=function(){return yi},$r.EndPointBoundaryNodeRule.get=function(){return Di},$r.MultiValentEndPointBoundaryNodeRule.get=function(){return sn},$r.MonoValentEndPointBoundaryNodeRule.get=function(){return ht},$r.MOD2_BOUNDARY_RULE.get=function(){return new yi},$r.ENDPOINT_BOUNDARY_RULE.get=function(){return new Di},$r.MULTIVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new sn},$r.MONOVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new ht},$r.OGC_SFS_BOUNDARY_RULE.get=function(){return gr.MOD2_BOUNDARY_RULE},Object.defineProperties(gr,$r);var yi=function(){};yi.prototype.isInBoundary=function(r){return r%2==1},yi.prototype.interfaces_=function(){return[gr]},yi.prototype.getClass=function(){return yi};var Di=function(){};Di.prototype.isInBoundary=function(r){return r>0},Di.prototype.interfaces_=function(){return[gr]},Di.prototype.getClass=function(){return Di};var sn=function(){};sn.prototype.isInBoundary=function(r){return r>1},sn.prototype.interfaces_=function(){return[gr]},sn.prototype.getClass=function(){return sn};var ht=function(){};ht.prototype.isInBoundary=function(r){return r===1},ht.prototype.interfaces_=function(){return[gr]},ht.prototype.getClass=function(){return ht};var X=function(){};X.prototype.add=function(){},X.prototype.addAll=function(){},X.prototype.isEmpty=function(){},X.prototype.iterator=function(){},X.prototype.size=function(){},X.prototype.toArray=function(){},X.prototype.remove=function(){},(D.prototype=new Error).name="IndexOutOfBoundsException";var W=function(){};W.prototype.hasNext=function(){},W.prototype.next=function(){},W.prototype.remove=function(){};var ut=function(r){function o(){r.apply(this,arguments)}return r&&(o.__proto__=r),o.prototype=Object.create(r&&r.prototype),o.prototype.constructor=o,o.prototype.get=function(){},o.prototype.set=function(){},o.prototype.isEmpty=function(){},o}(X);(z.prototype=new Error).name="NoSuchElementException";var et=function(r){function o(){r.call(this),this.array_=[],arguments[0]instanceof X&&this.addAll(arguments[0])}return r&&(o.__proto__=r),o.prototype=Object.create(r&&r.prototype),o.prototype.constructor=o,o.prototype.ensureCapacity=function(){},o.prototype.interfaces_=function(){return[r,X]},o.prototype.add=function(c){return arguments.length===1?this.array_.push(c):this.array_.splice(arguments[0],arguments[1]),!0},o.prototype.clear=function(){this.array_=[]},o.prototype.addAll=function(c){for(var p=c.iterator();p.hasNext();)this.add(p.next());return!0},o.prototype.set=function(c,p){var _=this.array_[c];return this.array_[c]=p,_},o.prototype.iterator=function(){return new Pt(this)},o.prototype.get=function(c){if(c<0||c>=this.size())throw new D;return this.array_[c]},o.prototype.isEmpty=function(){return this.array_.length===0},o.prototype.size=function(){return this.array_.length},o.prototype.toArray=function(){for(var c=[],p=0,_=this.array_.length;p<_;p++)c.push(this.array_[p]);return c},o.prototype.remove=function(c){for(var p=!1,_=0,C=this.array_.length;_<C;_++)if(this.array_[_]===c){this.array_.splice(_,1),p=!0;break}return p},o}(ut),Pt=function(r){function o(c){r.call(this),this.arrayList_=c,this.position_=0}return r&&(o.__proto__=r),o.prototype=Object.create(r&&r.prototype),o.prototype.constructor=o,o.prototype.next=function(){if(this.position_===this.arrayList_.size())throw new z;return this.arrayList_.get(this.position_++)},o.prototype.hasNext=function(){return this.position_<this.arrayList_.size()},o.prototype.set=function(c){return this.arrayList_.set(this.position_-1,c)},o.prototype.remove=function(){this.arrayList_.remove(this.arrayList_.get(this.position_))},o}(W),Ut=function(r){function o(){if(r.call(this),arguments.length!==0){if(arguments.length===1){var p=arguments[0];this.ensureCapacity(p.length),this.add(p,!0)}else if(arguments.length===2){var _=arguments[0],C=arguments[1];this.ensureCapacity(_.length),this.add(_,C)}}}r&&(o.__proto__=r),(o.prototype=Object.create(r&&r.prototype)).constructor=o;var c={coordArrayType:{configurable:!0}};return c.coordArrayType.get=function(){return new Array(0).fill(null)},o.prototype.getCoordinate=function(p){return this.get(p)},o.prototype.addAll=function(){if(arguments.length===2){for(var p=arguments[0],_=arguments[1],C=!1,R=p.iterator();R.hasNext();)this.add(R.next(),_),C=!0;return C}return r.prototype.addAll.apply(this,arguments)},o.prototype.clone=function(){for(var p=r.prototype.clone.call(this),_=0;_<this.size();_++)p.add(_,this.get(_).copy());return p},o.prototype.toCoordinateArray=function(){return this.toArray(o.coordArrayType)},o.prototype.add=function(){if(arguments.length===1){var p=arguments[0];r.prototype.add.call(this,p)}else if(arguments.length===2){if(arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var _=arguments[0],C=arguments[1];return this.add(_,C,!0),!0}if(arguments[0]instanceof yt&&typeof arguments[1]=="boolean"){var R=arguments[0];if(!arguments[1]&&this.size()>=1&&this.get(this.size()-1).equals2D(R))return null;r.prototype.add.call(this,R)}else if(arguments[0]instanceof Object&&typeof arguments[1]=="boolean"){var $=arguments[0],rt=arguments[1];return this.add($,rt),!0}}else if(arguments.length===3){if(typeof arguments[2]=="boolean"&&arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var bt=arguments[0],Yt=arguments[1];if(arguments[2])for(var Ht=0;Ht<bt.length;Ht++)this.add(bt[Ht],Yt);else for(var Re=bt.length-1;Re>=0;Re--)this.add(bt[Re],Yt);return!0}if(typeof arguments[2]=="boolean"&&Number.isInteger(arguments[0])&&arguments[1]instanceof yt){var ze=arguments[0],Ve=arguments[1];if(!arguments[2]){var We=this.size();if(We>0&&(ze>0&&this.get(ze-1).equals2D(Ve)||ze<We&&this.get(ze).equals2D(Ve)))return null}r.prototype.add.call(this,ze,Ve)}}else if(arguments.length===4){var Vr=arguments[0],Bi=arguments[1],De=arguments[2],Vo=arguments[3],vs=1;De>Vo&&(vs=-1);for(var aa=De;aa!==Vo;aa+=vs)this.add(Vr[aa],Bi);return!0}},o.prototype.closeRing=function(){this.size()>0&&this.add(new yt(this.get(0)),!1)},o.prototype.interfaces_=function(){return[]},o.prototype.getClass=function(){return o},Object.defineProperties(o,c),o}(et),Tt=function(){},Lt={ForwardComparator:{configurable:!0},BidirectionalComparator:{configurable:!0},coordArrayType:{configurable:!0}};Lt.ForwardComparator.get=function(){return jt},Lt.BidirectionalComparator.get=function(){return ge},Lt.coordArrayType.get=function(){return new Array(0).fill(null)},Tt.prototype.interfaces_=function(){return[]},Tt.prototype.getClass=function(){return Tt},Tt.isRing=function(r){return!(r.length<4)&&!!r[0].equals2D(r[r.length-1])},Tt.ptNotInList=function(r,o){for(var c=0;c<r.length;c++){var p=r[c];if(Tt.indexOf(p,o)<0)return p}return null},Tt.scroll=function(r,o){var c=Tt.indexOf(o,r);if(c<0)return null;var p=new Array(r.length).fill(null);Br.arraycopy(r,c,p,0,r.length-c),Br.arraycopy(r,0,p,r.length-c,c),Br.arraycopy(p,0,r,0,r.length)},Tt.equals=function(){if(arguments.length===2){var r=arguments[0],o=arguments[1];if(r===o)return!0;if(r===null||o===null||r.length!==o.length)return!1;for(var c=0;c<r.length;c++)if(!r[c].equals(o[c]))return!1;return!0}if(arguments.length===3){var p=arguments[0],_=arguments[1],C=arguments[2];if(p===_)return!0;if(p===null||_===null||p.length!==_.length)return!1;for(var R=0;R<p.length;R++)if(C.compare(p[R],_[R])!==0)return!1;return!0}},Tt.intersection=function(r,o){for(var c=new Ut,p=0;p<r.length;p++)o.intersects(r[p])&&c.add(r[p],!0);return c.toCoordinateArray()},Tt.hasRepeatedPoints=function(r){for(var o=1;o<r.length;o++)if(r[o-1].equals(r[o]))return!0;return!1},Tt.removeRepeatedPoints=function(r){return Tt.hasRepeatedPoints(r)?new Ut(r,!1).toCoordinateArray():r},Tt.reverse=function(r){for(var o=r.length-1,c=Math.trunc(o/2),p=0;p<=c;p++){var _=r[p];r[p]=r[o-p],r[o-p]=_}},Tt.removeNull=function(r){for(var o=0,c=0;c<r.length;c++)r[c]!==null&&o++;var p=new Array(o).fill(null);if(o===0)return p;for(var _=0,C=0;C<r.length;C++)r[C]!==null&&(p[_++]=r[C]);return p},Tt.copyDeep=function(){if(arguments.length===1){for(var r=arguments[0],o=new Array(r.length).fill(null),c=0;c<r.length;c++)o[c]=new yt(r[c]);return o}if(arguments.length===5)for(var p=arguments[0],_=arguments[1],C=arguments[2],R=arguments[3],$=arguments[4],rt=0;rt<$;rt++)C[R+rt]=new yt(p[_+rt])},Tt.isEqualReversed=function(r,o){for(var c=0;c<r.length;c++){var p=r[c],_=o[r.length-c-1];if(p.compareTo(_)!==0)return!1}return!0},Tt.envelope=function(r){for(var o=new qe,c=0;c<r.length;c++)o.expandToInclude(r[c]);return o},Tt.toCoordinateArray=function(r){return r.toArray(Tt.coordArrayType)},Tt.atLeastNCoordinatesOrNothing=function(r,o){return o.length>=r?o:[]},Tt.indexOf=function(r,o){for(var c=0;c<o.length;c++)if(r.equals(o[c]))return c;return-1},Tt.increasingDirection=function(r){for(var o=0;o<Math.trunc(r.length/2);o++){var c=r.length-1-o,p=r[o].compareTo(r[c]);if(p!==0)return p}return 1},Tt.compare=function(r,o){for(var c=0;c<r.length&&c<o.length;){var p=r[c].compareTo(o[c]);if(p!==0)return p;c++}return c<o.length?-1:c<r.length?1:0},Tt.minCoordinate=function(r){for(var o=null,c=0;c<r.length;c++)(o===null||o.compareTo(r[c])>0)&&(o=r[c]);return o},Tt.extract=function(r,o,c){o=Tr.clamp(o,0,r.length);var p=(c=Tr.clamp(c,-1,r.length))-o+1;c<0&&(p=0),o>=r.length&&(p=0),c<o&&(p=0);var _=new Array(p).fill(null);if(p===0)return _;for(var C=0,R=o;R<=c;R++)_[C++]=r[R];return _},Object.defineProperties(Tt,Lt);var jt=function(){};jt.prototype.compare=function(r,o){return Tt.compare(r,o)},jt.prototype.interfaces_=function(){return[$t]},jt.prototype.getClass=function(){return jt};var ge=function(){};ge.prototype.compare=function(r,o){var c=r,p=o;if(c.length<p.length)return-1;if(c.length>p.length)return 1;if(c.length===0)return 0;var _=Tt.compare(c,p);return Tt.isEqualReversed(c,p)?0:_},ge.prototype.OLDcompare=function(r,o){var c=r,p=o;if(c.length<p.length)return-1;if(c.length>p.length)return 1;if(c.length===0)return 0;for(var _=Tt.increasingDirection(c),C=Tt.increasingDirection(p),R=_>0?0:c.length-1,$=C>0?0:c.length-1,rt=0;rt<c.length;rt++){var bt=c[R].compareTo(p[$]);if(bt!==0)return bt;R+=_,$+=C}return 0},ge.prototype.interfaces_=function(){return[$t]},ge.prototype.getClass=function(){return ge};var Se=function(){};Se.prototype.get=function(){},Se.prototype.put=function(){},Se.prototype.size=function(){},Se.prototype.values=function(){},Se.prototype.entrySet=function(){};var we=function(r){function o(){r.apply(this,arguments)}return r&&(o.__proto__=r),o.prototype=Object.create(r&&r.prototype),o.prototype.constructor=o,o}(Se);(U.prototype=new Error).name="OperationNotSupported",(a.prototype=new X).contains=function(){};var dr=function(r){function o(){r.call(this),this.array_=[],arguments[0]instanceof X&&this.addAll(arguments[0])}return r&&(o.__proto__=r),o.prototype=Object.create(r&&r.prototype),o.prototype.constructor=o,o.prototype.contains=function(c){for(var p=0,_=this.array_.length;p<_;p++)if(this.array_[p]===c)return!0;return!1},o.prototype.add=function(c){return!this.contains(c)&&(this.array_.push(c),!0)},o.prototype.addAll=function(c){for(var p=c.iterator();p.hasNext();)this.add(p.next());return!0},o.prototype.remove=function(c){throw new Error},o.prototype.size=function(){return this.array_.length},o.prototype.isEmpty=function(){return this.array_.length===0},o.prototype.toArray=function(){for(var c=[],p=0,_=this.array_.length;p<_;p++)c.push(this.array_[p]);return c},o.prototype.iterator=function(){return new Cr(this)},o}(a),Cr=function(r){function o(c){r.call(this),this.hashSet_=c,this.position_=0}return r&&(o.__proto__=r),o.prototype=Object.create(r&&r.prototype),o.prototype.constructor=o,o.prototype.next=function(){if(this.position_===this.hashSet_.size())throw new z;return this.hashSet_.array_[this.position_++]},o.prototype.hasNext=function(){return this.position_<this.hashSet_.size()},o.prototype.remove=function(){throw new U},o}(W),or=0;(qt.prototype=new we).get=function(r){for(var o=this.root_;o!==null;){var c=r.compareTo(o.key);if(c<0)o=o.left;else{if(!(c>0))return o.value;o=o.right}}return null},qt.prototype.put=function(r,o){if(this.root_===null)return this.root_={key:r,value:o,left:null,right:null,parent:null,color:or,getValue:function(){return this.value},getKey:function(){return this.key}},this.size_=1,null;var c,p,_=this.root_;do if(c=_,(p=r.compareTo(_.key))<0)_=_.left;else{if(!(p>0)){var C=_.value;return _.value=o,C}_=_.right}while(_!==null);var R={key:r,left:null,right:null,value:o,parent:c,color:or,getValue:function(){return this.value},getKey:function(){return this.key}};return p<0?c.left=R:c.right=R,this.fixAfterInsertion(R),this.size_++,null},qt.prototype.fixAfterInsertion=function(r){for(r.color=1;r!=null&&r!==this.root_&&r.parent.color===1;)if(ot(r)===xt(ot(ot(r)))){var o=At(ot(ot(r)));G(o)===1?(Rt(ot(r),or),Rt(o,or),Rt(ot(ot(r)),1),r=ot(ot(r))):(r===At(ot(r))&&(r=ot(r),this.rotateLeft(r)),Rt(ot(r),or),Rt(ot(ot(r)),1),this.rotateRight(ot(ot(r))))}else{var c=xt(ot(ot(r)));G(c)===1?(Rt(ot(r),or),Rt(c,or),Rt(ot(ot(r)),1),r=ot(ot(r))):(r===xt(ot(r))&&(r=ot(r),this.rotateRight(r)),Rt(ot(r),or),Rt(ot(ot(r)),1),this.rotateLeft(ot(ot(r))))}this.root_.color=or},qt.prototype.values=function(){var r=new et,o=this.getFirstEntry();if(o!==null)for(r.add(o.value);(o=qt.successor(o))!==null;)r.add(o.value);return r},qt.prototype.entrySet=function(){var r=new dr,o=this.getFirstEntry();if(o!==null)for(r.add(o);(o=qt.successor(o))!==null;)r.add(o);return r},qt.prototype.rotateLeft=function(r){if(r!=null){var o=r.right;r.right=o.left,o.left!=null&&(o.left.parent=r),o.parent=r.parent,r.parent===null?this.root_=o:r.parent.left===r?r.parent.left=o:r.parent.right=o,o.left=r,r.parent=o}},qt.prototype.rotateRight=function(r){if(r!=null){var o=r.left;r.left=o.right,o.right!=null&&(o.right.parent=r),o.parent=r.parent,r.parent===null?this.root_=o:r.parent.right===r?r.parent.right=o:r.parent.left=o,o.right=r,r.parent=o}},qt.prototype.getFirstEntry=function(){var r=this.root_;if(r!=null)for(;r.left!=null;)r=r.left;return r},qt.successor=function(r){if(r===null)return null;if(r.right!==null){for(var o=r.right;o.left!==null;)o=o.left;return o}for(var c=r.parent,p=r;c!==null&&p===c.right;)p=c,c=c.parent;return c},qt.prototype.size=function(){return this.size_};var _r=function(){};_r.prototype.interfaces_=function(){return[]},_r.prototype.getClass=function(){return _r},re.prototype=new a,(ee.prototype=new re).contains=function(r){for(var o=0,c=this.array_.length;o<c;o++)if(this.array_[o].compareTo(r)===0)return!0;return!1},ee.prototype.add=function(r){if(this.contains(r))return!1;for(var o=0,c=this.array_.length;o<c;o++)if(this.array_[o].compareTo(r)===1)return this.array_.splice(o,0,r),!0;return this.array_.push(r),!0},ee.prototype.addAll=function(r){for(var o=r.iterator();o.hasNext();)this.add(o.next());return!0},ee.prototype.remove=function(r){throw new U},ee.prototype.size=function(){return this.array_.length},ee.prototype.isEmpty=function(){return this.array_.length===0},ee.prototype.toArray=function(){for(var r=[],o=0,c=this.array_.length;o<c;o++)r.push(this.array_[o]);return r},ee.prototype.iterator=function(){return new Ar(this)};var Ar=function(r){this.treeSet_=r,this.position_=0};Ar.prototype.next=function(){if(this.position_===this.treeSet_.size())throw new z;return this.treeSet_.array_[this.position_++]},Ar.prototype.hasNext=function(){return this.position_<this.treeSet_.size()},Ar.prototype.remove=function(){throw new U};var ni=function(){};ni.sort=function(){var r,o,c,p,_=arguments[0];if(arguments.length===1)p=function(R,$){return R.compareTo($)},_.sort(p);else if(arguments.length===2)c=arguments[1],p=function(R,$){return c.compare(R,$)},_.sort(p);else if(arguments.length===3){(o=_.slice(arguments[1],arguments[2])).sort();var C=_.slice(0,arguments[1]).concat(o,_.slice(arguments[2],_.length));for(_.splice(0,_.length),r=0;r<C.length;r++)_.push(C[r])}else if(arguments.length===4)for(o=_.slice(arguments[1],arguments[2]),c=arguments[3],p=function(R,$){return c.compare(R,$)},o.sort(p),C=_.slice(0,arguments[1]).concat(o,_.slice(arguments[2],_.length)),_.splice(0,_.length),r=0;r<C.length;r++)_.push(C[r])},ni.asList=function(r){for(var o=new et,c=0,p=r.length;c<p;c++)o.add(r[c]);return o};var sr=function(){},vi={P:{configurable:!0},L:{configurable:!0},A:{configurable:!0},FALSE:{configurable:!0},TRUE:{configurable:!0},DONTCARE:{configurable:!0},SYM_FALSE:{configurable:!0},SYM_TRUE:{configurable:!0},SYM_DONTCARE:{configurable:!0},SYM_P:{configurable:!0},SYM_L:{configurable:!0},SYM_A:{configurable:!0}};vi.P.get=function(){return 0},vi.L.get=function(){return 1},vi.A.get=function(){return 2},vi.FALSE.get=function(){return-1},vi.TRUE.get=function(){return-2},vi.DONTCARE.get=function(){return-3},vi.SYM_FALSE.get=function(){return"F"},vi.SYM_TRUE.get=function(){return"T"},vi.SYM_DONTCARE.get=function(){return"*"},vi.SYM_P.get=function(){return"0"},vi.SYM_L.get=function(){return"1"},vi.SYM_A.get=function(){return"2"},sr.prototype.interfaces_=function(){return[]},sr.prototype.getClass=function(){return sr},sr.toDimensionSymbol=function(r){switch(r){case sr.FALSE:return sr.SYM_FALSE;case sr.TRUE:return sr.SYM_TRUE;case sr.DONTCARE:return sr.SYM_DONTCARE;case sr.P:return sr.SYM_P;case sr.L:return sr.SYM_L;case sr.A:return sr.SYM_A}throw new Et("Unknown dimension value: "+r)},sr.toDimensionValue=function(r){switch(tr.toUpperCase(r)){case sr.SYM_FALSE:return sr.FALSE;case sr.SYM_TRUE:return sr.TRUE;case sr.SYM_DONTCARE:return sr.DONTCARE;case sr.SYM_P:return sr.P;case sr.SYM_L:return sr.L;case sr.SYM_A:return sr.A}throw new Et("Unknown dimension symbol: "+r)},Object.defineProperties(sr,vi);var si=function(){};si.prototype.filter=function(r){},si.prototype.interfaces_=function(){return[]},si.prototype.getClass=function(){return si};var an=function(){};an.prototype.filter=function(r,o){},an.prototype.isDone=function(){},an.prototype.isGeometryChanged=function(){},an.prototype.interfaces_=function(){return[]},an.prototype.getClass=function(){return an};var Kr=function(r){function o(p,_){if(r.call(this,_),this._geometries=p||[],r.hasNullElements(this._geometries))throw new Et("geometries must not contain null elements")}r&&(o.__proto__=r),(o.prototype=Object.create(r&&r.prototype)).constructor=o;var c={serialVersionUID:{configurable:!0}};return o.prototype.computeEnvelopeInternal=function(){for(var p=new qe,_=0;_<this._geometries.length;_++)p.expandToInclude(this._geometries[_].getEnvelopeInternal());return p},o.prototype.getGeometryN=function(p){return this._geometries[p]},o.prototype.getSortIndex=function(){return r.SORTINDEX_GEOMETRYCOLLECTION},o.prototype.getCoordinates=function(){for(var p=new Array(this.getNumPoints()).fill(null),_=-1,C=0;C<this._geometries.length;C++)for(var R=this._geometries[C].getCoordinates(),$=0;$<R.length;$++)p[++_]=R[$];return p},o.prototype.getArea=function(){for(var p=0,_=0;_<this._geometries.length;_++)p+=this._geometries[_].getArea();return p},o.prototype.equalsExact=function(){if(arguments.length===2){var p=arguments[0],_=arguments[1];if(!this.isEquivalentClass(p))return!1;var C=p;if(this._geometries.length!==C._geometries.length)return!1;for(var R=0;R<this._geometries.length;R++)if(!this._geometries[R].equalsExact(C._geometries[R],_))return!1;return!0}return r.prototype.equalsExact.apply(this,arguments)},o.prototype.normalize=function(){for(var p=0;p<this._geometries.length;p++)this._geometries[p].normalize();ni.sort(this._geometries)},o.prototype.getCoordinate=function(){return this.isEmpty()?null:this._geometries[0].getCoordinate()},o.prototype.getBoundaryDimension=function(){for(var p=sr.FALSE,_=0;_<this._geometries.length;_++)p=Math.max(p,this._geometries[_].getBoundaryDimension());return p},o.prototype.getDimension=function(){for(var p=sr.FALSE,_=0;_<this._geometries.length;_++)p=Math.max(p,this._geometries[_].getDimension());return p},o.prototype.getLength=function(){for(var p=0,_=0;_<this._geometries.length;_++)p+=this._geometries[_].getLength();return p},o.prototype.getNumPoints=function(){for(var p=0,_=0;_<this._geometries.length;_++)p+=this._geometries[_].getNumPoints();return p},o.prototype.getNumGeometries=function(){return this._geometries.length},o.prototype.reverse=function(){for(var p=this._geometries.length,_=new Array(p).fill(null),C=0;C<this._geometries.length;C++)_[C]=this._geometries[C].reverse();return this.getFactory().createGeometryCollection(_)},o.prototype.compareToSameClass=function(){if(arguments.length===1){var p=arguments[0],_=new ee(ni.asList(this._geometries)),C=new ee(ni.asList(p._geometries));return this.compare(_,C)}if(arguments.length===2){for(var R=arguments[0],$=arguments[1],rt=R,bt=this.getNumGeometries(),Yt=rt.getNumGeometries(),Ht=0;Ht<bt&&Ht<Yt;){var Re=this.getGeometryN(Ht),ze=rt.getGeometryN(Ht),Ve=Re.compareToSameClass(ze,$);if(Ve!==0)return Ve;Ht++}return Ht<bt?1:Ht<Yt?-1:0}},o.prototype.apply=function(){if(Ne(arguments[0],Fr))for(var p=arguments[0],_=0;_<this._geometries.length;_++)this._geometries[_].apply(p);else if(Ne(arguments[0],an)){var C=arguments[0];if(this._geometries.length===0)return null;for(var R=0;R<this._geometries.length&&(this._geometries[R].apply(C),!C.isDone());R++);C.isGeometryChanged()&&this.geometryChanged()}else if(Ne(arguments[0],si)){var $=arguments[0];$.filter(this);for(var rt=0;rt<this._geometries.length;rt++)this._geometries[rt].apply($)}else if(Ne(arguments[0],rr)){var bt=arguments[0];bt.filter(this);for(var Yt=0;Yt<this._geometries.length;Yt++)this._geometries[Yt].apply(bt)}},o.prototype.getBoundary=function(){return this.checkNotGeometryCollection(this),Z.shouldNeverReachHere(),null},o.prototype.clone=function(){var p=r.prototype.clone.call(this);p._geometries=new Array(this._geometries.length).fill(null);for(var _=0;_<this._geometries.length;_++)p._geometries[_]=this._geometries[_].clone();return p},o.prototype.getGeometryType=function(){return"GeometryCollection"},o.prototype.copy=function(){for(var p=new Array(this._geometries.length).fill(null),_=0;_<p.length;_++)p[_]=this._geometries[_].copy();return new o(p,this._factory)},o.prototype.isEmpty=function(){for(var p=0;p<this._geometries.length;p++)if(!this._geometries[p].isEmpty())return!1;return!0},o.prototype.interfaces_=function(){return[]},o.prototype.getClass=function(){return o},c.serialVersionUID.get=function(){return-5694727726395021e3},Object.defineProperties(o,c),o}(Me),ln=function(r){function o(){r.apply(this,arguments)}r&&(o.__proto__=r),(o.prototype=Object.create(r&&r.prototype)).constructor=o;var c={serialVersionUID:{configurable:!0}};return o.prototype.getSortIndex=function(){return Me.SORTINDEX_MULTILINESTRING},o.prototype.equalsExact=function(){if(arguments.length===2){var p=arguments[0],_=arguments[1];return!!this.isEquivalentClass(p)&&r.prototype.equalsExact.call(this,p,_)}return r.prototype.equalsExact.apply(this,arguments)},o.prototype.getBoundaryDimension=function(){return this.isClosed()?sr.FALSE:0},o.prototype.isClosed=function(){if(this.isEmpty())return!1;for(var p=0;p<this._geometries.length;p++)if(!this._geometries[p].isClosed())return!1;return!0},o.prototype.getDimension=function(){return 1},o.prototype.reverse=function(){for(var p=this._geometries.length,_=new Array(p).fill(null),C=0;C<this._geometries.length;C++)_[p-1-C]=this._geometries[C].reverse();return this.getFactory().createMultiLineString(_)},o.prototype.getBoundary=function(){return new Pn(this).getBoundary()},o.prototype.getGeometryType=function(){return"MultiLineString"},o.prototype.copy=function(){for(var p=new Array(this._geometries.length).fill(null),_=0;_<p.length;_++)p[_]=this._geometries[_].copy();return new o(p,this._factory)},o.prototype.interfaces_=function(){return[_r]},o.prototype.getClass=function(){return o},c.serialVersionUID.get=function(){return 8166665132445434e3},Object.defineProperties(o,c),o}(Kr),Pn=function(){if(this._geom=null,this._geomFact=null,this._bnRule=null,this._endpointMap=null,arguments.length===1){var r=arguments[0],o=gr.MOD2_BOUNDARY_RULE;this._geom=r,this._geomFact=r.getFactory(),this._bnRule=o}else if(arguments.length===2){var c=arguments[0],p=arguments[1];this._geom=c,this._geomFact=c.getFactory(),this._bnRule=p}};Pn.prototype.boundaryMultiLineString=function(r){if(this._geom.isEmpty())return this.getEmptyMultiPoint();var o=this.computeBoundaryCoordinates(r);return o.length===1?this._geomFact.createPoint(o[0]):this._geomFact.createMultiPointFromCoords(o)},Pn.prototype.getBoundary=function(){return this._geom instanceof fi?this.boundaryLineString(this._geom):this._geom instanceof ln?this.boundaryMultiLineString(this._geom):this._geom.getBoundary()},Pn.prototype.boundaryLineString=function(r){return this._geom.isEmpty()?this.getEmptyMultiPoint():r.isClosed()?this._bnRule.isInBoundary(2)?r.getStartPoint():this._geomFact.createMultiPoint():this._geomFact.createMultiPoint([r.getStartPoint(),r.getEndPoint()])},Pn.prototype.getEmptyMultiPoint=function(){return this._geomFact.createMultiPoint()},Pn.prototype.computeBoundaryCoordinates=function(r){var o=new et;this._endpointMap=new qt;for(var c=0;c<r.getNumGeometries();c++){var p=r.getGeometryN(c);p.getNumPoints()!==0&&(this.addEndpoint(p.getCoordinateN(0)),this.addEndpoint(p.getCoordinateN(p.getNumPoints()-1)))}for(var _=this._endpointMap.entrySet().iterator();_.hasNext();){var C=_.next(),R=C.getValue().count;this._bnRule.isInBoundary(R)&&o.add(C.getKey())}return Tt.toCoordinateArray(o)},Pn.prototype.addEndpoint=function(r){var o=this._endpointMap.get(r);o===null&&(o=new ml,this._endpointMap.put(r,o)),o.count++},Pn.prototype.interfaces_=function(){return[]},Pn.prototype.getClass=function(){return Pn},Pn.getBoundary=function(){if(arguments.length===1){var r=arguments[0];return new Pn(r).getBoundary()}if(arguments.length===2){var o=arguments[0],c=arguments[1];return new Pn(o,c).getBoundary()}};var ml=function(){this.count=null};ml.prototype.interfaces_=function(){return[]},ml.prototype.getClass=function(){return ml};var co=function(){},Wr={NEWLINE:{configurable:!0},SIMPLE_ORDINATE_FORMAT:{configurable:!0}};co.prototype.interfaces_=function(){return[]},co.prototype.getClass=function(){return co},co.chars=function(r,o){for(var c=new Array(o).fill(null),p=0;p<o;p++)c[p]=r;return String(c)},co.getStackTrace=function(){if(arguments.length===1){var r=arguments[0],o=new function(){},c=new function(){};return r.printStackTrace(c),o.toString()}if(arguments.length===2){for(var p=arguments[0],_=arguments[1],C="",R=new function(){}(new function(){}(co.getStackTrace(p))),$=0;$<_;$++)try{C+=R.readLine()+co.NEWLINE}catch(rt){if(!(rt instanceof Oe))throw rt;Z.shouldNeverReachHere()}return C}},co.split=function(r,o){for(var c=o.length,p=new et,_=""+r,C=_.indexOf(o);C>=0;){var R=_.substring(0,C);p.add(R),C=(_=_.substring(C+c)).indexOf(o)}_.length>0&&p.add(_);for(var $=new Array(p.size()).fill(null),rt=0;rt<$.length;rt++)$[rt]=p.get(rt);return $},co.toString=function(){if(arguments.length===1){var r=arguments[0];return co.SIMPLE_ORDINATE_FORMAT.format(r)}},co.spaces=function(r){return co.chars(" ",r)},Wr.NEWLINE.get=function(){return Br.getProperty("line.separator")},Wr.SIMPLE_ORDINATE_FORMAT.get=function(){return new function(){}},Object.defineProperties(co,Wr);var Ri=function(){};Ri.prototype.interfaces_=function(){return[]},Ri.prototype.getClass=function(){return Ri},Ri.copyCoord=function(r,o,c,p){for(var _=Math.min(r.getDimension(),c.getDimension()),C=0;C<_;C++)c.setOrdinate(p,C,r.getOrdinate(o,C))},Ri.isRing=function(r){var o=r.size();return o===0||!(o<=3)&&r.getOrdinate(0,je.X)===r.getOrdinate(o-1,je.X)&&r.getOrdinate(0,je.Y)===r.getOrdinate(o-1,je.Y)},Ri.isEqual=function(r,o){var c=r.size();if(c!==o.size())return!1;for(var p=Math.min(r.getDimension(),o.getDimension()),_=0;_<c;_++)for(var C=0;C<p;C++){var R=r.getOrdinate(_,C),$=o.getOrdinate(_,C);if(r.getOrdinate(_,C)!==o.getOrdinate(_,C)&&(!Ft.isNaN(R)||!Ft.isNaN($)))return!1}return!0},Ri.extend=function(r,o,c){var p=r.create(c,o.getDimension()),_=o.size();if(Ri.copy(o,0,p,0,_),_>0)for(var C=_;C<c;C++)Ri.copy(o,_-1,p,C,1);return p},Ri.reverse=function(r){for(var o=r.size()-1,c=Math.trunc(o/2),p=0;p<=c;p++)Ri.swap(r,p,o-p)},Ri.swap=function(r,o,c){if(o===c)return null;for(var p=0;p<r.getDimension();p++){var _=r.getOrdinate(o,p);r.setOrdinate(o,p,r.getOrdinate(c,p)),r.setOrdinate(c,p,_)}},Ri.copy=function(r,o,c,p,_){for(var C=0;C<_;C++)Ri.copyCoord(r,o+C,c,p+C)},Ri.toString=function(){if(arguments.length===1){var r=arguments[0],o=r.size();if(o===0)return"()";var c=r.getDimension(),p=new ti;p.append("(");for(var _=0;_<o;_++){_>0&&p.append(" ");for(var C=0;C<c;C++)C>0&&p.append(","),p.append(co.toString(r.getOrdinate(_,C)))}return p.append(")"),p.toString()}},Ri.ensureValidRing=function(r,o){var c=o.size();return c===0?o:c<=3?Ri.createClosedRing(r,o,4):o.getOrdinate(0,je.X)===o.getOrdinate(c-1,je.X)&&o.getOrdinate(0,je.Y)===o.getOrdinate(c-1,je.Y)?o:Ri.createClosedRing(r,o,c+1)},Ri.createClosedRing=function(r,o,c){var p=r.create(c,o.getDimension()),_=o.size();Ri.copy(o,0,p,0,_);for(var C=_;C<c;C++)Ri.copy(o,0,p,C,1);return p};var fi=function(r){function o(p,_){r.call(this,_),this._points=null,this.init(p)}r&&(o.__proto__=r),(o.prototype=Object.create(r&&r.prototype)).constructor=o;var c={serialVersionUID:{configurable:!0}};return o.prototype.computeEnvelopeInternal=function(){return this.isEmpty()?new qe:this._points.expandEnvelope(new qe)},o.prototype.isRing=function(){return this.isClosed()&&this.isSimple()},o.prototype.getSortIndex=function(){return r.SORTINDEX_LINESTRING},o.prototype.getCoordinates=function(){return this._points.toCoordinateArray()},o.prototype.equalsExact=function(){if(arguments.length===2){var p=arguments[0],_=arguments[1];if(!this.isEquivalentClass(p))return!1;var C=p;if(this._points.size()!==C._points.size())return!1;for(var R=0;R<this._points.size();R++)if(!this.equal(this._points.getCoordinate(R),C._points.getCoordinate(R),_))return!1;return!0}return r.prototype.equalsExact.apply(this,arguments)},o.prototype.normalize=function(){for(var p=0;p<Math.trunc(this._points.size()/2);p++){var _=this._points.size()-1-p;if(!this._points.getCoordinate(p).equals(this._points.getCoordinate(_)))return this._points.getCoordinate(p).compareTo(this._points.getCoordinate(_))>0&&Ri.reverse(this._points),null}},o.prototype.getCoordinate=function(){return this.isEmpty()?null:this._points.getCoordinate(0)},o.prototype.getBoundaryDimension=function(){return this.isClosed()?sr.FALSE:0},o.prototype.isClosed=function(){return!this.isEmpty()&&this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints()-1))},o.prototype.getEndPoint=function(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)},o.prototype.getDimension=function(){return 1},o.prototype.getLength=function(){return kt.computeLength(this._points)},o.prototype.getNumPoints=function(){return this._points.size()},o.prototype.reverse=function(){var p=this._points.copy();return Ri.reverse(p),this.getFactory().createLineString(p)},o.prototype.compareToSameClass=function(){if(arguments.length===1){for(var p=arguments[0],_=0,C=0;_<this._points.size()&&C<p._points.size();){var R=this._points.getCoordinate(_).compareTo(p._points.getCoordinate(C));if(R!==0)return R;_++,C++}return _<this._points.size()?1:C<p._points.size()?-1:0}if(arguments.length===2){var $=arguments[0];return arguments[1].compare(this._points,$._points)}},o.prototype.apply=function(){if(Ne(arguments[0],Fr))for(var p=arguments[0],_=0;_<this._points.size();_++)p.filter(this._points.getCoordinate(_));else if(Ne(arguments[0],an)){var C=arguments[0];if(this._points.size()===0)return null;for(var R=0;R<this._points.size()&&(C.filter(this._points,R),!C.isDone());R++);C.isGeometryChanged()&&this.geometryChanged()}else Ne(arguments[0],si)?arguments[0].filter(this):Ne(arguments[0],rr)&&arguments[0].filter(this)},o.prototype.getBoundary=function(){return new Pn(this).getBoundary()},o.prototype.isEquivalentClass=function(p){return p instanceof o},o.prototype.clone=function(){var p=r.prototype.clone.call(this);return p._points=this._points.clone(),p},o.prototype.getCoordinateN=function(p){return this._points.getCoordinate(p)},o.prototype.getGeometryType=function(){return"LineString"},o.prototype.copy=function(){return new o(this._points.copy(),this._factory)},o.prototype.getCoordinateSequence=function(){return this._points},o.prototype.isEmpty=function(){return this._points.size()===0},o.prototype.init=function(p){if(p===null&&(p=this.getFactory().getCoordinateSequenceFactory().create([])),p.size()===1)throw new Et("Invalid number of points in LineString (found "+p.size()+" - must be 0 or >= 2)");this._points=p},o.prototype.isCoordinate=function(p){for(var _=0;_<this._points.size();_++)if(this._points.getCoordinate(_).equals(p))return!0;return!1},o.prototype.getStartPoint=function(){return this.isEmpty()?null:this.getPointN(0)},o.prototype.getPointN=function(p){return this.getFactory().createPoint(this._points.getCoordinate(p))},o.prototype.interfaces_=function(){return[_r]},o.prototype.getClass=function(){return o},c.serialVersionUID.get=function(){return 0x2b2b51ba435c8e00},Object.defineProperties(o,c),o}(Me),fa=function(){};fa.prototype.interfaces_=function(){return[]},fa.prototype.getClass=function(){return fa};var Ln=function(r){function o(p,_){r.call(this,_),this._coordinates=p||null,this.init(this._coordinates)}r&&(o.__proto__=r),(o.prototype=Object.create(r&&r.prototype)).constructor=o;var c={serialVersionUID:{configurable:!0}};return o.prototype.computeEnvelopeInternal=function(){if(this.isEmpty())return new qe;var p=new qe;return p.expandToInclude(this._coordinates.getX(0),this._coordinates.getY(0)),p},o.prototype.getSortIndex=function(){return r.SORTINDEX_POINT},o.prototype.getCoordinates=function(){return this.isEmpty()?[]:[this.getCoordinate()]},o.prototype.equalsExact=function(){if(arguments.length===2){var p=arguments[0],_=arguments[1];return!!this.isEquivalentClass(p)&&(!(!this.isEmpty()||!p.isEmpty())||this.isEmpty()===p.isEmpty()&&this.equal(p.getCoordinate(),this.getCoordinate(),_))}return r.prototype.equalsExact.apply(this,arguments)},o.prototype.normalize=function(){},o.prototype.getCoordinate=function(){return this._coordinates.size()!==0?this._coordinates.getCoordinate(0):null},o.prototype.getBoundaryDimension=function(){return sr.FALSE},o.prototype.getDimension=function(){return 0},o.prototype.getNumPoints=function(){return this.isEmpty()?0:1},o.prototype.reverse=function(){return this.copy()},o.prototype.getX=function(){if(this.getCoordinate()===null)throw new Error("getX called on empty Point");return this.getCoordinate().x},o.prototype.compareToSameClass=function(){if(arguments.length===1){var p=arguments[0];return this.getCoordinate().compareTo(p.getCoordinate())}if(arguments.length===2){var _=arguments[0];return arguments[1].compare(this._coordinates,_._coordinates)}},o.prototype.apply=function(){if(Ne(arguments[0],Fr)){var p=arguments[0];if(this.isEmpty())return null;p.filter(this.getCoordinate())}else if(Ne(arguments[0],an)){var _=arguments[0];if(this.isEmpty())return null;_.filter(this._coordinates,0),_.isGeometryChanged()&&this.geometryChanged()}else Ne(arguments[0],si)?arguments[0].filter(this):Ne(arguments[0],rr)&&arguments[0].filter(this)},o.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},o.prototype.clone=function(){var p=r.prototype.clone.call(this);return p._coordinates=this._coordinates.clone(),p},o.prototype.getGeometryType=function(){return"Point"},o.prototype.copy=function(){return new o(this._coordinates.copy(),this._factory)},o.prototype.getCoordinateSequence=function(){return this._coordinates},o.prototype.getY=function(){if(this.getCoordinate()===null)throw new Error("getY called on empty Point");return this.getCoordinate().y},o.prototype.isEmpty=function(){return this._coordinates.size()===0},o.prototype.init=function(p){p===null&&(p=this.getFactory().getCoordinateSequenceFactory().create([])),Z.isTrue(p.size()<=1),this._coordinates=p},o.prototype.isSimple=function(){return!0},o.prototype.interfaces_=function(){return[fa]},o.prototype.getClass=function(){return o},c.serialVersionUID.get=function(){return 4902022702746615e3},Object.defineProperties(o,c),o}(Me),Gn=function(){};Gn.prototype.interfaces_=function(){return[]},Gn.prototype.getClass=function(){return Gn};var ai=function(r){function o(p,_,C){if(r.call(this,C),this._shell=null,this._holes=null,p===null&&(p=this.getFactory().createLinearRing()),_===null&&(_=[]),r.hasNullElements(_))throw new Et("holes must not contain null elements");if(p.isEmpty()&&r.hasNonEmptyElements(_))throw new Et("shell is empty but holes are not");this._shell=p,this._holes=_}r&&(o.__proto__=r),(o.prototype=Object.create(r&&r.prototype)).constructor=o;var c={serialVersionUID:{configurable:!0}};return o.prototype.computeEnvelopeInternal=function(){return this._shell.getEnvelopeInternal()},o.prototype.getSortIndex=function(){return r.SORTINDEX_POLYGON},o.prototype.getCoordinates=function(){if(this.isEmpty())return[];for(var p=new Array(this.getNumPoints()).fill(null),_=-1,C=this._shell.getCoordinates(),R=0;R<C.length;R++)p[++_]=C[R];for(var $=0;$<this._holes.length;$++)for(var rt=this._holes[$].getCoordinates(),bt=0;bt<rt.length;bt++)p[++_]=rt[bt];return p},o.prototype.getArea=function(){var p=0;p+=Math.abs(kt.signedArea(this._shell.getCoordinateSequence()));for(var _=0;_<this._holes.length;_++)p-=Math.abs(kt.signedArea(this._holes[_].getCoordinateSequence()));return p},o.prototype.isRectangle=function(){if(this.getNumInteriorRing()!==0||this._shell===null||this._shell.getNumPoints()!==5)return!1;for(var p=this._shell.getCoordinateSequence(),_=this.getEnvelopeInternal(),C=0;C<5;C++){var R=p.getX(C);if(R!==_.getMinX()&&R!==_.getMaxX())return!1;var $=p.getY(C);if($!==_.getMinY()&&$!==_.getMaxY())return!1}for(var rt=p.getX(0),bt=p.getY(0),Yt=1;Yt<=4;Yt++){var Ht=p.getX(Yt),Re=p.getY(Yt);if(Ht!==rt==(Re!==bt))return!1;rt=Ht,bt=Re}return!0},o.prototype.equalsExact=function(){if(arguments.length===2){var p=arguments[0],_=arguments[1];if(!this.isEquivalentClass(p))return!1;var C=p,R=this._shell,$=C._shell;if(!R.equalsExact($,_)||this._holes.length!==C._holes.length)return!1;for(var rt=0;rt<this._holes.length;rt++)if(!this._holes[rt].equalsExact(C._holes[rt],_))return!1;return!0}return r.prototype.equalsExact.apply(this,arguments)},o.prototype.normalize=function(){if(arguments.length===0){this.normalize(this._shell,!0);for(var p=0;p<this._holes.length;p++)this.normalize(this._holes[p],!1);ni.sort(this._holes)}else if(arguments.length===2){var _=arguments[0],C=arguments[1];if(_.isEmpty())return null;var R=new Array(_.getCoordinates().length-1).fill(null);Br.arraycopy(_.getCoordinates(),0,R,0,R.length);var $=Tt.minCoordinate(_.getCoordinates());Tt.scroll(R,$),Br.arraycopy(R,0,_.getCoordinates(),0,R.length),_.getCoordinates()[R.length]=R[0],kt.isCCW(_.getCoordinates())===C&&Tt.reverse(_.getCoordinates())}},o.prototype.getCoordinate=function(){return this._shell.getCoordinate()},o.prototype.getNumInteriorRing=function(){return this._holes.length},o.prototype.getBoundaryDimension=function(){return 1},o.prototype.getDimension=function(){return 2},o.prototype.getLength=function(){var p=0;p+=this._shell.getLength();for(var _=0;_<this._holes.length;_++)p+=this._holes[_].getLength();return p},o.prototype.getNumPoints=function(){for(var p=this._shell.getNumPoints(),_=0;_<this._holes.length;_++)p+=this._holes[_].getNumPoints();return p},o.prototype.reverse=function(){var p=this.copy();p._shell=this._shell.copy().reverse(),p._holes=new Array(this._holes.length).fill(null);for(var _=0;_<this._holes.length;_++)p._holes[_]=this._holes[_].copy().reverse();return p},o.prototype.convexHull=function(){return this.getExteriorRing().convexHull()},o.prototype.compareToSameClass=function(){if(arguments.length===1){var p=arguments[0],_=this._shell,C=p._shell;return _.compareToSameClass(C)}if(arguments.length===2){var R=arguments[0],$=arguments[1],rt=R,bt=this._shell,Yt=rt._shell,Ht=bt.compareToSameClass(Yt,$);if(Ht!==0)return Ht;for(var Re=this.getNumInteriorRing(),ze=rt.getNumInteriorRing(),Ve=0;Ve<Re&&Ve<ze;){var We=this.getInteriorRingN(Ve),Vr=rt.getInteriorRingN(Ve),Bi=We.compareToSameClass(Vr,$);if(Bi!==0)return Bi;Ve++}return Ve<Re?1:Ve<ze?-1:0}},o.prototype.apply=function(p){if(Ne(p,Fr)){this._shell.apply(p);for(var _=0;_<this._holes.length;_++)this._holes[_].apply(p)}else if(Ne(p,an)){if(this._shell.apply(p),!p.isDone())for(var C=0;C<this._holes.length&&(this._holes[C].apply(p),!p.isDone());C++);p.isGeometryChanged()&&this.geometryChanged()}else if(Ne(p,si))p.filter(this);else if(Ne(p,rr)){p.filter(this),this._shell.apply(p);for(var R=0;R<this._holes.length;R++)this._holes[R].apply(p)}},o.prototype.getBoundary=function(){if(this.isEmpty())return this.getFactory().createMultiLineString();var p=new Array(this._holes.length+1).fill(null);p[0]=this._shell;for(var _=0;_<this._holes.length;_++)p[_+1]=this._holes[_];return p.length<=1?this.getFactory().createLinearRing(p[0].getCoordinateSequence()):this.getFactory().createMultiLineString(p)},o.prototype.clone=function(){var p=r.prototype.clone.call(this);p._shell=this._shell.clone(),p._holes=new Array(this._holes.length).fill(null);for(var _=0;_<this._holes.length;_++)p._holes[_]=this._holes[_].clone();return p},o.prototype.getGeometryType=function(){return"Polygon"},o.prototype.copy=function(){for(var p=this._shell.copy(),_=new Array(this._holes.length).fill(null),C=0;C<_.length;C++)_[C]=this._holes[C].copy();return new o(p,_,this._factory)},o.prototype.getExteriorRing=function(){return this._shell},o.prototype.isEmpty=function(){return this._shell.isEmpty()},o.prototype.getInteriorRingN=function(p){return this._holes[p]},o.prototype.interfaces_=function(){return[Gn]},o.prototype.getClass=function(){return o},c.serialVersionUID.get=function(){return-0x307ffefd8dc97200},Object.defineProperties(o,c),o}(Me),Hs=function(r){function o(){r.apply(this,arguments)}r&&(o.__proto__=r),(o.prototype=Object.create(r&&r.prototype)).constructor=o;var c={serialVersionUID:{configurable:!0}};return o.prototype.getSortIndex=function(){return Me.SORTINDEX_MULTIPOINT},o.prototype.isValid=function(){return!0},o.prototype.equalsExact=function(){if(arguments.length===2){var p=arguments[0],_=arguments[1];return!!this.isEquivalentClass(p)&&r.prototype.equalsExact.call(this,p,_)}return r.prototype.equalsExact.apply(this,arguments)},o.prototype.getCoordinate=function(){if(arguments.length===1){var p=arguments[0];return this._geometries[p].getCoordinate()}return r.prototype.getCoordinate.apply(this,arguments)},o.prototype.getBoundaryDimension=function(){return sr.FALSE},o.prototype.getDimension=function(){return 0},o.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},o.prototype.getGeometryType=function(){return"MultiPoint"},o.prototype.copy=function(){for(var p=new Array(this._geometries.length).fill(null),_=0;_<p.length;_++)p[_]=this._geometries[_].copy();return new o(p,this._factory)},o.prototype.interfaces_=function(){return[fa]},o.prototype.getClass=function(){return o},c.serialVersionUID.get=function(){return-8048474874175356e3},Object.defineProperties(o,c),o}(Kr),Po=function(r){function o(p,_){p instanceof yt&&_ instanceof lr&&(p=_.getCoordinateSequenceFactory().create(p)),r.call(this,p,_),this.validateConstruction()}r&&(o.__proto__=r),(o.prototype=Object.create(r&&r.prototype)).constructor=o;var c={MINIMUM_VALID_SIZE:{configurable:!0},serialVersionUID:{configurable:!0}};return o.prototype.getSortIndex=function(){return Me.SORTINDEX_LINEARRING},o.prototype.getBoundaryDimension=function(){return sr.FALSE},o.prototype.isClosed=function(){return!!this.isEmpty()||r.prototype.isClosed.call(this)},o.prototype.reverse=function(){var p=this._points.copy();return Ri.reverse(p),this.getFactory().createLinearRing(p)},o.prototype.validateConstruction=function(){if(!this.isEmpty()&&!r.prototype.isClosed.call(this))throw new Et("Points of LinearRing do not form a closed linestring");if(this.getCoordinateSequence().size()>=1&&this.getCoordinateSequence().size()<o.MINIMUM_VALID_SIZE)throw new Et("Invalid number of points in LinearRing (found "+this.getCoordinateSequence().size()+" - must be 0 or >= 4)")},o.prototype.getGeometryType=function(){return"LinearRing"},o.prototype.copy=function(){return new o(this._points.copy(),this._factory)},o.prototype.interfaces_=function(){return[]},o.prototype.getClass=function(){return o},c.MINIMUM_VALID_SIZE.get=function(){return 4},c.serialVersionUID.get=function(){return-0x3b229e262367a600},Object.defineProperties(o,c),o}(fi),Zn=function(r){function o(){r.apply(this,arguments)}r&&(o.__proto__=r),(o.prototype=Object.create(r&&r.prototype)).constructor=o;var c={serialVersionUID:{configurable:!0}};return o.prototype.getSortIndex=function(){return Me.SORTINDEX_MULTIPOLYGON},o.prototype.equalsExact=function(){if(arguments.length===2){var p=arguments[0],_=arguments[1];return!!this.isEquivalentClass(p)&&r.prototype.equalsExact.call(this,p,_)}return r.prototype.equalsExact.apply(this,arguments)},o.prototype.getBoundaryDimension=function(){return 1},o.prototype.getDimension=function(){return 2},o.prototype.reverse=function(){for(var p=this._geometries.length,_=new Array(p).fill(null),C=0;C<this._geometries.length;C++)_[C]=this._geometries[C].reverse();return this.getFactory().createMultiPolygon(_)},o.prototype.getBoundary=function(){if(this.isEmpty())return this.getFactory().createMultiLineString();for(var p=new et,_=0;_<this._geometries.length;_++)for(var C=this._geometries[_].getBoundary(),R=0;R<C.getNumGeometries();R++)p.add(C.getGeometryN(R));var $=new Array(p.size()).fill(null);return this.getFactory().createMultiLineString(p.toArray($))},o.prototype.getGeometryType=function(){return"MultiPolygon"},o.prototype.copy=function(){for(var p=new Array(this._geometries.length).fill(null),_=0;_<p.length;_++)p[_]=this._geometries[_].copy();return new o(p,this._factory)},o.prototype.interfaces_=function(){return[Gn]},o.prototype.getClass=function(){return o},c.serialVersionUID.get=function(){return-0x7a5aa1369171980},Object.defineProperties(o,c),o}(Kr),un=function(r){this._factory=r||null,this._isUserDataCopied=!1},Ks={NoOpGeometryOperation:{configurable:!0},CoordinateOperation:{configurable:!0},CoordinateSequenceOperation:{configurable:!0}};un.prototype.setCopyUserData=function(r){this._isUserDataCopied=r},un.prototype.edit=function(r,o){if(r===null)return null;var c=this.editInternal(r,o);return this._isUserDataCopied&&c.setUserData(r.getUserData()),c},un.prototype.editInternal=function(r,o){return this._factory===null&&(this._factory=r.getFactory()),r instanceof Kr?this.editGeometryCollection(r,o):r instanceof ai?this.editPolygon(r,o):r instanceof Ln?o.edit(r,this._factory):r instanceof fi?o.edit(r,this._factory):(Z.shouldNeverReachHere("Unsupported Geometry class: "+r.getClass().getName()),null)},un.prototype.editGeometryCollection=function(r,o){for(var c=o.edit(r,this._factory),p=new et,_=0;_<c.getNumGeometries();_++){var C=this.edit(c.getGeometryN(_),o);C===null||C.isEmpty()||p.add(C)}return c.getClass()===Hs?this._factory.createMultiPoint(p.toArray([])):c.getClass()===ln?this._factory.createMultiLineString(p.toArray([])):c.getClass()===Zn?this._factory.createMultiPolygon(p.toArray([])):this._factory.createGeometryCollection(p.toArray([]))},un.prototype.editPolygon=function(r,o){var c=o.edit(r,this._factory);if(c===null&&(c=this._factory.createPolygon(null)),c.isEmpty())return c;var p=this.edit(c.getExteriorRing(),o);if(p===null||p.isEmpty())return this._factory.createPolygon();for(var _=new et,C=0;C<c.getNumInteriorRing();C++){var R=this.edit(c.getInteriorRingN(C),o);R===null||R.isEmpty()||_.add(R)}return this._factory.createPolygon(p,_.toArray([]))},un.prototype.interfaces_=function(){return[]},un.prototype.getClass=function(){return un},un.GeometryEditorOperation=function(){},Ks.NoOpGeometryOperation.get=function(){return ie},Ks.CoordinateOperation.get=function(){return Lo},Ks.CoordinateSequenceOperation.get=function(){return Xi},Object.defineProperties(un,Ks);var ie=function(){};ie.prototype.edit=function(r,o){return r},ie.prototype.interfaces_=function(){return[un.GeometryEditorOperation]},ie.prototype.getClass=function(){return ie};var Lo=function(){};Lo.prototype.edit=function(r,o){var c=this.editCoordinates(r.getCoordinates(),r);return c===null?r:r instanceof Po?o.createLinearRing(c):r instanceof fi?o.createLineString(c):r instanceof Ln?c.length>0?o.createPoint(c[0]):o.createPoint():r},Lo.prototype.interfaces_=function(){return[un.GeometryEditorOperation]},Lo.prototype.getClass=function(){return Lo};var Xi=function(){};Xi.prototype.edit=function(r,o){return r instanceof Po?o.createLinearRing(this.edit(r.getCoordinateSequence(),r)):r instanceof fi?o.createLineString(this.edit(r.getCoordinateSequence(),r)):r instanceof Ln?o.createPoint(this.edit(r.getCoordinateSequence(),r)):r},Xi.prototype.interfaces_=function(){return[un.GeometryEditorOperation]},Xi.prototype.getClass=function(){return Xi};var Rr=function(){if(this._dimension=3,this._coordinates=null,arguments.length===1){if(arguments[0]instanceof Array)this._coordinates=arguments[0],this._dimension=3;else if(Number.isInteger(arguments[0])){var r=arguments[0];this._coordinates=new Array(r).fill(null);for(var o=0;o<r;o++)this._coordinates[o]=new yt}else if(Ne(arguments[0],je)){var c=arguments[0];if(c===null)return this._coordinates=new Array(0).fill(null),null;this._dimension=c.getDimension(),this._coordinates=new Array(c.size()).fill(null);for(var p=0;p<this._coordinates.length;p++)this._coordinates[p]=c.getCoordinateCopy(p)}}else if(arguments.length===2){if(arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var _=arguments[0],C=arguments[1];this._coordinates=_,this._dimension=C,_===null&&(this._coordinates=new Array(0).fill(null))}else if(Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var R=arguments[0],$=arguments[1];this._coordinates=new Array(R).fill(null),this._dimension=$;for(var rt=0;rt<R;rt++)this._coordinates[rt]=new yt}}},zl={serialVersionUID:{configurable:!0}};Rr.prototype.setOrdinate=function(r,o,c){switch(o){case je.X:this._coordinates[r].x=c;break;case je.Y:this._coordinates[r].y=c;break;case je.Z:this._coordinates[r].z=c;break;default:throw new Et("invalid ordinateIndex")}},Rr.prototype.size=function(){return this._coordinates.length},Rr.prototype.getOrdinate=function(r,o){switch(o){case je.X:return this._coordinates[r].x;case je.Y:return this._coordinates[r].y;case je.Z:return this._coordinates[r].z}return Ft.NaN},Rr.prototype.getCoordinate=function(){if(arguments.length===1){var r=arguments[0];return this._coordinates[r]}if(arguments.length===2){var o=arguments[0],c=arguments[1];c.x=this._coordinates[o].x,c.y=this._coordinates[o].y,c.z=this._coordinates[o].z}},Rr.prototype.getCoordinateCopy=function(r){return new yt(this._coordinates[r])},Rr.prototype.getDimension=function(){return this._dimension},Rr.prototype.getX=function(r){return this._coordinates[r].x},Rr.prototype.clone=function(){for(var r=new Array(this.size()).fill(null),o=0;o<this._coordinates.length;o++)r[o]=this._coordinates[o].clone();return new Rr(r,this._dimension)},Rr.prototype.expandEnvelope=function(r){for(var o=0;o<this._coordinates.length;o++)r.expandToInclude(this._coordinates[o]);return r},Rr.prototype.copy=function(){for(var r=new Array(this.size()).fill(null),o=0;o<this._coordinates.length;o++)r[o]=this._coordinates[o].copy();return new Rr(r,this._dimension)},Rr.prototype.toString=function(){if(this._coordinates.length>0){var r=new ti(17*this._coordinates.length);r.append("("),r.append(this._coordinates[0]);for(var o=1;o<this._coordinates.length;o++)r.append(", "),r.append(this._coordinates[o]);return r.append(")"),r.toString()}return"()"},Rr.prototype.getY=function(r){return this._coordinates[r].y},Rr.prototype.toCoordinateArray=function(){return this._coordinates},Rr.prototype.interfaces_=function(){return[je,A]},Rr.prototype.getClass=function(){return Rr},zl.serialVersionUID.get=function(){return-0xcb44a778db18e00},Object.defineProperties(Rr,zl);var In=function(){},Ka={serialVersionUID:{configurable:!0},instanceObject:{configurable:!0}};In.prototype.readResolve=function(){return In.instance()},In.prototype.create=function(){if(arguments.length===1){if(arguments[0]instanceof Array){var r=arguments[0];return new Rr(r)}if(Ne(arguments[0],je)){var o=arguments[0];return new Rr(o)}}else if(arguments.length===2){var c=arguments[0],p=arguments[1];return p>3&&(p=3),p<2?new Rr(c):new Rr(c,p)}},In.prototype.interfaces_=function(){return[ae,A]},In.prototype.getClass=function(){return In},In.instance=function(){return In.instanceObject},Ka.serialVersionUID.get=function(){return-0x38e49fa6cf6f2e00},Ka.instanceObject.get=function(){return new In},Object.defineProperties(In,Ka);var kl=function(r){function o(){r.call(this),this.map_=new Map}return r&&(o.__proto__=r),o.prototype=Object.create(r&&r.prototype),o.prototype.constructor=o,o.prototype.get=function(c){return this.map_.get(c)||null},o.prototype.put=function(c,p){return this.map_.set(c,p),p},o.prototype.values=function(){for(var c=new et,p=this.map_.values(),_=p.next();!_.done;)c.add(_.value),_=p.next();return c},o.prototype.entrySet=function(){var c=new dr;return this.map_.entries().forEach(function(p){return c.add(p)}),c},o.prototype.size=function(){return this.map_.size()},o}(Se),Or=function r(){if(this._modelType=null,this._scale=null,arguments.length===0)this._modelType=r.FLOATING;else if(arguments.length===1){if(arguments[0]instanceof hr){var o=arguments[0];this._modelType=o,o===r.FIXED&&this.setScale(1)}else if(typeof arguments[0]=="number"){var c=arguments[0];this._modelType=r.FIXED,this.setScale(c)}else if(arguments[0]instanceof r){var p=arguments[0];this._modelType=p._modelType,this._scale=p._scale}}},ke={serialVersionUID:{configurable:!0},maximumPreciseValue:{configurable:!0}};Or.prototype.equals=function(r){if(!(r instanceof Or))return!1;var o=r;return this._modelType===o._modelType&&this._scale===o._scale},Or.prototype.compareTo=function(r){var o=r,c=this.getMaximumSignificantDigits(),p=o.getMaximumSignificantDigits();return new Pe(c).compareTo(new Pe(p))},Or.prototype.getScale=function(){return this._scale},Or.prototype.isFloating=function(){return this._modelType===Or.FLOATING||this._modelType===Or.FLOATING_SINGLE},Or.prototype.getType=function(){return this._modelType},Or.prototype.toString=function(){var r="UNKNOWN";return this._modelType===Or.FLOATING?r="Floating":this._modelType===Or.FLOATING_SINGLE?r="Floating-Single":this._modelType===Or.FIXED&&(r="Fixed (Scale="+this.getScale()+")"),r},Or.prototype.makePrecise=function(){if(typeof arguments[0]=="number"){var r=arguments[0];return Ft.isNaN(r)||this._modelType===Or.FLOATING_SINGLE?r:this._modelType===Or.FIXED?Math.round(r*this._scale)/this._scale:r}if(arguments[0]instanceof yt){var o=arguments[0];if(this._modelType===Or.FLOATING)return null;o.x=this.makePrecise(o.x),o.y=this.makePrecise(o.y)}},Or.prototype.getMaximumSignificantDigits=function(){var r=16;return this._modelType===Or.FLOATING?r=16:this._modelType===Or.FLOATING_SINGLE?r=6:this._modelType===Or.FIXED&&(r=1+Math.trunc(Math.ceil(Math.log(this.getScale())/Math.log(10)))),r},Or.prototype.setScale=function(r){this._scale=Math.abs(r)},Or.prototype.interfaces_=function(){return[A,de]},Or.prototype.getClass=function(){return Or},Or.mostPrecise=function(r,o){return r.compareTo(o)>=0?r:o},ke.serialVersionUID.get=function(){return 7777263578777804e3},ke.maximumPreciseValue.get=function(){return 9007199254740992},Object.defineProperties(Or,ke);var hr=function r(o){this._name=o||null,r.nameToTypeMap.put(o,this)},Ir={serialVersionUID:{configurable:!0},nameToTypeMap:{configurable:!0}};hr.prototype.readResolve=function(){return hr.nameToTypeMap.get(this._name)},hr.prototype.toString=function(){return this._name},hr.prototype.interfaces_=function(){return[A]},hr.prototype.getClass=function(){return hr},Ir.serialVersionUID.get=function(){return-552860263173159e4},Ir.nameToTypeMap.get=function(){return new kl},Object.defineProperties(hr,Ir),Or.Type=hr,Or.FIXED=new hr("FIXED"),Or.FLOATING=new hr("FLOATING"),Or.FLOATING_SINGLE=new hr("FLOATING SINGLE");var lr=function r(){this._precisionModel=new Or,this._SRID=0,this._coordinateSequenceFactory=r.getDefaultCoordinateSequenceFactory(),arguments.length===0||(arguments.length===1?Ne(arguments[0],ae)?this._coordinateSequenceFactory=arguments[0]:arguments[0]instanceof Or&&(this._precisionModel=arguments[0]):arguments.length===2?(this._precisionModel=arguments[0],this._SRID=arguments[1]):arguments.length===3&&(this._precisionModel=arguments[0],this._SRID=arguments[1],this._coordinateSequenceFactory=arguments[2]))},jo={serialVersionUID:{configurable:!0}};lr.prototype.toGeometry=function(r){return r.isNull()?this.createPoint(null):r.getMinX()===r.getMaxX()&&r.getMinY()===r.getMaxY()?this.createPoint(new yt(r.getMinX(),r.getMinY())):r.getMinX()===r.getMaxX()||r.getMinY()===r.getMaxY()?this.createLineString([new yt(r.getMinX(),r.getMinY()),new yt(r.getMaxX(),r.getMaxY())]):this.createPolygon(this.createLinearRing([new yt(r.getMinX(),r.getMinY()),new yt(r.getMinX(),r.getMaxY()),new yt(r.getMaxX(),r.getMaxY()),new yt(r.getMaxX(),r.getMinY()),new yt(r.getMinX(),r.getMinY())]),null)},lr.prototype.createLineString=function(r){return r?r instanceof Array?new fi(this.getCoordinateSequenceFactory().create(r),this):Ne(r,je)?new fi(r,this):void 0:new fi(this.getCoordinateSequenceFactory().create([]),this)},lr.prototype.createMultiLineString=function(){if(arguments.length===0)return new ln(null,this);if(arguments.length===1){var r=arguments[0];return new ln(r,this)}},lr.prototype.buildGeometry=function(r){for(var o=null,c=!1,p=!1,_=r.iterator();_.hasNext();){var C=_.next(),R=C.getClass();o===null&&(o=R),R!==o&&(c=!0),C.isGeometryCollectionOrDerived()&&(p=!0)}if(o===null)return this.createGeometryCollection();if(c||p)return this.createGeometryCollection(lr.toGeometryArray(r));var $=r.iterator().next();if(r.size()>1){if($ instanceof ai)return this.createMultiPolygon(lr.toPolygonArray(r));if($ instanceof fi)return this.createMultiLineString(lr.toLineStringArray(r));if($ instanceof Ln)return this.createMultiPoint(lr.toPointArray(r));Z.shouldNeverReachHere("Unhandled class: "+$.getClass().getName())}return $},lr.prototype.createMultiPointFromCoords=function(r){return this.createMultiPoint(r!==null?this.getCoordinateSequenceFactory().create(r):null)},lr.prototype.createPoint=function(){if(arguments.length===0)return this.createPoint(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof yt){var r=arguments[0];return this.createPoint(r!==null?this.getCoordinateSequenceFactory().create([r]):null)}if(Ne(arguments[0],je)){var o=arguments[0];return new Ln(o,this)}}},lr.prototype.getCoordinateSequenceFactory=function(){return this._coordinateSequenceFactory},lr.prototype.createPolygon=function(){if(arguments.length===0)return new ai(null,null,this);if(arguments.length===1){if(Ne(arguments[0],je)){var r=arguments[0];return this.createPolygon(this.createLinearRing(r))}if(arguments[0]instanceof Array){var o=arguments[0];return this.createPolygon(this.createLinearRing(o))}if(arguments[0]instanceof Po){var c=arguments[0];return this.createPolygon(c,null)}}else if(arguments.length===2){var p=arguments[0],_=arguments[1];return new ai(p,_,this)}},lr.prototype.getSRID=function(){return this._SRID},lr.prototype.createGeometryCollection=function(){if(arguments.length===0)return new Kr(null,this);if(arguments.length===1){var r=arguments[0];return new Kr(r,this)}},lr.prototype.createGeometry=function(r){return new un(this).edit(r,{edit:function(){if(arguments.length===2){var o=arguments[0];return this._coordinateSequenceFactory.create(o)}}})},lr.prototype.getPrecisionModel=function(){return this._precisionModel},lr.prototype.createLinearRing=function(){if(arguments.length===0)return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Array){var r=arguments[0];return this.createLinearRing(r!==null?this.getCoordinateSequenceFactory().create(r):null)}if(Ne(arguments[0],je)){var o=arguments[0];return new Po(o,this)}}},lr.prototype.createMultiPolygon=function(){if(arguments.length===0)return new Zn(null,this);if(arguments.length===1){var r=arguments[0];return new Zn(r,this)}},lr.prototype.createMultiPoint=function(){if(arguments.length===0)return new Hs(null,this);if(arguments.length===1){if(arguments[0]instanceof Array){var r=arguments[0];return new Hs(r,this)}if(arguments[0]instanceof Array){var o=arguments[0];return this.createMultiPoint(o!==null?this.getCoordinateSequenceFactory().create(o):null)}if(Ne(arguments[0],je)){var c=arguments[0];if(c===null)return this.createMultiPoint(new Array(0).fill(null));for(var p=new Array(c.size()).fill(null),_=0;_<c.size();_++){var C=this.getCoordinateSequenceFactory().create(1,c.getDimension());Ri.copy(c,_,C,0,1),p[_]=this.createPoint(C)}return this.createMultiPoint(p)}}},lr.prototype.interfaces_=function(){return[A]},lr.prototype.getClass=function(){return lr},lr.toMultiPolygonArray=function(r){var o=new Array(r.size()).fill(null);return r.toArray(o)},lr.toGeometryArray=function(r){if(r===null)return null;var o=new Array(r.size()).fill(null);return r.toArray(o)},lr.getDefaultCoordinateSequenceFactory=function(){return In.instance()},lr.toMultiLineStringArray=function(r){var o=new Array(r.size()).fill(null);return r.toArray(o)},lr.toLineStringArray=function(r){var o=new Array(r.size()).fill(null);return r.toArray(o)},lr.toMultiPointArray=function(r){var o=new Array(r.size()).fill(null);return r.toArray(o)},lr.toLinearRingArray=function(r){var o=new Array(r.size()).fill(null);return r.toArray(o)},lr.toPointArray=function(r){var o=new Array(r.size()).fill(null);return r.toArray(o)},lr.toPolygonArray=function(r){var o=new Array(r.size()).fill(null);return r.toArray(o)},lr.createPointFromInternalCoord=function(r,o){return o.getPrecisionModel().makePrecise(r),o.getFactory().createPoint(r)},jo.serialVersionUID.get=function(){return-6820524753094096e3},Object.defineProperties(lr,jo);var Pr=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],Qn=function(r){this.geometryFactory=r||new lr};Qn.prototype.read=function(r){var o,c=(o=typeof r=="string"?JSON.parse(r):r).type;if(!to[c])throw new Error("Unknown GeoJSON type: "+o.type);return Pr.indexOf(c)!==-1?to[c].apply(this,[o.coordinates]):c==="GeometryCollection"?to[c].apply(this,[o.geometries]):to[c].apply(this,[o])},Qn.prototype.write=function(r){var o=r.getGeometryType();if(!eo[o])throw new Error("Geometry is not supported");return eo[o].apply(this,[r])};var to={Feature:function(r){var o={};for(var c in r)o[c]=r[c];if(r.geometry){var p=r.geometry.type;if(!to[p])throw new Error("Unknown GeoJSON type: "+r.type);o.geometry=this.read(r.geometry)}return r.bbox&&(o.bbox=to.bbox.apply(this,[r.bbox])),o},FeatureCollection:function(r){var o={};if(r.features){o.features=[];for(var c=0;c<r.features.length;++c)o.features.push(this.read(r.features[c]))}return r.bbox&&(o.bbox=this.parse.bbox.apply(this,[r.bbox])),o},coordinates:function(r){for(var o=[],c=0;c<r.length;++c){var p=r[c];o.push(new yt(p[0],p[1]))}return o},bbox:function(r){return this.geometryFactory.createLinearRing([new yt(r[0],r[1]),new yt(r[2],r[1]),new yt(r[2],r[3]),new yt(r[0],r[3]),new yt(r[0],r[1])])},Point:function(r){var o=new yt(r[0],r[1]);return this.geometryFactory.createPoint(o)},MultiPoint:function(r){for(var o=[],c=0;c<r.length;++c)o.push(to.Point.apply(this,[r[c]]));return this.geometryFactory.createMultiPoint(o)},LineString:function(r){var o=to.coordinates.apply(this,[r]);return this.geometryFactory.createLineString(o)},MultiLineString:function(r){for(var o=[],c=0;c<r.length;++c)o.push(to.LineString.apply(this,[r[c]]));return this.geometryFactory.createMultiLineString(o)},Polygon:function(r){for(var o=to.coordinates.apply(this,[r[0]]),c=this.geometryFactory.createLinearRing(o),p=[],_=1;_<r.length;++_){var C=r[_],R=to.coordinates.apply(this,[C]),$=this.geometryFactory.createLinearRing(R);p.push($)}return this.geometryFactory.createPolygon(c,p)},MultiPolygon:function(r){for(var o=[],c=0;c<r.length;++c){var p=r[c];o.push(to.Polygon.apply(this,[p]))}return this.geometryFactory.createMultiPolygon(o)},GeometryCollection:function(r){for(var o=[],c=0;c<r.length;++c){var p=r[c];o.push(this.read(p))}return this.geometryFactory.createGeometryCollection(o)}},eo={coordinate:function(r){return[r.x,r.y]},Point:function(r){return{type:"Point",coordinates:eo.coordinate.apply(this,[r.getCoordinate()])}},MultiPoint:function(r){for(var o=[],c=0;c<r._geometries.length;++c){var p=r._geometries[c],_=eo.Point.apply(this,[p]);o.push(_.coordinates)}return{type:"MultiPoint",coordinates:o}},LineString:function(r){for(var o=[],c=r.getCoordinates(),p=0;p<c.length;++p){var _=c[p];o.push(eo.coordinate.apply(this,[_]))}return{type:"LineString",coordinates:o}},MultiLineString:function(r){for(var o=[],c=0;c<r._geometries.length;++c){var p=r._geometries[c],_=eo.LineString.apply(this,[p]);o.push(_.coordinates)}return{type:"MultiLineString",coordinates:o}},Polygon:function(r){var o=[],c=eo.LineString.apply(this,[r._shell]);o.push(c.coordinates);for(var p=0;p<r._holes.length;++p){var _=r._holes[p],C=eo.LineString.apply(this,[_]);o.push(C.coordinates)}return{type:"Polygon",coordinates:o}},MultiPolygon:function(r){for(var o=[],c=0;c<r._geometries.length;++c){var p=r._geometries[c],_=eo.Polygon.apply(this,[p]);o.push(_.coordinates)}return{type:"MultiPolygon",coordinates:o}},GeometryCollection:function(r){for(var o=[],c=0;c<r._geometries.length;++c){var p=r._geometries[c],_=p.getGeometryType();o.push(eo[_].apply(this,[p]))}return{type:"GeometryCollection",geometries:o}}},bo=function(r){this.geometryFactory=r||new lr,this.precisionModel=this.geometryFactory.getPrecisionModel(),this.parser=new Qn(this.geometryFactory)};bo.prototype.read=function(r){var o=this.parser.read(r);return this.precisionModel.getType()===Or.FIXED&&this.reducePrecision(o),o},bo.prototype.reducePrecision=function(r){var o,c;if(r.coordinate)this.precisionModel.makePrecise(r.coordinate);else if(r.points)for(o=0,c=r.points.length;o<c;o++)this.precisionModel.makePrecise(r.points[o]);else if(r.geometries)for(o=0,c=r.geometries.length;o<c;o++)this.reducePrecision(r.geometries[o])};var Oi=function(){this.parser=new Qn(this.geometryFactory)};Oi.prototype.write=function(r){return this.parser.write(r)};var Ae=function(){},qo={ON:{configurable:!0},LEFT:{configurable:!0},RIGHT:{configurable:!0}};Ae.prototype.interfaces_=function(){return[]},Ae.prototype.getClass=function(){return Ae},Ae.opposite=function(r){return r===Ae.LEFT?Ae.RIGHT:r===Ae.RIGHT?Ae.LEFT:r},qo.ON.get=function(){return 0},qo.LEFT.get=function(){return 1},qo.RIGHT.get=function(){return 2},Object.defineProperties(Ae,qo),(Ge.prototype=new Error).name="EmptyStackException",(Mt.prototype=new ut).add=function(r){return this.array_.push(r),!0},Mt.prototype.get=function(r){if(r<0||r>=this.size())throw new Error;return this.array_[r]},Mt.prototype.push=function(r){return this.array_.push(r),r},Mt.prototype.pop=function(r){if(this.array_.length===0)throw new Ge;return this.array_.pop()},Mt.prototype.peek=function(){if(this.array_.length===0)throw new Ge;return this.array_[this.array_.length-1]},Mt.prototype.empty=function(){return this.array_.length===0},Mt.prototype.isEmpty=function(){return this.empty()},Mt.prototype.search=function(r){return this.array_.indexOf(r)},Mt.prototype.size=function(){return this.array_.length},Mt.prototype.toArray=function(){for(var r=[],o=0,c=this.array_.length;o<c;o++)r.push(this.array_[o]);return r};var ro=function(){this._minIndex=-1,this._minCoord=null,this._minDe=null,this._orientedDe=null};ro.prototype.getCoordinate=function(){return this._minCoord},ro.prototype.getRightmostSide=function(r,o){var c=this.getRightmostSideOfSegment(r,o);return c<0&&(c=this.getRightmostSideOfSegment(r,o-1)),c<0&&(this._minCoord=null,this.checkForRightmostCoordinate(r)),c},ro.prototype.findRightmostEdgeAtVertex=function(){var r=this._minDe.getEdge().getCoordinates();Z.isTrue(this._minIndex>0&&this._minIndex<r.length,"rightmost point expected to be interior vertex of edge");var o=r[this._minIndex-1],c=r[this._minIndex+1],p=kt.computeOrientation(this._minCoord,c,o),_=!1;(o.y<this._minCoord.y&&c.y<this._minCoord.y&&p===kt.COUNTERCLOCKWISE||o.y>this._minCoord.y&&c.y>this._minCoord.y&&p===kt.CLOCKWISE)&&(_=!0),_&&(this._minIndex=this._minIndex-1)},ro.prototype.getRightmostSideOfSegment=function(r,o){var c=r.getEdge().getCoordinates();if(o<0||o+1>=c.length||c[o].y===c[o+1].y)return-1;var p=Ae.LEFT;return c[o].y<c[o+1].y&&(p=Ae.RIGHT),p},ro.prototype.getEdge=function(){return this._orientedDe},ro.prototype.checkForRightmostCoordinate=function(r){for(var o=r.getEdge().getCoordinates(),c=0;c<o.length-1;c++)(this._minCoord===null||o[c].x>this._minCoord.x)&&(this._minDe=r,this._minIndex=c,this._minCoord=o[c])},ro.prototype.findRightmostEdgeAtNode=function(){var r=this._minDe.getNode().getEdges();this._minDe=r.getRightmostEdge(),this._minDe.isForward()||(this._minDe=this._minDe.getSym(),this._minIndex=this._minDe.getEdge().getCoordinates().length-1)},ro.prototype.findEdge=function(r){for(var o=r.iterator();o.hasNext();){var c=o.next();c.isForward()&&this.checkForRightmostCoordinate(c)}Z.isTrue(this._minIndex!==0||this._minCoord.equals(this._minDe.getCoordinate()),"inconsistency in rightmost processing"),this._minIndex===0?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex(),this._orientedDe=this._minDe,this.getRightmostSide(this._minDe,this._minIndex)===Ae.LEFT&&(this._orientedDe=this._minDe.getSym())},ro.prototype.interfaces_=function(){return[]},ro.prototype.getClass=function(){return ro};var wo=function(r){function o(c,p){r.call(this,o.msgWithCoord(c,p)),this.pt=p?new yt(p):null,this.name="TopologyException"}return r&&(o.__proto__=r),o.prototype=Object.create(r&&r.prototype),o.prototype.constructor=o,o.prototype.getCoordinate=function(){return this.pt},o.prototype.interfaces_=function(){return[]},o.prototype.getClass=function(){return o},o.msgWithCoord=function(c,p){return p?c:c+" [ "+p+" ]"},o}(zt),Da=function(){this.array_=[]};Da.prototype.addLast=function(r){this.array_.push(r)},Da.prototype.removeFirst=function(){return this.array_.shift()},Da.prototype.isEmpty=function(){return this.array_.length===0};var Dn=function(){this._finder=null,this._dirEdgeList=new et,this._nodes=new et,this._rightMostCoord=null,this._env=null,this._finder=new ro};Dn.prototype.clearVisitedEdges=function(){for(var r=this._dirEdgeList.iterator();r.hasNext();)r.next().setVisited(!1)},Dn.prototype.getRightmostCoordinate=function(){return this._rightMostCoord},Dn.prototype.computeNodeDepth=function(r){for(var o=null,c=r.getEdges().iterator();c.hasNext();){var p=c.next();if(p.isVisited()||p.getSym().isVisited()){o=p;break}}if(o===null)throw new wo("unable to find edge to compute depths at "+r.getCoordinate());r.getEdges().computeDepths(o);for(var _=r.getEdges().iterator();_.hasNext();){var C=_.next();C.setVisited(!0),this.copySymDepths(C)}},Dn.prototype.computeDepth=function(r){this.clearVisitedEdges();var o=this._finder.getEdge();o.setEdgeDepths(Ae.RIGHT,r),this.copySymDepths(o),this.computeDepths(o)},Dn.prototype.create=function(r){this.addReachable(r),this._finder.findEdge(this._dirEdgeList),this._rightMostCoord=this._finder.getCoordinate()},Dn.prototype.findResultEdges=function(){for(var r=this._dirEdgeList.iterator();r.hasNext();){var o=r.next();o.getDepth(Ae.RIGHT)>=1&&o.getDepth(Ae.LEFT)<=0&&!o.isInteriorAreaEdge()&&o.setInResult(!0)}},Dn.prototype.computeDepths=function(r){var o=new dr,c=new Da,p=r.getNode();for(c.addLast(p),o.add(p),r.setVisited(!0);!c.isEmpty();){var _=c.removeFirst();o.add(_),this.computeNodeDepth(_);for(var C=_.getEdges().iterator();C.hasNext();){var R=C.next().getSym();if(!R.isVisited()){var $=R.getNode();o.contains($)||(c.addLast($),o.add($))}}}},Dn.prototype.compareTo=function(r){var o=r;return this._rightMostCoord.x<o._rightMostCoord.x?-1:this._rightMostCoord.x>o._rightMostCoord.x?1:0},Dn.prototype.getEnvelope=function(){if(this._env===null){for(var r=new qe,o=this._dirEdgeList.iterator();o.hasNext();)for(var c=o.next().getEdge().getCoordinates(),p=0;p<c.length-1;p++)r.expandToInclude(c[p]);this._env=r}return this._env},Dn.prototype.addReachable=function(r){var o=new Mt;for(o.add(r);!o.empty();){var c=o.pop();this.add(c,o)}},Dn.prototype.copySymDepths=function(r){var o=r.getSym();o.setDepth(Ae.LEFT,r.getDepth(Ae.RIGHT)),o.setDepth(Ae.RIGHT,r.getDepth(Ae.LEFT))},Dn.prototype.add=function(r,o){r.setVisited(!0),this._nodes.add(r);for(var c=r.getEdges().iterator();c.hasNext();){var p=c.next();this._dirEdgeList.add(p);var _=p.getSym().getNode();_.isVisited()||o.push(_)}},Dn.prototype.getNodes=function(){return this._nodes},Dn.prototype.getDirectedEdges=function(){return this._dirEdgeList},Dn.prototype.interfaces_=function(){return[de]},Dn.prototype.getClass=function(){return Dn};var Jr=function r(){if(this.location=null,arguments.length===1){if(arguments[0]instanceof Array){var o=arguments[0];this.init(o.length)}else if(Number.isInteger(arguments[0])){var c=arguments[0];this.init(1),this.location[Ae.ON]=c}else if(arguments[0]instanceof r){var p=arguments[0];if(this.init(p.location.length),p!==null)for(var _=0;_<this.location.length;_++)this.location[_]=p.location[_]}}else if(arguments.length===3){var C=arguments[0],R=arguments[1],$=arguments[2];this.init(3),this.location[Ae.ON]=C,this.location[Ae.LEFT]=R,this.location[Ae.RIGHT]=$}};Jr.prototype.setAllLocations=function(r){for(var o=0;o<this.location.length;o++)this.location[o]=r},Jr.prototype.isNull=function(){for(var r=0;r<this.location.length;r++)if(this.location[r]!==wt.NONE)return!1;return!0},Jr.prototype.setAllLocationsIfNull=function(r){for(var o=0;o<this.location.length;o++)this.location[o]===wt.NONE&&(this.location[o]=r)},Jr.prototype.isLine=function(){return this.location.length===1},Jr.prototype.merge=function(r){if(r.location.length>this.location.length){var o=new Array(3).fill(null);o[Ae.ON]=this.location[Ae.ON],o[Ae.LEFT]=wt.NONE,o[Ae.RIGHT]=wt.NONE,this.location=o}for(var c=0;c<this.location.length;c++)this.location[c]===wt.NONE&&c<r.location.length&&(this.location[c]=r.location[c])},Jr.prototype.getLocations=function(){return this.location},Jr.prototype.flip=function(){if(this.location.length<=1)return null;var r=this.location[Ae.LEFT];this.location[Ae.LEFT]=this.location[Ae.RIGHT],this.location[Ae.RIGHT]=r},Jr.prototype.toString=function(){var r=new ti;return this.location.length>1&&r.append(wt.toLocationSymbol(this.location[Ae.LEFT])),r.append(wt.toLocationSymbol(this.location[Ae.ON])),this.location.length>1&&r.append(wt.toLocationSymbol(this.location[Ae.RIGHT])),r.toString()},Jr.prototype.setLocations=function(r,o,c){this.location[Ae.ON]=r,this.location[Ae.LEFT]=o,this.location[Ae.RIGHT]=c},Jr.prototype.get=function(r){return r<this.location.length?this.location[r]:wt.NONE},Jr.prototype.isArea=function(){return this.location.length>1},Jr.prototype.isAnyNull=function(){for(var r=0;r<this.location.length;r++)if(this.location[r]===wt.NONE)return!0;return!1},Jr.prototype.setLocation=function(){if(arguments.length===1){var r=arguments[0];this.setLocation(Ae.ON,r)}else if(arguments.length===2){var o=arguments[0],c=arguments[1];this.location[o]=c}},Jr.prototype.init=function(r){this.location=new Array(r).fill(null),this.setAllLocations(wt.NONE)},Jr.prototype.isEqualOnSide=function(r,o){return this.location[o]===r.location[o]},Jr.prototype.allPositionsEqual=function(r){for(var o=0;o<this.location.length;o++)if(this.location[o]!==r)return!1;return!0},Jr.prototype.interfaces_=function(){return[]},Jr.prototype.getClass=function(){return Jr};var qr=function r(){if(this.elt=new Array(2).fill(null),arguments.length===1){if(Number.isInteger(arguments[0])){var o=arguments[0];this.elt[0]=new Jr(o),this.elt[1]=new Jr(o)}else if(arguments[0]instanceof r){var c=arguments[0];this.elt[0]=new Jr(c.elt[0]),this.elt[1]=new Jr(c.elt[1])}}else if(arguments.length===2){var p=arguments[0],_=arguments[1];this.elt[0]=new Jr(wt.NONE),this.elt[1]=new Jr(wt.NONE),this.elt[p].setLocation(_)}else if(arguments.length===3){var C=arguments[0],R=arguments[1],$=arguments[2];this.elt[0]=new Jr(C,R,$),this.elt[1]=new Jr(C,R,$)}else if(arguments.length===4){var rt=arguments[0],bt=arguments[1],Yt=arguments[2],Ht=arguments[3];this.elt[0]=new Jr(wt.NONE,wt.NONE,wt.NONE),this.elt[1]=new Jr(wt.NONE,wt.NONE,wt.NONE),this.elt[rt].setLocations(bt,Yt,Ht)}};qr.prototype.getGeometryCount=function(){var r=0;return this.elt[0].isNull()||r++,this.elt[1].isNull()||r++,r},qr.prototype.setAllLocations=function(r,o){this.elt[r].setAllLocations(o)},qr.prototype.isNull=function(r){return this.elt[r].isNull()},qr.prototype.setAllLocationsIfNull=function(){if(arguments.length===1){var r=arguments[0];this.setAllLocationsIfNull(0,r),this.setAllLocationsIfNull(1,r)}else if(arguments.length===2){var o=arguments[0],c=arguments[1];this.elt[o].setAllLocationsIfNull(c)}},qr.prototype.isLine=function(r){return this.elt[r].isLine()},qr.prototype.merge=function(r){for(var o=0;o<2;o++)this.elt[o]===null&&r.elt[o]!==null?this.elt[o]=new Jr(r.elt[o]):this.elt[o].merge(r.elt[o])},qr.prototype.flip=function(){this.elt[0].flip(),this.elt[1].flip()},qr.prototype.getLocation=function(){if(arguments.length===1){var r=arguments[0];return this.elt[r].get(Ae.ON)}if(arguments.length===2){var o=arguments[0],c=arguments[1];return this.elt[o].get(c)}},qr.prototype.toString=function(){var r=new ti;return this.elt[0]!==null&&(r.append("A:"),r.append(this.elt[0].toString())),this.elt[1]!==null&&(r.append(" B:"),r.append(this.elt[1].toString())),r.toString()},qr.prototype.isArea=function(){if(arguments.length===0)return this.elt[0].isArea()||this.elt[1].isArea();if(arguments.length===1){var r=arguments[0];return this.elt[r].isArea()}},qr.prototype.isAnyNull=function(r){return this.elt[r].isAnyNull()},qr.prototype.setLocation=function(){if(arguments.length===2){var r=arguments[0],o=arguments[1];this.elt[r].setLocation(Ae.ON,o)}else if(arguments.length===3){var c=arguments[0],p=arguments[1],_=arguments[2];this.elt[c].setLocation(p,_)}},qr.prototype.isEqualOnSide=function(r,o){return this.elt[0].isEqualOnSide(r.elt[0],o)&&this.elt[1].isEqualOnSide(r.elt[1],o)},qr.prototype.allPositionsEqual=function(r,o){return this.elt[r].allPositionsEqual(o)},qr.prototype.toLine=function(r){this.elt[r].isArea()&&(this.elt[r]=new Jr(this.elt[r].location[0]))},qr.prototype.interfaces_=function(){return[]},qr.prototype.getClass=function(){return qr},qr.toLineLabel=function(r){for(var o=new qr(wt.NONE),c=0;c<2;c++)o.setLocation(c,r.getLocation(c));return o};var Ni=function(){this._startDe=null,this._maxNodeDegree=-1,this._edges=new et,this._pts=new et,this._label=new qr(wt.NONE),this._ring=null,this._isHole=null,this._shell=null,this._holes=new et,this._geometryFactory=null;var r=arguments[0],o=arguments[1];this._geometryFactory=o,this.computePoints(r),this.computeRing()};Ni.prototype.computeRing=function(){if(this._ring!==null)return null;for(var r=new Array(this._pts.size()).fill(null),o=0;o<this._pts.size();o++)r[o]=this._pts.get(o);this._ring=this._geometryFactory.createLinearRing(r),this._isHole=kt.isCCW(this._ring.getCoordinates())},Ni.prototype.isIsolated=function(){return this._label.getGeometryCount()===1},Ni.prototype.computePoints=function(r){this._startDe=r;var o=r,c=!0;do{if(o===null)throw new wo("Found null DirectedEdge");if(o.getEdgeRing()===this)throw new wo("Directed Edge visited twice during ring-building at "+o.getCoordinate());this._edges.add(o);var p=o.getLabel();Z.isTrue(p.isArea()),this.mergeLabel(p),this.addPoints(o.getEdge(),o.isForward(),c),c=!1,this.setEdgeRing(o,this),o=this.getNext(o)}while(o!==this._startDe)},Ni.prototype.getLinearRing=function(){return this._ring},Ni.prototype.getCoordinate=function(r){return this._pts.get(r)},Ni.prototype.computeMaxNodeDegree=function(){this._maxNodeDegree=0;var r=this._startDe;do{var o=r.getNode().getEdges().getOutgoingDegree(this);o>this._maxNodeDegree&&(this._maxNodeDegree=o),r=this.getNext(r)}while(r!==this._startDe);this._maxNodeDegree*=2},Ni.prototype.addPoints=function(r,o,c){var p=r.getCoordinates();if(o){var _=1;c&&(_=0);for(var C=_;C<p.length;C++)this._pts.add(p[C])}else{var R=p.length-2;c&&(R=p.length-1);for(var $=R;$>=0;$--)this._pts.add(p[$])}},Ni.prototype.isHole=function(){return this._isHole},Ni.prototype.setInResult=function(){var r=this._startDe;do r.getEdge().setInResult(!0),r=r.getNext();while(r!==this._startDe)},Ni.prototype.containsPoint=function(r){var o=this.getLinearRing();if(!o.getEnvelopeInternal().contains(r)||!kt.isPointInRing(r,o.getCoordinates()))return!1;for(var c=this._holes.iterator();c.hasNext();)if(c.next().containsPoint(r))return!1;return!0},Ni.prototype.addHole=function(r){this._holes.add(r)},Ni.prototype.isShell=function(){return this._shell===null},Ni.prototype.getLabel=function(){return this._label},Ni.prototype.getEdges=function(){return this._edges},Ni.prototype.getMaxNodeDegree=function(){return this._maxNodeDegree<0&&this.computeMaxNodeDegree(),this._maxNodeDegree},Ni.prototype.getShell=function(){return this._shell},Ni.prototype.mergeLabel=function(){if(arguments.length===1){var r=arguments[0];this.mergeLabel(r,0),this.mergeLabel(r,1)}else if(arguments.length===2){var o=arguments[0],c=arguments[1],p=o.getLocation(c,Ae.RIGHT);if(p===wt.NONE)return null;if(this._label.getLocation(c)===wt.NONE)return this._label.setLocation(c,p),null}},Ni.prototype.setShell=function(r){this._shell=r,r!==null&&r.addHole(this)},Ni.prototype.toPolygon=function(r){for(var o=new Array(this._holes.size()).fill(null),c=0;c<this._holes.size();c++)o[c]=this._holes.get(c).getLinearRing();return r.createPolygon(this.getLinearRing(),o)},Ni.prototype.interfaces_=function(){return[]},Ni.prototype.getClass=function(){return Ni};var Ra=function(r){function o(){var c=arguments[0],p=arguments[1];r.call(this,c,p)}return r&&(o.__proto__=r),o.prototype=Object.create(r&&r.prototype),o.prototype.constructor=o,o.prototype.setEdgeRing=function(c,p){c.setMinEdgeRing(p)},o.prototype.getNext=function(c){return c.getNextMin()},o.prototype.interfaces_=function(){return[]},o.prototype.getClass=function(){return o},o}(Ni),Eo=function(r){function o(){var c=arguments[0],p=arguments[1];r.call(this,c,p)}return r&&(o.__proto__=r),o.prototype=Object.create(r&&r.prototype),o.prototype.constructor=o,o.prototype.buildMinimalRings=function(){var c=new et,p=this._startDe;do{if(p.getMinEdgeRing()===null){var _=new Ra(p,this._geometryFactory);c.add(_)}p=p.getNext()}while(p!==this._startDe);return c},o.prototype.setEdgeRing=function(c,p){c.setEdgeRing(p)},o.prototype.linkDirectedEdgesForMinimalEdgeRings=function(){var c=this._startDe;do c.getNode().getEdges().linkMinimalDirectedEdges(this),c=c.getNext();while(c!==this._startDe)},o.prototype.getNext=function(c){return c.getNext()},o.prototype.interfaces_=function(){return[]},o.prototype.getClass=function(){return o},o}(Ni),Yr=function(){if(this._label=null,this._isInResult=!1,this._isCovered=!1,this._isCoveredSet=!1,this._isVisited=!1,arguments.length!==0){if(arguments.length===1){var r=arguments[0];this._label=r}}};Yr.prototype.setVisited=function(r){this._isVisited=r},Yr.prototype.setInResult=function(r){this._isInResult=r},Yr.prototype.isCovered=function(){return this._isCovered},Yr.prototype.isCoveredSet=function(){return this._isCoveredSet},Yr.prototype.setLabel=function(r){this._label=r},Yr.prototype.getLabel=function(){return this._label},Yr.prototype.setCovered=function(r){this._isCovered=r,this._isCoveredSet=!0},Yr.prototype.updateIM=function(r){Z.isTrue(this._label.getGeometryCount()>=2,"found partial label"),this.computeIM(r)},Yr.prototype.isInResult=function(){return this._isInResult},Yr.prototype.isVisited=function(){return this._isVisited},Yr.prototype.interfaces_=function(){return[]},Yr.prototype.getClass=function(){return Yr};var Oa=function(r){function o(){r.call(this),this._coord=null,this._edges=null;var c=arguments[0],p=arguments[1];this._coord=c,this._edges=p,this._label=new qr(0,wt.NONE)}return r&&(o.__proto__=r),o.prototype=Object.create(r&&r.prototype),o.prototype.constructor=o,o.prototype.isIncidentEdgeInResult=function(){for(var c=this.getEdges().getEdges().iterator();c.hasNext();)if(c.next().getEdge().isInResult())return!0;return!1},o.prototype.isIsolated=function(){return this._label.getGeometryCount()===1},o.prototype.getCoordinate=function(){return this._coord},o.prototype.print=function(c){c.println("node "+this._coord+" lbl: "+this._label)},o.prototype.computeIM=function(c){},o.prototype.computeMergedLocation=function(c,p){var _=wt.NONE;if(_=this._label.getLocation(p),!c.isNull(p)){var C=c.getLocation(p);_!==wt.BOUNDARY&&(_=C)}return _},o.prototype.setLabel=function(){if(arguments.length!==2)return r.prototype.setLabel.apply(this,arguments);var c=arguments[0],p=arguments[1];this._label===null?this._label=new qr(c,p):this._label.setLocation(c,p)},o.prototype.getEdges=function(){return this._edges},o.prototype.mergeLabel=function(){if(arguments[0]instanceof o){var c=arguments[0];this.mergeLabel(c._label)}else if(arguments[0]instanceof qr)for(var p=arguments[0],_=0;_<2;_++){var C=this.computeMergedLocation(p,_);this._label.getLocation(_)===wt.NONE&&this._label.setLocation(_,C)}},o.prototype.add=function(c){this._edges.insert(c),c.setNode(this)},o.prototype.setLabelBoundary=function(c){if(this._label===null)return null;var p=wt.NONE;this._label!==null&&(p=this._label.getLocation(c));var _=null;switch(p){case wt.BOUNDARY:_=wt.INTERIOR;break;case wt.INTERIOR:default:_=wt.BOUNDARY}this._label.setLocation(c,_)},o.prototype.interfaces_=function(){return[]},o.prototype.getClass=function(){return o},o}(Yr),To=function(){this.nodeMap=new qt,this.nodeFact=null;var r=arguments[0];this.nodeFact=r};To.prototype.find=function(r){return this.nodeMap.get(r)},To.prototype.addNode=function(){if(arguments[0]instanceof yt){var r=arguments[0],o=this.nodeMap.get(r);return o===null&&(o=this.nodeFact.createNode(r),this.nodeMap.put(r,o)),o}if(arguments[0]instanceof Oa){var c=arguments[0],p=this.nodeMap.get(c.getCoordinate());return p===null?(this.nodeMap.put(c.getCoordinate(),c),c):(p.mergeLabel(c),p)}},To.prototype.print=function(r){for(var o=this.iterator();o.hasNext();)o.next().print(r)},To.prototype.iterator=function(){return this.nodeMap.values().iterator()},To.prototype.values=function(){return this.nodeMap.values()},To.prototype.getBoundaryNodes=function(r){for(var o=new et,c=this.iterator();c.hasNext();){var p=c.next();p.getLabel().getLocation(r)===wt.BOUNDARY&&o.add(p)}return o},To.prototype.add=function(r){var o=r.getCoordinate();this.addNode(o).add(r)},To.prototype.interfaces_=function(){return[]},To.prototype.getClass=function(){return To};var br=function(){},io={NE:{configurable:!0},NW:{configurable:!0},SW:{configurable:!0},SE:{configurable:!0}};br.prototype.interfaces_=function(){return[]},br.prototype.getClass=function(){return br},br.isNorthern=function(r){return r===br.NE||r===br.NW},br.isOpposite=function(r,o){return r===o?!1:(r-o+4)%4===2},br.commonHalfPlane=function(r,o){if(r===o)return r;if((r-o+4)%4===2)return-1;var c=r<o?r:o;return c===0&&(r>o?r:o)===3?3:c},br.isInHalfPlane=function(r,o){return o===br.SE?r===br.SE||r===br.SW:r===o||r===o+1},br.quadrant=function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var r=arguments[0],o=arguments[1];if(r===0&&o===0)throw new Et("Cannot compute the quadrant for point ( "+r+", "+o+" )");return r>=0?o>=0?br.NE:br.SE:o>=0?br.NW:br.SW}if(arguments[0]instanceof yt&&arguments[1]instanceof yt){var c=arguments[0],p=arguments[1];if(p.x===c.x&&p.y===c.y)throw new Et("Cannot compute the quadrant for two identical points "+c);return p.x>=c.x?p.y>=c.y?br.NE:br.SE:p.y>=c.y?br.NW:br.SW}},io.NE.get=function(){return 0},io.NW.get=function(){return 1},io.SW.get=function(){return 2},io.SE.get=function(){return 3},Object.defineProperties(br,io);var Sn=function(){if(this._edge=null,this._label=null,this._node=null,this._p0=null,this._p1=null,this._dx=null,this._dy=null,this._quadrant=null,arguments.length===1){var r=arguments[0];this._edge=r}else if(arguments.length===3){var o=arguments[0],c=arguments[1],p=arguments[2];this._edge=o,this.init(c,p),this._label=null}else if(arguments.length===4){var _=arguments[0],C=arguments[1],R=arguments[2],$=arguments[3];this._edge=_,this.init(C,R),this._label=$}};Sn.prototype.compareDirection=function(r){return this._dx===r._dx&&this._dy===r._dy?0:this._quadrant>r._quadrant?1:this._quadrant<r._quadrant?-1:kt.computeOrientation(r._p0,r._p1,this._p1)},Sn.prototype.getDy=function(){return this._dy},Sn.prototype.getCoordinate=function(){return this._p0},Sn.prototype.setNode=function(r){this._node=r},Sn.prototype.print=function(r){var o=Math.atan2(this._dy,this._dx),c=this.getClass().getName(),p=c.lastIndexOf("."),_=c.substring(p+1);r.print("  "+_+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+o+"   "+this._label)},Sn.prototype.compareTo=function(r){var o=r;return this.compareDirection(o)},Sn.prototype.getDirectedCoordinate=function(){return this._p1},Sn.prototype.getDx=function(){return this._dx},Sn.prototype.getLabel=function(){return this._label},Sn.prototype.getEdge=function(){return this._edge},Sn.prototype.getQuadrant=function(){return this._quadrant},Sn.prototype.getNode=function(){return this._node},Sn.prototype.toString=function(){var r=Math.atan2(this._dy,this._dx),o=this.getClass().getName(),c=o.lastIndexOf(".");return"  "+o.substring(c+1)+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+r+"   "+this._label},Sn.prototype.computeLabel=function(r){},Sn.prototype.init=function(r,o){this._p0=r,this._p1=o,this._dx=o.x-r.x,this._dy=o.y-r.y,this._quadrant=br.quadrant(this._dx,this._dy),Z.isTrue(!(this._dx===0&&this._dy===0),"EdgeEnd with identical endpoints found")},Sn.prototype.interfaces_=function(){return[de]},Sn.prototype.getClass=function(){return Sn};var da=function(r){function o(){var c=arguments[0],p=arguments[1];if(r.call(this,c),this._isForward=null,this._isInResult=!1,this._isVisited=!1,this._sym=null,this._next=null,this._nextMin=null,this._edgeRing=null,this._minEdgeRing=null,this._depth=[0,-999,-999],this._isForward=p,p)this.init(c.getCoordinate(0),c.getCoordinate(1));else{var _=c.getNumPoints()-1;this.init(c.getCoordinate(_),c.getCoordinate(_-1))}this.computeDirectedLabel()}return r&&(o.__proto__=r),o.prototype=Object.create(r&&r.prototype),o.prototype.constructor=o,o.prototype.getNextMin=function(){return this._nextMin},o.prototype.getDepth=function(c){return this._depth[c]},o.prototype.setVisited=function(c){this._isVisited=c},o.prototype.computeDirectedLabel=function(){this._label=new qr(this._edge.getLabel()),this._isForward||this._label.flip()},o.prototype.getNext=function(){return this._next},o.prototype.setDepth=function(c,p){if(this._depth[c]!==-999&&this._depth[c]!==p)throw new wo("assigned depths do not match",this.getCoordinate());this._depth[c]=p},o.prototype.isInteriorAreaEdge=function(){for(var c=!0,p=0;p<2;p++)this._label.isArea(p)&&this._label.getLocation(p,Ae.LEFT)===wt.INTERIOR&&this._label.getLocation(p,Ae.RIGHT)===wt.INTERIOR||(c=!1);return c},o.prototype.setNextMin=function(c){this._nextMin=c},o.prototype.print=function(c){r.prototype.print.call(this,c),c.print(" "+this._depth[Ae.LEFT]+"/"+this._depth[Ae.RIGHT]),c.print(" ("+this.getDepthDelta()+")"),this._isInResult&&c.print(" inResult")},o.prototype.setMinEdgeRing=function(c){this._minEdgeRing=c},o.prototype.isLineEdge=function(){var c=this._label.isLine(0)||this._label.isLine(1),p=!this._label.isArea(0)||this._label.allPositionsEqual(0,wt.EXTERIOR),_=!this._label.isArea(1)||this._label.allPositionsEqual(1,wt.EXTERIOR);return c&&p&&_},o.prototype.setEdgeRing=function(c){this._edgeRing=c},o.prototype.getMinEdgeRing=function(){return this._minEdgeRing},o.prototype.getDepthDelta=function(){var c=this._edge.getDepthDelta();return this._isForward||(c=-c),c},o.prototype.setInResult=function(c){this._isInResult=c},o.prototype.getSym=function(){return this._sym},o.prototype.isForward=function(){return this._isForward},o.prototype.getEdge=function(){return this._edge},o.prototype.printEdge=function(c){this.print(c),c.print(" "),this._isForward?this._edge.print(c):this._edge.printReverse(c)},o.prototype.setSym=function(c){this._sym=c},o.prototype.setVisitedEdge=function(c){this.setVisited(c),this._sym.setVisited(c)},o.prototype.setEdgeDepths=function(c,p){var _=this.getEdge().getDepthDelta();this._isForward||(_=-_);var C=1;c===Ae.LEFT&&(C=-1);var R=Ae.opposite(c),$=p+_*C;this.setDepth(c,p),this.setDepth(R,$)},o.prototype.getEdgeRing=function(){return this._edgeRing},o.prototype.isInResult=function(){return this._isInResult},o.prototype.setNext=function(c){this._next=c},o.prototype.isVisited=function(){return this._isVisited},o.prototype.interfaces_=function(){return[]},o.prototype.getClass=function(){return o},o.depthFactor=function(c,p){return c===wt.EXTERIOR&&p===wt.INTERIOR?1:c===wt.INTERIOR&&p===wt.EXTERIOR?-1:0},o}(Sn),xi=function(){};xi.prototype.createNode=function(r){return new Oa(r,null)},xi.prototype.interfaces_=function(){return[]},xi.prototype.getClass=function(){return xi};var li=function(){if(this._edges=new et,this._nodes=null,this._edgeEndList=new et,arguments.length===0)this._nodes=new To(new xi);else if(arguments.length===1){var r=arguments[0];this._nodes=new To(r)}};li.prototype.printEdges=function(r){r.println("Edges:");for(var o=0;o<this._edges.size();o++){r.println("edge "+o+":");var c=this._edges.get(o);c.print(r),c.eiList.print(r)}},li.prototype.find=function(r){return this._nodes.find(r)},li.prototype.addNode=function(){if(arguments[0]instanceof Oa){var r=arguments[0];return this._nodes.addNode(r)}if(arguments[0]instanceof yt){var o=arguments[0];return this._nodes.addNode(o)}},li.prototype.getNodeIterator=function(){return this._nodes.iterator()},li.prototype.linkResultDirectedEdges=function(){for(var r=this._nodes.iterator();r.hasNext();)r.next().getEdges().linkResultDirectedEdges()},li.prototype.debugPrintln=function(r){Br.out.println(r)},li.prototype.isBoundaryNode=function(r,o){var c=this._nodes.find(o);if(c===null)return!1;var p=c.getLabel();return p!==null&&p.getLocation(r)===wt.BOUNDARY},li.prototype.linkAllDirectedEdges=function(){for(var r=this._nodes.iterator();r.hasNext();)r.next().getEdges().linkAllDirectedEdges()},li.prototype.matchInSameDirection=function(r,o,c,p){return!!r.equals(c)&&kt.computeOrientation(r,o,p)===kt.COLLINEAR&&br.quadrant(r,o)===br.quadrant(c,p)},li.prototype.getEdgeEnds=function(){return this._edgeEndList},li.prototype.debugPrint=function(r){Br.out.print(r)},li.prototype.getEdgeIterator=function(){return this._edges.iterator()},li.prototype.findEdgeInSameDirection=function(r,o){for(var c=0;c<this._edges.size();c++){var p=this._edges.get(c),_=p.getCoordinates();if(this.matchInSameDirection(r,o,_[0],_[1])||this.matchInSameDirection(r,o,_[_.length-1],_[_.length-2]))return p}return null},li.prototype.insertEdge=function(r){this._edges.add(r)},li.prototype.findEdgeEnd=function(r){for(var o=this.getEdgeEnds().iterator();o.hasNext();){var c=o.next();if(c.getEdge()===r)return c}return null},li.prototype.addEdges=function(r){for(var o=r.iterator();o.hasNext();){var c=o.next();this._edges.add(c);var p=new da(c,!0),_=new da(c,!1);p.setSym(_),_.setSym(p),this.add(p),this.add(_)}},li.prototype.add=function(r){this._nodes.add(r),this._edgeEndList.add(r)},li.prototype.getNodes=function(){return this._nodes.values()},li.prototype.findEdge=function(r,o){for(var c=0;c<this._edges.size();c++){var p=this._edges.get(c),_=p.getCoordinates();if(r.equals(_[0])&&o.equals(_[1]))return p}return null},li.prototype.interfaces_=function(){return[]},li.prototype.getClass=function(){return li},li.linkResultDirectedEdges=function(r){for(var o=r.iterator();o.hasNext();)o.next().getEdges().linkResultDirectedEdges()};var jn=function(){this._geometryFactory=null,this._shellList=new et;var r=arguments[0];this._geometryFactory=r};jn.prototype.sortShellsAndHoles=function(r,o,c){for(var p=r.iterator();p.hasNext();){var _=p.next();_.isHole()?c.add(_):o.add(_)}},jn.prototype.computePolygons=function(r){for(var o=new et,c=r.iterator();c.hasNext();){var p=c.next().toPolygon(this._geometryFactory);o.add(p)}return o},jn.prototype.placeFreeHoles=function(r,o){for(var c=o.iterator();c.hasNext();){var p=c.next();if(p.getShell()===null){var _=this.findEdgeRingContaining(p,r);if(_===null)throw new wo("unable to assign hole to a shell",p.getCoordinate(0));p.setShell(_)}}},jn.prototype.buildMinimalEdgeRings=function(r,o,c){for(var p=new et,_=r.iterator();_.hasNext();){var C=_.next();if(C.getMaxNodeDegree()>2){C.linkDirectedEdgesForMinimalEdgeRings();var R=C.buildMinimalRings(),$=this.findShell(R);$!==null?(this.placePolygonHoles($,R),o.add($)):c.addAll(R)}else p.add(C)}return p},jn.prototype.containsPoint=function(r){for(var o=this._shellList.iterator();o.hasNext();)if(o.next().containsPoint(r))return!0;return!1},jn.prototype.buildMaximalEdgeRings=function(r){for(var o=new et,c=r.iterator();c.hasNext();){var p=c.next();if(p.isInResult()&&p.getLabel().isArea()&&p.getEdgeRing()===null){var _=new Eo(p,this._geometryFactory);o.add(_),_.setInResult()}}return o},jn.prototype.placePolygonHoles=function(r,o){for(var c=o.iterator();c.hasNext();){var p=c.next();p.isHole()&&p.setShell(r)}},jn.prototype.getPolygons=function(){return this.computePolygons(this._shellList)},jn.prototype.findEdgeRingContaining=function(r,o){for(var c=r.getLinearRing(),p=c.getEnvelopeInternal(),_=c.getCoordinateN(0),C=null,R=null,$=o.iterator();$.hasNext();){var rt=$.next(),bt=rt.getLinearRing(),Yt=bt.getEnvelopeInternal();C!==null&&(R=C.getLinearRing().getEnvelopeInternal());var Ht=!1;Yt.contains(p)&&kt.isPointInRing(_,bt.getCoordinates())&&(Ht=!0),Ht&&(C===null||R.contains(Yt))&&(C=rt)}return C},jn.prototype.findShell=function(r){for(var o=0,c=null,p=r.iterator();p.hasNext();){var _=p.next();_.isHole()||(c=_,o++)}return Z.isTrue(o<=1,"found two shells in MinimalEdgeRing list"),c},jn.prototype.add=function(){if(arguments.length===1){var r=arguments[0];this.add(r.getEdgeEnds(),r.getNodes())}else if(arguments.length===2){var o=arguments[0],c=arguments[1];li.linkResultDirectedEdges(c);var p=this.buildMaximalEdgeRings(o),_=new et,C=this.buildMinimalEdgeRings(p,this._shellList,_);this.sortShellsAndHoles(C,this._shellList,_),this.placeFreeHoles(this._shellList,_)}},jn.prototype.interfaces_=function(){return[]},jn.prototype.getClass=function(){return jn};var $o=function(){};$o.prototype.getBounds=function(){},$o.prototype.interfaces_=function(){return[]},$o.prototype.getClass=function(){return $o};var mi=function(){this._bounds=null,this._item=null;var r=arguments[0],o=arguments[1];this._bounds=r,this._item=o};mi.prototype.getItem=function(){return this._item},mi.prototype.getBounds=function(){return this._bounds},mi.prototype.interfaces_=function(){return[$o,A]},mi.prototype.getClass=function(){return mi};var Xo=function(){this._size=null,this._items=null,this._size=0,this._items=new et,this._items.add(null)};Xo.prototype.poll=function(){if(this.isEmpty())return null;var r=this._items.get(1);return this._items.set(1,this._items.get(this._size)),this._size-=1,this.reorder(1),r},Xo.prototype.size=function(){return this._size},Xo.prototype.reorder=function(r){for(var o=null,c=this._items.get(r);2*r<=this._size&&((o=2*r)!==this._size&&this._items.get(o+1).compareTo(this._items.get(o))<0&&o++,this._items.get(o).compareTo(c)<0);r=o)this._items.set(r,this._items.get(o));this._items.set(r,c)},Xo.prototype.clear=function(){this._size=0,this._items.clear()},Xo.prototype.isEmpty=function(){return this._size===0},Xo.prototype.add=function(r){this._items.add(null),this._size+=1;var o=this._size;for(this._items.set(0,r);r.compareTo(this._items.get(Math.trunc(o/2)))<0;o/=2)this._items.set(o,this._items.get(Math.trunc(o/2)));this._items.set(o,r)},Xo.prototype.interfaces_=function(){return[]},Xo.prototype.getClass=function(){return Xo};var ps=function(){};ps.prototype.visitItem=function(r){},ps.prototype.interfaces_=function(){return[]},ps.prototype.getClass=function(){return ps};var ho=function(){};ho.prototype.insert=function(r,o){},ho.prototype.remove=function(r,o){},ho.prototype.query=function(){},ho.prototype.interfaces_=function(){return[]},ho.prototype.getClass=function(){return ho};var di=function(){if(this._childBoundables=new et,this._bounds=null,this._level=null,arguments.length!==0){if(arguments.length===1){var r=arguments[0];this._level=r}}},Ja={serialVersionUID:{configurable:!0}};di.prototype.getLevel=function(){return this._level},di.prototype.size=function(){return this._childBoundables.size()},di.prototype.getChildBoundables=function(){return this._childBoundables},di.prototype.addChildBoundable=function(r){Z.isTrue(this._bounds===null),this._childBoundables.add(r)},di.prototype.isEmpty=function(){return this._childBoundables.isEmpty()},di.prototype.getBounds=function(){return this._bounds===null&&(this._bounds=this.computeBounds()),this._bounds},di.prototype.interfaces_=function(){return[$o,A]},di.prototype.getClass=function(){return di},Ja.serialVersionUID.get=function(){return 6493722185909574e3},Object.defineProperties(di,Ja);var Do=function(){};Do.reverseOrder=function(){return{compare:function(r,o){return o.compareTo(r)}}},Do.min=function(r){return Do.sort(r),r.get(0)},Do.sort=function(r,o){var c=r.toArray();o?ni.sort(c,o):ni.sort(c);for(var p=r.iterator(),_=0,C=c.length;_<C;_++)p.next(),p.set(c[_])},Do.singletonList=function(r){var o=new et;return o.add(r),o};var ji=function(){this._boundable1=null,this._boundable2=null,this._distance=null,this._itemDistance=null;var r=arguments[0],o=arguments[1],c=arguments[2];this._boundable1=r,this._boundable2=o,this._itemDistance=c,this._distance=this.distance()};ji.prototype.expandToQueue=function(r,o){var c=ji.isComposite(this._boundable1),p=ji.isComposite(this._boundable2);if(c&&p)return ji.area(this._boundable1)>ji.area(this._boundable2)?(this.expand(this._boundable1,this._boundable2,r,o),null):(this.expand(this._boundable2,this._boundable1,r,o),null);if(c)return this.expand(this._boundable1,this._boundable2,r,o),null;if(p)return this.expand(this._boundable2,this._boundable1,r,o),null;throw new Et("neither boundable is composite")},ji.prototype.isLeaves=function(){return!(ji.isComposite(this._boundable1)||ji.isComposite(this._boundable2))},ji.prototype.compareTo=function(r){var o=r;return this._distance<o._distance?-1:this._distance>o._distance?1:0},ji.prototype.expand=function(r,o,c,p){for(var _=r.getChildBoundables().iterator();_.hasNext();){var C=_.next(),R=new ji(C,o,this._itemDistance);R.getDistance()<p&&c.add(R)}},ji.prototype.getBoundable=function(r){return r===0?this._boundable1:this._boundable2},ji.prototype.getDistance=function(){return this._distance},ji.prototype.distance=function(){return this.isLeaves()?this._itemDistance.distance(this._boundable1,this._boundable2):this._boundable1.getBounds().distance(this._boundable2.getBounds())},ji.prototype.interfaces_=function(){return[de]},ji.prototype.getClass=function(){return ji},ji.area=function(r){return r.getBounds().getArea()},ji.isComposite=function(r){return r instanceof di};var qi=function r(){if(this._root=null,this._built=!1,this._itemBoundables=new et,this._nodeCapacity=null,arguments.length===0){var o=r.DEFAULT_NODE_CAPACITY;this._nodeCapacity=o}else if(arguments.length===1){var c=arguments[0];Z.isTrue(c>1,"Node capacity must be greater than 1"),this._nodeCapacity=c}},Ro={IntersectsOp:{configurable:!0},serialVersionUID:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};qi.prototype.getNodeCapacity=function(){return this._nodeCapacity},qi.prototype.lastNode=function(r){return r.get(r.size()-1)},qi.prototype.size=function(){if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.size(this._root));if(arguments.length===1){for(var r=0,o=arguments[0].getChildBoundables().iterator();o.hasNext();){var c=o.next();c instanceof di?r+=this.size(c):c instanceof mi&&(r+=1)}return r}},qi.prototype.removeItem=function(r,o){for(var c=null,p=r.getChildBoundables().iterator();p.hasNext();){var _=p.next();_ instanceof mi&&_.getItem()===o&&(c=_)}return c!==null&&(r.getChildBoundables().remove(c),!0)},qi.prototype.itemsTree=function(){if(arguments.length===0){this.build();var r=this.itemsTree(this._root);return r===null?new et:r}if(arguments.length===1){for(var o=arguments[0],c=new et,p=o.getChildBoundables().iterator();p.hasNext();){var _=p.next();if(_ instanceof di){var C=this.itemsTree(_);C!==null&&c.add(C)}else _ instanceof mi?c.add(_.getItem()):Z.shouldNeverReachHere()}return c.size()<=0?null:c}},qi.prototype.insert=function(r,o){Z.isTrue(!this._built,"Cannot insert items into an STR packed R-tree after it has been built."),this._itemBoundables.add(new mi(r,o))},qi.prototype.boundablesAtLevel=function(){if(arguments.length===1){var r=arguments[0],o=new et;return this.boundablesAtLevel(r,this._root,o),o}if(arguments.length===3){var c=arguments[0],p=arguments[1],_=arguments[2];if(Z.isTrue(c>-2),p.getLevel()===c)return _.add(p),null;for(var C=p.getChildBoundables().iterator();C.hasNext();){var R=C.next();R instanceof di?this.boundablesAtLevel(c,R,_):(Z.isTrue(R instanceof mi),c===-1&&_.add(R))}return null}},qi.prototype.query=function(){if(arguments.length===1){var r=arguments[0];this.build();var o=new et;return this.isEmpty()||this.getIntersectsOp().intersects(this._root.getBounds(),r)&&this.query(r,this._root,o),o}if(arguments.length===2){var c=arguments[0],p=arguments[1];if(this.build(),this.isEmpty())return null;this.getIntersectsOp().intersects(this._root.getBounds(),c)&&this.query(c,this._root,p)}else if(arguments.length===3){if(Ne(arguments[2],ps)&&arguments[0]instanceof Object&&arguments[1]instanceof di)for(var _=arguments[0],C=arguments[1],R=arguments[2],$=C.getChildBoundables(),rt=0;rt<$.size();rt++){var bt=$.get(rt);this.getIntersectsOp().intersects(bt.getBounds(),_)&&(bt instanceof di?this.query(_,bt,R):bt instanceof mi?R.visitItem(bt.getItem()):Z.shouldNeverReachHere())}else if(Ne(arguments[2],ut)&&arguments[0]instanceof Object&&arguments[1]instanceof di)for(var Yt=arguments[0],Ht=arguments[1],Re=arguments[2],ze=Ht.getChildBoundables(),Ve=0;Ve<ze.size();Ve++){var We=ze.get(Ve);this.getIntersectsOp().intersects(We.getBounds(),Yt)&&(We instanceof di?this.query(Yt,We,Re):We instanceof mi?Re.add(We.getItem()):Z.shouldNeverReachHere())}}},qi.prototype.build=function(){if(this._built)return null;this._root=this._itemBoundables.isEmpty()?this.createNode(0):this.createHigherLevels(this._itemBoundables,-1),this._itemBoundables=null,this._built=!0},qi.prototype.getRoot=function(){return this.build(),this._root},qi.prototype.remove=function(){if(arguments.length===2){var r=arguments[0],o=arguments[1];return this.build(),!!this.getIntersectsOp().intersects(this._root.getBounds(),r)&&this.remove(r,this._root,o)}if(arguments.length===3){var c=arguments[0],p=arguments[1],_=arguments[2],C=this.removeItem(p,_);if(C)return!0;for(var R=null,$=p.getChildBoundables().iterator();$.hasNext();){var rt=$.next();if(this.getIntersectsOp().intersects(rt.getBounds(),c)&&rt instanceof di&&(C=this.remove(c,rt,_))){R=rt;break}}return R!==null&&R.getChildBoundables().isEmpty()&&p.getChildBoundables().remove(R),C}},qi.prototype.createHigherLevels=function(r,o){Z.isTrue(!r.isEmpty());var c=this.createParentBoundables(r,o+1);return c.size()===1?c.get(0):this.createHigherLevels(c,o+1)},qi.prototype.depth=function(){if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.depth(this._root));if(arguments.length===1){for(var r=0,o=arguments[0].getChildBoundables().iterator();o.hasNext();){var c=o.next();if(c instanceof di){var p=this.depth(c);p>r&&(r=p)}}return r+1}},qi.prototype.createParentBoundables=function(r,o){Z.isTrue(!r.isEmpty());var c=new et;c.add(this.createNode(o));var p=new et(r);Do.sort(p,this.getComparator());for(var _=p.iterator();_.hasNext();){var C=_.next();this.lastNode(c).getChildBoundables().size()===this.getNodeCapacity()&&c.add(this.createNode(o)),this.lastNode(c).addChildBoundable(C)}return c},qi.prototype.isEmpty=function(){return this._built?this._root.isEmpty():this._itemBoundables.isEmpty()},qi.prototype.interfaces_=function(){return[A]},qi.prototype.getClass=function(){return qi},qi.compareDoubles=function(r,o){return r>o?1:r<o?-1:0},Ro.IntersectsOp.get=function(){return Bl},Ro.serialVersionUID.get=function(){return-3886435814360241e3},Ro.DEFAULT_NODE_CAPACITY.get=function(){return 10},Object.defineProperties(qi,Ro);var Bl=function(){},Zo=function(){};Zo.prototype.distance=function(r,o){},Zo.prototype.interfaces_=function(){return[]},Zo.prototype.getClass=function(){return Zo};var bs=function(r){function o(p){p=p||o.DEFAULT_NODE_CAPACITY,r.call(this,p)}r&&(o.__proto__=r),(o.prototype=Object.create(r&&r.prototype)).constructor=o;var c={STRtreeNode:{configurable:!0},serialVersionUID:{configurable:!0},xComparator:{configurable:!0},yComparator:{configurable:!0},intersectsOp:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};return o.prototype.createParentBoundablesFromVerticalSlices=function(p,_){Z.isTrue(p.length>0);for(var C=new et,R=0;R<p.length;R++)C.addAll(this.createParentBoundablesFromVerticalSlice(p[R],_));return C},o.prototype.createNode=function(p){return new Na(p)},o.prototype.size=function(){return arguments.length===0?r.prototype.size.call(this):r.prototype.size.apply(this,arguments)},o.prototype.insert=function(){if(arguments.length!==2)return r.prototype.insert.apply(this,arguments);var p=arguments[0],_=arguments[1];if(p.isNull())return null;r.prototype.insert.call(this,p,_)},o.prototype.getIntersectsOp=function(){return o.intersectsOp},o.prototype.verticalSlices=function(p,_){for(var C=Math.trunc(Math.ceil(p.size()/_)),R=new Array(_).fill(null),$=p.iterator(),rt=0;rt<_;rt++){R[rt]=new et;for(var bt=0;$.hasNext()&&bt<C;){var Yt=$.next();R[rt].add(Yt),bt++}}return R},o.prototype.query=function(){if(arguments.length===1){var p=arguments[0];return r.prototype.query.call(this,p)}if(arguments.length===2){var _=arguments[0],C=arguments[1];r.prototype.query.call(this,_,C)}else if(arguments.length===3){if(Ne(arguments[2],ps)&&arguments[0]instanceof Object&&arguments[1]instanceof di){var R=arguments[0],$=arguments[1],rt=arguments[2];r.prototype.query.call(this,R,$,rt)}else if(Ne(arguments[2],ut)&&arguments[0]instanceof Object&&arguments[1]instanceof di){var bt=arguments[0],Yt=arguments[1],Ht=arguments[2];r.prototype.query.call(this,bt,Yt,Ht)}}},o.prototype.getComparator=function(){return o.yComparator},o.prototype.createParentBoundablesFromVerticalSlice=function(p,_){return r.prototype.createParentBoundables.call(this,p,_)},o.prototype.remove=function(){if(arguments.length===2){var p=arguments[0],_=arguments[1];return r.prototype.remove.call(this,p,_)}return r.prototype.remove.apply(this,arguments)},o.prototype.depth=function(){return arguments.length===0?r.prototype.depth.call(this):r.prototype.depth.apply(this,arguments)},o.prototype.createParentBoundables=function(p,_){Z.isTrue(!p.isEmpty());var C=Math.trunc(Math.ceil(p.size()/this.getNodeCapacity())),R=new et(p);Do.sort(R,o.xComparator);var $=this.verticalSlices(R,Math.trunc(Math.ceil(Math.sqrt(C))));return this.createParentBoundablesFromVerticalSlices($,_)},o.prototype.nearestNeighbour=function(){if(arguments.length===1){if(Ne(arguments[0],Zo)){var p=arguments[0],_=new ji(this.getRoot(),this.getRoot(),p);return this.nearestNeighbour(_)}if(arguments[0]instanceof ji){var C=arguments[0];return this.nearestNeighbour(C,Ft.POSITIVE_INFINITY)}}else if(arguments.length===2){if(arguments[0]instanceof o&&Ne(arguments[1],Zo)){var R=arguments[0],$=arguments[1],rt=new ji(this.getRoot(),R.getRoot(),$);return this.nearestNeighbour(rt)}if(arguments[0]instanceof ji&&typeof arguments[1]=="number"){var bt=arguments[0],Yt=arguments[1],Ht=null,Re=new Xo;for(Re.add(bt);!Re.isEmpty()&&Yt>0;){var ze=Re.poll(),Ve=ze.getDistance();if(Ve>=Yt)break;ze.isLeaves()?(Yt=Ve,Ht=ze):ze.expandToQueue(Re,Yt)}return[Ht.getBoundable(0).getItem(),Ht.getBoundable(1).getItem()]}}else if(arguments.length===3){var We=arguments[0],Vr=arguments[1],Bi=arguments[2],De=new mi(We,Vr),Vo=new ji(this.getRoot(),De,Bi);return this.nearestNeighbour(Vo)[0]}},o.prototype.interfaces_=function(){return[ho,A]},o.prototype.getClass=function(){return o},o.centreX=function(p){return o.avg(p.getMinX(),p.getMaxX())},o.avg=function(p,_){return(p+_)/2},o.centreY=function(p){return o.avg(p.getMinY(),p.getMaxY())},c.STRtreeNode.get=function(){return Na},c.serialVersionUID.get=function(){return 0x39920f7d5f261e0},c.xComparator.get=function(){return{interfaces_:function(){return[$t]},compare:function(p,_){return r.compareDoubles(o.centreX(p.getBounds()),o.centreX(_.getBounds()))}}},c.yComparator.get=function(){return{interfaces_:function(){return[$t]},compare:function(p,_){return r.compareDoubles(o.centreY(p.getBounds()),o.centreY(_.getBounds()))}}},c.intersectsOp.get=function(){return{interfaces_:function(){return[r.IntersectsOp]},intersects:function(p,_){return p.intersects(_)}}},c.DEFAULT_NODE_CAPACITY.get=function(){return 10},Object.defineProperties(o,c),o}(qi),Na=function(r){function o(){var c=arguments[0];r.call(this,c)}return r&&(o.__proto__=r),o.prototype=Object.create(r&&r.prototype),o.prototype.constructor=o,o.prototype.computeBounds=function(){for(var c=null,p=this.getChildBoundables().iterator();p.hasNext();){var _=p.next();c===null?c=new qe(_.getBounds()):c.expandToInclude(_.getBounds())}return c},o.prototype.interfaces_=function(){return[]},o.prototype.getClass=function(){return o},o}(di),Zi=function(){};Zi.prototype.interfaces_=function(){return[]},Zi.prototype.getClass=function(){return Zi},Zi.relativeSign=function(r,o){return r<o?-1:r>o?1:0},Zi.compare=function(r,o,c){if(o.equals2D(c))return 0;var p=Zi.relativeSign(o.x,c.x),_=Zi.relativeSign(o.y,c.y);switch(r){case 0:return Zi.compareValue(p,_);case 1:return Zi.compareValue(_,p);case 2:return Zi.compareValue(_,-p);case 3:return Zi.compareValue(-p,_);case 4:return Zi.compareValue(-p,-_);case 5:return Zi.compareValue(-_,-p);case 6:return Zi.compareValue(-_,p);case 7:return Zi.compareValue(p,-_)}return Z.shouldNeverReachHere("invalid octant value"),0},Zi.compareValue=function(r,o){return r<0?-1:r>0?1:o<0?-1:o>0?1:0};var Wo=function(){this._segString=null,this.coord=null,this.segmentIndex=null,this._segmentOctant=null,this._isInterior=null;var r=arguments[0],o=arguments[1],c=arguments[2],p=arguments[3];this._segString=r,this.coord=new yt(o),this.segmentIndex=c,this._segmentOctant=p,this._isInterior=!o.equals2D(r.getCoordinate(c))};Wo.prototype.getCoordinate=function(){return this.coord},Wo.prototype.print=function(r){r.print(this.coord),r.print(" seg # = "+this.segmentIndex)},Wo.prototype.compareTo=function(r){var o=r;return this.segmentIndex<o.segmentIndex?-1:this.segmentIndex>o.segmentIndex?1:this.coord.equals2D(o.coord)?0:Zi.compare(this._segmentOctant,this.coord,o.coord)},Wo.prototype.isEndPoint=function(r){return this.segmentIndex===0&&!this._isInterior||this.segmentIndex===r},Wo.prototype.isInterior=function(){return this._isInterior},Wo.prototype.interfaces_=function(){return[de]},Wo.prototype.getClass=function(){return Wo};var nn=function(){this._nodeMap=new qt,this._edge=null;var r=arguments[0];this._edge=r};nn.prototype.getSplitCoordinates=function(){var r=new Ut;this.addEndpoints();for(var o=this.iterator(),c=o.next();o.hasNext();){var p=o.next();this.addEdgeCoordinates(c,p,r),c=p}return r.toCoordinateArray()},nn.prototype.addCollapsedNodes=function(){var r=new et;this.findCollapsesFromInsertedNodes(r),this.findCollapsesFromExistingVertices(r);for(var o=r.iterator();o.hasNext();){var c=o.next().intValue();this.add(this._edge.getCoordinate(c),c)}},nn.prototype.print=function(r){r.println("Intersections:");for(var o=this.iterator();o.hasNext();)o.next().print(r)},nn.prototype.findCollapsesFromExistingVertices=function(r){for(var o=0;o<this._edge.size()-2;o++){var c=this._edge.getCoordinate(o),p=this._edge.getCoordinate(o+2);c.equals2D(p)&&r.add(new Pe(o+1))}},nn.prototype.addEdgeCoordinates=function(r,o,c){var p=this._edge.getCoordinate(o.segmentIndex),_=o.isInterior()||!o.coord.equals2D(p);c.add(new yt(r.coord),!1);for(var C=r.segmentIndex+1;C<=o.segmentIndex;C++)c.add(this._edge.getCoordinate(C));_&&c.add(new yt(o.coord))},nn.prototype.iterator=function(){return this._nodeMap.values().iterator()},nn.prototype.addSplitEdges=function(r){this.addEndpoints(),this.addCollapsedNodes();for(var o=this.iterator(),c=o.next();o.hasNext();){var p=o.next(),_=this.createSplitEdge(c,p);r.add(_),c=p}},nn.prototype.findCollapseIndex=function(r,o,c){if(!r.coord.equals2D(o.coord))return!1;var p=o.segmentIndex-r.segmentIndex;return o.isInterior()||p--,p===1&&(c[0]=r.segmentIndex+1,!0)},nn.prototype.findCollapsesFromInsertedNodes=function(r){for(var o=new Array(1).fill(null),c=this.iterator(),p=c.next();c.hasNext();){var _=c.next();this.findCollapseIndex(p,_,o)&&r.add(new Pe(o[0])),p=_}},nn.prototype.getEdge=function(){return this._edge},nn.prototype.addEndpoints=function(){var r=this._edge.size()-1;this.add(this._edge.getCoordinate(0),0),this.add(this._edge.getCoordinate(r),r)},nn.prototype.createSplitEdge=function(r,o){var c=o.segmentIndex-r.segmentIndex+2,p=this._edge.getCoordinate(o.segmentIndex),_=o.isInterior()||!o.coord.equals2D(p);_||c--;var C=new Array(c).fill(null),R=0;C[R++]=new yt(r.coord);for(var $=r.segmentIndex+1;$<=o.segmentIndex;$++)C[R++]=this._edge.getCoordinate($);return _&&(C[R]=new yt(o.coord)),new zi(C,this._edge.getData())},nn.prototype.add=function(r,o){var c=new Wo(this._edge,r,o,this._edge.getSegmentOctant(o)),p=this._nodeMap.get(c);return p!==null?(Z.isTrue(p.coord.equals2D(r),"Found equal nodes with different coordinates"),p):(this._nodeMap.put(c,c),c)},nn.prototype.checkSplitEdgesCorrectness=function(r){var o=this._edge.getCoordinates(),c=r.get(0).getCoordinate(0);if(!c.equals2D(o[0]))throw new zt("bad split edge start point at "+c);var p=r.get(r.size()-1).getCoordinates(),_=p[p.length-1];if(!_.equals2D(o[o.length-1]))throw new zt("bad split edge end point at "+_)},nn.prototype.interfaces_=function(){return[]},nn.prototype.getClass=function(){return nn};var fs=function(){};fs.prototype.interfaces_=function(){return[]},fs.prototype.getClass=function(){return fs},fs.octant=function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var r=arguments[0],o=arguments[1];if(r===0&&o===0)throw new Et("Cannot compute the octant for point ( "+r+", "+o+" )");var c=Math.abs(r),p=Math.abs(o);return r>=0?o>=0?c>=p?0:1:c>=p?7:6:o>=0?c>=p?3:2:c>=p?4:5}if(arguments[0]instanceof yt&&arguments[1]instanceof yt){var _=arguments[0],C=arguments[1],R=C.x-_.x,$=C.y-_.y;if(R===0&&$===0)throw new Et("Cannot compute the octant for two identical points "+_);return fs.octant(R,$)}};var Yo=function(){};Yo.prototype.getCoordinates=function(){},Yo.prototype.size=function(){},Yo.prototype.getCoordinate=function(r){},Yo.prototype.isClosed=function(){},Yo.prototype.setData=function(r){},Yo.prototype.getData=function(){},Yo.prototype.interfaces_=function(){return[]},Yo.prototype.getClass=function(){return Yo};var Js=function(){};Js.prototype.addIntersection=function(r,o){},Js.prototype.interfaces_=function(){return[Yo]},Js.prototype.getClass=function(){return Js};var zi=function(){this._nodeList=new nn(this),this._pts=null,this._data=null;var r=arguments[0],o=arguments[1];this._pts=r,this._data=o};zi.prototype.getCoordinates=function(){return this._pts},zi.prototype.size=function(){return this._pts.length},zi.prototype.getCoordinate=function(r){return this._pts[r]},zi.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])},zi.prototype.getSegmentOctant=function(r){return r===this._pts.length-1?-1:this.safeOctant(this.getCoordinate(r),this.getCoordinate(r+1))},zi.prototype.setData=function(r){this._data=r},zi.prototype.safeOctant=function(r,o){return r.equals2D(o)?0:fs.octant(r,o)},zi.prototype.getData=function(){return this._data},zi.prototype.addIntersection=function(){if(arguments.length===2){var r=arguments[0],o=arguments[1];this.addIntersectionNode(r,o)}else if(arguments.length===4){var c=arguments[0],p=arguments[1],_=arguments[3],C=new yt(c.getIntersection(_));this.addIntersection(C,p)}},zi.prototype.toString=function(){return ii.toLineString(new Rr(this._pts))},zi.prototype.getNodeList=function(){return this._nodeList},zi.prototype.addIntersectionNode=function(r,o){var c=o,p=c+1;if(p<this._pts.length){var _=this._pts[p];r.equals2D(_)&&(c=p)}return this._nodeList.add(r,c)},zi.prototype.addIntersections=function(r,o,c){for(var p=0;p<r.getIntersectionNum();p++)this.addIntersection(r,o,c,p)},zi.prototype.interfaces_=function(){return[Js]},zi.prototype.getClass=function(){return zi},zi.getNodedSubstrings=function(){if(arguments.length===1){var r=arguments[0],o=new et;return zi.getNodedSubstrings(r,o),o}if(arguments.length===2)for(var c=arguments[0],p=arguments[1],_=c.iterator();_.hasNext();)_.next().getNodeList().addSplitEdges(p)};var Ke=function(){if(this.p0=null,this.p1=null,arguments.length===0)this.p0=new yt,this.p1=new yt;else if(arguments.length===1){var r=arguments[0];this.p0=new yt(r.p0),this.p1=new yt(r.p1)}else if(arguments.length===2)this.p0=arguments[0],this.p1=arguments[1];else if(arguments.length===4){var o=arguments[0],c=arguments[1],p=arguments[2],_=arguments[3];this.p0=new yt(o,c),this.p1=new yt(p,_)}},ma={serialVersionUID:{configurable:!0}};Ke.prototype.minX=function(){return Math.min(this.p0.x,this.p1.x)},Ke.prototype.orientationIndex=function(){if(arguments[0]instanceof Ke){var r=arguments[0],o=kt.orientationIndex(this.p0,this.p1,r.p0),c=kt.orientationIndex(this.p0,this.p1,r.p1);return o>=0&&c>=0||o<=0&&c<=0?Math.max(o,c):0}if(arguments[0]instanceof yt){var p=arguments[0];return kt.orientationIndex(this.p0,this.p1,p)}},Ke.prototype.toGeometry=function(r){return r.createLineString([this.p0,this.p1])},Ke.prototype.isVertical=function(){return this.p0.x===this.p1.x},Ke.prototype.equals=function(r){if(!(r instanceof Ke))return!1;var o=r;return this.p0.equals(o.p0)&&this.p1.equals(o.p1)},Ke.prototype.intersection=function(r){var o=new Dt;return o.computeIntersection(this.p0,this.p1,r.p0,r.p1),o.hasIntersection()?o.getIntersection(0):null},Ke.prototype.project=function(){if(arguments[0]instanceof yt){var r=arguments[0];if(r.equals(this.p0)||r.equals(this.p1))return new yt(r);var o=this.projectionFactor(r),c=new yt;return c.x=this.p0.x+o*(this.p1.x-this.p0.x),c.y=this.p0.y+o*(this.p1.y-this.p0.y),c}if(arguments[0]instanceof Ke){var p=arguments[0],_=this.projectionFactor(p.p0),C=this.projectionFactor(p.p1);if(_>=1&&C>=1||_<=0&&C<=0)return null;var R=this.project(p.p0);_<0&&(R=this.p0),_>1&&(R=this.p1);var $=this.project(p.p1);return C<0&&($=this.p0),C>1&&($=this.p1),new Ke(R,$)}},Ke.prototype.normalize=function(){this.p1.compareTo(this.p0)<0&&this.reverse()},Ke.prototype.angle=function(){return Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)},Ke.prototype.getCoordinate=function(r){return r===0?this.p0:this.p1},Ke.prototype.distancePerpendicular=function(r){return kt.distancePointLinePerpendicular(r,this.p0,this.p1)},Ke.prototype.minY=function(){return Math.min(this.p0.y,this.p1.y)},Ke.prototype.midPoint=function(){return Ke.midPoint(this.p0,this.p1)},Ke.prototype.projectionFactor=function(r){if(r.equals(this.p0))return 0;if(r.equals(this.p1))return 1;var o=this.p1.x-this.p0.x,c=this.p1.y-this.p0.y,p=o*o+c*c;return p<=0?Ft.NaN:((r.x-this.p0.x)*o+(r.y-this.p0.y)*c)/p},Ke.prototype.closestPoints=function(r){var o=this.intersection(r);if(o!==null)return[o,o];var c=new Array(2).fill(null),p=Ft.MAX_VALUE,_=null,C=this.closestPoint(r.p0);p=C.distance(r.p0),c[0]=C,c[1]=r.p0;var R=this.closestPoint(r.p1);(_=R.distance(r.p1))<p&&(p=_,c[0]=R,c[1]=r.p1);var $=r.closestPoint(this.p0);(_=$.distance(this.p0))<p&&(p=_,c[0]=this.p0,c[1]=$);var rt=r.closestPoint(this.p1);return(_=rt.distance(this.p1))<p&&(p=_,c[0]=this.p1,c[1]=rt),c},Ke.prototype.closestPoint=function(r){var o=this.projectionFactor(r);return o>0&&o<1?this.project(r):this.p0.distance(r)<this.p1.distance(r)?this.p0:this.p1},Ke.prototype.maxX=function(){return Math.max(this.p0.x,this.p1.x)},Ke.prototype.getLength=function(){return this.p0.distance(this.p1)},Ke.prototype.compareTo=function(r){var o=r,c=this.p0.compareTo(o.p0);return c!==0?c:this.p1.compareTo(o.p1)},Ke.prototype.reverse=function(){var r=this.p0;this.p0=this.p1,this.p1=r},Ke.prototype.equalsTopo=function(r){return this.p0.equals(r.p0)&&(this.p1.equals(r.p1)||this.p0.equals(r.p1))&&this.p1.equals(r.p0)},Ke.prototype.lineIntersection=function(r){try{return He.intersection(this.p0,this.p1,r.p0,r.p1)}catch(o){if(!(o instanceof oi))throw o}return null},Ke.prototype.maxY=function(){return Math.max(this.p0.y,this.p1.y)},Ke.prototype.pointAlongOffset=function(r,o){var c=this.p0.x+r*(this.p1.x-this.p0.x),p=this.p0.y+r*(this.p1.y-this.p0.y),_=this.p1.x-this.p0.x,C=this.p1.y-this.p0.y,R=Math.sqrt(_*_+C*C),$=0,rt=0;if(o!==0){if(R<=0)throw new Error("Cannot compute offset from zero-length line segment");$=o*_/R,rt=o*C/R}return new yt(c-rt,p+$)},Ke.prototype.setCoordinates=function(){if(arguments.length===1){var r=arguments[0];this.setCoordinates(r.p0,r.p1)}else if(arguments.length===2){var o=arguments[0],c=arguments[1];this.p0.x=o.x,this.p0.y=o.y,this.p1.x=c.x,this.p1.y=c.y}},Ke.prototype.segmentFraction=function(r){var o=this.projectionFactor(r);return o<0?o=0:(o>1||Ft.isNaN(o))&&(o=1),o},Ke.prototype.toString=function(){return"LINESTRING( "+this.p0.x+" "+this.p0.y+", "+this.p1.x+" "+this.p1.y+")"},Ke.prototype.isHorizontal=function(){return this.p0.y===this.p1.y},Ke.prototype.distance=function(){if(arguments[0]instanceof Ke){var r=arguments[0];return kt.distanceLineLine(this.p0,this.p1,r.p0,r.p1)}if(arguments[0]instanceof yt){var o=arguments[0];return kt.distancePointLine(o,this.p0,this.p1)}},Ke.prototype.pointAlong=function(r){var o=new yt;return o.x=this.p0.x+r*(this.p1.x-this.p0.x),o.y=this.p0.y+r*(this.p1.y-this.p0.y),o},Ke.prototype.hashCode=function(){var r=Ft.doubleToLongBits(this.p0.x);r^=31*Ft.doubleToLongBits(this.p0.y);var o=Math.trunc(r)^Math.trunc(r>>32),c=Ft.doubleToLongBits(this.p1.x);return c^=31*Ft.doubleToLongBits(this.p1.y),o^(Math.trunc(c)^Math.trunc(c>>32))},Ke.prototype.interfaces_=function(){return[de,A]},Ke.prototype.getClass=function(){return Ke},Ke.midPoint=function(r,o){return new yt((r.x+o.x)/2,(r.y+o.y)/2)},ma.serialVersionUID.get=function(){return 0x2d2172135f411c00},Object.defineProperties(Ke,ma);var Xr=function(){this.tempEnv1=new qe,this.tempEnv2=new qe,this._overlapSeg1=new Ke,this._overlapSeg2=new Ke};Xr.prototype.overlap=function(){if(arguments.length!==2){if(arguments.length===4){var r=arguments[0],o=arguments[1],c=arguments[2],p=arguments[3];r.getLineSegment(o,this._overlapSeg1),c.getLineSegment(p,this._overlapSeg2),this.overlap(this._overlapSeg1,this._overlapSeg2)}}},Xr.prototype.interfaces_=function(){return[]},Xr.prototype.getClass=function(){return Xr};var no=function(){this._pts=null,this._start=null,this._end=null,this._env=null,this._context=null,this._id=null;var r=arguments[0],o=arguments[1],c=arguments[2],p=arguments[3];this._pts=r,this._start=o,this._end=c,this._context=p};no.prototype.getLineSegment=function(r,o){o.p0=this._pts[r],o.p1=this._pts[r+1]},no.prototype.computeSelect=function(r,o,c,p){var _=this._pts[o],C=this._pts[c];if(p.tempEnv1.init(_,C),c-o==1)return p.select(this,o),null;if(!r.intersects(p.tempEnv1))return null;var R=Math.trunc((o+c)/2);o<R&&this.computeSelect(r,o,R,p),R<c&&this.computeSelect(r,R,c,p)},no.prototype.getCoordinates=function(){for(var r=new Array(this._end-this._start+1).fill(null),o=0,c=this._start;c<=this._end;c++)r[o++]=this._pts[c];return r},no.prototype.computeOverlaps=function(r,o){this.computeOverlapsInternal(this._start,this._end,r,r._start,r._end,o)},no.prototype.setId=function(r){this._id=r},no.prototype.select=function(r,o){this.computeSelect(r,this._start,this._end,o)},no.prototype.getEnvelope=function(){if(this._env===null){var r=this._pts[this._start],o=this._pts[this._end];this._env=new qe(r,o)}return this._env},no.prototype.getEndIndex=function(){return this._end},no.prototype.getStartIndex=function(){return this._start},no.prototype.getContext=function(){return this._context},no.prototype.getId=function(){return this._id},no.prototype.computeOverlapsInternal=function(r,o,c,p,_,C){var R=this._pts[r],$=this._pts[o],rt=c._pts[p],bt=c._pts[_];if(o-r==1&&_-p==1)return C.overlap(this,r,c,p),null;if(C.tempEnv1.init(R,$),C.tempEnv2.init(rt,bt),!C.tempEnv1.intersects(C.tempEnv2))return null;var Yt=Math.trunc((r+o)/2),Ht=Math.trunc((p+_)/2);r<Yt&&(p<Ht&&this.computeOverlapsInternal(r,Yt,c,p,Ht,C),Ht<_&&this.computeOverlapsInternal(r,Yt,c,Ht,_,C)),Yt<o&&(p<Ht&&this.computeOverlapsInternal(Yt,o,c,p,Ht,C),Ht<_&&this.computeOverlapsInternal(Yt,o,c,Ht,_,C))},no.prototype.interfaces_=function(){return[]},no.prototype.getClass=function(){return no};var Io=function(){};Io.prototype.interfaces_=function(){return[]},Io.prototype.getClass=function(){return Io},Io.getChainStartIndices=function(r){var o=0,c=new et;c.add(new Pe(o));do{var p=Io.findChainEnd(r,o);c.add(new Pe(p)),o=p}while(o<r.length-1);return Io.toIntArray(c)},Io.findChainEnd=function(r,o){for(var c=o;c<r.length-1&&r[c].equals2D(r[c+1]);)c++;if(c>=r.length-1)return r.length-1;for(var p=br.quadrant(r[c],r[c+1]),_=o+1;_<r.length&&!(!r[_-1].equals2D(r[_])&&br.quadrant(r[_-1],r[_])!==p);)_++;return _-1},Io.getChains=function(){if(arguments.length===1){var r=arguments[0];return Io.getChains(r,null)}if(arguments.length===2){for(var o=arguments[0],c=arguments[1],p=new et,_=Io.getChainStartIndices(o),C=0;C<_.length-1;C++){var R=new no(o,_[C],_[C+1],c);p.add(R)}return p}},Io.toIntArray=function(r){for(var o=new Array(r.size()).fill(null),c=0;c<o.length;c++)o[c]=r.get(c).intValue();return o};var zs=function(){};zs.prototype.computeNodes=function(r){},zs.prototype.getNodedSubstrings=function(){},zs.prototype.interfaces_=function(){return[]},zs.prototype.getClass=function(){return zs};var ga=function(){if(this._segInt=null,arguments.length!==0){if(arguments.length===1){var r=arguments[0];this.setSegmentIntersector(r)}}};ga.prototype.setSegmentIntersector=function(r){this._segInt=r},ga.prototype.interfaces_=function(){return[zs]},ga.prototype.getClass=function(){return ga};var gl=function(r){function o(p){p?r.call(this,p):r.call(this),this._monoChains=new et,this._index=new bs,this._idCounter=0,this._nodedSegStrings=null,this._nOverlaps=0}r&&(o.__proto__=r),(o.prototype=Object.create(r&&r.prototype)).constructor=o;var c={SegmentOverlapAction:{configurable:!0}};return o.prototype.getMonotoneChains=function(){return this._monoChains},o.prototype.getNodedSubstrings=function(){return zi.getNodedSubstrings(this._nodedSegStrings)},o.prototype.getIndex=function(){return this._index},o.prototype.add=function(p){for(var _=Io.getChains(p.getCoordinates(),p).iterator();_.hasNext();){var C=_.next();C.setId(this._idCounter++),this._index.insert(C.getEnvelope(),C),this._monoChains.add(C)}},o.prototype.computeNodes=function(p){this._nodedSegStrings=p;for(var _=p.iterator();_.hasNext();)this.add(_.next());this.intersectChains()},o.prototype.intersectChains=function(){for(var p=new _l(this._segInt),_=this._monoChains.iterator();_.hasNext();)for(var C=_.next(),R=this._index.query(C.getEnvelope()).iterator();R.hasNext();){var $=R.next();if($.getId()>C.getId()&&(C.computeOverlaps($,p),this._nOverlaps++),this._segInt.isDone())return null}},o.prototype.interfaces_=function(){return[]},o.prototype.getClass=function(){return o},c.SegmentOverlapAction.get=function(){return _l},Object.defineProperties(o,c),o}(ga),_l=function(r){function o(){r.call(this),this._si=null;var c=arguments[0];this._si=c}return r&&(o.__proto__=r),o.prototype=Object.create(r&&r.prototype),o.prototype.constructor=o,o.prototype.overlap=function(){if(arguments.length!==4)return r.prototype.overlap.apply(this,arguments);var c=arguments[0],p=arguments[1],_=arguments[2],C=arguments[3],R=c.getContext(),$=_.getContext();this._si.processIntersections(R,p,$,C)},o.prototype.interfaces_=function(){return[]},o.prototype.getClass=function(){return o},o}(Xr),Nr=function r(){if(this._quadrantSegments=r.DEFAULT_QUADRANT_SEGMENTS,this._endCapStyle=r.CAP_ROUND,this._joinStyle=r.JOIN_ROUND,this._mitreLimit=r.DEFAULT_MITRE_LIMIT,this._isSingleSided=!1,this._simplifyFactor=r.DEFAULT_SIMPLIFY_FACTOR,arguments.length!==0){if(arguments.length===1){var o=arguments[0];this.setQuadrantSegments(o)}else if(arguments.length===2){var c=arguments[0],p=arguments[1];this.setQuadrantSegments(c),this.setEndCapStyle(p)}else if(arguments.length===4){var _=arguments[0],C=arguments[1],R=arguments[2],$=arguments[3];this.setQuadrantSegments(_),this.setEndCapStyle(C),this.setJoinStyle(R),this.setMitreLimit($)}}},Oo={CAP_ROUND:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},JOIN_ROUND:{configurable:!0},JOIN_MITRE:{configurable:!0},JOIN_BEVEL:{configurable:!0},DEFAULT_QUADRANT_SEGMENTS:{configurable:!0},DEFAULT_MITRE_LIMIT:{configurable:!0},DEFAULT_SIMPLIFY_FACTOR:{configurable:!0}};Nr.prototype.getEndCapStyle=function(){return this._endCapStyle},Nr.prototype.isSingleSided=function(){return this._isSingleSided},Nr.prototype.setQuadrantSegments=function(r){this._quadrantSegments=r,this._quadrantSegments===0&&(this._joinStyle=Nr.JOIN_BEVEL),this._quadrantSegments<0&&(this._joinStyle=Nr.JOIN_MITRE,this._mitreLimit=Math.abs(this._quadrantSegments)),r<=0&&(this._quadrantSegments=1),this._joinStyle!==Nr.JOIN_ROUND&&(this._quadrantSegments=Nr.DEFAULT_QUADRANT_SEGMENTS)},Nr.prototype.getJoinStyle=function(){return this._joinStyle},Nr.prototype.setJoinStyle=function(r){this._joinStyle=r},Nr.prototype.setSimplifyFactor=function(r){this._simplifyFactor=r<0?0:r},Nr.prototype.getSimplifyFactor=function(){return this._simplifyFactor},Nr.prototype.getQuadrantSegments=function(){return this._quadrantSegments},Nr.prototype.setEndCapStyle=function(r){this._endCapStyle=r},Nr.prototype.getMitreLimit=function(){return this._mitreLimit},Nr.prototype.setMitreLimit=function(r){this._mitreLimit=r},Nr.prototype.setSingleSided=function(r){this._isSingleSided=r},Nr.prototype.interfaces_=function(){return[]},Nr.prototype.getClass=function(){return Nr},Nr.bufferDistanceError=function(r){var o=Math.PI/2/r;return 1-Math.cos(o/2)},Oo.CAP_ROUND.get=function(){return 1},Oo.CAP_FLAT.get=function(){return 2},Oo.CAP_SQUARE.get=function(){return 3},Oo.JOIN_ROUND.get=function(){return 1},Oo.JOIN_MITRE.get=function(){return 2},Oo.JOIN_BEVEL.get=function(){return 3},Oo.DEFAULT_QUADRANT_SEGMENTS.get=function(){return 8},Oo.DEFAULT_MITRE_LIMIT.get=function(){return 5},Oo.DEFAULT_SIMPLIFY_FACTOR.get=function(){return .01},Object.defineProperties(Nr,Oo);var ui=function(r){this._distanceTol=null,this._isDeleted=null,this._angleOrientation=kt.COUNTERCLOCKWISE,this._inputLine=r||null},No={INIT:{configurable:!0},DELETE:{configurable:!0},KEEP:{configurable:!0},NUM_PTS_TO_CHECK:{configurable:!0}};ui.prototype.isDeletable=function(r,o,c,p){var _=this._inputLine[r],C=this._inputLine[o],R=this._inputLine[c];return!!this.isConcave(_,C,R)&&!!this.isShallow(_,C,R,p)&&this.isShallowSampled(_,C,r,c,p)},ui.prototype.deleteShallowConcavities=function(){for(var r=1,o=this.findNextNonDeletedIndex(r),c=this.findNextNonDeletedIndex(o),p=!1;c<this._inputLine.length;){var _=!1;this.isDeletable(r,o,c,this._distanceTol)&&(this._isDeleted[o]=ui.DELETE,_=!0,p=!0),r=_?c:o,o=this.findNextNonDeletedIndex(r),c=this.findNextNonDeletedIndex(o)}return p},ui.prototype.isShallowConcavity=function(r,o,c,p){return kt.computeOrientation(r,o,c)!==this._angleOrientation?!1:kt.distancePointLine(o,r,c)<p},ui.prototype.isShallowSampled=function(r,o,c,p,_){var C=Math.trunc((p-c)/ui.NUM_PTS_TO_CHECK);C<=0&&(C=1);for(var R=c;R<p;R+=C)if(!this.isShallow(r,o,this._inputLine[R],_))return!1;return!0},ui.prototype.isConcave=function(r,o,c){var p=kt.computeOrientation(r,o,c)===this._angleOrientation;return p},ui.prototype.simplify=function(r){this._distanceTol=Math.abs(r),r<0&&(this._angleOrientation=kt.CLOCKWISE),this._isDeleted=new Array(this._inputLine.length).fill(null);var o=!1;do o=this.deleteShallowConcavities();while(o);return this.collapseLine()},ui.prototype.findNextNonDeletedIndex=function(r){for(var o=r+1;o<this._inputLine.length&&this._isDeleted[o]===ui.DELETE;)o++;return o},ui.prototype.isShallow=function(r,o,c,p){return kt.distancePointLine(o,r,c)<p},ui.prototype.collapseLine=function(){for(var r=new Ut,o=0;o<this._inputLine.length;o++)this._isDeleted[o]!==ui.DELETE&&r.add(this._inputLine[o]);return r.toCoordinateArray()},ui.prototype.interfaces_=function(){return[]},ui.prototype.getClass=function(){return ui},ui.simplify=function(r,o){return new ui(r).simplify(o)},No.INIT.get=function(){return 0},No.DELETE.get=function(){return 1},No.KEEP.get=function(){return 1},No.NUM_PTS_TO_CHECK.get=function(){return 10},Object.defineProperties(ui,No);var dn=function(){this._ptList=null,this._precisionModel=null,this._minimimVertexDistance=0,this._ptList=new et},Qa={COORDINATE_ARRAY_TYPE:{configurable:!0}};dn.prototype.getCoordinates=function(){return this._ptList.toArray(dn.COORDINATE_ARRAY_TYPE)},dn.prototype.setPrecisionModel=function(r){this._precisionModel=r},dn.prototype.addPt=function(r){var o=new yt(r);if(this._precisionModel.makePrecise(o),this.isRedundant(o))return null;this._ptList.add(o)},dn.prototype.revere=function(){},dn.prototype.addPts=function(r,o){if(o)for(var c=0;c<r.length;c++)this.addPt(r[c]);else for(var p=r.length-1;p>=0;p--)this.addPt(r[p])},dn.prototype.isRedundant=function(r){if(this._ptList.size()<1)return!1;var o=this._ptList.get(this._ptList.size()-1);return r.distance(o)<this._minimimVertexDistance},dn.prototype.toString=function(){return new lr().createLineString(this.getCoordinates()).toString()},dn.prototype.closeRing=function(){if(this._ptList.size()<1)return null;var r=new yt(this._ptList.get(0)),o=this._ptList.get(this._ptList.size()-1);if(r.equals(o))return null;this._ptList.add(r)},dn.prototype.setMinimumVertexDistance=function(r){this._minimimVertexDistance=r},dn.prototype.interfaces_=function(){return[]},dn.prototype.getClass=function(){return dn},Qa.COORDINATE_ARRAY_TYPE.get=function(){return new Array(0).fill(null)},Object.defineProperties(dn,Qa);var zr=function(){},ds={PI_TIMES_2:{configurable:!0},PI_OVER_2:{configurable:!0},PI_OVER_4:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},CLOCKWISE:{configurable:!0},NONE:{configurable:!0}};zr.prototype.interfaces_=function(){return[]},zr.prototype.getClass=function(){return zr},zr.toDegrees=function(r){return 180*r/Math.PI},zr.normalize=function(r){for(;r>Math.PI;)r-=zr.PI_TIMES_2;for(;r<=-Math.PI;)r+=zr.PI_TIMES_2;return r},zr.angle=function(){if(arguments.length===1){var r=arguments[0];return Math.atan2(r.y,r.x)}if(arguments.length===2){var o=arguments[0],c=arguments[1],p=c.x-o.x,_=c.y-o.y;return Math.atan2(_,p)}},zr.isAcute=function(r,o,c){var p=r.x-o.x,_=r.y-o.y;return p*(c.x-o.x)+_*(c.y-o.y)>0},zr.isObtuse=function(r,o,c){var p=r.x-o.x,_=r.y-o.y;return p*(c.x-o.x)+_*(c.y-o.y)<0},zr.interiorAngle=function(r,o,c){var p=zr.angle(o,r),_=zr.angle(o,c);return Math.abs(_-p)},zr.normalizePositive=function(r){if(r<0){for(;r<0;)r+=zr.PI_TIMES_2;r>=zr.PI_TIMES_2&&(r=0)}else{for(;r>=zr.PI_TIMES_2;)r-=zr.PI_TIMES_2;r<0&&(r=0)}return r},zr.angleBetween=function(r,o,c){var p=zr.angle(o,r),_=zr.angle(o,c);return zr.diff(p,_)},zr.diff=function(r,o){var c=null;return(c=r<o?o-r:r-o)>Math.PI&&(c=2*Math.PI-c),c},zr.toRadians=function(r){return r*Math.PI/180},zr.getTurn=function(r,o){var c=Math.sin(o-r);return c>0?zr.COUNTERCLOCKWISE:c<0?zr.CLOCKWISE:zr.NONE},zr.angleBetweenOriented=function(r,o,c){var p=zr.angle(o,r),_=zr.angle(o,c)-p;return _<=-Math.PI?_+zr.PI_TIMES_2:_>Math.PI?_-zr.PI_TIMES_2:_},ds.PI_TIMES_2.get=function(){return 2*Math.PI},ds.PI_OVER_2.get=function(){return Math.PI/2},ds.PI_OVER_4.get=function(){return Math.PI/4},ds.COUNTERCLOCKWISE.get=function(){return kt.COUNTERCLOCKWISE},ds.CLOCKWISE.get=function(){return kt.CLOCKWISE},ds.NONE.get=function(){return kt.COLLINEAR},Object.defineProperties(zr,ds);var ci=function r(){this._maxCurveSegmentError=0,this._filletAngleQuantum=null,this._closingSegLengthFactor=1,this._segList=null,this._distance=0,this._precisionModel=null,this._bufParams=null,this._li=null,this._s0=null,this._s1=null,this._s2=null,this._seg0=new Ke,this._seg1=new Ke,this._offset0=new Ke,this._offset1=new Ke,this._side=0,this._hasNarrowConcaveAngle=!1;var o=arguments[0],c=arguments[1],p=arguments[2];this._precisionModel=o,this._bufParams=c,this._li=new Dt,this._filletAngleQuantum=Math.PI/2/c.getQuadrantSegments(),c.getQuadrantSegments()>=8&&c.getJoinStyle()===Nr.JOIN_ROUND&&(this._closingSegLengthFactor=r.MAX_CLOSING_SEG_LEN_FACTOR),this.init(p)},_a={OFFSET_SEGMENT_SEPARATION_FACTOR:{configurable:!0},INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},CURVE_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},MAX_CLOSING_SEG_LEN_FACTOR:{configurable:!0}};ci.prototype.addNextSegment=function(r,o){if(this._s0=this._s1,this._s1=this._s2,this._s2=r,this._seg0.setCoordinates(this._s0,this._s1),this.computeOffsetSegment(this._seg0,this._side,this._distance,this._offset0),this._seg1.setCoordinates(this._s1,this._s2),this.computeOffsetSegment(this._seg1,this._side,this._distance,this._offset1),this._s1.equals(this._s2))return null;var c=kt.computeOrientation(this._s0,this._s1,this._s2),p=c===kt.CLOCKWISE&&this._side===Ae.LEFT||c===kt.COUNTERCLOCKWISE&&this._side===Ae.RIGHT;c===0?this.addCollinear(o):p?this.addOutsideTurn(c,o):this.addInsideTurn(c,o)},ci.prototype.addLineEndCap=function(r,o){var c=new Ke(r,o),p=new Ke;this.computeOffsetSegment(c,Ae.LEFT,this._distance,p);var _=new Ke;this.computeOffsetSegment(c,Ae.RIGHT,this._distance,_);var C=o.x-r.x,R=o.y-r.y,$=Math.atan2(R,C);switch(this._bufParams.getEndCapStyle()){case Nr.CAP_ROUND:this._segList.addPt(p.p1),this.addFilletArc(o,$+Math.PI/2,$-Math.PI/2,kt.CLOCKWISE,this._distance),this._segList.addPt(_.p1);break;case Nr.CAP_FLAT:this._segList.addPt(p.p1),this._segList.addPt(_.p1);break;case Nr.CAP_SQUARE:var rt=new yt;rt.x=Math.abs(this._distance)*Math.cos($),rt.y=Math.abs(this._distance)*Math.sin($);var bt=new yt(p.p1.x+rt.x,p.p1.y+rt.y),Yt=new yt(_.p1.x+rt.x,_.p1.y+rt.y);this._segList.addPt(bt),this._segList.addPt(Yt)}},ci.prototype.getCoordinates=function(){return this._segList.getCoordinates()},ci.prototype.addMitreJoin=function(r,o,c,p){var _=!0,C=null;try{C=He.intersection(o.p0,o.p1,c.p0,c.p1),(p<=0?1:C.distance(r)/Math.abs(p))>this._bufParams.getMitreLimit()&&(_=!1)}catch(R){if(!(R instanceof oi))throw R;C=new yt(0,0),_=!1}_?this._segList.addPt(C):this.addLimitedMitreJoin(o,c,p,this._bufParams.getMitreLimit())},ci.prototype.addFilletCorner=function(r,o,c,p,_){var C=o.x-r.x,R=o.y-r.y,$=Math.atan2(R,C),rt=c.x-r.x,bt=c.y-r.y,Yt=Math.atan2(bt,rt);p===kt.CLOCKWISE?$<=Yt&&($+=2*Math.PI):$>=Yt&&($-=2*Math.PI),this._segList.addPt(o),this.addFilletArc(r,$,Yt,p,_),this._segList.addPt(c)},ci.prototype.addOutsideTurn=function(r,o){if(this._offset0.p1.distance(this._offset1.p0)<this._distance*ci.OFFSET_SEGMENT_SEPARATION_FACTOR)return this._segList.addPt(this._offset0.p1),null;this._bufParams.getJoinStyle()===Nr.JOIN_MITRE?this.addMitreJoin(this._s1,this._offset0,this._offset1,this._distance):this._bufParams.getJoinStyle()===Nr.JOIN_BEVEL?this.addBevelJoin(this._offset0,this._offset1):(o&&this._segList.addPt(this._offset0.p1),this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,r,this._distance),this._segList.addPt(this._offset1.p0))},ci.prototype.createSquare=function(r){this._segList.addPt(new yt(r.x+this._distance,r.y+this._distance)),this._segList.addPt(new yt(r.x+this._distance,r.y-this._distance)),this._segList.addPt(new yt(r.x-this._distance,r.y-this._distance)),this._segList.addPt(new yt(r.x-this._distance,r.y+this._distance)),this._segList.closeRing()},ci.prototype.addSegments=function(r,o){this._segList.addPts(r,o)},ci.prototype.addFirstSegment=function(){this._segList.addPt(this._offset1.p0)},ci.prototype.addLastSegment=function(){this._segList.addPt(this._offset1.p1)},ci.prototype.initSideSegments=function(r,o,c){this._s1=r,this._s2=o,this._side=c,this._seg1.setCoordinates(r,o),this.computeOffsetSegment(this._seg1,c,this._distance,this._offset1)},ci.prototype.addLimitedMitreJoin=function(r,o,c,p){var _=this._seg0.p1,C=zr.angle(_,this._seg0.p0),R=zr.angleBetweenOriented(this._seg0.p0,_,this._seg1.p1)/2,$=zr.normalize(C+R),rt=zr.normalize($+Math.PI),bt=p*c,Yt=c-bt*Math.abs(Math.sin(R)),Ht=_.x+bt*Math.cos(rt),Re=_.y+bt*Math.sin(rt),ze=new yt(Ht,Re),Ve=new Ke(_,ze),We=Ve.pointAlongOffset(1,Yt),Vr=Ve.pointAlongOffset(1,-Yt);this._side===Ae.LEFT?(this._segList.addPt(We),this._segList.addPt(Vr)):(this._segList.addPt(Vr),this._segList.addPt(We))},ci.prototype.computeOffsetSegment=function(r,o,c,p){var _=o===Ae.LEFT?1:-1,C=r.p1.x-r.p0.x,R=r.p1.y-r.p0.y,$=Math.sqrt(C*C+R*R),rt=_*c*C/$,bt=_*c*R/$;p.p0.x=r.p0.x-bt,p.p0.y=r.p0.y+rt,p.p1.x=r.p1.x-bt,p.p1.y=r.p1.y+rt},ci.prototype.addFilletArc=function(r,o,c,p,_){var C=p===kt.CLOCKWISE?-1:1,R=Math.abs(o-c),$=Math.trunc(R/this._filletAngleQuantum+.5);if($<1)return null;for(var rt=R/$,bt=0,Yt=new yt;bt<R;){var Ht=o+C*bt;Yt.x=r.x+_*Math.cos(Ht),Yt.y=r.y+_*Math.sin(Ht),this._segList.addPt(Yt),bt+=rt}},ci.prototype.addInsideTurn=function(r,o){if(this._li.computeIntersection(this._offset0.p0,this._offset0.p1,this._offset1.p0,this._offset1.p1),this._li.hasIntersection())this._segList.addPt(this._li.getIntersection(0));else if(this._hasNarrowConcaveAngle=!0,this._offset0.p1.distance(this._offset1.p0)<this._distance*ci.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR)this._segList.addPt(this._offset0.p1);else{if(this._segList.addPt(this._offset0.p1),this._closingSegLengthFactor>0){var c=new yt((this._closingSegLengthFactor*this._offset0.p1.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset0.p1.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(c);var p=new yt((this._closingSegLengthFactor*this._offset1.p0.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset1.p0.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(p)}else this._segList.addPt(this._s1);this._segList.addPt(this._offset1.p0)}},ci.prototype.createCircle=function(r){var o=new yt(r.x+this._distance,r.y);this._segList.addPt(o),this.addFilletArc(r,0,2*Math.PI,-1,this._distance),this._segList.closeRing()},ci.prototype.addBevelJoin=function(r,o){this._segList.addPt(r.p1),this._segList.addPt(o.p0)},ci.prototype.init=function(r){this._distance=r,this._maxCurveSegmentError=r*(1-Math.cos(this._filletAngleQuantum/2)),this._segList=new dn,this._segList.setPrecisionModel(this._precisionModel),this._segList.setMinimumVertexDistance(r*ci.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)},ci.prototype.addCollinear=function(r){this._li.computeIntersection(this._s0,this._s1,this._s1,this._s2),this._li.getIntersectionNum()>=2&&(this._bufParams.getJoinStyle()===Nr.JOIN_BEVEL||this._bufParams.getJoinStyle()===Nr.JOIN_MITRE?(r&&this._segList.addPt(this._offset0.p1),this._segList.addPt(this._offset1.p0)):this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,kt.CLOCKWISE,this._distance))},ci.prototype.closeRing=function(){this._segList.closeRing()},ci.prototype.hasNarrowConcaveAngle=function(){return this._hasNarrowConcaveAngle},ci.prototype.interfaces_=function(){return[]},ci.prototype.getClass=function(){return ci},_a.OFFSET_SEGMENT_SEPARATION_FACTOR.get=function(){return .001},_a.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return .001},_a.CURVE_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return 1e-6},_a.MAX_CLOSING_SEG_LEN_FACTOR.get=function(){return 80},Object.defineProperties(ci,_a);var Cn=function(){this._distance=0,this._precisionModel=null,this._bufParams=null;var r=arguments[0],o=arguments[1];this._precisionModel=r,this._bufParams=o};Cn.prototype.getOffsetCurve=function(r,o){if(this._distance=o,o===0)return null;var c=o<0,p=Math.abs(o),_=this.getSegGen(p);r.length<=1?this.computePointCurve(r[0],_):this.computeOffsetCurve(r,c,_);var C=_.getCoordinates();return c&&Tt.reverse(C),C},Cn.prototype.computeSingleSidedBufferCurve=function(r,o,c){var p=this.simplifyTolerance(this._distance);if(o){c.addSegments(r,!0);var _=ui.simplify(r,-p),C=_.length-1;c.initSideSegments(_[C],_[C-1],Ae.LEFT),c.addFirstSegment();for(var R=C-2;R>=0;R--)c.addNextSegment(_[R],!0)}else{c.addSegments(r,!1);var $=ui.simplify(r,p),rt=$.length-1;c.initSideSegments($[0],$[1],Ae.LEFT),c.addFirstSegment();for(var bt=2;bt<=rt;bt++)c.addNextSegment($[bt],!0)}c.addLastSegment(),c.closeRing()},Cn.prototype.computeRingBufferCurve=function(r,o,c){var p=this.simplifyTolerance(this._distance);o===Ae.RIGHT&&(p=-p);var _=ui.simplify(r,p),C=_.length-1;c.initSideSegments(_[C-1],_[0],o);for(var R=1;R<=C;R++){var $=R!==1;c.addNextSegment(_[R],$)}c.closeRing()},Cn.prototype.computeLineBufferCurve=function(r,o){var c=this.simplifyTolerance(this._distance),p=ui.simplify(r,c),_=p.length-1;o.initSideSegments(p[0],p[1],Ae.LEFT);for(var C=2;C<=_;C++)o.addNextSegment(p[C],!0);o.addLastSegment(),o.addLineEndCap(p[_-1],p[_]);var R=ui.simplify(r,-c),$=R.length-1;o.initSideSegments(R[$],R[$-1],Ae.LEFT);for(var rt=$-2;rt>=0;rt--)o.addNextSegment(R[rt],!0);o.addLastSegment(),o.addLineEndCap(R[1],R[0]),o.closeRing()},Cn.prototype.computePointCurve=function(r,o){switch(this._bufParams.getEndCapStyle()){case Nr.CAP_ROUND:o.createCircle(r);break;case Nr.CAP_SQUARE:o.createSquare(r)}},Cn.prototype.getLineCurve=function(r,o){if(this._distance=o,o<0&&!this._bufParams.isSingleSided()||o===0)return null;var c=Math.abs(o),p=this.getSegGen(c);if(r.length<=1)this.computePointCurve(r[0],p);else if(this._bufParams.isSingleSided()){var _=o<0;this.computeSingleSidedBufferCurve(r,_,p)}else this.computeLineBufferCurve(r,p);return p.getCoordinates()},Cn.prototype.getBufferParameters=function(){return this._bufParams},Cn.prototype.simplifyTolerance=function(r){return r*this._bufParams.getSimplifyFactor()},Cn.prototype.getRingCurve=function(r,o,c){if(this._distance=c,r.length<=2)return this.getLineCurve(r,c);if(c===0)return Cn.copyCoordinates(r);var p=this.getSegGen(c);return this.computeRingBufferCurve(r,o,p),p.getCoordinates()},Cn.prototype.computeOffsetCurve=function(r,o,c){var p=this.simplifyTolerance(this._distance);if(o){var _=ui.simplify(r,-p),C=_.length-1;c.initSideSegments(_[C],_[C-1],Ae.LEFT),c.addFirstSegment();for(var R=C-2;R>=0;R--)c.addNextSegment(_[R],!0)}else{var $=ui.simplify(r,p),rt=$.length-1;c.initSideSegments($[0],$[1],Ae.LEFT),c.addFirstSegment();for(var bt=2;bt<=rt;bt++)c.addNextSegment($[bt],!0)}c.addLastSegment()},Cn.prototype.getSegGen=function(r){return new ci(this._precisionModel,this._bufParams,r)},Cn.prototype.interfaces_=function(){return[]},Cn.prototype.getClass=function(){return Cn},Cn.copyCoordinates=function(r){for(var o=new Array(r.length).fill(null),c=0;c<o.length;c++)o[c]=new yt(r[c]);return o};var ws=function(){this._subgraphs=null,this._seg=new Ke,this._cga=new kt;var r=arguments[0];this._subgraphs=r},yl={DepthSegment:{configurable:!0}};ws.prototype.findStabbedSegments=function(){if(arguments.length===1){for(var r=arguments[0],o=new et,c=this._subgraphs.iterator();c.hasNext();){var p=c.next(),_=p.getEnvelope();r.y<_.getMinY()||r.y>_.getMaxY()||this.findStabbedSegments(r,p.getDirectedEdges(),o)}return o}if(arguments.length===3){if(Ne(arguments[2],ut)&&arguments[0]instanceof yt&&arguments[1]instanceof da){for(var C=arguments[0],R=arguments[1],$=arguments[2],rt=R.getEdge().getCoordinates(),bt=0;bt<rt.length-1;bt++)if(this._seg.p0=rt[bt],this._seg.p1=rt[bt+1],this._seg.p0.y>this._seg.p1.y&&this._seg.reverse(),!(Math.max(this._seg.p0.x,this._seg.p1.x)<C.x)&&!(this._seg.isHorizontal()||C.y<this._seg.p0.y||C.y>this._seg.p1.y||kt.computeOrientation(this._seg.p0,this._seg.p1,C)===kt.RIGHT)){var Yt=R.getDepth(Ae.LEFT);this._seg.p0.equals(rt[bt])||(Yt=R.getDepth(Ae.RIGHT));var Ht=new Mr(this._seg,Yt);$.add(Ht)}}else if(Ne(arguments[2],ut)&&arguments[0]instanceof yt&&Ne(arguments[1],ut))for(var Re=arguments[0],ze=arguments[1],Ve=arguments[2],We=ze.iterator();We.hasNext();){var Vr=We.next();Vr.isForward()&&this.findStabbedSegments(Re,Vr,Ve)}}},ws.prototype.getDepth=function(r){var o=this.findStabbedSegments(r);return o.size()===0?0:Do.min(o)._leftDepth},ws.prototype.interfaces_=function(){return[]},ws.prototype.getClass=function(){return ws},yl.DepthSegment.get=function(){return Mr},Object.defineProperties(ws,yl);var Mr=function(){this._upwardSeg=null,this._leftDepth=null;var r=arguments[0],o=arguments[1];this._upwardSeg=new Ke(r),this._leftDepth=o};Mr.prototype.compareTo=function(r){var o=r;if(this._upwardSeg.minX()>=o._upwardSeg.maxX())return 1;if(this._upwardSeg.maxX()<=o._upwardSeg.minX())return-1;var c=this._upwardSeg.orientationIndex(o._upwardSeg);return c!==0||(c=-1*o._upwardSeg.orientationIndex(this._upwardSeg))!=0?c:this._upwardSeg.compareTo(o._upwardSeg)},Mr.prototype.compareX=function(r,o){var c=r.p0.compareTo(o.p0);return c!==0?c:r.p1.compareTo(o.p1)},Mr.prototype.toString=function(){return this._upwardSeg.toString()},Mr.prototype.interfaces_=function(){return[de]},Mr.prototype.getClass=function(){return Mr};var Ur=function(r,o,c){this.p0=r||null,this.p1=o||null,this.p2=c||null};Ur.prototype.area=function(){return Ur.area(this.p0,this.p1,this.p2)},Ur.prototype.signedArea=function(){return Ur.signedArea(this.p0,this.p1,this.p2)},Ur.prototype.interpolateZ=function(r){if(r===null)throw new Et("Supplied point is null.");return Ur.interpolateZ(r,this.p0,this.p1,this.p2)},Ur.prototype.longestSideLength=function(){return Ur.longestSideLength(this.p0,this.p1,this.p2)},Ur.prototype.isAcute=function(){return Ur.isAcute(this.p0,this.p1,this.p2)},Ur.prototype.circumcentre=function(){return Ur.circumcentre(this.p0,this.p1,this.p2)},Ur.prototype.area3D=function(){return Ur.area3D(this.p0,this.p1,this.p2)},Ur.prototype.centroid=function(){return Ur.centroid(this.p0,this.p1,this.p2)},Ur.prototype.inCentre=function(){return Ur.inCentre(this.p0,this.p1,this.p2)},Ur.prototype.interfaces_=function(){return[]},Ur.prototype.getClass=function(){return Ur},Ur.area=function(r,o,c){return Math.abs(((c.x-r.x)*(o.y-r.y)-(o.x-r.x)*(c.y-r.y))/2)},Ur.signedArea=function(r,o,c){return((c.x-r.x)*(o.y-r.y)-(o.x-r.x)*(c.y-r.y))/2},Ur.det=function(r,o,c,p){return r*p-o*c},Ur.interpolateZ=function(r,o,c,p){var _=o.x,C=o.y,R=c.x-_,$=p.x-_,rt=c.y-C,bt=p.y-C,Yt=R*bt-$*rt,Ht=r.x-_,Re=r.y-C,ze=(bt*Ht-$*Re)/Yt,Ve=(-rt*Ht+R*Re)/Yt;return o.z+ze*(c.z-o.z)+Ve*(p.z-o.z)},Ur.longestSideLength=function(r,o,c){var p=r.distance(o),_=o.distance(c),C=c.distance(r),R=p;return _>R&&(R=_),C>R&&(R=C),R},Ur.isAcute=function(r,o,c){return!!zr.isAcute(r,o,c)&&!!zr.isAcute(o,c,r)&&!!zr.isAcute(c,r,o)},Ur.circumcentre=function(r,o,c){var p=c.x,_=c.y,C=r.x-p,R=r.y-_,$=o.x-p,rt=o.y-_,bt=2*Ur.det(C,R,$,rt),Yt=Ur.det(R,C*C+R*R,rt,$*$+rt*rt),Ht=Ur.det(C,C*C+R*R,$,$*$+rt*rt);return new yt(p-Yt/bt,_+Ht/bt)},Ur.perpendicularBisector=function(r,o){var c=o.x-r.x,p=o.y-r.y,_=new He(r.x+c/2,r.y+p/2,1),C=new He(r.x-p+c/2,r.y+c+p/2,1);return new He(_,C)},Ur.angleBisector=function(r,o,c){var p=o.distance(r),_=p/(p+o.distance(c)),C=c.x-r.x,R=c.y-r.y;return new yt(r.x+_*C,r.y+_*R)},Ur.area3D=function(r,o,c){var p=o.x-r.x,_=o.y-r.y,C=o.z-r.z,R=c.x-r.x,$=c.y-r.y,rt=c.z-r.z,bt=_*rt-C*$,Yt=C*R-p*rt,Ht=p*$-_*R,Re=bt*bt+Yt*Yt+Ht*Ht,ze=Math.sqrt(Re)/2;return ze},Ur.centroid=function(r,o,c){var p=(r.x+o.x+c.x)/3,_=(r.y+o.y+c.y)/3;return new yt(p,_)},Ur.inCentre=function(r,o,c){var p=o.distance(c),_=r.distance(c),C=r.distance(o),R=p+_+C,$=(p*r.x+_*o.x+C*c.x)/R,rt=(p*r.y+_*o.y+C*c.y)/R;return new yt($,rt)};var po=function(){this._inputGeom=null,this._distance=null,this._curveBuilder=null,this._curveList=new et;var r=arguments[0],o=arguments[1],c=arguments[2];this._inputGeom=r,this._distance=o,this._curveBuilder=c};po.prototype.addPoint=function(r){if(this._distance<=0)return null;var o=r.getCoordinates(),c=this._curveBuilder.getLineCurve(o,this._distance);this.addCurve(c,wt.EXTERIOR,wt.INTERIOR)},po.prototype.addPolygon=function(r){var o=this._distance,c=Ae.LEFT;this._distance<0&&(o=-this._distance,c=Ae.RIGHT);var p=r.getExteriorRing(),_=Tt.removeRepeatedPoints(p.getCoordinates());if(this._distance<0&&this.isErodedCompletely(p,this._distance)||this._distance<=0&&_.length<3)return null;this.addPolygonRing(_,o,c,wt.EXTERIOR,wt.INTERIOR);for(var C=0;C<r.getNumInteriorRing();C++){var R=r.getInteriorRingN(C),$=Tt.removeRepeatedPoints(R.getCoordinates());this._distance>0&&this.isErodedCompletely(R,-this._distance)||this.addPolygonRing($,o,Ae.opposite(c),wt.INTERIOR,wt.EXTERIOR)}},po.prototype.isTriangleErodedCompletely=function(r,o){var c=new Ur(r[0],r[1],r[2]),p=c.inCentre();return kt.distancePointLine(p,c.p0,c.p1)<Math.abs(o)},po.prototype.addLineString=function(r){if(this._distance<=0&&!this._curveBuilder.getBufferParameters().isSingleSided())return null;var o=Tt.removeRepeatedPoints(r.getCoordinates()),c=this._curveBuilder.getLineCurve(o,this._distance);this.addCurve(c,wt.EXTERIOR,wt.INTERIOR)},po.prototype.addCurve=function(r,o,c){if(r===null||r.length<2)return null;var p=new zi(r,new qr(0,wt.BOUNDARY,o,c));this._curveList.add(p)},po.prototype.getCurves=function(){return this.add(this._inputGeom),this._curveList},po.prototype.addPolygonRing=function(r,o,c,p,_){if(o===0&&r.length<Po.MINIMUM_VALID_SIZE)return null;var C=p,R=_;r.length>=Po.MINIMUM_VALID_SIZE&&kt.isCCW(r)&&(C=_,R=p,c=Ae.opposite(c));var $=this._curveBuilder.getRingCurve(r,c,o);this.addCurve($,C,R)},po.prototype.add=function(r){if(r.isEmpty())return null;r instanceof ai?this.addPolygon(r):r instanceof fi?this.addLineString(r):r instanceof Ln?this.addPoint(r):r instanceof Hs?this.addCollection(r):r instanceof ln?this.addCollection(r):r instanceof Zn?this.addCollection(r):r instanceof Kr&&this.addCollection(r)},po.prototype.isErodedCompletely=function(r,o){var c=r.getCoordinates();if(c.length<4)return o<0;if(c.length===4)return this.isTriangleErodedCompletely(c,o);var p=r.getEnvelopeInternal(),_=Math.min(p.getHeight(),p.getWidth());return o<0&&2*Math.abs(o)>_},po.prototype.addCollection=function(r){for(var o=0;o<r.getNumGeometries();o++){var c=r.getGeometryN(o);this.add(c)}},po.prototype.interfaces_=function(){return[]},po.prototype.getClass=function(){return po};var Qs=function(){};Qs.prototype.locate=function(r){},Qs.prototype.interfaces_=function(){return[]},Qs.prototype.getClass=function(){return Qs};var Ho=function(){this._parent=null,this._atStart=null,this._max=null,this._index=null,this._subcollectionIterator=null;var r=arguments[0];this._parent=r,this._atStart=!0,this._index=0,this._max=r.getNumGeometries()};Ho.prototype.next=function(){if(this._atStart)return this._atStart=!1,Ho.isAtomic(this._parent)&&this._index++,this._parent;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return this._subcollectionIterator.next();this._subcollectionIterator=null}if(this._index>=this._max)throw new z;var r=this._parent.getGeometryN(this._index++);return r instanceof Kr?(this._subcollectionIterator=new Ho(r),this._subcollectionIterator.next()):r},Ho.prototype.remove=function(){throw new Error(this.getClass().getName())},Ho.prototype.hasNext=function(){if(this._atStart)return!0;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return!0;this._subcollectionIterator=null}return!(this._index>=this._max)},Ho.prototype.interfaces_=function(){return[W]},Ho.prototype.getClass=function(){return Ho},Ho.isAtomic=function(r){return!(r instanceof Kr)};var mn=function(){this._geom=null;var r=arguments[0];this._geom=r};mn.prototype.locate=function(r){return mn.locate(r,this._geom)},mn.prototype.interfaces_=function(){return[Qs]},mn.prototype.getClass=function(){return mn},mn.isPointInRing=function(r,o){return!!o.getEnvelopeInternal().intersects(r)&&kt.isPointInRing(r,o.getCoordinates())},mn.containsPointInPolygon=function(r,o){if(o.isEmpty())return!1;var c=o.getExteriorRing();if(!mn.isPointInRing(r,c))return!1;for(var p=0;p<o.getNumInteriorRing();p++){var _=o.getInteriorRingN(p);if(mn.isPointInRing(r,_))return!1}return!0},mn.containsPoint=function(r,o){if(o instanceof ai)return mn.containsPointInPolygon(r,o);if(o instanceof Kr)for(var c=new Ho(o);c.hasNext();){var p=c.next();if(p!==o&&mn.containsPoint(r,p))return!0}return!1},mn.locate=function(r,o){return o.isEmpty()?wt.EXTERIOR:mn.containsPoint(r,o)?wt.INTERIOR:wt.EXTERIOR};var gn=function(){this._edgeMap=new qt,this._edgeList=null,this._ptInAreaLocation=[wt.NONE,wt.NONE]};gn.prototype.getNextCW=function(r){this.getEdges();var o=this._edgeList.indexOf(r),c=o-1;return o===0&&(c=this._edgeList.size()-1),this._edgeList.get(c)},gn.prototype.propagateSideLabels=function(r){for(var o=wt.NONE,c=this.iterator();c.hasNext();){var p=c.next().getLabel();p.isArea(r)&&p.getLocation(r,Ae.LEFT)!==wt.NONE&&(o=p.getLocation(r,Ae.LEFT))}if(o===wt.NONE)return null;for(var _=o,C=this.iterator();C.hasNext();){var R=C.next(),$=R.getLabel();if($.getLocation(r,Ae.ON)===wt.NONE&&$.setLocation(r,Ae.ON,_),$.isArea(r)){var rt=$.getLocation(r,Ae.LEFT),bt=$.getLocation(r,Ae.RIGHT);if(bt!==wt.NONE){if(bt!==_)throw new wo("side location conflict",R.getCoordinate());rt===wt.NONE&&Z.shouldNeverReachHere("found single null side (at "+R.getCoordinate()+")"),_=rt}else Z.isTrue($.getLocation(r,Ae.LEFT)===wt.NONE,"found single null side"),$.setLocation(r,Ae.RIGHT,_),$.setLocation(r,Ae.LEFT,_)}}},gn.prototype.getCoordinate=function(){var r=this.iterator();return r.hasNext()?r.next().getCoordinate():null},gn.prototype.print=function(r){Br.out.println("EdgeEndStar:   "+this.getCoordinate());for(var o=this.iterator();o.hasNext();)o.next().print(r)},gn.prototype.isAreaLabelsConsistent=function(r){return this.computeEdgeEndLabels(r.getBoundaryNodeRule()),this.checkAreaLabelsConsistent(0)},gn.prototype.checkAreaLabelsConsistent=function(r){var o=this.getEdges();if(o.size()<=0)return!0;var c=o.size()-1,p=o.get(c).getLabel().getLocation(r,Ae.LEFT);Z.isTrue(p!==wt.NONE,"Found unlabelled area edge");for(var _=p,C=this.iterator();C.hasNext();){var R=C.next().getLabel();Z.isTrue(R.isArea(r),"Found non-area edge");var $=R.getLocation(r,Ae.LEFT),rt=R.getLocation(r,Ae.RIGHT);if($===rt||rt!==_)return!1;_=$}return!0},gn.prototype.findIndex=function(r){this.iterator();for(var o=0;o<this._edgeList.size();o++)if(this._edgeList.get(o)===r)return o;return-1},gn.prototype.iterator=function(){return this.getEdges().iterator()},gn.prototype.getEdges=function(){return this._edgeList===null&&(this._edgeList=new et(this._edgeMap.values())),this._edgeList},gn.prototype.getLocation=function(r,o,c){return this._ptInAreaLocation[r]===wt.NONE&&(this._ptInAreaLocation[r]=mn.locate(o,c[r].getGeometry())),this._ptInAreaLocation[r]},gn.prototype.toString=function(){var r=new ti;r.append("EdgeEndStar:   "+this.getCoordinate()),r.append(`
`);for(var o=this.iterator();o.hasNext();){var c=o.next();r.append(c),r.append(`
`)}return r.toString()},gn.prototype.computeEdgeEndLabels=function(r){for(var o=this.iterator();o.hasNext();)o.next().computeLabel(r)},gn.prototype.computeLabelling=function(r){this.computeEdgeEndLabels(r[0].getBoundaryNodeRule()),this.propagateSideLabels(0),this.propagateSideLabels(1);for(var o=[!1,!1],c=this.iterator();c.hasNext();)for(var p=c.next().getLabel(),_=0;_<2;_++)p.isLine(_)&&p.getLocation(_)===wt.BOUNDARY&&(o[_]=!0);for(var C=this.iterator();C.hasNext();)for(var R=C.next(),$=R.getLabel(),rt=0;rt<2;rt++)if($.isAnyNull(rt)){var bt=wt.NONE;if(o[rt])bt=wt.EXTERIOR;else{var Yt=R.getCoordinate();bt=this.getLocation(rt,Yt,r)}$.setAllLocationsIfNull(rt,bt)}},gn.prototype.getDegree=function(){return this._edgeMap.size()},gn.prototype.insertEdgeEnd=function(r,o){this._edgeMap.put(r,o),this._edgeList=null},gn.prototype.interfaces_=function(){return[]},gn.prototype.getClass=function(){return gn};var Ku=function(r){function o(){r.call(this),this._resultAreaEdgeList=null,this._label=null,this._SCANNING_FOR_INCOMING=1,this._LINKING_TO_OUTGOING=2}return r&&(o.__proto__=r),o.prototype=Object.create(r&&r.prototype),o.prototype.constructor=o,o.prototype.linkResultDirectedEdges=function(){this.getResultAreaEdges();for(var c=null,p=null,_=this._SCANNING_FOR_INCOMING,C=0;C<this._resultAreaEdgeList.size();C++){var R=this._resultAreaEdgeList.get(C),$=R.getSym();if(R.getLabel().isArea())switch(c===null&&R.isInResult()&&(c=R),_){case this._SCANNING_FOR_INCOMING:if(!$.isInResult())continue;p=$,_=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(!R.isInResult())continue;p.setNext(R),_=this._SCANNING_FOR_INCOMING}}if(_===this._LINKING_TO_OUTGOING){if(c===null)throw new wo("no outgoing dirEdge found",this.getCoordinate());Z.isTrue(c.isInResult(),"unable to link last incoming dirEdge"),p.setNext(c)}},o.prototype.insert=function(c){var p=c;this.insertEdgeEnd(p,p)},o.prototype.getRightmostEdge=function(){var c=this.getEdges(),p=c.size();if(p<1)return null;var _=c.get(0);if(p===1)return _;var C=c.get(p-1),R=_.getQuadrant(),$=C.getQuadrant();return br.isNorthern(R)&&br.isNorthern($)?_:br.isNorthern(R)||br.isNorthern($)?_.getDy()!==0?_:C.getDy()!==0?C:(Z.shouldNeverReachHere("found two horizontal edges incident on node"),null):C},o.prototype.print=function(c){Br.out.println("DirectedEdgeStar: "+this.getCoordinate());for(var p=this.iterator();p.hasNext();){var _=p.next();c.print("out "),_.print(c),c.println(),c.print("in "),_.getSym().print(c),c.println()}},o.prototype.getResultAreaEdges=function(){if(this._resultAreaEdgeList!==null)return this._resultAreaEdgeList;this._resultAreaEdgeList=new et;for(var c=this.iterator();c.hasNext();){var p=c.next();(p.isInResult()||p.getSym().isInResult())&&this._resultAreaEdgeList.add(p)}return this._resultAreaEdgeList},o.prototype.updateLabelling=function(c){for(var p=this.iterator();p.hasNext();){var _=p.next().getLabel();_.setAllLocationsIfNull(0,c.getLocation(0)),_.setAllLocationsIfNull(1,c.getLocation(1))}},o.prototype.linkAllDirectedEdges=function(){this.getEdges();for(var c=null,p=null,_=this._edgeList.size()-1;_>=0;_--){var C=this._edgeList.get(_),R=C.getSym();p===null&&(p=R),c!==null&&R.setNext(c),c=C}p.setNext(c)},o.prototype.computeDepths=function(){if(arguments.length===1){var c=arguments[0],p=this.findIndex(c),_=c.getDepth(Ae.LEFT),C=c.getDepth(Ae.RIGHT),R=this.computeDepths(p+1,this._edgeList.size(),_);if(this.computeDepths(0,p,R)!==C)throw new wo("depth mismatch at "+c.getCoordinate())}else if(arguments.length===3){for(var $=arguments[0],rt=arguments[1],bt=arguments[2],Yt=$;Yt<rt;Yt++){var Ht=this._edgeList.get(Yt);Ht.setEdgeDepths(Ae.RIGHT,bt),bt=Ht.getDepth(Ae.LEFT)}return bt}},o.prototype.mergeSymLabels=function(){for(var c=this.iterator();c.hasNext();){var p=c.next();p.getLabel().merge(p.getSym().getLabel())}},o.prototype.linkMinimalDirectedEdges=function(c){for(var p=null,_=null,C=this._SCANNING_FOR_INCOMING,R=this._resultAreaEdgeList.size()-1;R>=0;R--){var $=this._resultAreaEdgeList.get(R),rt=$.getSym();switch(p===null&&$.getEdgeRing()===c&&(p=$),C){case this._SCANNING_FOR_INCOMING:if(rt.getEdgeRing()!==c)continue;_=rt,C=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if($.getEdgeRing()!==c)continue;_.setNextMin($),C=this._SCANNING_FOR_INCOMING}}C===this._LINKING_TO_OUTGOING&&(Z.isTrue(p!==null,"found null for first outgoing dirEdge"),Z.isTrue(p.getEdgeRing()===c,"unable to link last incoming dirEdge"),_.setNextMin(p))},o.prototype.getOutgoingDegree=function(){if(arguments.length===0){for(var c=0,p=this.iterator();p.hasNext();)p.next().isInResult()&&c++;return c}if(arguments.length===1){for(var _=arguments[0],C=0,R=this.iterator();R.hasNext();)R.next().getEdgeRing()===_&&C++;return C}},o.prototype.getLabel=function(){return this._label},o.prototype.findCoveredLineEdges=function(){for(var c=wt.NONE,p=this.iterator();p.hasNext();){var _=p.next(),C=_.getSym();if(!_.isLineEdge()){if(_.isInResult()){c=wt.INTERIOR;break}if(C.isInResult()){c=wt.EXTERIOR;break}}}if(c===wt.NONE)return null;for(var R=c,$=this.iterator();$.hasNext();){var rt=$.next(),bt=rt.getSym();rt.isLineEdge()?rt.getEdge().setCovered(R===wt.INTERIOR):(rt.isInResult()&&(R=wt.EXTERIOR),bt.isInResult()&&(R=wt.INTERIOR))}},o.prototype.computeLabelling=function(c){r.prototype.computeLabelling.call(this,c),this._label=new qr(wt.NONE);for(var p=this.iterator();p.hasNext();)for(var _=p.next().getEdge().getLabel(),C=0;C<2;C++){var R=_.getLocation(C);R!==wt.INTERIOR&&R!==wt.BOUNDARY||this._label.setLocation(C,wt.INTERIOR)}},o.prototype.interfaces_=function(){return[]},o.prototype.getClass=function(){return o},o}(gn),ou=function(r){function o(){r.apply(this,arguments)}return r&&(o.__proto__=r),o.prototype=Object.create(r&&r.prototype),o.prototype.constructor=o,o.prototype.createNode=function(c){return new Oa(c,new Ku)},o.prototype.interfaces_=function(){return[]},o.prototype.getClass=function(){return o},o}(xi),ks=function r(){this._pts=null,this._orientation=null;var o=arguments[0];this._pts=o,this._orientation=r.orientation(o)};ks.prototype.compareTo=function(r){var o=r;return ks.compareOriented(this._pts,this._orientation,o._pts,o._orientation)},ks.prototype.interfaces_=function(){return[de]},ks.prototype.getClass=function(){return ks},ks.orientation=function(r){return Tt.increasingDirection(r)===1},ks.compareOriented=function(r,o,c,p){for(var _=o?1:-1,C=p?1:-1,R=o?r.length:-1,$=p?c.length:-1,rt=o?0:r.length-1,bt=p?0:c.length-1;;){var Yt=r[rt].compareTo(c[bt]);if(Yt!==0)return Yt;var Ht=(rt+=_)===R,Re=(bt+=C)===$;if(Ht&&!Re)return-1;if(!Ht&&Re)return 1;if(Ht&&Re)return 0}};var fo=function(){this._edges=new et,this._ocaMap=new qt};fo.prototype.print=function(r){r.print("MULTILINESTRING ( ");for(var o=0;o<this._edges.size();o++){var c=this._edges.get(o);o>0&&r.print(","),r.print("(");for(var p=c.getCoordinates(),_=0;_<p.length;_++)_>0&&r.print(","),r.print(p[_].x+" "+p[_].y);r.println(")")}r.print(")  ")},fo.prototype.addAll=function(r){for(var o=r.iterator();o.hasNext();)this.add(o.next())},fo.prototype.findEdgeIndex=function(r){for(var o=0;o<this._edges.size();o++)if(this._edges.get(o).equals(r))return o;return-1},fo.prototype.iterator=function(){return this._edges.iterator()},fo.prototype.getEdges=function(){return this._edges},fo.prototype.get=function(r){return this._edges.get(r)},fo.prototype.findEqualEdge=function(r){var o=new ks(r.getCoordinates());return this._ocaMap.get(o)},fo.prototype.add=function(r){this._edges.add(r);var o=new ks(r.getCoordinates());this._ocaMap.put(o,r)},fo.prototype.interfaces_=function(){return[]},fo.prototype.getClass=function(){return fo};var Es=function(){};Es.prototype.processIntersections=function(r,o,c,p){},Es.prototype.isDone=function(){},Es.prototype.interfaces_=function(){return[]},Es.prototype.getClass=function(){return Es};var Wn=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._hasInterior=!1,this._properIntersectionPoint=null,this._li=null,this._isSelfIntersection=null,this.numIntersections=0,this.numInteriorIntersections=0,this.numProperIntersections=0,this.numTests=0;var r=arguments[0];this._li=r};Wn.prototype.isTrivialIntersection=function(r,o,c,p){if(r===c&&this._li.getIntersectionNum()===1){if(Wn.isAdjacentSegments(o,p))return!0;if(r.isClosed()){var _=r.size()-1;if(o===0&&p===_||p===0&&o===_)return!0}}return!1},Wn.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint},Wn.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior},Wn.prototype.getLineIntersector=function(){return this._li},Wn.prototype.hasProperIntersection=function(){return this._hasProper},Wn.prototype.processIntersections=function(r,o,c,p){if(r===c&&o===p)return null;this.numTests++;var _=r.getCoordinates()[o],C=r.getCoordinates()[o+1],R=c.getCoordinates()[p],$=c.getCoordinates()[p+1];this._li.computeIntersection(_,C,R,$),this._li.hasIntersection()&&(this.numIntersections++,this._li.isInteriorIntersection()&&(this.numInteriorIntersections++,this._hasInterior=!0),this.isTrivialIntersection(r,o,c,p)||(this._hasIntersection=!0,r.addIntersections(this._li,o,0),c.addIntersections(this._li,p,1),this._li.isProper()&&(this.numProperIntersections++,this._hasProper=!0,this._hasProperInterior=!0)))},Wn.prototype.hasIntersection=function(){return this._hasIntersection},Wn.prototype.isDone=function(){return!1},Wn.prototype.hasInteriorIntersection=function(){return this._hasInterior},Wn.prototype.interfaces_=function(){return[Es]},Wn.prototype.getClass=function(){return Wn},Wn.isAdjacentSegments=function(r,o){return Math.abs(r-o)===1};var mo=function(){this.coord=null,this.segmentIndex=null,this.dist=null;var r=arguments[0],o=arguments[1],c=arguments[2];this.coord=new yt(r),this.segmentIndex=o,this.dist=c};mo.prototype.getSegmentIndex=function(){return this.segmentIndex},mo.prototype.getCoordinate=function(){return this.coord},mo.prototype.print=function(r){r.print(this.coord),r.print(" seg # = "+this.segmentIndex),r.println(" dist = "+this.dist)},mo.prototype.compareTo=function(r){var o=r;return this.compare(o.segmentIndex,o.dist)},mo.prototype.isEndPoint=function(r){return this.segmentIndex===0&&this.dist===0||this.segmentIndex===r},mo.prototype.toString=function(){return this.coord+" seg # = "+this.segmentIndex+" dist = "+this.dist},mo.prototype.getDistance=function(){return this.dist},mo.prototype.compare=function(r,o){return this.segmentIndex<r?-1:this.segmentIndex>r?1:this.dist<o?-1:this.dist>o?1:0},mo.prototype.interfaces_=function(){return[de]},mo.prototype.getClass=function(){return mo};var Ko=function(){this._nodeMap=new qt,this.edge=null;var r=arguments[0];this.edge=r};Ko.prototype.print=function(r){r.println("Intersections:");for(var o=this.iterator();o.hasNext();)o.next().print(r)},Ko.prototype.iterator=function(){return this._nodeMap.values().iterator()},Ko.prototype.addSplitEdges=function(r){this.addEndpoints();for(var o=this.iterator(),c=o.next();o.hasNext();){var p=o.next(),_=this.createSplitEdge(c,p);r.add(_),c=p}},Ko.prototype.addEndpoints=function(){var r=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0),this.add(this.edge.pts[r],r,0)},Ko.prototype.createSplitEdge=function(r,o){var c=o.segmentIndex-r.segmentIndex+2,p=this.edge.pts[o.segmentIndex],_=o.dist>0||!o.coord.equals2D(p);_||c--;var C=new Array(c).fill(null),R=0;C[R++]=new yt(r.coord);for(var $=r.segmentIndex+1;$<=o.segmentIndex;$++)C[R++]=this.edge.pts[$];return _&&(C[R]=o.coord),new za(C,new qr(this.edge._label))},Ko.prototype.add=function(r,o,c){var p=new mo(r,o,c),_=this._nodeMap.get(p);return _!==null?_:(this._nodeMap.put(p,p),p)},Ko.prototype.isIntersection=function(r){for(var o=this.iterator();o.hasNext();)if(o.next().coord.equals(r))return!0;return!1},Ko.prototype.interfaces_=function(){return[]},Ko.prototype.getClass=function(){return Ko};var Bs=function(){};Bs.prototype.getChainStartIndices=function(r){var o=0,c=new et;c.add(new Pe(o));do{var p=this.findChainEnd(r,o);c.add(new Pe(p)),o=p}while(o<r.length-1);return Bs.toIntArray(c)},Bs.prototype.findChainEnd=function(r,o){for(var c=br.quadrant(r[o],r[o+1]),p=o+1;p<r.length&&br.quadrant(r[p-1],r[p])===c;)p++;return p-1},Bs.prototype.interfaces_=function(){return[]},Bs.prototype.getClass=function(){return Bs},Bs.toIntArray=function(r){for(var o=new Array(r.size()).fill(null),c=0;c<o.length;c++)o[c]=r.get(c).intValue();return o};var Ts=function(){this.e=null,this.pts=null,this.startIndex=null,this.env1=new qe,this.env2=new qe;var r=arguments[0];this.e=r,this.pts=r.getCoordinates();var o=new Bs;this.startIndex=o.getChainStartIndices(this.pts)};Ts.prototype.getCoordinates=function(){return this.pts},Ts.prototype.getMaxX=function(r){var o=this.pts[this.startIndex[r]].x,c=this.pts[this.startIndex[r+1]].x;return o>c?o:c},Ts.prototype.getMinX=function(r){var o=this.pts[this.startIndex[r]].x,c=this.pts[this.startIndex[r+1]].x;return o<c?o:c},Ts.prototype.computeIntersectsForChain=function(){if(arguments.length===4){var r=arguments[0],o=arguments[1],c=arguments[2],p=arguments[3];this.computeIntersectsForChain(this.startIndex[r],this.startIndex[r+1],o,o.startIndex[c],o.startIndex[c+1],p)}else if(arguments.length===6){var _=arguments[0],C=arguments[1],R=arguments[2],$=arguments[3],rt=arguments[4],bt=arguments[5],Yt=this.pts[_],Ht=this.pts[C],Re=R.pts[$],ze=R.pts[rt];if(C-_==1&&rt-$==1)return bt.addIntersections(this.e,_,R.e,$),null;if(this.env1.init(Yt,Ht),this.env2.init(Re,ze),!this.env1.intersects(this.env2))return null;var Ve=Math.trunc((_+C)/2),We=Math.trunc(($+rt)/2);_<Ve&&($<We&&this.computeIntersectsForChain(_,Ve,R,$,We,bt),We<rt&&this.computeIntersectsForChain(_,Ve,R,We,rt,bt)),Ve<C&&($<We&&this.computeIntersectsForChain(Ve,C,R,$,We,bt),We<rt&&this.computeIntersectsForChain(Ve,C,R,We,rt,bt))}},Ts.prototype.getStartIndexes=function(){return this.startIndex},Ts.prototype.computeIntersects=function(r,o){for(var c=0;c<this.startIndex.length-1;c++)for(var p=0;p<r.startIndex.length-1;p++)this.computeIntersectsForChain(c,r,p,o)},Ts.prototype.interfaces_=function(){return[]},Ts.prototype.getClass=function(){return Ts};var Ji=function r(){this._depth=Array(2).fill().map(function(){return Array(3)});for(var o=0;o<2;o++)for(var c=0;c<3;c++)this._depth[o][c]=r.NULL_VALUE},ya={NULL_VALUE:{configurable:!0}};Ji.prototype.getDepth=function(r,o){return this._depth[r][o]},Ji.prototype.setDepth=function(r,o,c){this._depth[r][o]=c},Ji.prototype.isNull=function(){if(arguments.length===0){for(var r=0;r<2;r++)for(var o=0;o<3;o++)if(this._depth[r][o]!==Ji.NULL_VALUE)return!1;return!0}if(arguments.length===1){var c=arguments[0];return this._depth[c][1]===Ji.NULL_VALUE}if(arguments.length===2){var p=arguments[0],_=arguments[1];return this._depth[p][_]===Ji.NULL_VALUE}},Ji.prototype.normalize=function(){for(var r=0;r<2;r++)if(!this.isNull(r)){var o=this._depth[r][1];this._depth[r][2]<o&&(o=this._depth[r][2]),o<0&&(o=0);for(var c=1;c<3;c++){var p=0;this._depth[r][c]>o&&(p=1),this._depth[r][c]=p}}},Ji.prototype.getDelta=function(r){return this._depth[r][Ae.RIGHT]-this._depth[r][Ae.LEFT]},Ji.prototype.getLocation=function(r,o){return this._depth[r][o]<=0?wt.EXTERIOR:wt.INTERIOR},Ji.prototype.toString=function(){return"A: "+this._depth[0][1]+","+this._depth[0][2]+" B: "+this._depth[1][1]+","+this._depth[1][2]},Ji.prototype.add=function(){if(arguments.length===1)for(var r=arguments[0],o=0;o<2;o++)for(var c=1;c<3;c++){var p=r.getLocation(o,c);p!==wt.EXTERIOR&&p!==wt.INTERIOR||(this.isNull(o,c)?this._depth[o][c]=Ji.depthAtLocation(p):this._depth[o][c]+=Ji.depthAtLocation(p))}else if(arguments.length===3){var _=arguments[0],C=arguments[1];arguments[2]===wt.INTERIOR&&this._depth[_][C]++}},Ji.prototype.interfaces_=function(){return[]},Ji.prototype.getClass=function(){return Ji},Ji.depthAtLocation=function(r){return r===wt.EXTERIOR?0:r===wt.INTERIOR?1:Ji.NULL_VALUE},ya.NULL_VALUE.get=function(){return-1},Object.defineProperties(Ji,ya);var za=function(r){function o(){if(r.call(this),this.pts=null,this._env=null,this.eiList=new Ko(this),this._name=null,this._mce=null,this._isIsolated=!0,this._depth=new Ji,this._depthDelta=0,arguments.length===1){var c=arguments[0];o.call(this,c,null)}else if(arguments.length===2){var p=arguments[0],_=arguments[1];this.pts=p,this._label=_}}return r&&(o.__proto__=r),o.prototype=Object.create(r&&r.prototype),o.prototype.constructor=o,o.prototype.getDepth=function(){return this._depth},o.prototype.getCollapsedEdge=function(){var c=new Array(2).fill(null);return c[0]=this.pts[0],c[1]=this.pts[1],new o(c,qr.toLineLabel(this._label))},o.prototype.isIsolated=function(){return this._isIsolated},o.prototype.getCoordinates=function(){return this.pts},o.prototype.setIsolated=function(c){this._isIsolated=c},o.prototype.setName=function(c){this._name=c},o.prototype.equals=function(c){if(!(c instanceof o))return!1;var p=c;if(this.pts.length!==p.pts.length)return!1;for(var _=!0,C=!0,R=this.pts.length,$=0;$<this.pts.length;$++)if(this.pts[$].equals2D(p.pts[$])||(_=!1),this.pts[$].equals2D(p.pts[--R])||(C=!1),!_&&!C)return!1;return!0},o.prototype.getCoordinate=function(){if(arguments.length===0)return this.pts.length>0?this.pts[0]:null;if(arguments.length===1){var c=arguments[0];return this.pts[c]}},o.prototype.print=function(c){c.print("edge "+this._name+": "),c.print("LINESTRING (");for(var p=0;p<this.pts.length;p++)p>0&&c.print(","),c.print(this.pts[p].x+" "+this.pts[p].y);c.print(")  "+this._label+" "+this._depthDelta)},o.prototype.computeIM=function(c){o.updateIM(this._label,c)},o.prototype.isCollapsed=function(){return!!this._label.isArea()&&this.pts.length===3&&!!this.pts[0].equals(this.pts[2])},o.prototype.isClosed=function(){return this.pts[0].equals(this.pts[this.pts.length-1])},o.prototype.getMaximumSegmentIndex=function(){return this.pts.length-1},o.prototype.getDepthDelta=function(){return this._depthDelta},o.prototype.getNumPoints=function(){return this.pts.length},o.prototype.printReverse=function(c){c.print("edge "+this._name+": ");for(var p=this.pts.length-1;p>=0;p--)c.print(this.pts[p]+" ");c.println("")},o.prototype.getMonotoneChainEdge=function(){return this._mce===null&&(this._mce=new Ts(this)),this._mce},o.prototype.getEnvelope=function(){if(this._env===null){this._env=new qe;for(var c=0;c<this.pts.length;c++)this._env.expandToInclude(this.pts[c])}return this._env},o.prototype.addIntersection=function(c,p,_,C){var R=new yt(c.getIntersection(C)),$=p,rt=c.getEdgeDistance(_,C),bt=$+1;if(bt<this.pts.length){var Yt=this.pts[bt];R.equals2D(Yt)&&($=bt,rt=0)}this.eiList.add(R,$,rt)},o.prototype.toString=function(){var c=new ti;c.append("edge "+this._name+": "),c.append("LINESTRING (");for(var p=0;p<this.pts.length;p++)p>0&&c.append(","),c.append(this.pts[p].x+" "+this.pts[p].y);return c.append(")  "+this._label+" "+this._depthDelta),c.toString()},o.prototype.isPointwiseEqual=function(c){if(this.pts.length!==c.pts.length)return!1;for(var p=0;p<this.pts.length;p++)if(!this.pts[p].equals2D(c.pts[p]))return!1;return!0},o.prototype.setDepthDelta=function(c){this._depthDelta=c},o.prototype.getEdgeIntersectionList=function(){return this.eiList},o.prototype.addIntersections=function(c,p,_){for(var C=0;C<c.getIntersectionNum();C++)this.addIntersection(c,p,_,C)},o.prototype.interfaces_=function(){return[]},o.prototype.getClass=function(){return o},o.updateIM=function(){if(arguments.length!==2)return r.prototype.updateIM.apply(this,arguments);var c=arguments[0],p=arguments[1];p.setAtLeastIfValid(c.getLocation(0,Ae.ON),c.getLocation(1,Ae.ON),1),c.isArea()&&(p.setAtLeastIfValid(c.getLocation(0,Ae.LEFT),c.getLocation(1,Ae.LEFT),2),p.setAtLeastIfValid(c.getLocation(0,Ae.RIGHT),c.getLocation(1,Ae.RIGHT),2))},o}(Yr),cn=function(r){this._workingPrecisionModel=null,this._workingNoder=null,this._geomFact=null,this._graph=null,this._edgeList=new fo,this._bufParams=r||null};cn.prototype.setWorkingPrecisionModel=function(r){this._workingPrecisionModel=r},cn.prototype.insertUniqueEdge=function(r){var o=this._edgeList.findEqualEdge(r);if(o!==null){var c=o.getLabel(),p=r.getLabel();o.isPointwiseEqual(r)||(p=new qr(r.getLabel())).flip(),c.merge(p);var _=cn.depthDelta(p),C=o.getDepthDelta()+_;o.setDepthDelta(C)}else this._edgeList.add(r),r.setDepthDelta(cn.depthDelta(r.getLabel()))},cn.prototype.buildSubgraphs=function(r,o){for(var c=new et,p=r.iterator();p.hasNext();){var _=p.next(),C=_.getRightmostCoordinate(),R=new ws(c).getDepth(C);_.computeDepth(R),_.findResultEdges(),c.add(_),o.add(_.getDirectedEdges(),_.getNodes())}},cn.prototype.createSubgraphs=function(r){for(var o=new et,c=r.getNodes().iterator();c.hasNext();){var p=c.next();if(!p.isVisited()){var _=new Dn;_.create(p),o.add(_)}}return Do.sort(o,Do.reverseOrder()),o},cn.prototype.createEmptyResultGeometry=function(){return this._geomFact.createPolygon()},cn.prototype.getNoder=function(r){if(this._workingNoder!==null)return this._workingNoder;var o=new gl,c=new Dt;return c.setPrecisionModel(r),o.setSegmentIntersector(new Wn(c)),o},cn.prototype.buffer=function(r,o){var c=this._workingPrecisionModel;c===null&&(c=r.getPrecisionModel()),this._geomFact=r.getFactory();var p=new Cn(c,this._bufParams),_=new po(r,o,p).getCurves();if(_.size()<=0)return this.createEmptyResultGeometry();this.computeNodedEdges(_,c),this._graph=new li(new ou),this._graph.addEdges(this._edgeList.getEdges());var C=this.createSubgraphs(this._graph),R=new jn(this._geomFact);this.buildSubgraphs(C,R);var $=R.getPolygons();return $.size()<=0?this.createEmptyResultGeometry():this._geomFact.buildGeometry($)},cn.prototype.computeNodedEdges=function(r,o){var c=this.getNoder(o);c.computeNodes(r);for(var p=c.getNodedSubstrings().iterator();p.hasNext();){var _=p.next(),C=_.getCoordinates();if(C.length!==2||!C[0].equals2D(C[1])){var R=_.getData(),$=new za(_.getCoordinates(),new qr(R));this.insertUniqueEdge($)}}},cn.prototype.setNoder=function(r){this._workingNoder=r},cn.prototype.interfaces_=function(){return[]},cn.prototype.getClass=function(){return cn},cn.depthDelta=function(r){var o=r.getLocation(0,Ae.LEFT),c=r.getLocation(0,Ae.RIGHT);return o===wt.INTERIOR&&c===wt.EXTERIOR?1:o===wt.EXTERIOR&&c===wt.INTERIOR?-1:0},cn.convertSegStrings=function(r){for(var o=new lr,c=new et;r.hasNext();){var p=r.next(),_=o.createLineString(p.getCoordinates());c.add(_)}return o.buildGeometry(c)};var ms=function(){if(this._noder=null,this._scaleFactor=null,this._offsetX=null,this._offsetY=null,this._isScaled=!1,arguments.length===2){var r=arguments[0],o=arguments[1];this._noder=r,this._scaleFactor=o,this._offsetX=0,this._offsetY=0,this._isScaled=!this.isIntegerPrecision()}else if(arguments.length===4){var c=arguments[0],p=arguments[1],_=arguments[2],C=arguments[3];this._noder=c,this._scaleFactor=p,this._offsetX=_,this._offsetY=C,this._isScaled=!this.isIntegerPrecision()}};ms.prototype.rescale=function(){if(Ne(arguments[0],X))for(var r=arguments[0].iterator();r.hasNext();){var o=r.next();this.rescale(o.getCoordinates())}else if(arguments[0]instanceof Array){for(var c=arguments[0],p=0;p<c.length;p++)c[p].x=c[p].x/this._scaleFactor+this._offsetX,c[p].y=c[p].y/this._scaleFactor+this._offsetY;c.length===2&&c[0].equals2D(c[1])&&Br.out.println(c)}},ms.prototype.scale=function(){if(Ne(arguments[0],X)){for(var r=arguments[0],o=new et,c=r.iterator();c.hasNext();){var p=c.next();o.add(new zi(this.scale(p.getCoordinates()),p.getData()))}return o}if(arguments[0]instanceof Array){for(var _=arguments[0],C=new Array(_.length).fill(null),R=0;R<_.length;R++)C[R]=new yt(Math.round((_[R].x-this._offsetX)*this._scaleFactor),Math.round((_[R].y-this._offsetY)*this._scaleFactor),_[R].z);return Tt.removeRepeatedPoints(C)}},ms.prototype.isIntegerPrecision=function(){return this._scaleFactor===1},ms.prototype.getNodedSubstrings=function(){var r=this._noder.getNodedSubstrings();return this._isScaled&&this.rescale(r),r},ms.prototype.computeNodes=function(r){var o=r;this._isScaled&&(o=this.scale(r)),this._noder.computeNodes(o)},ms.prototype.interfaces_=function(){return[zs]},ms.prototype.getClass=function(){return ms};var _n=function(){this._li=new Dt,this._segStrings=null;var r=arguments[0];this._segStrings=r},tl={fact:{configurable:!0}};_n.prototype.checkEndPtVertexIntersections=function(){if(arguments.length===0)for(var r=this._segStrings.iterator();r.hasNext();){var o=r.next().getCoordinates();this.checkEndPtVertexIntersections(o[0],this._segStrings),this.checkEndPtVertexIntersections(o[o.length-1],this._segStrings)}else if(arguments.length===2){for(var c=arguments[0],p=arguments[1].iterator();p.hasNext();)for(var _=p.next().getCoordinates(),C=1;C<_.length-1;C++)if(_[C].equals(c))throw new zt("found endpt/interior pt intersection at index "+C+" :pt "+c)}},_n.prototype.checkInteriorIntersections=function(){if(arguments.length===0)for(var r=this._segStrings.iterator();r.hasNext();)for(var o=r.next(),c=this._segStrings.iterator();c.hasNext();){var p=c.next();this.checkInteriorIntersections(o,p)}else if(arguments.length===2)for(var _=arguments[0],C=arguments[1],R=_.getCoordinates(),$=C.getCoordinates(),rt=0;rt<R.length-1;rt++)for(var bt=0;bt<$.length-1;bt++)this.checkInteriorIntersections(_,rt,C,bt);else if(arguments.length===4){var Yt=arguments[0],Ht=arguments[1],Re=arguments[2],ze=arguments[3];if(Yt===Re&&Ht===ze)return null;var Ve=Yt.getCoordinates()[Ht],We=Yt.getCoordinates()[Ht+1],Vr=Re.getCoordinates()[ze],Bi=Re.getCoordinates()[ze+1];if(this._li.computeIntersection(Ve,We,Vr,Bi),this._li.hasIntersection()&&(this._li.isProper()||this.hasInteriorIntersection(this._li,Ve,We)||this.hasInteriorIntersection(this._li,Vr,Bi)))throw new zt("found non-noded intersection at "+Ve+"-"+We+" and "+Vr+"-"+Bi)}},_n.prototype.checkValid=function(){this.checkEndPtVertexIntersections(),this.checkInteriorIntersections(),this.checkCollapses()},_n.prototype.checkCollapses=function(){if(arguments.length===0)for(var r=this._segStrings.iterator();r.hasNext();){var o=r.next();this.checkCollapses(o)}else if(arguments.length===1)for(var c=arguments[0].getCoordinates(),p=0;p<c.length-2;p++)this.checkCollapse(c[p],c[p+1],c[p+2])},_n.prototype.hasInteriorIntersection=function(r,o,c){for(var p=0;p<r.getIntersectionNum();p++){var _=r.getIntersection(p);if(!_.equals(o)&&!_.equals(c))return!0}return!1},_n.prototype.checkCollapse=function(r,o,c){if(r.equals(c))throw new zt("found non-noded collapse at "+_n.fact.createLineString([r,o,c]))},_n.prototype.interfaces_=function(){return[]},_n.prototype.getClass=function(){return _n},tl.fact.get=function(){return new lr},Object.defineProperties(_n,tl);var Rn=function(){this._li=null,this._pt=null,this._originalPt=null,this._ptScaled=null,this._p0Scaled=null,this._p1Scaled=null,this._scaleFactor=null,this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,this._corner=new Array(4).fill(null),this._safeEnv=null;var r=arguments[0],o=arguments[1],c=arguments[2];if(this._originalPt=r,this._pt=r,this._scaleFactor=o,this._li=c,o<=0)throw new Et("Scale factor must be non-zero");o!==1&&(this._pt=new yt(this.scale(r.x),this.scale(r.y)),this._p0Scaled=new yt,this._p1Scaled=new yt),this.initCorners(this._pt)},el={SAFE_ENV_EXPANSION_FACTOR:{configurable:!0}};Rn.prototype.intersectsScaled=function(r,o){var c=Math.min(r.x,o.x),p=Math.max(r.x,o.x),_=Math.min(r.y,o.y),C=Math.max(r.y,o.y),R=this._maxx<c||this._minx>p||this._maxy<_||this._miny>C;if(R)return!1;var $=this.intersectsToleranceSquare(r,o);return Z.isTrue(!(R&&$),"Found bad envelope test"),$},Rn.prototype.initCorners=function(r){this._minx=r.x-.5,this._maxx=r.x+.5,this._miny=r.y-.5,this._maxy=r.y+.5,this._corner[0]=new yt(this._maxx,this._maxy),this._corner[1]=new yt(this._minx,this._maxy),this._corner[2]=new yt(this._minx,this._miny),this._corner[3]=new yt(this._maxx,this._miny)},Rn.prototype.intersects=function(r,o){return this._scaleFactor===1?this.intersectsScaled(r,o):(this.copyScaled(r,this._p0Scaled),this.copyScaled(o,this._p1Scaled),this.intersectsScaled(this._p0Scaled,this._p1Scaled))},Rn.prototype.scale=function(r){return Math.round(r*this._scaleFactor)},Rn.prototype.getCoordinate=function(){return this._originalPt},Rn.prototype.copyScaled=function(r,o){o.x=this.scale(r.x),o.y=this.scale(r.y)},Rn.prototype.getSafeEnvelope=function(){if(this._safeEnv===null){var r=Rn.SAFE_ENV_EXPANSION_FACTOR/this._scaleFactor;this._safeEnv=new qe(this._originalPt.x-r,this._originalPt.x+r,this._originalPt.y-r,this._originalPt.y+r)}return this._safeEnv},Rn.prototype.intersectsPixelClosure=function(r,o){return this._li.computeIntersection(r,o,this._corner[0],this._corner[1]),!!this._li.hasIntersection()||(this._li.computeIntersection(r,o,this._corner[1],this._corner[2]),!!this._li.hasIntersection()||(this._li.computeIntersection(r,o,this._corner[2],this._corner[3]),!!this._li.hasIntersection()||(this._li.computeIntersection(r,o,this._corner[3],this._corner[0]),!!this._li.hasIntersection())))},Rn.prototype.intersectsToleranceSquare=function(r,o){var c=!1,p=!1;return this._li.computeIntersection(r,o,this._corner[0],this._corner[1]),!!this._li.isProper()||(this._li.computeIntersection(r,o,this._corner[1],this._corner[2]),!!this._li.isProper()||(this._li.hasIntersection()&&(c=!0),this._li.computeIntersection(r,o,this._corner[2],this._corner[3]),!!this._li.isProper()||(this._li.hasIntersection()&&(p=!0),this._li.computeIntersection(r,o,this._corner[3],this._corner[0]),!!this._li.isProper()||!(!c||!p)||!!r.equals(this._pt)||!!o.equals(this._pt))))},Rn.prototype.addSnappedNode=function(r,o){var c=r.getCoordinate(o),p=r.getCoordinate(o+1);return!!this.intersects(c,p)&&(r.addIntersection(this.getCoordinate(),o),!0)},Rn.prototype.interfaces_=function(){return[]},Rn.prototype.getClass=function(){return Rn},el.SAFE_ENV_EXPANSION_FACTOR.get=function(){return .75},Object.defineProperties(Rn,el);var ka=function(){this.tempEnv1=new qe,this.selectedSegment=new Ke};ka.prototype.select=function(){if(arguments.length!==1){if(arguments.length===2){var r=arguments[0],o=arguments[1];r.getLineSegment(o,this.selectedSegment),this.select(this.selectedSegment)}}},ka.prototype.interfaces_=function(){return[]},ka.prototype.getClass=function(){return ka};var ta=function(){this._index=null;var r=arguments[0];this._index=r},su={HotPixelSnapAction:{configurable:!0}};ta.prototype.snap=function(){if(arguments.length===1){var r=arguments[0];return this.snap(r,null,-1)}if(arguments.length===3){var o=arguments[0],c=arguments[1],p=arguments[2],_=o.getSafeEnvelope(),C=new vl(o,c,p);return this._index.query(_,{interfaces_:function(){return[ps]},visitItem:function(R){R.select(_,C)}}),C.isNodeAdded()}},ta.prototype.interfaces_=function(){return[]},ta.prototype.getClass=function(){return ta},su.HotPixelSnapAction.get=function(){return vl},Object.defineProperties(ta,su);var vl=function(r){function o(){r.call(this),this._hotPixel=null,this._parentEdge=null,this._hotPixelVertexIndex=null,this._isNodeAdded=!1;var c=arguments[0],p=arguments[1],_=arguments[2];this._hotPixel=c,this._parentEdge=p,this._hotPixelVertexIndex=_}return r&&(o.__proto__=r),o.prototype=Object.create(r&&r.prototype),o.prototype.constructor=o,o.prototype.isNodeAdded=function(){return this._isNodeAdded},o.prototype.select=function(){if(arguments.length!==2)return r.prototype.select.apply(this,arguments);var c=arguments[0],p=arguments[1],_=c.getContext();if(this._parentEdge!==null&&_===this._parentEdge&&p===this._hotPixelVertexIndex)return null;this._isNodeAdded=this._hotPixel.addSnappedNode(_,p)},o.prototype.interfaces_=function(){return[]},o.prototype.getClass=function(){return o},o}(ka),Is=function(){this._li=null,this._interiorIntersections=null;var r=arguments[0];this._li=r,this._interiorIntersections=new et};Is.prototype.processIntersections=function(r,o,c,p){if(r===c&&o===p)return null;var _=r.getCoordinates()[o],C=r.getCoordinates()[o+1],R=c.getCoordinates()[p],$=c.getCoordinates()[p+1];if(this._li.computeIntersection(_,C,R,$),this._li.hasIntersection()&&this._li.isInteriorIntersection()){for(var rt=0;rt<this._li.getIntersectionNum();rt++)this._interiorIntersections.add(this._li.getIntersection(rt));r.addIntersections(this._li,o,0),c.addIntersections(this._li,p,1)}},Is.prototype.isDone=function(){return!1},Is.prototype.getInteriorIntersections=function(){return this._interiorIntersections},Is.prototype.interfaces_=function(){return[Es]},Is.prototype.getClass=function(){return Is};var go=function(){this._pm=null,this._li=null,this._scaleFactor=null,this._noder=null,this._pointSnapper=null,this._nodedSegStrings=null;var r=arguments[0];this._pm=r,this._li=new Dt,this._li.setPrecisionModel(r),this._scaleFactor=r.getScale()};go.prototype.checkCorrectness=function(r){var o=zi.getNodedSubstrings(r),c=new _n(o);try{c.checkValid()}catch(p){if(!(p instanceof Tn))throw p;p.printStackTrace()}},go.prototype.getNodedSubstrings=function(){return zi.getNodedSubstrings(this._nodedSegStrings)},go.prototype.snapRound=function(r,o){var c=this.findInteriorIntersections(r,o);this.computeIntersectionSnaps(c),this.computeVertexSnaps(r)},go.prototype.findInteriorIntersections=function(r,o){var c=new Is(o);return this._noder.setSegmentIntersector(c),this._noder.computeNodes(r),c.getInteriorIntersections()},go.prototype.computeVertexSnaps=function(){if(Ne(arguments[0],X))for(var r=arguments[0].iterator();r.hasNext();){var o=r.next();this.computeVertexSnaps(o)}else if(arguments[0]instanceof zi)for(var c=arguments[0],p=c.getCoordinates(),_=0;_<p.length;_++){var C=new Rn(p[_],this._scaleFactor,this._li);this._pointSnapper.snap(C,c,_)&&c.addIntersection(p[_],_)}},go.prototype.computeNodes=function(r){this._nodedSegStrings=r,this._noder=new gl,this._pointSnapper=new ta(this._noder.getIndex()),this.snapRound(r,this._li)},go.prototype.computeIntersectionSnaps=function(r){for(var o=r.iterator();o.hasNext();){var c=o.next(),p=new Rn(c,this._scaleFactor,this._li);this._pointSnapper.snap(p)}},go.prototype.interfaces_=function(){return[zs]},go.prototype.getClass=function(){return go};var yn=function(){if(this._argGeom=null,this._distance=null,this._bufParams=new Nr,this._resultGeometry=null,this._saveException=null,arguments.length===1){var r=arguments[0];this._argGeom=r}else if(arguments.length===2){var o=arguments[0],c=arguments[1];this._argGeom=o,this._bufParams=c}},ea={CAP_ROUND:{configurable:!0},CAP_BUTT:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},MAX_PRECISION_DIGITS:{configurable:!0}};yn.prototype.bufferFixedPrecision=function(r){var o=new ms(new go(new Or(1)),r.getScale()),c=new cn(this._bufParams);c.setWorkingPrecisionModel(r),c.setNoder(o),this._resultGeometry=c.buffer(this._argGeom,this._distance)},yn.prototype.bufferReducedPrecision=function(){var r=this;if(arguments.length===0){for(var o=yn.MAX_PRECISION_DIGITS;o>=0;o--){try{r.bufferReducedPrecision(o)}catch(C){if(!(C instanceof wo))throw C;r._saveException=C}if(r._resultGeometry!==null)return null}throw this._saveException}if(arguments.length===1){var c=arguments[0],p=yn.precisionScaleFactor(this._argGeom,this._distance,c),_=new Or(p);this.bufferFixedPrecision(_)}},yn.prototype.computeGeometry=function(){if(this.bufferOriginalPrecision(),this._resultGeometry!==null)return null;var r=this._argGeom.getFactory().getPrecisionModel();r.getType()===Or.FIXED?this.bufferFixedPrecision(r):this.bufferReducedPrecision()},yn.prototype.setQuadrantSegments=function(r){this._bufParams.setQuadrantSegments(r)},yn.prototype.bufferOriginalPrecision=function(){try{var r=new cn(this._bufParams);this._resultGeometry=r.buffer(this._argGeom,this._distance)}catch(o){if(!(o instanceof zt))throw o;this._saveException=o}},yn.prototype.getResultGeometry=function(r){return this._distance=r,this.computeGeometry(),this._resultGeometry},yn.prototype.setEndCapStyle=function(r){this._bufParams.setEndCapStyle(r)},yn.prototype.interfaces_=function(){return[]},yn.prototype.getClass=function(){return yn},yn.bufferOp=function(){if(arguments.length===2){var r=arguments[0],o=arguments[1];return new yn(r).getResultGeometry(o)}if(arguments.length===3){if(Number.isInteger(arguments[2])&&arguments[0]instanceof Me&&typeof arguments[1]=="number"){var c=arguments[0],p=arguments[1],_=arguments[2],C=new yn(c);return C.setQuadrantSegments(_),C.getResultGeometry(p)}if(arguments[2]instanceof Nr&&arguments[0]instanceof Me&&typeof arguments[1]=="number"){var R=arguments[0],$=arguments[1],rt=arguments[2];return new yn(R,rt).getResultGeometry($)}}else if(arguments.length===4){var bt=arguments[0],Yt=arguments[1],Ht=arguments[2],Re=arguments[3],ze=new yn(bt);return ze.setQuadrantSegments(Ht),ze.setEndCapStyle(Re),ze.getResultGeometry(Yt)}},yn.precisionScaleFactor=function(r,o,c){var p=r.getEnvelopeInternal(),_=Tr.max(Math.abs(p.getMaxX()),Math.abs(p.getMaxY()),Math.abs(p.getMinX()),Math.abs(p.getMinY()))+2*(o>0?o:0),C=c-Math.trunc(Math.log(_)/Math.log(10)+1);return Math.pow(10,C)},ea.CAP_ROUND.get=function(){return Nr.CAP_ROUND},ea.CAP_BUTT.get=function(){return Nr.CAP_FLAT},ea.CAP_FLAT.get=function(){return Nr.CAP_FLAT},ea.CAP_SQUARE.get=function(){return Nr.CAP_SQUARE},ea.MAX_PRECISION_DIGITS.get=function(){return 12},Object.defineProperties(yn,ea);var qn=function(){this._pt=[new yt,new yt],this._distance=Ft.NaN,this._isNull=!0};qn.prototype.getCoordinates=function(){return this._pt},qn.prototype.getCoordinate=function(r){return this._pt[r]},qn.prototype.setMinimum=function(){if(arguments.length===1){var r=arguments[0];this.setMinimum(r._pt[0],r._pt[1])}else if(arguments.length===2){var o=arguments[0],c=arguments[1];if(this._isNull)return this.initialize(o,c),null;var p=o.distance(c);p<this._distance&&this.initialize(o,c,p)}},qn.prototype.initialize=function(){if(arguments.length===0)this._isNull=!0;else if(arguments.length===2){var r=arguments[0],o=arguments[1];this._pt[0].setCoordinate(r),this._pt[1].setCoordinate(o),this._distance=r.distance(o),this._isNull=!1}else if(arguments.length===3){var c=arguments[0],p=arguments[1],_=arguments[2];this._pt[0].setCoordinate(c),this._pt[1].setCoordinate(p),this._distance=_,this._isNull=!1}},qn.prototype.getDistance=function(){return this._distance},qn.prototype.setMaximum=function(){if(arguments.length===1){var r=arguments[0];this.setMaximum(r._pt[0],r._pt[1])}else if(arguments.length===2){var o=arguments[0],c=arguments[1];if(this._isNull)return this.initialize(o,c),null;var p=o.distance(c);p>this._distance&&this.initialize(o,c,p)}},qn.prototype.interfaces_=function(){return[]},qn.prototype.getClass=function(){return qn};var zo=function(){};zo.prototype.interfaces_=function(){return[]},zo.prototype.getClass=function(){return zo},zo.computeDistance=function(){if(arguments[2]instanceof qn&&arguments[0]instanceof fi&&arguments[1]instanceof yt)for(var r=arguments[0],o=arguments[1],c=arguments[2],p=r.getCoordinates(),_=new Ke,C=0;C<p.length-1;C++){_.setCoordinates(p[C],p[C+1]);var R=_.closestPoint(o);c.setMinimum(R,o)}else if(arguments[2]instanceof qn&&arguments[0]instanceof ai&&arguments[1]instanceof yt){var $=arguments[0],rt=arguments[1],bt=arguments[2];zo.computeDistance($.getExteriorRing(),rt,bt);for(var Yt=0;Yt<$.getNumInteriorRing();Yt++)zo.computeDistance($.getInteriorRingN(Yt),rt,bt)}else if(arguments[2]instanceof qn&&arguments[0]instanceof Me&&arguments[1]instanceof yt){var Ht=arguments[0],Re=arguments[1],ze=arguments[2];if(Ht instanceof fi)zo.computeDistance(Ht,Re,ze);else if(Ht instanceof ai)zo.computeDistance(Ht,Re,ze);else if(Ht instanceof Kr)for(var Ve=Ht,We=0;We<Ve.getNumGeometries();We++){var Vr=Ve.getGeometryN(We);zo.computeDistance(Vr,Re,ze)}else ze.setMinimum(Ht.getCoordinate(),Re)}else if(arguments[2]instanceof qn&&arguments[0]instanceof Ke&&arguments[1]instanceof yt){var Bi=arguments[0],De=arguments[1],Vo=arguments[2],vs=Bi.closestPoint(De);Vo.setMinimum(vs,De)}};var Fs=function(r){this._maxPtDist=new qn,this._inputGeom=r||null},va={MaxPointDistanceFilter:{configurable:!0},MaxMidpointDistanceFilter:{configurable:!0}};Fs.prototype.computeMaxMidpointDistance=function(r){var o=new Jo(this._inputGeom);r.apply(o),this._maxPtDist.setMaximum(o.getMaxPointDistance())},Fs.prototype.computeMaxVertexDistance=function(r){var o=new ra(this._inputGeom);r.apply(o),this._maxPtDist.setMaximum(o.getMaxPointDistance())},Fs.prototype.findDistance=function(r){return this.computeMaxVertexDistance(r),this.computeMaxMidpointDistance(r),this._maxPtDist.getDistance()},Fs.prototype.getDistancePoints=function(){return this._maxPtDist},Fs.prototype.interfaces_=function(){return[]},Fs.prototype.getClass=function(){return Fs},va.MaxPointDistanceFilter.get=function(){return ra},va.MaxMidpointDistanceFilter.get=function(){return Jo},Object.defineProperties(Fs,va);var ra=function(r){this._maxPtDist=new qn,this._minPtDist=new qn,this._geom=r||null};ra.prototype.filter=function(r){this._minPtDist.initialize(),zo.computeDistance(this._geom,r,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)},ra.prototype.getMaxPointDistance=function(){return this._maxPtDist},ra.prototype.interfaces_=function(){return[Fr]},ra.prototype.getClass=function(){return ra};var Jo=function(r){this._maxPtDist=new qn,this._minPtDist=new qn,this._geom=r||null};Jo.prototype.filter=function(r,o){if(o===0)return null;var c=r.getCoordinate(o-1),p=r.getCoordinate(o),_=new yt((c.x+p.x)/2,(c.y+p.y)/2);this._minPtDist.initialize(),zo.computeDistance(this._geom,_,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)},Jo.prototype.isDone=function(){return!1},Jo.prototype.isGeometryChanged=function(){return!1},Jo.prototype.getMaxPointDistance=function(){return this._maxPtDist},Jo.prototype.interfaces_=function(){return[an]},Jo.prototype.getClass=function(){return Jo};var gs=function(r){this._comps=r||null};gs.prototype.filter=function(r){r instanceof ai&&this._comps.add(r)},gs.prototype.interfaces_=function(){return[si]},gs.prototype.getClass=function(){return gs},gs.getPolygons=function(){if(arguments.length===1){var r=arguments[0];return gs.getPolygons(r,new et)}if(arguments.length===2){var o=arguments[0],c=arguments[1];return o instanceof ai?c.add(o):o instanceof Kr&&o.apply(new gs(c)),c}};var Wi=function(){if(this._lines=null,this._isForcedToLineString=!1,arguments.length===1){var r=arguments[0];this._lines=r}else if(arguments.length===2){var o=arguments[0],c=arguments[1];this._lines=o,this._isForcedToLineString=c}};Wi.prototype.filter=function(r){if(this._isForcedToLineString&&r instanceof Po){var o=r.getFactory().createLineString(r.getCoordinateSequence());return this._lines.add(o),null}r instanceof fi&&this._lines.add(r)},Wi.prototype.setForceToLineString=function(r){this._isForcedToLineString=r},Wi.prototype.interfaces_=function(){return[rr]},Wi.prototype.getClass=function(){return Wi},Wi.getGeometry=function(){if(arguments.length===1){var r=arguments[0];return r.getFactory().buildGeometry(Wi.getLines(r))}if(arguments.length===2){var o=arguments[0],c=arguments[1];return o.getFactory().buildGeometry(Wi.getLines(o,c))}},Wi.getLines=function(){if(arguments.length===1){var r=arguments[0];return Wi.getLines(r,!1)}if(arguments.length===2){if(Ne(arguments[0],X)&&Ne(arguments[1],X)){for(var o=arguments[0],c=arguments[1],p=o.iterator();p.hasNext();){var _=p.next();Wi.getLines(_,c)}return c}if(arguments[0]instanceof Me&&typeof arguments[1]=="boolean"){var C=arguments[0],R=arguments[1],$=new et;return C.apply(new Wi($,R)),$}if(arguments[0]instanceof Me&&Ne(arguments[1],X)){var rt=arguments[0],bt=arguments[1];return rt instanceof fi?bt.add(rt):rt.apply(new Wi(bt)),bt}}else if(arguments.length===3){if(typeof arguments[2]=="boolean"&&Ne(arguments[0],X)&&Ne(arguments[1],X)){for(var Yt=arguments[0],Ht=arguments[1],Re=arguments[2],ze=Yt.iterator();ze.hasNext();){var Ve=ze.next();Wi.getLines(Ve,Ht,Re)}return Ht}if(typeof arguments[2]=="boolean"&&arguments[0]instanceof Me&&Ne(arguments[1],X)){var We=arguments[0],Vr=arguments[1],Bi=arguments[2];return We.apply(new Wi(Vr,Bi)),Vr}}};var ko=function(){if(this._boundaryRule=gr.OGC_SFS_BOUNDARY_RULE,this._isIn=null,this._numBoundaries=null,arguments.length!==0){if(arguments.length===1){var r=arguments[0];if(r===null)throw new Et("Rule must be non-null");this._boundaryRule=r}}};ko.prototype.locateInternal=function(){if(arguments[0]instanceof yt&&arguments[1]instanceof ai){var r=arguments[0],o=arguments[1];if(o.isEmpty())return wt.EXTERIOR;var c=o.getExteriorRing(),p=this.locateInPolygonRing(r,c);if(p===wt.EXTERIOR)return wt.EXTERIOR;if(p===wt.BOUNDARY)return wt.BOUNDARY;for(var _=0;_<o.getNumInteriorRing();_++){var C=o.getInteriorRingN(_),R=this.locateInPolygonRing(r,C);if(R===wt.INTERIOR)return wt.EXTERIOR;if(R===wt.BOUNDARY)return wt.BOUNDARY}return wt.INTERIOR}if(arguments[0]instanceof yt&&arguments[1]instanceof fi){var $=arguments[0],rt=arguments[1];if(!rt.getEnvelopeInternal().intersects($))return wt.EXTERIOR;var bt=rt.getCoordinates();return rt.isClosed()||!$.equals(bt[0])&&!$.equals(bt[bt.length-1])?kt.isOnLine($,bt)?wt.INTERIOR:wt.EXTERIOR:wt.BOUNDARY}if(arguments[0]instanceof yt&&arguments[1]instanceof Ln){var Yt=arguments[0];return arguments[1].getCoordinate().equals2D(Yt)?wt.INTERIOR:wt.EXTERIOR}},ko.prototype.locateInPolygonRing=function(r,o){return o.getEnvelopeInternal().intersects(r)?kt.locatePointInRing(r,o.getCoordinates()):wt.EXTERIOR},ko.prototype.intersects=function(r,o){return this.locate(r,o)!==wt.EXTERIOR},ko.prototype.updateLocationInfo=function(r){r===wt.INTERIOR&&(this._isIn=!0),r===wt.BOUNDARY&&this._numBoundaries++},ko.prototype.computeLocation=function(r,o){if(o instanceof Ln&&this.updateLocationInfo(this.locateInternal(r,o)),o instanceof fi)this.updateLocationInfo(this.locateInternal(r,o));else if(o instanceof ai)this.updateLocationInfo(this.locateInternal(r,o));else if(o instanceof ln)for(var c=o,p=0;p<c.getNumGeometries();p++){var _=c.getGeometryN(p);this.updateLocationInfo(this.locateInternal(r,_))}else if(o instanceof Zn)for(var C=o,R=0;R<C.getNumGeometries();R++){var $=C.getGeometryN(R);this.updateLocationInfo(this.locateInternal(r,$))}else if(o instanceof Kr)for(var rt=new Ho(o);rt.hasNext();){var bt=rt.next();bt!==o&&this.computeLocation(r,bt)}},ko.prototype.locate=function(r,o){return o.isEmpty()?wt.EXTERIOR:o instanceof fi?this.locateInternal(r,o):o instanceof ai?this.locateInternal(r,o):(this._isIn=!1,this._numBoundaries=0,this.computeLocation(r,o),this._boundaryRule.isInBoundary(this._numBoundaries)?wt.BOUNDARY:this._numBoundaries>0||this._isIn?wt.INTERIOR:wt.EXTERIOR)},ko.prototype.interfaces_=function(){return[]},ko.prototype.getClass=function(){return ko};var $n=function r(){if(this._component=null,this._segIndex=null,this._pt=null,arguments.length===2){var o=arguments[0],c=arguments[1];r.call(this,o,r.INSIDE_AREA,c)}else if(arguments.length===3){var p=arguments[0],_=arguments[1],C=arguments[2];this._component=p,this._segIndex=_,this._pt=C}},au={INSIDE_AREA:{configurable:!0}};$n.prototype.isInsideArea=function(){return this._segIndex===$n.INSIDE_AREA},$n.prototype.getCoordinate=function(){return this._pt},$n.prototype.getGeometryComponent=function(){return this._component},$n.prototype.getSegmentIndex=function(){return this._segIndex},$n.prototype.interfaces_=function(){return[]},$n.prototype.getClass=function(){return $n},au.INSIDE_AREA.get=function(){return-1},Object.defineProperties($n,au);var Us=function(r){this._pts=r||null};Us.prototype.filter=function(r){r instanceof Ln&&this._pts.add(r)},Us.prototype.interfaces_=function(){return[si]},Us.prototype.getClass=function(){return Us},Us.getPoints=function(){if(arguments.length===1){var r=arguments[0];return r instanceof Ln?Do.singletonList(r):Us.getPoints(r,new et)}if(arguments.length===2){var o=arguments[0],c=arguments[1];return o instanceof Ln?c.add(o):o instanceof Kr&&o.apply(new Us(c)),c}};var xa=function(){this._locations=null;var r=arguments[0];this._locations=r};xa.prototype.filter=function(r){(r instanceof Ln||r instanceof fi||r instanceof ai)&&this._locations.add(new $n(r,0,r.getCoordinate()))},xa.prototype.interfaces_=function(){return[si]},xa.prototype.getClass=function(){return xa},xa.getLocations=function(r){var o=new et;return r.apply(new xa(o)),o};var vn=function(){if(this._geom=null,this._terminateDistance=0,this._ptLocator=new ko,this._minDistanceLocation=null,this._minDistance=Ft.MAX_VALUE,arguments.length===2){var r=arguments[0],o=arguments[1];this._geom=[r,o],this._terminateDistance=0}else if(arguments.length===3){var c=arguments[0],p=arguments[1],_=arguments[2];this._geom=new Array(2).fill(null),this._geom[0]=c,this._geom[1]=p,this._terminateDistance=_}};vn.prototype.computeContainmentDistance=function(){if(arguments.length===0){var r=new Array(2).fill(null);if(this.computeContainmentDistance(0,r),this._minDistance<=this._terminateDistance)return null;this.computeContainmentDistance(1,r)}else if(arguments.length===2){var o=arguments[0],c=arguments[1],p=1-o,_=gs.getPolygons(this._geom[o]);if(_.size()>0){var C=xa.getLocations(this._geom[p]);if(this.computeContainmentDistance(C,_,c),this._minDistance<=this._terminateDistance)return this._minDistanceLocation[p]=c[0],this._minDistanceLocation[o]=c[1],null}}else if(arguments.length===3){if(arguments[2]instanceof Array&&Ne(arguments[0],ut)&&Ne(arguments[1],ut)){for(var R=arguments[0],$=arguments[1],rt=arguments[2],bt=0;bt<R.size();bt++)for(var Yt=R.get(bt),Ht=0;Ht<$.size();Ht++)if(this.computeContainmentDistance(Yt,$.get(Ht),rt),this._minDistance<=this._terminateDistance)return null}else if(arguments[2]instanceof Array&&arguments[0]instanceof $n&&arguments[1]instanceof ai){var Re=arguments[0],ze=arguments[1],Ve=arguments[2],We=Re.getCoordinate();if(wt.EXTERIOR!==this._ptLocator.locate(We,ze))return this._minDistance=0,Ve[0]=Re,Ve[1]=new $n(ze,We),null}}},vn.prototype.computeMinDistanceLinesPoints=function(r,o,c){for(var p=0;p<r.size();p++)for(var _=r.get(p),C=0;C<o.size();C++){var R=o.get(C);if(this.computeMinDistance(_,R,c),this._minDistance<=this._terminateDistance)return null}},vn.prototype.computeFacetDistance=function(){var r=new Array(2).fill(null),o=Wi.getLines(this._geom[0]),c=Wi.getLines(this._geom[1]),p=Us.getPoints(this._geom[0]),_=Us.getPoints(this._geom[1]);return this.computeMinDistanceLines(o,c,r),this.updateMinDistance(r,!1),this._minDistance<=this._terminateDistance?null:(r[0]=null,r[1]=null,this.computeMinDistanceLinesPoints(o,_,r),this.updateMinDistance(r,!1),this._minDistance<=this._terminateDistance?null:(r[0]=null,r[1]=null,this.computeMinDistanceLinesPoints(c,p,r),this.updateMinDistance(r,!0),this._minDistance<=this._terminateDistance?null:(r[0]=null,r[1]=null,this.computeMinDistancePoints(p,_,r),void this.updateMinDistance(r,!1))))},vn.prototype.nearestLocations=function(){return this.computeMinDistance(),this._minDistanceLocation},vn.prototype.updateMinDistance=function(r,o){if(r[0]===null)return null;o?(this._minDistanceLocation[0]=r[1],this._minDistanceLocation[1]=r[0]):(this._minDistanceLocation[0]=r[0],this._minDistanceLocation[1]=r[1])},vn.prototype.nearestPoints=function(){return this.computeMinDistance(),[this._minDistanceLocation[0].getCoordinate(),this._minDistanceLocation[1].getCoordinate()]},vn.prototype.computeMinDistance=function(){if(arguments.length===0){if(this._minDistanceLocation!==null||(this._minDistanceLocation=new Array(2).fill(null),this.computeContainmentDistance(),this._minDistance<=this._terminateDistance))return null;this.computeFacetDistance()}else if(arguments.length===3){if(arguments[2]instanceof Array&&arguments[0]instanceof fi&&arguments[1]instanceof Ln){var r=arguments[0],o=arguments[1],c=arguments[2];if(r.getEnvelopeInternal().distance(o.getEnvelopeInternal())>this._minDistance)return null;for(var p=r.getCoordinates(),_=o.getCoordinate(),C=0;C<p.length-1;C++){var R=kt.distancePointLine(_,p[C],p[C+1]);if(R<this._minDistance){this._minDistance=R;var $=new Ke(p[C],p[C+1]).closestPoint(_);c[0]=new $n(r,C,$),c[1]=new $n(o,0,_)}if(this._minDistance<=this._terminateDistance)return null}}else if(arguments[2]instanceof Array&&arguments[0]instanceof fi&&arguments[1]instanceof fi){var rt=arguments[0],bt=arguments[1],Yt=arguments[2];if(rt.getEnvelopeInternal().distance(bt.getEnvelopeInternal())>this._minDistance)return null;for(var Ht=rt.getCoordinates(),Re=bt.getCoordinates(),ze=0;ze<Ht.length-1;ze++)for(var Ve=0;Ve<Re.length-1;Ve++){var We=kt.distanceLineLine(Ht[ze],Ht[ze+1],Re[Ve],Re[Ve+1]);if(We<this._minDistance){this._minDistance=We;var Vr=new Ke(Ht[ze],Ht[ze+1]),Bi=new Ke(Re[Ve],Re[Ve+1]),De=Vr.closestPoints(Bi);Yt[0]=new $n(rt,ze,De[0]),Yt[1]=new $n(bt,Ve,De[1])}if(this._minDistance<=this._terminateDistance)return null}}}},vn.prototype.computeMinDistancePoints=function(r,o,c){for(var p=0;p<r.size();p++)for(var _=r.get(p),C=0;C<o.size();C++){var R=o.get(C),$=_.getCoordinate().distance(R.getCoordinate());if($<this._minDistance&&(this._minDistance=$,c[0]=new $n(_,0,_.getCoordinate()),c[1]=new $n(R,0,R.getCoordinate())),this._minDistance<=this._terminateDistance)return null}},vn.prototype.distance=function(){if(this._geom[0]===null||this._geom[1]===null)throw new Et("null geometries are not supported");return this._geom[0].isEmpty()||this._geom[1].isEmpty()?0:(this.computeMinDistance(),this._minDistance)},vn.prototype.computeMinDistanceLines=function(r,o,c){for(var p=0;p<r.size();p++)for(var _=r.get(p),C=0;C<o.size();C++){var R=o.get(C);if(this.computeMinDistance(_,R,c),this._minDistance<=this._terminateDistance)return null}},vn.prototype.interfaces_=function(){return[]},vn.prototype.getClass=function(){return vn},vn.distance=function(r,o){return new vn(r,o).distance()},vn.isWithinDistance=function(r,o,c){return new vn(r,o,c).distance()<=c},vn.nearestPoints=function(r,o){return new vn(r,o).nearestPoints()};var hn=function(){this._pt=[new yt,new yt],this._distance=Ft.NaN,this._isNull=!0};hn.prototype.getCoordinates=function(){return this._pt},hn.prototype.getCoordinate=function(r){return this._pt[r]},hn.prototype.setMinimum=function(){if(arguments.length===1){var r=arguments[0];this.setMinimum(r._pt[0],r._pt[1])}else if(arguments.length===2){var o=arguments[0],c=arguments[1];if(this._isNull)return this.initialize(o,c),null;var p=o.distance(c);p<this._distance&&this.initialize(o,c,p)}},hn.prototype.initialize=function(){if(arguments.length===0)this._isNull=!0;else if(arguments.length===2){var r=arguments[0],o=arguments[1];this._pt[0].setCoordinate(r),this._pt[1].setCoordinate(o),this._distance=r.distance(o),this._isNull=!1}else if(arguments.length===3){var c=arguments[0],p=arguments[1],_=arguments[2];this._pt[0].setCoordinate(c),this._pt[1].setCoordinate(p),this._distance=_,this._isNull=!1}},hn.prototype.toString=function(){return ii.toLineString(this._pt[0],this._pt[1])},hn.prototype.getDistance=function(){return this._distance},hn.prototype.setMaximum=function(){if(arguments.length===1){var r=arguments[0];this.setMaximum(r._pt[0],r._pt[1])}else if(arguments.length===2){var o=arguments[0],c=arguments[1];if(this._isNull)return this.initialize(o,c),null;var p=o.distance(c);p>this._distance&&this.initialize(o,c,p)}},hn.prototype.interfaces_=function(){return[]},hn.prototype.getClass=function(){return hn};var Yn=function(){};Yn.prototype.interfaces_=function(){return[]},Yn.prototype.getClass=function(){return Yn},Yn.computeDistance=function(){if(arguments[2]instanceof hn&&arguments[0]instanceof fi&&arguments[1]instanceof yt)for(var r=arguments[0],o=arguments[1],c=arguments[2],p=new Ke,_=r.getCoordinates(),C=0;C<_.length-1;C++){p.setCoordinates(_[C],_[C+1]);var R=p.closestPoint(o);c.setMinimum(R,o)}else if(arguments[2]instanceof hn&&arguments[0]instanceof ai&&arguments[1]instanceof yt){var $=arguments[0],rt=arguments[1],bt=arguments[2];Yn.computeDistance($.getExteriorRing(),rt,bt);for(var Yt=0;Yt<$.getNumInteriorRing();Yt++)Yn.computeDistance($.getInteriorRingN(Yt),rt,bt)}else if(arguments[2]instanceof hn&&arguments[0]instanceof Me&&arguments[1]instanceof yt){var Ht=arguments[0],Re=arguments[1],ze=arguments[2];if(Ht instanceof fi)Yn.computeDistance(Ht,Re,ze);else if(Ht instanceof ai)Yn.computeDistance(Ht,Re,ze);else if(Ht instanceof Kr)for(var Ve=Ht,We=0;We<Ve.getNumGeometries();We++){var Vr=Ve.getGeometryN(We);Yn.computeDistance(Vr,Re,ze)}else ze.setMinimum(Ht.getCoordinate(),Re)}else if(arguments[2]instanceof hn&&arguments[0]instanceof Ke&&arguments[1]instanceof yt){var Bi=arguments[0],De=arguments[1],Vo=arguments[2],vs=Bi.closestPoint(De);Vo.setMinimum(vs,De)}};var _o=function(){this._g0=null,this._g1=null,this._ptDist=new hn,this._densifyFrac=0;var r=arguments[0],o=arguments[1];this._g0=r,this._g1=o},xl={MaxPointDistanceFilter:{configurable:!0},MaxDensifiedByFractionDistanceFilter:{configurable:!0}};_o.prototype.getCoordinates=function(){return this._ptDist.getCoordinates()},_o.prototype.setDensifyFraction=function(r){if(r>1||r<=0)throw new Et("Fraction is not in range (0.0 - 1.0]");this._densifyFrac=r},_o.prototype.compute=function(r,o){this.computeOrientedDistance(r,o,this._ptDist),this.computeOrientedDistance(o,r,this._ptDist)},_o.prototype.distance=function(){return this.compute(this._g0,this._g1),this._ptDist.getDistance()},_o.prototype.computeOrientedDistance=function(r,o,c){var p=new yo(o);if(r.apply(p),c.setMaximum(p.getMaxPointDistance()),this._densifyFrac>0){var _=new Qo(o,this._densifyFrac);r.apply(_),c.setMaximum(_.getMaxPointDistance())}},_o.prototype.orientedDistance=function(){return this.computeOrientedDistance(this._g0,this._g1,this._ptDist),this._ptDist.getDistance()},_o.prototype.interfaces_=function(){return[]},_o.prototype.getClass=function(){return _o},_o.distance=function(){if(arguments.length===2){var r=arguments[0],o=arguments[1];return new _o(r,o).distance()}if(arguments.length===3){var c=arguments[0],p=arguments[1],_=arguments[2],C=new _o(c,p);return C.setDensifyFraction(_),C.distance()}},xl.MaxPointDistanceFilter.get=function(){return yo},xl.MaxDensifiedByFractionDistanceFilter.get=function(){return Qo},Object.defineProperties(_o,xl);var yo=function(){this._maxPtDist=new hn,this._minPtDist=new hn,this._euclideanDist=new Yn,this._geom=null;var r=arguments[0];this._geom=r};yo.prototype.filter=function(r){this._minPtDist.initialize(),Yn.computeDistance(this._geom,r,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)},yo.prototype.getMaxPointDistance=function(){return this._maxPtDist},yo.prototype.interfaces_=function(){return[Fr]},yo.prototype.getClass=function(){return yo};var Qo=function(){this._maxPtDist=new hn,this._minPtDist=new hn,this._geom=null,this._numSubSegs=0;var r=arguments[0],o=arguments[1];this._geom=r,this._numSubSegs=Math.trunc(Math.round(1/o))};Qo.prototype.filter=function(r,o){if(o===0)return null;for(var c=r.getCoordinate(o-1),p=r.getCoordinate(o),_=(p.x-c.x)/this._numSubSegs,C=(p.y-c.y)/this._numSubSegs,R=0;R<this._numSubSegs;R++){var $=c.x+R*_,rt=c.y+R*C,bt=new yt($,rt);this._minPtDist.initialize(),Yn.computeDistance(this._geom,bt,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)}},Qo.prototype.isDone=function(){return!1},Qo.prototype.isGeometryChanged=function(){return!1},Qo.prototype.getMaxPointDistance=function(){return this._maxPtDist},Qo.prototype.interfaces_=function(){return[an]},Qo.prototype.getClass=function(){return Qo};var ki=function(r,o,c){this._minValidDistance=null,this._maxValidDistance=null,this._minDistanceFound=null,this._maxDistanceFound=null,this._isValid=!0,this._errMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=r||null,this._bufDistance=o||null,this._result=c||null},ba={VERBOSE:{configurable:!0},MAX_DISTANCE_DIFF_FRAC:{configurable:!0}};ki.prototype.checkMaximumDistance=function(r,o,c){var p=new _o(o,r);if(p.setDensifyFraction(.25),this._maxDistanceFound=p.orientedDistance(),this._maxDistanceFound>c){this._isValid=!1;var _=p.getCoordinates();this._errorLocation=_[1],this._errorIndicator=r.getFactory().createLineString(_),this._errMsg="Distance between buffer curve and input is too large ("+this._maxDistanceFound+" at "+ii.toLineString(_[0],_[1])+")"}},ki.prototype.isValid=function(){var r=Math.abs(this._bufDistance),o=ki.MAX_DISTANCE_DIFF_FRAC*r;return this._minValidDistance=r-o,this._maxValidDistance=r+o,!(!this._input.isEmpty()&&!this._result.isEmpty())||(this._bufDistance>0?this.checkPositiveValid():this.checkNegativeValid(),ki.VERBOSE&&Br.out.println("Min Dist= "+this._minDistanceFound+"  err= "+(1-this._minDistanceFound/this._bufDistance)+"  Max Dist= "+this._maxDistanceFound+"  err= "+(this._maxDistanceFound/this._bufDistance-1)),this._isValid)},ki.prototype.checkNegativeValid=function(){if(!(this._input instanceof ai||this._input instanceof Zn||this._input instanceof Kr))return null;var r=this.getPolygonLines(this._input);if(this.checkMinimumDistance(r,this._result,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(r,this._result,this._maxValidDistance)},ki.prototype.getErrorIndicator=function(){return this._errorIndicator},ki.prototype.checkMinimumDistance=function(r,o,c){var p=new vn(r,o,c);if(this._minDistanceFound=p.distance(),this._minDistanceFound<c){this._isValid=!1;var _=p.nearestPoints();this._errorLocation=p.nearestPoints()[1],this._errorIndicator=r.getFactory().createLineString(_),this._errMsg="Distance between buffer curve and input is too small ("+this._minDistanceFound+" at "+ii.toLineString(_[0],_[1])+" )"}},ki.prototype.checkPositiveValid=function(){var r=this._result.getBoundary();if(this.checkMinimumDistance(this._input,r,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(this._input,r,this._maxValidDistance)},ki.prototype.getErrorLocation=function(){return this._errorLocation},ki.prototype.getPolygonLines=function(r){for(var o=new et,c=new Wi(o),p=gs.getPolygons(r).iterator();p.hasNext();)p.next().apply(c);return r.getFactory().buildGeometry(o)},ki.prototype.getErrorMessage=function(){return this._errMsg},ki.prototype.interfaces_=function(){return[]},ki.prototype.getClass=function(){return ki},ba.VERBOSE.get=function(){return!1},ba.MAX_DISTANCE_DIFF_FRAC.get=function(){return .012},Object.defineProperties(ki,ba);var xn=function(r,o,c){this._isValid=!0,this._errorMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=r||null,this._distance=o||null,this._result=c||null},Vs={VERBOSE:{configurable:!0},MAX_ENV_DIFF_FRAC:{configurable:!0}};xn.prototype.isValid=function(){return this.checkPolygonal(),this._isValid?(this.checkExpectedEmpty(),this._isValid?(this.checkEnvelope(),this._isValid?(this.checkArea(),this._isValid?(this.checkDistance(),this._isValid):this._isValid):this._isValid):this._isValid):this._isValid},xn.prototype.checkEnvelope=function(){if(this._distance<0)return null;var r=this._distance*xn.MAX_ENV_DIFF_FRAC;r===0&&(r=.001);var o=new qe(this._input.getEnvelopeInternal());o.expandBy(this._distance);var c=new qe(this._result.getEnvelopeInternal());c.expandBy(r),c.contains(o)||(this._isValid=!1,this._errorMsg="Buffer envelope is incorrect",this._errorIndicator=this._input.getFactory().toGeometry(c)),this.report("Envelope")},xn.prototype.checkDistance=function(){var r=new ki(this._input,this._distance,this._result);r.isValid()||(this._isValid=!1,this._errorMsg=r.getErrorMessage(),this._errorLocation=r.getErrorLocation(),this._errorIndicator=r.getErrorIndicator()),this.report("Distance")},xn.prototype.checkArea=function(){var r=this._input.getArea(),o=this._result.getArea();this._distance>0&&r>o&&(this._isValid=!1,this._errorMsg="Area of positive buffer is smaller than input",this._errorIndicator=this._result),this._distance<0&&r<o&&(this._isValid=!1,this._errorMsg="Area of negative buffer is larger than input",this._errorIndicator=this._result),this.report("Area")},xn.prototype.checkPolygonal=function(){this._result instanceof ai||this._result instanceof Zn||(this._isValid=!1),this._errorMsg="Result is not polygonal",this._errorIndicator=this._result,this.report("Polygonal")},xn.prototype.getErrorIndicator=function(){return this._errorIndicator},xn.prototype.getErrorLocation=function(){return this._errorLocation},xn.prototype.checkExpectedEmpty=function(){return this._input.getDimension()>=2||this._distance>0?null:(this._result.isEmpty()||(this._isValid=!1,this._errorMsg="Result is non-empty",this._errorIndicator=this._result),void this.report("ExpectedEmpty"))},xn.prototype.report=function(r){if(!xn.VERBOSE)return null;Br.out.println("Check "+r+": "+(this._isValid?"passed":"FAILED"))},xn.prototype.getErrorMessage=function(){return this._errorMsg},xn.prototype.interfaces_=function(){return[]},xn.prototype.getClass=function(){return xn},xn.isValidMsg=function(r,o,c){var p=new xn(r,o,c);return p.isValid()?null:p.getErrorMessage()},xn.isValid=function(r,o,c){return!!new xn(r,o,c).isValid()},Vs.VERBOSE.get=function(){return!1},Vs.MAX_ENV_DIFF_FRAC.get=function(){return .012},Object.defineProperties(xn,Vs);var Hn=function(){this._pts=null,this._data=null;var r=arguments[0],o=arguments[1];this._pts=r,this._data=o};Hn.prototype.getCoordinates=function(){return this._pts},Hn.prototype.size=function(){return this._pts.length},Hn.prototype.getCoordinate=function(r){return this._pts[r]},Hn.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])},Hn.prototype.getSegmentOctant=function(r){return r===this._pts.length-1?-1:fs.octant(this.getCoordinate(r),this.getCoordinate(r+1))},Hn.prototype.setData=function(r){this._data=r},Hn.prototype.getData=function(){return this._data},Hn.prototype.toString=function(){return ii.toLineString(new Rr(this._pts))},Hn.prototype.interfaces_=function(){return[Yo]},Hn.prototype.getClass=function(){return Hn};var Qi=function(){this._findAllIntersections=!1,this._isCheckEndSegmentsOnly=!1,this._li=null,this._interiorIntersection=null,this._intSegments=null,this._intersections=new et,this._intersectionCount=0,this._keepIntersections=!0;var r=arguments[0];this._li=r,this._interiorIntersection=null};Qi.prototype.getInteriorIntersection=function(){return this._interiorIntersection},Qi.prototype.setCheckEndSegmentsOnly=function(r){this._isCheckEndSegmentsOnly=r},Qi.prototype.getIntersectionSegments=function(){return this._intSegments},Qi.prototype.count=function(){return this._intersectionCount},Qi.prototype.getIntersections=function(){return this._intersections},Qi.prototype.setFindAllIntersections=function(r){this._findAllIntersections=r},Qi.prototype.setKeepIntersections=function(r){this._keepIntersections=r},Qi.prototype.processIntersections=function(r,o,c,p){if(!this._findAllIntersections&&this.hasIntersection()||r===c&&o===p||this._isCheckEndSegmentsOnly&&!(this.isEndSegment(r,o)||this.isEndSegment(c,p)))return null;var _=r.getCoordinates()[o],C=r.getCoordinates()[o+1],R=c.getCoordinates()[p],$=c.getCoordinates()[p+1];this._li.computeIntersection(_,C,R,$),this._li.hasIntersection()&&this._li.isInteriorIntersection()&&(this._intSegments=new Array(4).fill(null),this._intSegments[0]=_,this._intSegments[1]=C,this._intSegments[2]=R,this._intSegments[3]=$,this._interiorIntersection=this._li.getIntersection(0),this._keepIntersections&&this._intersections.add(this._interiorIntersection),this._intersectionCount++)},Qi.prototype.isEndSegment=function(r,o){return o===0||o>=r.size()-2},Qi.prototype.hasIntersection=function(){return this._interiorIntersection!==null},Qi.prototype.isDone=function(){return!this._findAllIntersections&&this._interiorIntersection!==null},Qi.prototype.interfaces_=function(){return[Es]},Qi.prototype.getClass=function(){return Qi},Qi.createAllIntersectionsFinder=function(r){var o=new Qi(r);return o.setFindAllIntersections(!0),o},Qi.createAnyIntersectionFinder=function(r){return new Qi(r)},Qi.createIntersectionCounter=function(r){var o=new Qi(r);return o.setFindAllIntersections(!0),o.setKeepIntersections(!1),o};var oo=function(){this._li=new Dt,this._segStrings=null,this._findAllIntersections=!1,this._segInt=null,this._isValid=!0;var r=arguments[0];this._segStrings=r};oo.prototype.execute=function(){if(this._segInt!==null)return null;this.checkInteriorIntersections()},oo.prototype.getIntersections=function(){return this._segInt.getIntersections()},oo.prototype.isValid=function(){return this.execute(),this._isValid},oo.prototype.setFindAllIntersections=function(r){this._findAllIntersections=r},oo.prototype.checkInteriorIntersections=function(){this._isValid=!0,this._segInt=new Qi(this._li),this._segInt.setFindAllIntersections(this._findAllIntersections);var r=new gl;if(r.setSegmentIntersector(this._segInt),r.computeNodes(this._segStrings),this._segInt.hasIntersection())return this._isValid=!1,null},oo.prototype.checkValid=function(){if(this.execute(),!this._isValid)throw new wo(this.getErrorMessage(),this._segInt.getInteriorIntersection())},oo.prototype.getErrorMessage=function(){if(this._isValid)return"no intersections found";var r=this._segInt.getIntersectionSegments();return"found non-noded intersection between "+ii.toLineString(r[0],r[1])+" and "+ii.toLineString(r[2],r[3])},oo.prototype.interfaces_=function(){return[]},oo.prototype.getClass=function(){return oo},oo.computeIntersections=function(r){var o=new oo(r);return o.setFindAllIntersections(!0),o.isValid(),o.getIntersections()};var Lr=function r(){this._nv=null;var o=arguments[0];this._nv=new oo(r.toSegmentStrings(o))};Lr.prototype.checkValid=function(){this._nv.checkValid()},Lr.prototype.interfaces_=function(){return[]},Lr.prototype.getClass=function(){return Lr},Lr.toSegmentStrings=function(r){for(var o=new et,c=r.iterator();c.hasNext();){var p=c.next();o.add(new Hn(p.getCoordinates(),p))}return o},Lr.checkValid=function(r){new Lr(r).checkValid()};var _s=function(r){this._mapOp=r};_s.prototype.map=function(r){for(var o=new et,c=0;c<r.getNumGeometries();c++){var p=this._mapOp.map(r.getGeometryN(c));p.isEmpty()||o.add(p)}return r.getFactory().createGeometryCollection(lr.toGeometryArray(o))},_s.prototype.interfaces_=function(){return[]},_s.prototype.getClass=function(){return _s},_s.map=function(r,o){return new _s(o).map(r)};var Bo=function(){this._op=null,this._geometryFactory=null,this._ptLocator=null,this._lineEdgesList=new et,this._resultLineList=new et;var r=arguments[0],o=arguments[1],c=arguments[2];this._op=r,this._geometryFactory=o,this._ptLocator=c};Bo.prototype.collectLines=function(r){for(var o=this._op.getGraph().getEdgeEnds().iterator();o.hasNext();){var c=o.next();this.collectLineEdge(c,r,this._lineEdgesList),this.collectBoundaryTouchEdge(c,r,this._lineEdgesList)}},Bo.prototype.labelIsolatedLine=function(r,o){var c=this._ptLocator.locate(r.getCoordinate(),this._op.getArgGeometry(o));r.getLabel().setLocation(o,c)},Bo.prototype.build=function(r){return this.findCoveredLineEdges(),this.collectLines(r),this.buildLines(r),this._resultLineList},Bo.prototype.collectLineEdge=function(r,o,c){var p=r.getLabel(),_=r.getEdge();r.isLineEdge()&&(r.isVisited()||!cr.isResultOfOp(p,o)||_.isCovered()||(c.add(_),r.setVisitedEdge(!0)))},Bo.prototype.findCoveredLineEdges=function(){for(var r=this._op.getGraph().getNodes().iterator();r.hasNext();)r.next().getEdges().findCoveredLineEdges();for(var o=this._op.getGraph().getEdgeEnds().iterator();o.hasNext();){var c=o.next(),p=c.getEdge();if(c.isLineEdge()&&!p.isCoveredSet()){var _=this._op.isCoveredByA(c.getCoordinate());p.setCovered(_)}}},Bo.prototype.labelIsolatedLines=function(r){for(var o=r.iterator();o.hasNext();){var c=o.next(),p=c.getLabel();c.isIsolated()&&(p.isNull(0)?this.labelIsolatedLine(c,0):this.labelIsolatedLine(c,1))}},Bo.prototype.buildLines=function(r){for(var o=this._lineEdgesList.iterator();o.hasNext();){var c=o.next(),p=this._geometryFactory.createLineString(c.getCoordinates());this._resultLineList.add(p),c.setInResult(!0)}},Bo.prototype.collectBoundaryTouchEdge=function(r,o,c){var p=r.getLabel();return r.isLineEdge()||r.isVisited()||r.isInteriorAreaEdge()||r.getEdge().isInResult()?null:(Z.isTrue(!(r.isInResult()||r.getSym().isInResult())||!r.getEdge().isInResult()),void(cr.isResultOfOp(p,o)&&o===cr.INTERSECTION&&(c.add(r.getEdge()),r.setVisitedEdge(!0))))},Bo.prototype.interfaces_=function(){return[]},Bo.prototype.getClass=function(){return Bo};var Ss=function(){this._op=null,this._geometryFactory=null,this._resultPointList=new et;var r=arguments[0],o=arguments[1];this._op=r,this._geometryFactory=o};Ss.prototype.filterCoveredNodeToPoint=function(r){var o=r.getCoordinate();if(!this._op.isCoveredByLA(o)){var c=this._geometryFactory.createPoint(o);this._resultPointList.add(c)}},Ss.prototype.extractNonCoveredResultNodes=function(r){for(var o=this._op.getGraph().getNodes().iterator();o.hasNext();){var c=o.next();if(!c.isInResult()&&!c.isIncidentEdgeInResult()&&(c.getEdges().getDegree()===0||r===cr.INTERSECTION)){var p=c.getLabel();cr.isResultOfOp(p,r)&&this.filterCoveredNodeToPoint(c)}}},Ss.prototype.build=function(r){return this.extractNonCoveredResultNodes(r),this._resultPointList},Ss.prototype.interfaces_=function(){return[]},Ss.prototype.getClass=function(){return Ss};var pn=function(){this._inputGeom=null,this._factory=null,this._pruneEmptyGeometry=!0,this._preserveGeometryCollectionType=!0,this._preserveCollections=!1,this._preserveType=!1};pn.prototype.transformPoint=function(r,o){return this._factory.createPoint(this.transformCoordinates(r.getCoordinateSequence(),r))},pn.prototype.transformPolygon=function(r,o){var c=!0,p=this.transformLinearRing(r.getExteriorRing(),r);p!==null&&p instanceof Po&&!p.isEmpty()||(c=!1);for(var _=new et,C=0;C<r.getNumInteriorRing();C++){var R=this.transformLinearRing(r.getInteriorRingN(C),r);R===null||R.isEmpty()||(R instanceof Po||(c=!1),_.add(R))}if(c)return this._factory.createPolygon(p,_.toArray([]));var $=new et;return p!==null&&$.add(p),$.addAll(_),this._factory.buildGeometry($)},pn.prototype.createCoordinateSequence=function(r){return this._factory.getCoordinateSequenceFactory().create(r)},pn.prototype.getInputGeometry=function(){return this._inputGeom},pn.prototype.transformMultiLineString=function(r,o){for(var c=new et,p=0;p<r.getNumGeometries();p++){var _=this.transformLineString(r.getGeometryN(p),r);_!==null&&(_.isEmpty()||c.add(_))}return this._factory.buildGeometry(c)},pn.prototype.transformCoordinates=function(r,o){return this.copy(r)},pn.prototype.transformLineString=function(r,o){return this._factory.createLineString(this.transformCoordinates(r.getCoordinateSequence(),r))},pn.prototype.transformMultiPoint=function(r,o){for(var c=new et,p=0;p<r.getNumGeometries();p++){var _=this.transformPoint(r.getGeometryN(p),r);_!==null&&(_.isEmpty()||c.add(_))}return this._factory.buildGeometry(c)},pn.prototype.transformMultiPolygon=function(r,o){for(var c=new et,p=0;p<r.getNumGeometries();p++){var _=this.transformPolygon(r.getGeometryN(p),r);_!==null&&(_.isEmpty()||c.add(_))}return this._factory.buildGeometry(c)},pn.prototype.copy=function(r){return r.copy()},pn.prototype.transformGeometryCollection=function(r,o){for(var c=new et,p=0;p<r.getNumGeometries();p++){var _=this.transform(r.getGeometryN(p));_!==null&&(this._pruneEmptyGeometry&&_.isEmpty()||c.add(_))}return this._preserveGeometryCollectionType?this._factory.createGeometryCollection(lr.toGeometryArray(c)):this._factory.buildGeometry(c)},pn.prototype.transform=function(r){if(this._inputGeom=r,this._factory=r.getFactory(),r instanceof Ln)return this.transformPoint(r,null);if(r instanceof Hs)return this.transformMultiPoint(r,null);if(r instanceof Po)return this.transformLinearRing(r,null);if(r instanceof fi)return this.transformLineString(r,null);if(r instanceof ln)return this.transformMultiLineString(r,null);if(r instanceof ai)return this.transformPolygon(r,null);if(r instanceof Zn)return this.transformMultiPolygon(r,null);if(r instanceof Kr)return this.transformGeometryCollection(r,null);throw new Et("Unknown Geometry subtype: "+r.getClass().getName())},pn.prototype.transformLinearRing=function(r,o){var c=this.transformCoordinates(r.getCoordinateSequence(),r);if(c===null)return this._factory.createLinearRing(null);var p=c.size();return p>0&&p<4&&!this._preserveType?this._factory.createLineString(c):this._factory.createLinearRing(c)},pn.prototype.interfaces_=function(){return[]},pn.prototype.getClass=function(){return pn};var ts=function r(){if(this._snapTolerance=0,this._srcPts=null,this._seg=new Ke,this._allowSnappingToSourceVertices=!1,this._isClosed=!1,arguments[0]instanceof fi&&typeof arguments[1]=="number"){var o=arguments[0],c=arguments[1];r.call(this,o.getCoordinates(),c)}else if(arguments[0]instanceof Array&&typeof arguments[1]=="number"){var p=arguments[0],_=arguments[1];this._srcPts=p,this._isClosed=r.isClosed(p),this._snapTolerance=_}};ts.prototype.snapVertices=function(r,o){for(var c=this._isClosed?r.size()-1:r.size(),p=0;p<c;p++){var _=r.get(p),C=this.findSnapForVertex(_,o);C!==null&&(r.set(p,new yt(C)),p===0&&this._isClosed&&r.set(r.size()-1,new yt(C)))}},ts.prototype.findSnapForVertex=function(r,o){for(var c=0;c<o.length;c++){if(r.equals2D(o[c]))return null;if(r.distance(o[c])<this._snapTolerance)return o[c]}return null},ts.prototype.snapTo=function(r){var o=new Ut(this._srcPts);return this.snapVertices(o,r),this.snapSegments(o,r),o.toCoordinateArray()},ts.prototype.snapSegments=function(r,o){if(o.length===0)return null;var c=o.length;o[0].equals2D(o[o.length-1])&&(c=o.length-1);for(var p=0;p<c;p++){var _=o[p],C=this.findSegmentIndexToSnap(_,r);C>=0&&r.add(C+1,new yt(_),!1)}},ts.prototype.findSegmentIndexToSnap=function(r,o){for(var c=Ft.MAX_VALUE,p=-1,_=0;_<o.size()-1;_++){if(this._seg.p0=o.get(_),this._seg.p1=o.get(_+1),this._seg.p0.equals2D(r)||this._seg.p1.equals2D(r)){if(this._allowSnappingToSourceVertices)continue;return-1}var C=this._seg.distance(r);C<this._snapTolerance&&C<c&&(c=C,p=_)}return p},ts.prototype.setAllowSnappingToSourceVertices=function(r){this._allowSnappingToSourceVertices=r},ts.prototype.interfaces_=function(){return[]},ts.prototype.getClass=function(){return ts},ts.isClosed=function(r){return!(r.length<=1)&&r[0].equals2D(r[r.length-1])};var bi=function(r){this._srcGeom=r||null},Cs={SNAP_PRECISION_FACTOR:{configurable:!0}};bi.prototype.snapTo=function(r,o){var c=this.extractTargetCoordinates(r);return new Fl(o,c).transform(this._srcGeom)},bi.prototype.snapToSelf=function(r,o){var c=this.extractTargetCoordinates(this._srcGeom),p=new Fl(r,c,!0).transform(this._srcGeom),_=p;return o&&Ne(_,Gn)&&(_=p.buffer(0)),_},bi.prototype.computeSnapTolerance=function(r){return this.computeMinimumSegmentLength(r)/10},bi.prototype.extractTargetCoordinates=function(r){for(var o=new ee,c=r.getCoordinates(),p=0;p<c.length;p++)o.add(c[p]);return o.toArray(new Array(0).fill(null))},bi.prototype.computeMinimumSegmentLength=function(r){for(var o=Ft.MAX_VALUE,c=0;c<r.length-1;c++){var p=r[c].distance(r[c+1]);p<o&&(o=p)}return o},bi.prototype.interfaces_=function(){return[]},bi.prototype.getClass=function(){return bi},bi.snap=function(r,o,c){var p=new Array(2).fill(null),_=new bi(r);p[0]=_.snapTo(o,c);var C=new bi(o);return p[1]=C.snapTo(p[0],c),p},bi.computeOverlaySnapTolerance=function(){if(arguments.length===1){var r=arguments[0],o=bi.computeSizeBasedSnapTolerance(r),c=r.getPrecisionModel();if(c.getType()===Or.FIXED){var p=1/c.getScale()*2/1.415;p>o&&(o=p)}return o}if(arguments.length===2){var _=arguments[0],C=arguments[1];return Math.min(bi.computeOverlaySnapTolerance(_),bi.computeOverlaySnapTolerance(C))}},bi.computeSizeBasedSnapTolerance=function(r){var o=r.getEnvelopeInternal();return Math.min(o.getHeight(),o.getWidth())*bi.SNAP_PRECISION_FACTOR},bi.snapToSelf=function(r,o,c){return new bi(r).snapToSelf(o,c)},Cs.SNAP_PRECISION_FACTOR.get=function(){return 1e-9},Object.defineProperties(bi,Cs);var Fl=function(r){function o(c,p,_){r.call(this),this._snapTolerance=c||null,this._snapPts=p||null,this._isSelfSnap=_!==void 0&&_}return r&&(o.__proto__=r),o.prototype=Object.create(r&&r.prototype),o.prototype.constructor=o,o.prototype.snapLine=function(c,p){var _=new ts(c,this._snapTolerance);return _.setAllowSnappingToSourceVertices(this._isSelfSnap),_.snapTo(p)},o.prototype.transformCoordinates=function(c,p){var _=c.toCoordinateArray(),C=this.snapLine(_,this._snapPts);return this._factory.getCoordinateSequenceFactory().create(C)},o.prototype.interfaces_=function(){return[]},o.prototype.getClass=function(){return o},o}(pn),bn=function(){this._isFirst=!0,this._commonMantissaBitsCount=53,this._commonBits=0,this._commonSignExp=null};bn.prototype.getCommon=function(){return Ft.longBitsToDouble(this._commonBits)},bn.prototype.add=function(r){var o=Ft.doubleToLongBits(r);if(this._isFirst)return this._commonBits=o,this._commonSignExp=bn.signExpBits(this._commonBits),this._isFirst=!1,null;if(bn.signExpBits(o)!==this._commonSignExp)return this._commonBits=0,null;this._commonMantissaBitsCount=bn.numCommonMostSigMantissaBits(this._commonBits,o),this._commonBits=bn.zeroLowerBits(this._commonBits,64-(12+this._commonMantissaBitsCount))},bn.prototype.toString=function(){if(arguments.length===1){var r=arguments[0],o=Ft.longBitsToDouble(r),c="0000000000000000000000000000000000000000000000000000000000000000"+Ft.toBinaryString(r),p=c.substring(c.length-64);return p.substring(0,1)+"  "+p.substring(1,12)+"(exp) "+p.substring(12)+" [ "+o+" ]"}},bn.prototype.interfaces_=function(){return[]},bn.prototype.getClass=function(){return bn},bn.getBit=function(r,o){return r&1<<o?1:0},bn.signExpBits=function(r){return r>>52},bn.zeroLowerBits=function(r,o){return r&~((1<<o)-1)},bn.numCommonMostSigMantissaBits=function(r,o){for(var c=0,p=52;p>=0;p--){if(bn.getBit(r,p)!==bn.getBit(o,p))return c;c++}return 52};var So=function(){this._commonCoord=null,this._ccFilter=new Gs},ia={CommonCoordinateFilter:{configurable:!0},Translater:{configurable:!0}};So.prototype.addCommonBits=function(r){var o=new Fo(this._commonCoord);r.apply(o),r.geometryChanged()},So.prototype.removeCommonBits=function(r){if(this._commonCoord.x===0&&this._commonCoord.y===0)return r;var o=new yt(this._commonCoord);o.x=-o.x,o.y=-o.y;var c=new Fo(o);return r.apply(c),r.geometryChanged(),r},So.prototype.getCommonCoordinate=function(){return this._commonCoord},So.prototype.add=function(r){r.apply(this._ccFilter),this._commonCoord=this._ccFilter.getCommonCoordinate()},So.prototype.interfaces_=function(){return[]},So.prototype.getClass=function(){return So},ia.CommonCoordinateFilter.get=function(){return Gs},ia.Translater.get=function(){return Fo},Object.defineProperties(So,ia);var Gs=function(){this._commonBitsX=new bn,this._commonBitsY=new bn};Gs.prototype.filter=function(r){this._commonBitsX.add(r.x),this._commonBitsY.add(r.y)},Gs.prototype.getCommonCoordinate=function(){return new yt(this._commonBitsX.getCommon(),this._commonBitsY.getCommon())},Gs.prototype.interfaces_=function(){return[Fr]},Gs.prototype.getClass=function(){return Gs};var Fo=function(){this.trans=null;var r=arguments[0];this.trans=r};Fo.prototype.filter=function(r,o){var c=r.getOrdinate(o,0)+this.trans.x,p=r.getOrdinate(o,1)+this.trans.y;r.setOrdinate(o,0,c),r.setOrdinate(o,1,p)},Fo.prototype.isDone=function(){return!1},Fo.prototype.isGeometryChanged=function(){return!0},Fo.prototype.interfaces_=function(){return[an]},Fo.prototype.getClass=function(){return Fo};var Yi=function(r,o){this._geom=new Array(2).fill(null),this._snapTolerance=null,this._cbr=null,this._geom[0]=r,this._geom[1]=o,this.computeSnapTolerance()};Yi.prototype.selfSnap=function(r){return new bi(r).snapTo(r,this._snapTolerance)},Yi.prototype.removeCommonBits=function(r){this._cbr=new So,this._cbr.add(r[0]),this._cbr.add(r[1]);var o=new Array(2).fill(null);return o[0]=this._cbr.removeCommonBits(r[0].copy()),o[1]=this._cbr.removeCommonBits(r[1].copy()),o},Yi.prototype.prepareResult=function(r){return this._cbr.addCommonBits(r),r},Yi.prototype.getResultGeometry=function(r){var o=this.snap(this._geom),c=cr.overlayOp(o[0],o[1],r);return this.prepareResult(c)},Yi.prototype.checkValid=function(r){r.isValid()||Br.out.println("Snapped geometry is invalid")},Yi.prototype.computeSnapTolerance=function(){this._snapTolerance=bi.computeOverlaySnapTolerance(this._geom[0],this._geom[1])},Yi.prototype.snap=function(r){var o=this.removeCommonBits(r);return bi.snap(o[0],o[1],this._snapTolerance)},Yi.prototype.interfaces_=function(){return[]},Yi.prototype.getClass=function(){return Yi},Yi.overlayOp=function(r,o,c){return new Yi(r,o).getResultGeometry(c)},Yi.union=function(r,o){return Yi.overlayOp(r,o,cr.UNION)},Yi.intersection=function(r,o){return Yi.overlayOp(r,o,cr.INTERSECTION)},Yi.symDifference=function(r,o){return Yi.overlayOp(r,o,cr.SYMDIFFERENCE)},Yi.difference=function(r,o){return Yi.overlayOp(r,o,cr.DIFFERENCE)};var wn=function(r,o){this._geom=new Array(2).fill(null),this._geom[0]=r,this._geom[1]=o};wn.prototype.getResultGeometry=function(r){var o=null,c=!1,p=null;try{o=cr.overlayOp(this._geom[0],this._geom[1],r),c=!0}catch(_){if(!(_ instanceof zt))throw _;p=_}if(!c)try{o=Yi.overlayOp(this._geom[0],this._geom[1],r)}catch(_){throw _ instanceof zt?p:_}return o},wn.prototype.interfaces_=function(){return[]},wn.prototype.getClass=function(){return wn},wn.overlayOp=function(r,o,c){return new wn(r,o).getResultGeometry(c)},wn.union=function(r,o){return wn.overlayOp(r,o,cr.UNION)},wn.intersection=function(r,o){return wn.overlayOp(r,o,cr.INTERSECTION)},wn.symDifference=function(r,o){return wn.overlayOp(r,o,cr.SYMDIFFERENCE)},wn.difference=function(r,o){return wn.overlayOp(r,o,cr.DIFFERENCE)};var na=function(){this.mce=null,this.chainIndex=null;var r=arguments[0],o=arguments[1];this.mce=r,this.chainIndex=o};na.prototype.computeIntersections=function(r,o){this.mce.computeIntersectsForChain(this.chainIndex,r.mce,r.chainIndex,o)},na.prototype.interfaces_=function(){return[]},na.prototype.getClass=function(){return na};var Le=function r(){if(this._label=null,this._xValue=null,this._eventType=null,this._insertEvent=null,this._deleteEventIndex=null,this._obj=null,arguments.length===2){var o=arguments[0],c=arguments[1];this._eventType=r.DELETE,this._xValue=o,this._insertEvent=c}else if(arguments.length===3){var p=arguments[0],_=arguments[1],C=arguments[2];this._eventType=r.INSERT,this._label=p,this._xValue=_,this._obj=C}},Uo={INSERT:{configurable:!0},DELETE:{configurable:!0}};Le.prototype.isDelete=function(){return this._eventType===Le.DELETE},Le.prototype.setDeleteEventIndex=function(r){this._deleteEventIndex=r},Le.prototype.getObject=function(){return this._obj},Le.prototype.compareTo=function(r){var o=r;return this._xValue<o._xValue?-1:this._xValue>o._xValue?1:this._eventType<o._eventType?-1:this._eventType>o._eventType?1:0},Le.prototype.getInsertEvent=function(){return this._insertEvent},Le.prototype.isInsert=function(){return this._eventType===Le.INSERT},Le.prototype.isSameLabel=function(r){return this._label!==null&&this._label===r._label},Le.prototype.getDeleteEventIndex=function(){return this._deleteEventIndex},Le.prototype.interfaces_=function(){return[de]},Le.prototype.getClass=function(){return Le},Uo.INSERT.get=function(){return 1},Uo.DELETE.get=function(){return 2},Object.defineProperties(Le,Uo);var rl=function(){};rl.prototype.interfaces_=function(){return[]},rl.prototype.getClass=function(){return rl};var tn=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._properIntersectionPoint=null,this._li=null,this._includeProper=null,this._recordIsolated=null,this._isSelfIntersection=null,this._numIntersections=0,this.numTests=0,this._bdyNodes=null,this._isDone=!1,this._isDoneWhenProperInt=!1;var r=arguments[0],o=arguments[1],c=arguments[2];this._li=r,this._includeProper=o,this._recordIsolated=c};tn.prototype.isTrivialIntersection=function(r,o,c,p){if(r===c&&this._li.getIntersectionNum()===1){if(tn.isAdjacentSegments(o,p))return!0;if(r.isClosed()){var _=r.getNumPoints()-1;if(o===0&&p===_||p===0&&o===_)return!0}}return!1},tn.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint},tn.prototype.setIsDoneIfProperInt=function(r){this._isDoneWhenProperInt=r},tn.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior},tn.prototype.isBoundaryPointInternal=function(r,o){for(var c=o.iterator();c.hasNext();){var p=c.next().getCoordinate();if(r.isIntersection(p))return!0}return!1},tn.prototype.hasProperIntersection=function(){return this._hasProper},tn.prototype.hasIntersection=function(){return this._hasIntersection},tn.prototype.isDone=function(){return this._isDone},tn.prototype.isBoundaryPoint=function(r,o){return o!==null&&(!!this.isBoundaryPointInternal(r,o[0])||!!this.isBoundaryPointInternal(r,o[1]))},tn.prototype.setBoundaryNodes=function(r,o){this._bdyNodes=new Array(2).fill(null),this._bdyNodes[0]=r,this._bdyNodes[1]=o},tn.prototype.addIntersections=function(r,o,c,p){if(r===c&&o===p)return null;this.numTests++;var _=r.getCoordinates()[o],C=r.getCoordinates()[o+1],R=c.getCoordinates()[p],$=c.getCoordinates()[p+1];this._li.computeIntersection(_,C,R,$),this._li.hasIntersection()&&(this._recordIsolated&&(r.setIsolated(!1),c.setIsolated(!1)),this._numIntersections++,this.isTrivialIntersection(r,o,c,p)||(this._hasIntersection=!0,!this._includeProper&&this._li.isProper()||(r.addIntersections(this._li,o,0),c.addIntersections(this._li,p,1)),this._li.isProper()&&(this._properIntersectionPoint=this._li.getIntersection(0).copy(),this._hasProper=!0,this._isDoneWhenProperInt&&(this._isDone=!0),this.isBoundaryPoint(this._li,this._bdyNodes)||(this._hasProperInterior=!0))))},tn.prototype.interfaces_=function(){return[]},tn.prototype.getClass=function(){return tn},tn.isAdjacentSegments=function(r,o){return Math.abs(r-o)===1};var il=function(r){function o(){r.call(this),this.events=new et,this.nOverlaps=null}return r&&(o.__proto__=r),o.prototype=Object.create(r&&r.prototype),o.prototype.constructor=o,o.prototype.prepareEvents=function(){Do.sort(this.events);for(var c=0;c<this.events.size();c++){var p=this.events.get(c);p.isDelete()&&p.getInsertEvent().setDeleteEventIndex(c)}},o.prototype.computeIntersections=function(){if(arguments.length===1){var c=arguments[0];this.nOverlaps=0,this.prepareEvents();for(var p=0;p<this.events.size();p++){var _=this.events.get(p);if(_.isInsert()&&this.processOverlaps(p,_.getDeleteEventIndex(),_,c),c.isDone())break}}else if(arguments.length===3){if(arguments[2]instanceof tn&&Ne(arguments[0],ut)&&Ne(arguments[1],ut)){var C=arguments[0],R=arguments[1],$=arguments[2];this.addEdges(C,C),this.addEdges(R,R),this.computeIntersections($)}else if(typeof arguments[2]=="boolean"&&Ne(arguments[0],ut)&&arguments[1]instanceof tn){var rt=arguments[0],bt=arguments[1];arguments[2]?this.addEdges(rt,null):this.addEdges(rt),this.computeIntersections(bt)}}},o.prototype.addEdge=function(c,p){for(var _=c.getMonotoneChainEdge(),C=_.getStartIndexes(),R=0;R<C.length-1;R++){var $=new na(_,R),rt=new Le(p,_.getMinX(R),$);this.events.add(rt),this.events.add(new Le(_.getMaxX(R),rt))}},o.prototype.processOverlaps=function(c,p,_,C){for(var R=_.getObject(),$=c;$<p;$++){var rt=this.events.get($);if(rt.isInsert()){var bt=rt.getObject();_.isSameLabel(rt)||(R.computeIntersections(bt,C),this.nOverlaps++)}}},o.prototype.addEdges=function(){if(arguments.length===1)for(var c=arguments[0].iterator();c.hasNext();){var p=c.next();this.addEdge(p,p)}else if(arguments.length===2)for(var _=arguments[0],C=arguments[1],R=_.iterator();R.hasNext();){var $=R.next();this.addEdge($,C)}},o.prototype.interfaces_=function(){return[]},o.prototype.getClass=function(){return o},o}(rl),wi=function(){this._min=Ft.POSITIVE_INFINITY,this._max=Ft.NEGATIVE_INFINITY},Ba={NodeComparator:{configurable:!0}};wi.prototype.getMin=function(){return this._min},wi.prototype.intersects=function(r,o){return!(this._min>o||this._max<r)},wi.prototype.getMax=function(){return this._max},wi.prototype.toString=function(){return ii.toLineString(new yt(this._min,0),new yt(this._max,0))},wi.prototype.interfaces_=function(){return[]},wi.prototype.getClass=function(){return wi},Ba.NodeComparator.get=function(){return oa},Object.defineProperties(wi,Ba);var oa=function(){};oa.prototype.compare=function(r,o){var c=r,p=o,_=(c._min+c._max)/2,C=(p._min+p._max)/2;return _<C?-1:_>C?1:0},oa.prototype.interfaces_=function(){return[$t]},oa.prototype.getClass=function(){return oa};var Ul=function(r){function o(){r.call(this),this._item=null;var c=arguments[0],p=arguments[1],_=arguments[2];this._min=c,this._max=p,this._item=_}return r&&(o.__proto__=r),o.prototype=Object.create(r&&r.prototype),o.prototype.constructor=o,o.prototype.query=function(c,p,_){if(!this.intersects(c,p))return null;_.visitItem(this._item)},o.prototype.interfaces_=function(){return[]},o.prototype.getClass=function(){return o},o}(wi),bl=function(r){function o(){r.call(this),this._node1=null,this._node2=null;var c=arguments[0],p=arguments[1];this._node1=c,this._node2=p,this.buildExtent(this._node1,this._node2)}return r&&(o.__proto__=r),o.prototype=Object.create(r&&r.prototype),o.prototype.constructor=o,o.prototype.buildExtent=function(c,p){this._min=Math.min(c._min,p._min),this._max=Math.max(c._max,p._max)},o.prototype.query=function(c,p,_){if(!this.intersects(c,p))return null;this._node1!==null&&this._node1.query(c,p,_),this._node2!==null&&this._node2.query(c,p,_)},o.prototype.interfaces_=function(){return[]},o.prototype.getClass=function(){return o},o}(wi),es=function(){this._leaves=new et,this._root=null,this._level=0};es.prototype.buildTree=function(){Do.sort(this._leaves,new wi.NodeComparator);for(var r=this._leaves,o=null,c=new et;;){if(this.buildLevel(r,c),c.size()===1)return c.get(0);o=r,r=c,c=o}},es.prototype.insert=function(r,o,c){if(this._root!==null)throw new Error("Index cannot be added to once it has been queried");this._leaves.add(new Ul(r,o,c))},es.prototype.query=function(r,o,c){this.init(),this._root.query(r,o,c)},es.prototype.buildRoot=function(){if(this._root!==null)return null;this._root=this.buildTree()},es.prototype.printNode=function(r){Br.out.println(ii.toLineString(new yt(r._min,this._level),new yt(r._max,this._level)))},es.prototype.init=function(){if(this._root!==null)return null;this.buildRoot()},es.prototype.buildLevel=function(r,o){this._level++,o.clear();for(var c=0;c<r.size();c+=2){var p=r.get(c);if((c+1<r.size()?r.get(c):null)===null)o.add(p);else{var _=new bl(r.get(c),r.get(c+1));o.add(_)}}},es.prototype.interfaces_=function(){return[]},es.prototype.getClass=function(){return es};var js=function(){this._items=new et};js.prototype.visitItem=function(r){this._items.add(r)},js.prototype.getItems=function(){return this._items},js.prototype.interfaces_=function(){return[ps]},js.prototype.getClass=function(){return js};var ys=function(){this._index=null;var r=arguments[0];if(!Ne(r,Gn))throw new Et("Argument must be Polygonal");this._index=new qs(r)},nl={SegmentVisitor:{configurable:!0},IntervalIndexedGeometry:{configurable:!0}};ys.prototype.locate=function(r){var o=new pe(r),c=new Fa(o);return this._index.query(r.y,r.y,c),o.getLocation()},ys.prototype.interfaces_=function(){return[Qs]},ys.prototype.getClass=function(){return ys},nl.SegmentVisitor.get=function(){return Fa},nl.IntervalIndexedGeometry.get=function(){return qs},Object.defineProperties(ys,nl);var Fa=function(){this._counter=null;var r=arguments[0];this._counter=r};Fa.prototype.visitItem=function(r){var o=r;this._counter.countSegment(o.getCoordinate(0),o.getCoordinate(1))},Fa.prototype.interfaces_=function(){return[ps]},Fa.prototype.getClass=function(){return Fa};var qs=function(){this._index=new es;var r=arguments[0];this.init(r)};qs.prototype.init=function(r){for(var o=Wi.getLines(r).iterator();o.hasNext();){var c=o.next().getCoordinates();this.addLine(c)}},qs.prototype.addLine=function(r){for(var o=1;o<r.length;o++){var c=new Ke(r[o-1],r[o]),p=Math.min(c.p0.y,c.p1.y),_=Math.max(c.p0.y,c.p1.y);this._index.insert(p,_,c)}},qs.prototype.query=function(){if(arguments.length===2){var r=arguments[0],o=arguments[1],c=new js;return this._index.query(r,o,c),c.getItems()}if(arguments.length===3){var p=arguments[0],_=arguments[1],C=arguments[2];this._index.query(p,_,C)}},qs.prototype.interfaces_=function(){return[]},qs.prototype.getClass=function(){return qs};var Ms=function(r){function o(){if(r.call(this),this._parentGeom=null,this._lineEdgeMap=new kl,this._boundaryNodeRule=null,this._useBoundaryDeterminationRule=!0,this._argIndex=null,this._boundaryNodes=null,this._hasTooFewPoints=!1,this._invalidPoint=null,this._areaPtLocator=null,this._ptLocator=new ko,arguments.length===2){var c=arguments[0],p=arguments[1],_=gr.OGC_SFS_BOUNDARY_RULE;this._argIndex=c,this._parentGeom=p,this._boundaryNodeRule=_,p!==null&&this.add(p)}else if(arguments.length===3){var C=arguments[0],R=arguments[1],$=arguments[2];this._argIndex=C,this._parentGeom=R,this._boundaryNodeRule=$,R!==null&&this.add(R)}}return r&&(o.__proto__=r),o.prototype=Object.create(r&&r.prototype),o.prototype.constructor=o,o.prototype.insertBoundaryPoint=function(c,p){var _=this._nodes.addNode(p).getLabel(),C=1;wt.NONE,_.getLocation(c,Ae.ON)===wt.BOUNDARY&&C++;var R=o.determineBoundary(this._boundaryNodeRule,C);_.setLocation(c,R)},o.prototype.computeSelfNodes=function(){if(arguments.length===2){var c=arguments[0],p=arguments[1];return this.computeSelfNodes(c,p,!1)}if(arguments.length===3){var _=arguments[0],C=arguments[1],R=arguments[2],$=new tn(_,!0,!1);$.setIsDoneIfProperInt(R);var rt=this.createEdgeSetIntersector(),bt=this._parentGeom instanceof Po||this._parentGeom instanceof ai||this._parentGeom instanceof Zn,Yt=C||!bt;return rt.computeIntersections(this._edges,$,Yt),this.addSelfIntersectionNodes(this._argIndex),$}},o.prototype.computeSplitEdges=function(c){for(var p=this._edges.iterator();p.hasNext();)p.next().eiList.addSplitEdges(c)},o.prototype.computeEdgeIntersections=function(c,p,_){var C=new tn(p,_,!0);return C.setBoundaryNodes(this.getBoundaryNodes(),c.getBoundaryNodes()),this.createEdgeSetIntersector().computeIntersections(this._edges,c._edges,C),C},o.prototype.getGeometry=function(){return this._parentGeom},o.prototype.getBoundaryNodeRule=function(){return this._boundaryNodeRule},o.prototype.hasTooFewPoints=function(){return this._hasTooFewPoints},o.prototype.addPoint=function(){if(arguments[0]instanceof Ln){var c=arguments[0].getCoordinate();this.insertPoint(this._argIndex,c,wt.INTERIOR)}else if(arguments[0]instanceof yt){var p=arguments[0];this.insertPoint(this._argIndex,p,wt.INTERIOR)}},o.prototype.addPolygon=function(c){this.addPolygonRing(c.getExteriorRing(),wt.EXTERIOR,wt.INTERIOR);for(var p=0;p<c.getNumInteriorRing();p++){var _=c.getInteriorRingN(p);this.addPolygonRing(_,wt.INTERIOR,wt.EXTERIOR)}},o.prototype.addEdge=function(c){this.insertEdge(c);var p=c.getCoordinates();this.insertPoint(this._argIndex,p[0],wt.BOUNDARY),this.insertPoint(this._argIndex,p[p.length-1],wt.BOUNDARY)},o.prototype.addLineString=function(c){var p=Tt.removeRepeatedPoints(c.getCoordinates());if(p.length<2)return this._hasTooFewPoints=!0,this._invalidPoint=p[0],null;var _=new za(p,new qr(this._argIndex,wt.INTERIOR));this._lineEdgeMap.put(c,_),this.insertEdge(_),Z.isTrue(p.length>=2,"found LineString with single point"),this.insertBoundaryPoint(this._argIndex,p[0]),this.insertBoundaryPoint(this._argIndex,p[p.length-1])},o.prototype.getInvalidPoint=function(){return this._invalidPoint},o.prototype.getBoundaryPoints=function(){for(var c=this.getBoundaryNodes(),p=new Array(c.size()).fill(null),_=0,C=c.iterator();C.hasNext();){var R=C.next();p[_++]=R.getCoordinate().copy()}return p},o.prototype.getBoundaryNodes=function(){return this._boundaryNodes===null&&(this._boundaryNodes=this._nodes.getBoundaryNodes(this._argIndex)),this._boundaryNodes},o.prototype.addSelfIntersectionNode=function(c,p,_){if(this.isBoundaryNode(c,p))return null;_===wt.BOUNDARY&&this._useBoundaryDeterminationRule?this.insertBoundaryPoint(c,p):this.insertPoint(c,p,_)},o.prototype.addPolygonRing=function(c,p,_){if(c.isEmpty())return null;var C=Tt.removeRepeatedPoints(c.getCoordinates());if(C.length<4)return this._hasTooFewPoints=!0,this._invalidPoint=C[0],null;var R=p,$=_;kt.isCCW(C)&&(R=_,$=p);var rt=new za(C,new qr(this._argIndex,wt.BOUNDARY,R,$));this._lineEdgeMap.put(c,rt),this.insertEdge(rt),this.insertPoint(this._argIndex,C[0],wt.BOUNDARY)},o.prototype.insertPoint=function(c,p,_){var C=this._nodes.addNode(p),R=C.getLabel();R===null?C._label=new qr(c,_):R.setLocation(c,_)},o.prototype.createEdgeSetIntersector=function(){return new il},o.prototype.addSelfIntersectionNodes=function(c){for(var p=this._edges.iterator();p.hasNext();)for(var _=p.next(),C=_.getLabel().getLocation(c),R=_.eiList.iterator();R.hasNext();){var $=R.next();this.addSelfIntersectionNode(c,$.coord,C)}},o.prototype.add=function(){if(arguments.length!==1)return r.prototype.add.apply(this,arguments);var c=arguments[0];if(c.isEmpty())return null;if(c instanceof Zn&&(this._useBoundaryDeterminationRule=!1),c instanceof ai)this.addPolygon(c);else if(c instanceof fi)this.addLineString(c);else if(c instanceof Ln)this.addPoint(c);else if(c instanceof Hs)this.addCollection(c);else if(c instanceof ln)this.addCollection(c);else if(c instanceof Zn)this.addCollection(c);else{if(!(c instanceof Kr))throw new Error(c.getClass().getName());this.addCollection(c)}},o.prototype.addCollection=function(c){for(var p=0;p<c.getNumGeometries();p++){var _=c.getGeometryN(p);this.add(_)}},o.prototype.locate=function(c){return Ne(this._parentGeom,Gn)&&this._parentGeom.getNumGeometries()>50?(this._areaPtLocator===null&&(this._areaPtLocator=new ys(this._parentGeom)),this._areaPtLocator.locate(c)):this._ptLocator.locate(c,this._parentGeom)},o.prototype.findEdge=function(){if(arguments.length===1){var c=arguments[0];return this._lineEdgeMap.get(c)}return r.prototype.findEdge.apply(this,arguments)},o.prototype.interfaces_=function(){return[]},o.prototype.getClass=function(){return o},o.determineBoundary=function(c,p){return c.isInBoundary(p)?wt.BOUNDARY:wt.INTERIOR},o}(li),sa=function(){if(this._li=new Dt,this._resultPrecisionModel=null,this._arg=null,arguments.length===1){var r=arguments[0];this.setComputationPrecision(r.getPrecisionModel()),this._arg=new Array(1).fill(null),this._arg[0]=new Ms(0,r)}else if(arguments.length===2){var o=arguments[0],c=arguments[1],p=gr.OGC_SFS_BOUNDARY_RULE;o.getPrecisionModel().compareTo(c.getPrecisionModel())>=0?this.setComputationPrecision(o.getPrecisionModel()):this.setComputationPrecision(c.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new Ms(0,o,p),this._arg[1]=new Ms(1,c,p)}else if(arguments.length===3){var _=arguments[0],C=arguments[1],R=arguments[2];_.getPrecisionModel().compareTo(C.getPrecisionModel())>=0?this.setComputationPrecision(_.getPrecisionModel()):this.setComputationPrecision(C.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new Ms(0,_,R),this._arg[1]=new Ms(1,C,R)}};sa.prototype.getArgGeometry=function(r){return this._arg[r].getGeometry()},sa.prototype.setComputationPrecision=function(r){this._resultPrecisionModel=r,this._li.setPrecisionModel(this._resultPrecisionModel)},sa.prototype.interfaces_=function(){return[]},sa.prototype.getClass=function(){return sa};var As=function(){};As.prototype.interfaces_=function(){return[]},As.prototype.getClass=function(){return As},As.map=function(){if(arguments[0]instanceof Me&&Ne(arguments[1],As.MapOp)){for(var r=arguments[0],o=arguments[1],c=new et,p=0;p<r.getNumGeometries();p++){var _=o.map(r.getGeometryN(p));_!==null&&c.add(_)}return r.getFactory().buildGeometry(c)}if(Ne(arguments[0],X)&&Ne(arguments[1],As.MapOp)){for(var C=arguments[0],R=arguments[1],$=new et,rt=C.iterator();rt.hasNext();){var bt=rt.next(),Yt=R.map(bt);Yt!==null&&$.add(Yt)}return $}},As.MapOp=function(){};var cr=function(r){function o(){var c=arguments[0],p=arguments[1];r.call(this,c,p),this._ptLocator=new ko,this._geomFact=null,this._resultGeom=null,this._graph=null,this._edgeList=new fo,this._resultPolyList=new et,this._resultLineList=new et,this._resultPointList=new et,this._graph=new li(new ou),this._geomFact=c.getFactory()}return r&&(o.__proto__=r),o.prototype=Object.create(r&&r.prototype),o.prototype.constructor=o,o.prototype.insertUniqueEdge=function(c){var p=this._edgeList.findEqualEdge(c);if(p!==null){var _=p.getLabel(),C=c.getLabel();p.isPointwiseEqual(c)||(C=new qr(c.getLabel())).flip();var R=p.getDepth();R.isNull()&&R.add(_),R.add(C),_.merge(C)}else this._edgeList.add(c)},o.prototype.getGraph=function(){return this._graph},o.prototype.cancelDuplicateResultEdges=function(){for(var c=this._graph.getEdgeEnds().iterator();c.hasNext();){var p=c.next(),_=p.getSym();p.isInResult()&&_.isInResult()&&(p.setInResult(!1),_.setInResult(!1))}},o.prototype.isCoveredByLA=function(c){return!!this.isCovered(c,this._resultLineList)||!!this.isCovered(c,this._resultPolyList)},o.prototype.computeGeometry=function(c,p,_,C){var R=new et;return R.addAll(c),R.addAll(p),R.addAll(_),R.isEmpty()?o.createEmptyResult(C,this._arg[0].getGeometry(),this._arg[1].getGeometry(),this._geomFact):this._geomFact.buildGeometry(R)},o.prototype.mergeSymLabels=function(){for(var c=this._graph.getNodes().iterator();c.hasNext();)c.next().getEdges().mergeSymLabels()},o.prototype.isCovered=function(c,p){for(var _=p.iterator();_.hasNext();){var C=_.next();if(this._ptLocator.locate(c,C)!==wt.EXTERIOR)return!0}return!1},o.prototype.replaceCollapsedEdges=function(){for(var c=new et,p=this._edgeList.iterator();p.hasNext();){var _=p.next();_.isCollapsed()&&(p.remove(),c.add(_.getCollapsedEdge()))}this._edgeList.addAll(c)},o.prototype.updateNodeLabelling=function(){for(var c=this._graph.getNodes().iterator();c.hasNext();){var p=c.next(),_=p.getEdges().getLabel();p.getLabel().merge(_)}},o.prototype.getResultGeometry=function(c){return this.computeOverlay(c),this._resultGeom},o.prototype.insertUniqueEdges=function(c){for(var p=c.iterator();p.hasNext();){var _=p.next();this.insertUniqueEdge(_)}},o.prototype.computeOverlay=function(c){this.copyPoints(0),this.copyPoints(1),this._arg[0].computeSelfNodes(this._li,!1),this._arg[1].computeSelfNodes(this._li,!1),this._arg[0].computeEdgeIntersections(this._arg[1],this._li,!0);var p=new et;this._arg[0].computeSplitEdges(p),this._arg[1].computeSplitEdges(p),this.insertUniqueEdges(p),this.computeLabelsFromDepths(),this.replaceCollapsedEdges(),Lr.checkValid(this._edgeList.getEdges()),this._graph.addEdges(this._edgeList.getEdges()),this.computeLabelling(),this.labelIncompleteNodes(),this.findResultAreaEdges(c),this.cancelDuplicateResultEdges();var _=new jn(this._geomFact);_.add(this._graph),this._resultPolyList=_.getPolygons();var C=new Bo(this,this._geomFact,this._ptLocator);this._resultLineList=C.build(c);var R=new Ss(this,this._geomFact,this._ptLocator);this._resultPointList=R.build(c),this._resultGeom=this.computeGeometry(this._resultPointList,this._resultLineList,this._resultPolyList,c)},o.prototype.labelIncompleteNode=function(c,p){var _=this._ptLocator.locate(c.getCoordinate(),this._arg[p].getGeometry());c.getLabel().setLocation(p,_)},o.prototype.copyPoints=function(c){for(var p=this._arg[c].getNodeIterator();p.hasNext();){var _=p.next();this._graph.addNode(_.getCoordinate()).setLabel(c,_.getLabel().getLocation(c))}},o.prototype.findResultAreaEdges=function(c){for(var p=this._graph.getEdgeEnds().iterator();p.hasNext();){var _=p.next(),C=_.getLabel();C.isArea()&&!_.isInteriorAreaEdge()&&o.isResultOfOp(C.getLocation(0,Ae.RIGHT),C.getLocation(1,Ae.RIGHT),c)&&_.setInResult(!0)}},o.prototype.computeLabelsFromDepths=function(){for(var c=this._edgeList.iterator();c.hasNext();){var p=c.next(),_=p.getLabel(),C=p.getDepth();if(!C.isNull()){C.normalize();for(var R=0;R<2;R++)_.isNull(R)||!_.isArea()||C.isNull(R)||(C.getDelta(R)===0?_.toLine(R):(Z.isTrue(!C.isNull(R,Ae.LEFT),"depth of LEFT side has not been initialized"),_.setLocation(R,Ae.LEFT,C.getLocation(R,Ae.LEFT)),Z.isTrue(!C.isNull(R,Ae.RIGHT),"depth of RIGHT side has not been initialized"),_.setLocation(R,Ae.RIGHT,C.getLocation(R,Ae.RIGHT))))}}},o.prototype.computeLabelling=function(){for(var c=this._graph.getNodes().iterator();c.hasNext();)c.next().getEdges().computeLabelling(this._arg);this.mergeSymLabels(),this.updateNodeLabelling()},o.prototype.labelIncompleteNodes=function(){for(var c=this._graph.getNodes().iterator();c.hasNext();){var p=c.next(),_=p.getLabel();p.isIsolated()&&(_.isNull(0)?this.labelIncompleteNode(p,0):this.labelIncompleteNode(p,1)),p.getEdges().updateLabelling(_)}},o.prototype.isCoveredByA=function(c){return!!this.isCovered(c,this._resultPolyList)},o.prototype.interfaces_=function(){return[]},o.prototype.getClass=function(){return o},o}(sa);cr.overlayOp=function(r,o,c){return new cr(r,o).getResultGeometry(c)},cr.intersection=function(r,o){if(r.isEmpty()||o.isEmpty())return cr.createEmptyResult(cr.INTERSECTION,r,o,r.getFactory());if(r.isGeometryCollection()){var c=o;return _s.map(r,{interfaces_:function(){return[As.MapOp]},map:function(p){return p.intersection(c)}})}return r.checkNotGeometryCollection(r),r.checkNotGeometryCollection(o),wn.overlayOp(r,o,cr.INTERSECTION)},cr.symDifference=function(r,o){if(r.isEmpty()||o.isEmpty()){if(r.isEmpty()&&o.isEmpty())return cr.createEmptyResult(cr.SYMDIFFERENCE,r,o,r.getFactory());if(r.isEmpty())return o.copy();if(o.isEmpty())return r.copy()}return r.checkNotGeometryCollection(r),r.checkNotGeometryCollection(o),wn.overlayOp(r,o,cr.SYMDIFFERENCE)},cr.resultDimension=function(r,o,c){var p=o.getDimension(),_=c.getDimension(),C=-1;switch(r){case cr.INTERSECTION:C=Math.min(p,_);break;case cr.UNION:C=Math.max(p,_);break;case cr.DIFFERENCE:C=p;break;case cr.SYMDIFFERENCE:C=Math.max(p,_)}return C},cr.createEmptyResult=function(r,o,c,p){var _=null;switch(cr.resultDimension(r,o,c)){case-1:_=p.createGeometryCollection(new Array(0).fill(null));break;case 0:_=p.createPoint();break;case 1:_=p.createLineString();break;case 2:_=p.createPolygon()}return _},cr.difference=function(r,o){return r.isEmpty()?cr.createEmptyResult(cr.DIFFERENCE,r,o,r.getFactory()):o.isEmpty()?r.copy():(r.checkNotGeometryCollection(r),r.checkNotGeometryCollection(o),wn.overlayOp(r,o,cr.DIFFERENCE))},cr.isResultOfOp=function(){if(arguments.length===2){var r=arguments[0],o=arguments[1],c=r.getLocation(0),p=r.getLocation(1);return cr.isResultOfOp(c,p,o)}if(arguments.length===3){var _=arguments[0],C=arguments[1],R=arguments[2];switch(_===wt.BOUNDARY&&(_=wt.INTERIOR),C===wt.BOUNDARY&&(C=wt.INTERIOR),R){case cr.INTERSECTION:return _===wt.INTERIOR&&C===wt.INTERIOR;case cr.UNION:return _===wt.INTERIOR||C===wt.INTERIOR;case cr.DIFFERENCE:return _===wt.INTERIOR&&C!==wt.INTERIOR;case cr.SYMDIFFERENCE:return _===wt.INTERIOR&&C!==wt.INTERIOR||_!==wt.INTERIOR&&C===wt.INTERIOR}return!1}},cr.INTERSECTION=1,cr.UNION=2,cr.DIFFERENCE=3,cr.SYMDIFFERENCE=4;var rs=function(){this._g=null,this._boundaryDistanceTolerance=null,this._linework=null,this._ptLocator=new ko,this._seg=new Ke;var r=arguments[0],o=arguments[1];this._g=r,this._boundaryDistanceTolerance=o,this._linework=this.extractLinework(r)};rs.prototype.isWithinToleranceOfBoundary=function(r){for(var o=0;o<this._linework.getNumGeometries();o++)for(var c=this._linework.getGeometryN(o).getCoordinateSequence(),p=0;p<c.size()-1;p++)if(c.getCoordinate(p,this._seg.p0),c.getCoordinate(p+1,this._seg.p1),this._seg.distance(r)<=this._boundaryDistanceTolerance)return!0;return!1},rs.prototype.getLocation=function(r){return this.isWithinToleranceOfBoundary(r)?wt.BOUNDARY:this._ptLocator.locate(r,this._g)},rs.prototype.extractLinework=function(r){var o=new Ps;r.apply(o);var c=o.getLinework(),p=lr.toLineStringArray(c);return r.getFactory().createMultiLineString(p)},rs.prototype.interfaces_=function(){return[]},rs.prototype.getClass=function(){return rs};var Ps=function(){this._linework=null,this._linework=new et};Ps.prototype.getLinework=function(){return this._linework},Ps.prototype.filter=function(r){if(r instanceof ai){var o=r;this._linework.add(o.getExteriorRing());for(var c=0;c<o.getNumInteriorRing();c++)this._linework.add(o.getInteriorRingN(c))}},Ps.prototype.interfaces_=function(){return[si]},Ps.prototype.getClass=function(){return Ps};var is=function(){this._g=null,this._doLeft=!0,this._doRight=!0;var r=arguments[0];this._g=r};is.prototype.extractPoints=function(r,o,c){for(var p=r.getCoordinates(),_=0;_<p.length-1;_++)this.computeOffsetPoints(p[_],p[_+1],o,c)},is.prototype.setSidesToGenerate=function(r,o){this._doLeft=r,this._doRight=o},is.prototype.getPoints=function(r){for(var o=new et,c=Wi.getLines(this._g).iterator();c.hasNext();){var p=c.next();this.extractPoints(p,r,o)}return o},is.prototype.computeOffsetPoints=function(r,o,c,p){var _=o.x-r.x,C=o.y-r.y,R=Math.sqrt(_*_+C*C),$=c*_/R,rt=c*C/R,bt=(o.x+r.x)/2,Yt=(o.y+r.y)/2;if(this._doLeft){var Ht=new yt(bt-rt,Yt+$);p.add(Ht)}if(this._doRight){var Re=new yt(bt+rt,Yt-$);p.add(Re)}},is.prototype.interfaces_=function(){return[]},is.prototype.getClass=function(){return is};var Kn=function r(){this._geom=null,this._locFinder=null,this._location=new Array(3).fill(null),this._invalidLocation=null,this._boundaryDistanceTolerance=r.TOLERANCE,this._testCoords=new et;var o=arguments[0],c=arguments[1],p=arguments[2];this._boundaryDistanceTolerance=r.computeBoundaryDistanceTolerance(o,c),this._geom=[o,c,p],this._locFinder=[new rs(this._geom[0],this._boundaryDistanceTolerance),new rs(this._geom[1],this._boundaryDistanceTolerance),new rs(this._geom[2],this._boundaryDistanceTolerance)]},Vl={TOLERANCE:{configurable:!0}};Kn.prototype.reportResult=function(r,o,c){Br.out.println("Overlay result invalid - A:"+wt.toLocationSymbol(o[0])+" B:"+wt.toLocationSymbol(o[1])+" expected:"+(c?"i":"e")+" actual:"+wt.toLocationSymbol(o[2]))},Kn.prototype.isValid=function(r){this.addTestPts(this._geom[0]),this.addTestPts(this._geom[1]);var o=this.checkValid(r);return o},Kn.prototype.checkValid=function(){if(arguments.length===1){for(var r=arguments[0],o=0;o<this._testCoords.size();o++){var c=this._testCoords.get(o);if(!this.checkValid(r,c))return this._invalidLocation=c,!1}return!0}if(arguments.length===2){var p=arguments[0],_=arguments[1];return this._location[0]=this._locFinder[0].getLocation(_),this._location[1]=this._locFinder[1].getLocation(_),this._location[2]=this._locFinder[2].getLocation(_),!!Kn.hasLocation(this._location,wt.BOUNDARY)||this.isValidResult(p,this._location)}},Kn.prototype.addTestPts=function(r){var o=new is(r);this._testCoords.addAll(o.getPoints(5*this._boundaryDistanceTolerance))},Kn.prototype.isValidResult=function(r,o){var c=cr.isResultOfOp(o[0],o[1],r),p=!(c^o[2]===wt.INTERIOR);return p||this.reportResult(r,o,c),p},Kn.prototype.getInvalidLocation=function(){return this._invalidLocation},Kn.prototype.interfaces_=function(){return[]},Kn.prototype.getClass=function(){return Kn},Kn.hasLocation=function(r,o){for(var c=0;c<3;c++)if(r[c]===o)return!0;return!1},Kn.computeBoundaryDistanceTolerance=function(r,o){return Math.min(bi.computeSizeBasedSnapTolerance(r),bi.computeSizeBasedSnapTolerance(o))},Kn.isValid=function(r,o,c,p){return new Kn(r,o,p).isValid(c)},Vl.TOLERANCE.get=function(){return 1e-6},Object.defineProperties(Kn,Vl);var Jn=function r(o){this._geomFactory=null,this._skipEmpty=!1,this._inputGeoms=null,this._geomFactory=r.extractFactory(o),this._inputGeoms=o};Jn.prototype.extractElements=function(r,o){if(r===null)return null;for(var c=0;c<r.getNumGeometries();c++){var p=r.getGeometryN(c);this._skipEmpty&&p.isEmpty()||o.add(p)}},Jn.prototype.combine=function(){for(var r=new et,o=this._inputGeoms.iterator();o.hasNext();){var c=o.next();this.extractElements(c,r)}return r.size()===0?this._geomFactory!==null?this._geomFactory.createGeometryCollection(null):null:this._geomFactory.buildGeometry(r)},Jn.prototype.interfaces_=function(){return[]},Jn.prototype.getClass=function(){return Jn},Jn.combine=function(){if(arguments.length===1){var r=arguments[0];return new Jn(r).combine()}if(arguments.length===2){var o=arguments[0],c=arguments[1];return new Jn(Jn.createList(o,c)).combine()}if(arguments.length===3){var p=arguments[0],_=arguments[1],C=arguments[2];return new Jn(Jn.createList(p,_,C)).combine()}},Jn.extractFactory=function(r){return r.isEmpty()?null:r.iterator().next().getFactory()},Jn.createList=function(){if(arguments.length===2){var r=arguments[0],o=arguments[1],c=new et;return c.add(r),c.add(o),c}if(arguments.length===3){var p=arguments[0],_=arguments[1],C=arguments[2],R=new et;return R.add(p),R.add(_),R.add(C),R}};var Hi=function(){this._inputPolys=null,this._geomFactory=null;var r=arguments[0];this._inputPolys=r,this._inputPolys===null&&(this._inputPolys=new et)},$s={STRTREE_NODE_CAPACITY:{configurable:!0}};Hi.prototype.reduceToGeometries=function(r){for(var o=new et,c=r.iterator();c.hasNext();){var p=c.next(),_=null;Ne(p,ut)?_=this.unionTree(p):p instanceof Me&&(_=p),o.add(_)}return o},Hi.prototype.extractByEnvelope=function(r,o,c){for(var p=new et,_=0;_<o.getNumGeometries();_++){var C=o.getGeometryN(_);C.getEnvelopeInternal().intersects(r)?p.add(C):c.add(C)}return this._geomFactory.buildGeometry(p)},Hi.prototype.unionOptimized=function(r,o){var c=r.getEnvelopeInternal(),p=o.getEnvelopeInternal();if(!c.intersects(p))return Jn.combine(r,o);if(r.getNumGeometries()<=1&&o.getNumGeometries()<=1)return this.unionActual(r,o);var _=c.intersection(p);return this.unionUsingEnvelopeIntersection(r,o,_)},Hi.prototype.union=function(){if(this._inputPolys===null)throw new Error("union() method cannot be called twice");if(this._inputPolys.isEmpty())return null;this._geomFactory=this._inputPolys.iterator().next().getFactory();for(var r=new bs(Hi.STRTREE_NODE_CAPACITY),o=this._inputPolys.iterator();o.hasNext();){var c=o.next();r.insert(c.getEnvelopeInternal(),c)}this._inputPolys=null;var p=r.itemsTree();return this.unionTree(p)},Hi.prototype.binaryUnion=function(){if(arguments.length===1){var r=arguments[0];return this.binaryUnion(r,0,r.size())}if(arguments.length===3){var o=arguments[0],c=arguments[1],p=arguments[2];if(p-c<=1){var _=Hi.getGeometry(o,c);return this.unionSafe(_,null)}if(p-c==2)return this.unionSafe(Hi.getGeometry(o,c),Hi.getGeometry(o,c+1));var C=Math.trunc((p+c)/2),R=this.binaryUnion(o,c,C),$=this.binaryUnion(o,C,p);return this.unionSafe(R,$)}},Hi.prototype.repeatedUnion=function(r){for(var o=null,c=r.iterator();c.hasNext();){var p=c.next();o=o===null?p.copy():o.union(p)}return o},Hi.prototype.unionSafe=function(r,o){return r===null&&o===null?null:r===null?o.copy():o===null?r.copy():this.unionOptimized(r,o)},Hi.prototype.unionActual=function(r,o){return Hi.restrictToPolygons(r.union(o))},Hi.prototype.unionTree=function(r){var o=this.reduceToGeometries(r);return this.binaryUnion(o)},Hi.prototype.unionUsingEnvelopeIntersection=function(r,o,c){var p=new et,_=this.extractByEnvelope(c,r,p),C=this.extractByEnvelope(c,o,p),R=this.unionActual(_,C);return p.add(R),Jn.combine(p)},Hi.prototype.bufferUnion=function(){if(arguments.length===1){var r=arguments[0];return r.get(0).getFactory().buildGeometry(r).buffer(0)}if(arguments.length===2){var o=arguments[0],c=arguments[1];return o.getFactory().createGeometryCollection([o,c]).buffer(0)}},Hi.prototype.interfaces_=function(){return[]},Hi.prototype.getClass=function(){return Hi},Hi.restrictToPolygons=function(r){if(Ne(r,Gn))return r;var o=gs.getPolygons(r);return o.size()===1?o.get(0):r.getFactory().createMultiPolygon(lr.toPolygonArray(o))},Hi.getGeometry=function(r,o){return o>=r.size()?null:r.get(o)},Hi.union=function(r){return new Hi(r).union()},$s.STRTREE_NODE_CAPACITY.get=function(){return 4},Object.defineProperties(Hi,$s);var Ua=function(){};Ua.prototype.interfaces_=function(){return[]},Ua.prototype.getClass=function(){return Ua},Ua.union=function(r,o){if(r.isEmpty()||o.isEmpty()){if(r.isEmpty()&&o.isEmpty())return cr.createEmptyResult(cr.UNION,r,o,r.getFactory());if(r.isEmpty())return o.copy();if(o.isEmpty())return r.copy()}return r.checkNotGeometryCollection(r),r.checkNotGeometryCollection(o),wn.overlayOp(r,o,cr.UNION)},E.GeoJSONReader=bo,E.GeoJSONWriter=Oi,E.OverlayOp=cr,E.UnionOp=Ua,E.BufferOp=yn,Object.defineProperty(E,"__esModule",{value:!0})})})(F_,F_.exports);function Nl(){return new cp}function cp(){this.reset()}cp.prototype={constructor:cp,reset:function(){this.s=this.t=0},add:function(b){U_(tp,b,this.t),U_(this,tp.s,this.s),this.s?this.t+=tp.t:this.s=tp.t},valueOf:function(){return this.s}};var tp=new cp;function U_(b,T,E){var A=b.s=T+E,D=A-T,z=A-D;b.t=T-z+(E-D)}var ld=Math.PI,V_=ld*2;Nl();Nl();Nl();function G_(b,T){return[b>ld?b-V_:b<-ld?b+V_:b,T]}G_.invert=G_;function Hy(b,T){return b<T?-1:b>T?1:b>=T?0:NaN}function Tw(b){return b.length===1&&(b=Iw(b)),{left:function(T,E,A,D){for(A==null&&(A=0),D==null&&(D=T.length);A<D;){var z=A+D>>>1;b(T[z],E)<0?A=z+1:D=z}return A},right:function(T,E,A,D){for(A==null&&(A=0),D==null&&(D=T.length);A<D;){var z=A+D>>>1;b(T[z],E)>0?D=z:A=z+1}return A}}}function Iw(b){return function(T,E){return Hy(b(T),E)}}Tw(Hy);Nl();Nl();Nl();Nl();Nl();function j_(){}j_.prototype={constructor:j_,point:function(b,T){this.stream.point(b,T)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function q_(b,T){return[b,T]}q_.invert=q_;const $_=(b,T,E)=>{const D=yy(T).bbox;let z=[0,0,0,0];if(D.length===4&&(z=D),D.length===6&&(z=[D[0],D[1],D[3],D[4]]),z.some(a=>!isFinite(a))||z[0]<-180||z[1]<-90||z[2]>180||z[3]>90)return;const U=new sy.LngLatBounds(z);b.fitBounds(U,E)},Jw=(b,T,E)=>{let A=null;if(typeof T.source=="string"&&(A=b.getSource(T.source)),A?.type==="geojson"){const D=A._options.data;if(typeof D=="string"){const z=new URL(D),a=new URLSearchParams(z.search).get("bbox");if(a){const G=new sy.LngLatBounds(a.split(",").map(Number));b.fitBounds(G,E)}else fetch(D).then(G=>G.json()).then(G=>{$_(b,G,E)})}else $_(b,D,E)}},Ed={id:{type:String,default:void 0},type:{type:String,default:"fill"},before:String},Sw=rh(Ed),Td={load:b=>b,change:b=>b},Cw=fp(Td);var hp=Object.freeze({__proto__:null,props:Ed,createBindProps:Sw,emits:Td,createOnEmits:Cw}),Zu=eh({name:"VmGeojsonAddLayer",emits:Td,props:Ed,setup(b,{emit:T}){const E=cd(),A=O0(ey),D=op(()=>{var a;return(a=b.id)!=null?a:A.value.id}),z=P0(),U=op(()=>({id:D.value,type:b.type,source:A.value.id}));return E.addLayer(U.value,b.before),Hf("vmLayer",z),Hf("vmGeojsonLayer",z),z.value=E.getLayer(D.value),T("load",{map:E,source:A.value,layer:z.value}),H_(()=>U.value,async(a,G)=>{await K_(),G?ay(E,G.id,a,b.before):E.addLayer(a,b.before),T("change",{map:E,source:A.value,layer:E.getLayer(D.value)}),z.value=E.getLayer(D.value)}),np(()=>{E.getLayer(D.value)&&E.removeLayer(D.value)}),{layer:z}}});function Mw(b,T,E,A,D,z){return b.layer?Yu(b.$slots,"default",{key:0,layer:b.layer}):ty("v-if",!0)}Zu.render=Mw;Zu.__file="geojson-add-layer/src/index.vue";Zu.install=b=>{b.component(Zu.name,Zu)};const Ky={maxzoom:Number,minzoom:Number},Aw=rh(Ky),Jy={},Pw=fp(Jy);var Lw=Object.freeze({__proto__:null,props:Ky,createBindProps:Aw,emits:Jy,createOnEmits:Pw}),Dw=Object.defineProperty,X_=Object.getOwnPropertySymbols,Rw=Object.prototype.hasOwnProperty,Ow=Object.prototype.propertyIsEnumerable,Z_=(b,T,E)=>T in b?Dw(b,T,{enumerable:!0,configurable:!0,writable:!0,value:E}):b[T]=E,Nw=(b,T)=>{for(var E in T||(T={}))Rw.call(T,E)&&Z_(b,E,T[E]);if(X_)for(var E of X_(T))Ow.call(T,E)&&Z_(b,E,T[E]);return b};const Id=Nw({cursor:{type:String,default:""},paint:{type:Object,default:()=>({})}},Lw.props),zw=rh(Id),Sd={click:b=>b},kw=fp(Sd);var pp=Object.freeze({__proto__:null,props:Id,createBindProps:zw,emits:Sd,createOnEmits:kw}),Wu=eh({name:"VmGeojsonLayerSet",props:Id,emits:Sd,setup(b,{emit:T}){const E=z0(),A=cd();Yf(()=>{Reflect.ownKeys(b.paint).forEach(Rt=>{const xt=Rt;xt.startsWith(E.value.type)&&A.setPaintProperty(E.value.id,xt,b.paint[Rt])})}),k0(E,b);class D extends o_{constructor(xt,At){super(),this.event=xt,this.listener=At}add(){A.on(this.event,E.value.id,this.listener),this.removeHandler=()=>{A.off(this.event,E.value.id,this.listener)}}}const z=new D("click",Rt=>{const xt=A.queryRenderedFeatures(Rt.point,{layers:[E.value.id]}),At=xt[0];T("click",{features:xt,feature:At,map:A,layer:E.value,event:Rt})});z.add(),np(()=>{z.remove()});class U extends o_{constructor(){super(...arguments),this.removeHandler=()=>{A.getCanvas().style.cursor=""}}add(){A.getCanvas().style.cursor=b.cursor}remove(){var xt;(xt=this.removeHandler)==null||xt.call(this)}}const a=new U,G=new D("mouseenter",()=>{a.add()}),ot=new D("mouseleave",()=>{a.remove()});return G.add(),ot.add(),np(()=>{G.remove(),ot.remove()}),{layer:E}}});function Bw(b,T,E,A,D,z){return Yu(b.$slots,"default")}Wu.render=Bw;Wu.__file="geojson-layer-set/src/index.vue";Wu.install=b=>{b.component(Wu.name,Wu)};var Fw=Object.defineProperty,Uw=Object.defineProperties,Vw=Object.getOwnPropertyDescriptors,W_=Object.getOwnPropertySymbols,Gw=Object.prototype.hasOwnProperty,jw=Object.prototype.propertyIsEnumerable,Y_=(b,T,E)=>T in b?Fw(b,T,{enumerable:!0,configurable:!0,writable:!0,value:E}):b[T]=E,Zc=(b,T)=>{for(var E in T||(T={}))Gw.call(T,E)&&Y_(b,E,T[E]);if(W_)for(var E of W_(T))jw.call(T,E)&&Y_(b,E,T[E]);return b},qw=(b,T)=>Uw(b,Vw(T));const Cd=qw(Zc(Zc(Zc({},iy.props),hp.props),pp.props),{id:{type:String,default:"geojson-layer"},type:{type:String,default:"fill"}}),$w=rh(Cd),Md=Zc(Zc({},hp.emits),pp.emits),Xw=fp(Md);var Qw=Object.freeze({__proto__:null,props:Cd,createBindProps:$w,emits:Md,createOnEmits:Xw}),Wc=eh({name:"VmGeojsonLayer",components:{VmGeojsonAddLayer:Zu,VmGeojsonSource:Gu,VmGeojsonLayerSet:Wu},emits:Md,props:Cd,setup(b,{emit:T}){const E=iy.createBindProps(b),A=hp.createBindProps(b,["type"]),D=hp.createOnEmits(T),z=pp.createBindProps(b),U=pp.createOnEmits(T),a=op(()=>Reflect.ownKeys(b.paint).some(G=>G.startsWith("fill")));return{sourceBindProps:E,addBindProps:A,addOnEmits:D,setBindProps:z,setOnEmits:U,hasFillSource:a}}});function Zw(b,T,E,A,D,z){const U=ep("VmGeojsonLayerSet"),a=ep("VmGeojsonAddLayer"),G=ep("VmGeojsonSource");return Kf(),J_(Q_,null,[b.hasFillSource?(Kf(),L0(G,Fc({key:0},b.sourceBindProps,{id:b.id+"-fill"}),{default:Lu(()=>[Nu(a,Fc(b.addBindProps,Wh(b.addOnEmits),{id:b.id+"-fill",type:"fill"}),{default:Lu(()=>[Nu(U,Fc(b.setBindProps,Wh(b.setOnEmits)),{default:Lu(()=>[Yu(b.$slots,"fill")]),_:3},16)]),_:3},16,["id"])]),_:3},16,["id"])):ty("v-if",!0),Nu(G,D0(R0(b.sourceBindProps)),{default:Lu(()=>[Nu(a,Fc(b.addBindProps,Wh(b.addOnEmits),{type:b.type}),{default:Lu(()=>[Nu(U,Fc(b.setBindProps,Wh(b.setOnEmits)),{default:Lu(()=>[Yu(b.$slots,"default")]),_:3},16)]),_:3},16,["type"])]),_:3},16)],64)}Wc.render=Zw;Wc.__file="geojson-layer/src/index.vue";Wc.install=b=>{b.component(Wc.name,Wc)};export{N0 as E,z0 as a,k0 as b,ay as c,ey as d,Vu as e,Jw as f,Qw as g,$_ as h,sy as m,Kw as o,Wc as s,cd as u};
