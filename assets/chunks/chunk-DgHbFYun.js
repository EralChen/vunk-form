import{p as E,V as T,c as V,G as F,u as N}from"./chunk-DC95vdEF.js";import{bj as S,d as $,bk as z,ac as j,bl as O,bm as G,bn as M,bo as W,bp as Z,bq as q,aW as X,br as D,bs as Y,M as P,f as r,o as i,g as v,F as R,aZ as a,a as w,I as b,h as g,b as t,w as d,t as B,bt as A,a_ as H,bu as J,a9 as K,O as Q,p as _,m as x,a1 as ee,W as se,i as oe,X as ne,Y as le}from"./chunk-CYWh0Wrq.js";import{N as ae}from"./chunk-Dd5vnLK-.js";import{R as te}from"./chunk-zKPkODU6.js";const ie={...E,...S,tip:{type:String,default:""},preview:{type:Boolean,default:!1},beforeUpload:{type:Function,default:void 0},onDownload:{type:Function,default:void 0}},re={"update:fileList":null,remove:e=>e},de=new te({baseURL:""}),pe=$({components:{ElProgress:z,ElIcon:j,Check:O,ZoomIn:G,Delete:M,Close:W,CircleCheck:Z,Document:q,Download:X},props:{listType:{type:String,default:"text"},file:{type:Object,default:()=>({})},disabled:{type:Boolean,default:!1},onPreview:{type:Function,default:()=>ae},onDownload:{type:Function,default:void 0},preview:{type:Boolean,default:!1}},emits:{remove:e=>e},setup(e,{emit:o}){const m=D("upload"),n=D("icon"),{t:f}=Y();return{handleRemove:(s=e.file)=>{o("remove",s)},t:f,nsIcon:n,nsUpload:m,handleDownload:(s=e.file)=>{if(e.onDownload){e.onDownload(s);return}let c="";s.url?c=s.url:s.raw&&(c=window.URL.createObjectURL(s.raw)),c&&de.download({url:c,fileName:s.name},{method:"GET"})}}}}),ue=["src"];function ce(e,o,m,n,f,y){const l=r("Document"),s=r("el-icon"),c=r("Download"),p=r("el-progress"),u=r("circle-check"),k=r("Check"),h=r("Close"),U=r("zoom-in"),L=r("Delete");return i(),v(R,null,[e.listType==="picture"||e.file.status!=="uploading"&&e.listType==="picture-card"?(i(),v(R,{key:0},[/\.(svg|png|jpg|jpeg)$/.test(e.file.name)?(i(),v("img",{key:0,class:a(e.nsUpload.be("list","item-thumbnail")),src:e.file.url,alt:""},null,10,ue)):(i(),w(l,{key:1}))],64)):b("",!0),e.listType!=="picture"&&(e.file.status==="uploading"||e.listType!=="picture-card")?(i(),v("div",{key:1,class:a(e.nsUpload.be("list","item-info"))},[g("a",{class:a(e.nsUpload.be("list","item-name")),onClick:o[1]||(o[1]=A(I=>e.onPreview(e.file),["prevent"]))},[t(s,{class:a(e.nsIcon.m("document"))},{default:d(()=>[t(l)]),_:1},8,["class"]),t(s,{class:a([e.nsIcon.m("download"),e.nsIcon.m("download-primary")]),onClick:o[0]||(o[0]=I=>e.handleDownload(e.file))},{default:d(()=>[t(c)]),_:1},8,["class"]),g("span",{class:a(e.nsUpload.be("list","item-file-name"))},B(e.file.name),3)],2),e.file.status==="uploading"?(i(),w(p,{key:0,type:e.listType==="picture-card"?"circle":"line","stroke-width":e.listType==="picture-card"?6:2,percentage:Number(e.file.percentage),style:H(e.listType==="picture-card"?"":"margin-top: 0.5rem")},null,8,["type","stroke-width","percentage","style"])):b("",!0)],2)):b("",!0),g("label",{class:a(e.nsUpload.be("list","item-status-label"))},[e.listType==="text"?(i(),w(s,{key:0,class:a([e.nsIcon.m("upload-success"),e.nsIcon.m("circle-check")])},{default:d(()=>[t(u)]),_:1},8,["class"])):["picture-card","picture"].includes(e.listType)?(i(),w(s,{key:1,class:a([e.nsIcon.m("upload-success"),e.nsIcon.m("check")])},{default:d(()=>[t(k)]),_:1},8,["class"])):b("",!0)],2),e.disabled?b("",!0):(i(),w(s,{key:2,class:a(e.nsIcon.m("close")),onClick:o[2]||(o[2]=I=>e.handleRemove(e.file))},{default:d(()=>[t(h)]),_:1},8,["class"])),e.listType==="picture-card"?(i(),v("span",{key:3,class:a(e.nsUpload.be("list","item-actions"))},[e.preview?(i(),v("span",{key:0,class:a(e.nsUpload.be("list","item-preview")),onClick:o[3]||(o[3]=I=>e.onPreview(e.file))},[t(s,{class:a(e.nsIcon.m("zoom-in"))},{default:d(()=>[t(U)]),_:1},8,["class"])],2)):b("",!0),g("span",{class:a(e.nsUpload.be("list","item-download")),onClick:o[4]||(o[4]=I=>e.handleDownload(e.file))},[t(s,{class:a(e.nsIcon.m("download"))},{default:d(()=>[t(c)]),_:1},8,["class"])],2),e.disabled?b("",!0):(i(),v("span",{key:1,class:a(e.nsUpload.be("list","item-delete")),onClick:o[5]||(o[5]=I=>e.handleRemove(e.file))},[t(s,{class:a(e.nsIcon.m("delete"))},{default:d(()=>[t(L)]),_:1},8,["class"])],2))],2)):b("",!0)],64)}const me=P(pe,[["render",ce]]),fe=(e,o,m)=>n=>e(n)?o(n):m(n),ye=(e,o)=>m=>{const n={interval:100,speed:.01,...o,percent:0,timeLine:0,timer:void 0},f=l=>fe(s=>!!s,s=>e(1,s),s=>setInterval(()=>{l.timeLine++,l.percent=s?1:(-1/(l.speed*l.timeLine+1)+1)*1,e(l.percent,s)},l.interval));n.timer=f(n)(m);const y=l=>typeof l!="boolean"?(n.timer&&clearInterval(n.timer),n.percent=1,e(n.percent,"fail"),y):(l&&(n.timer&&clearInterval(n.timer),n.percent=1,e(n.percent,l)),y);return y},be=$({name:"VkfUpload",components:{VkfFormItem:T,ElUpload:J,FileVue:me,ElLink:K},props:ie,emits:re,setup(e,{emit:o}){const m=V(e),n=F(e,["disabled","fileList","beforeUpload","onSuccess"]),f=Q(),y=p=>{f.value?.handleRemove(p),f.value?.abort(p),o("update:fileList",e.fileList)},l=N(e);return{formItemBindProps:m,pickObject:_,coreBindProps:n,uploadRef:f,handleRemove:y,readonly:l,onSuccess:(p,u,k)=>{u.raw.progress(!0),u.percentage=100,u.status="success",e.onSuccess?.(p,u,k)},beforeUpload:async p=>{const u=(k,h)=>{const U=e.fileList.find(L=>L.uid===p.uid);U&&(U.percentage=Number((k*100).toFixed(2)),h===!1&&(U.status="uploading"))};return p.progress=ye(u)(!1),e.beforeUpload?await e.beforeUpload?.(p):!0}}}}),ve={class:"el-upload__tip"};function ke(e,o,m,n,f,y){const l=r("ElLink"),s=r("FileVue"),c=r("ElUpload"),p=r("VkfFormItem");return i(),w(p,ne(le(e.formItemBindProps)),{default:d(()=>[t(c,x(e.coreBindProps,{ref:"uploadRef",class:["vkf-upload",{"is-readonly":e.readonly,"is-empty":e.fileList?.length===0,"is-limit":e.limit&&e.fileList?.length>=e.limit}],"file-list":e.fileList??[],"on-success":e.onSuccess,"before-upload":e.beforeUpload,disabled:e.readonly||e.disabled,"onUpdate:fileList":o[0]||(o[0]=u=>e.$emit("update:fileList",u))}),ee({file:d(({file:u})=>[t(s,{file:u,"list-type":e.listType,disabled:e.readonly||e.disabled,"on-preview":e.onPreview,preview:e.preview,"on-download":e.onDownload,onRemove:e.handleRemove},null,8,["file","list-type","disabled","on-preview","preview","on-download","onRemove"])]),default:d(()=>[se(e.$slots,"default",{},()=>[t(l,{type:"primary"},{default:d(()=>o[1]||(o[1]=[oe(" + 选择文件 ")])),_:1})])]),_:2},[e.tip?{name:"tip",fn:d(()=>[g("div",ve,B(e.tip),1)]),key:"0"}:void 0]),1040,["class","file-list","on-success","before-upload","disabled"]),g("span",{class:a(["vkf-upload-empty-tip",{"is-readonly":e.readonly,"is-empty":e.fileList?.length===0}])},"暂无",2)]),_:3},16)}const C=P(be,[["render",ke]]);C.install=e=>{e.component(C.name,C)};export{C as V};
